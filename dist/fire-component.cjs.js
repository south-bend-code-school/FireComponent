"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var mediumEditor=createCommonjsModule(function(e){var t,n;"classList"in document.createElement("_")||function(e){if("Element"in e){var t=e.Element.prototype,n=Object,r=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},i=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(""===t)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return i.call(e,t)},s=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],i=0,o=n.length;i<o;i++)this.push(n[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},u=s.prototype=[],l=function(){return new s(this)};if(o.prototype=Error.prototype,u.item=function(e){return this[e]||null},u.contains=function(e){return-1!==a(this,e+="")},u.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do{e=t[n]+"",-1===a(this,e)&&(this.push(e),i=!0)}while(++n<r);i&&this._updateClassName()},u.remove=function(){var e,t,n=arguments,r=0,i=n.length,o=!1;do{for(e=n[r]+"",t=a(this,e);-1!==t;)this.splice(t,1),o=!0,t=a(this,e)}while(++r<i);o&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),r=n?!0!==t&&"remove":!1!==t&&"add";return r&&this[r](e),!0===t||!1===t?t:!n},u.toString=function(){return this.join(" ")},n.defineProperty){var c={get:l,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",c)}catch(e){-2146823252===e.number&&(c.enumerable=!1,n.defineProperty(t,"classList",c))}}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",l)}}(self),function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(e){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},i=n.prototype,o=r.prototype,a=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},u="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),l=u.length,c=e.URL||e.webkitURL||e,d=c.createObjectURL,f=c.revokeObjectURL,h=c,m=e.btoa,p=e.atob,g=e.ArrayBuffer,v=e.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(r.fake=o.fake=!0;l--;)s.prototype[u[l]]=l+1;return c.createObjectURL||(h=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(b),n.origin=t&&t[1])),n}),h.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof r?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):d?d.call(c,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(c,e)},i.append=function(e){var n=this.data;if(v&&(e instanceof g||e instanceof v)){for(var i="",o=new v(e),u=0,l=o.length;u<l;u++)i+=String.fromCharCode(o[u]);n.push(i)}else if("Blob"===t(e)||"File"===t(e)){if(!a)throw new s("NOT_READABLE_ERR");var c=new a;n.push(c.readAsBinaryString(e))}else e instanceof r?"base64"===e.encoding&&p?n.push(p(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},o.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},o.toString=function(){return"[object Blob]"},o.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,n){var r=n&&n.type||"",i=new t;if(e)for(var o=0,a=e.length;o<a;o++)Uint8Array&&e[o]instanceof Uint8Array?i.append(e[o].buffer):i.append(e[o]);var s=i.getBlob(r);return!s.slice&&s.webkitSlice&&(s.slice=s.webkitSlice),s};var n=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=n(new e.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||commonjsGlobal.content||commonjsGlobal),t=commonjsGlobal,n=function(){function e(e,t){return this.init(e,t)}var t,n,r,i,o,a,s,u,l,c,d;return e.extensions={},function(t){function n(e,t){var n,r=Array.prototype.slice.call(arguments,2);t=t||{};for(var i=0;i<r.length;i++){var o=r[i];if(o)for(n in o)o.hasOwnProperty(n)&&void 0!==o[n]&&(e||!1===t.hasOwnProperty(n))&&(t[n]=o[n])}return t}var r=!1;try{var i=document.createElement("div"),o=document.createTextNode(" ");i.appendChild(o),r=i.contains(o)}catch(e){}var a={isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),isEdge:null!==/Edge\/\d+/.exec(navigator.userAgent),isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(e){return!!(a.isMac&&e.metaKey||!a.isMac&&e.ctrlKey)},isKey:function(e,t){var n=a.getKeyCode(e);return!1===Array.isArray(t)?n===t:-1!==t.indexOf(n)},getKeyCode:function(e){var t=e.which;return null===t&&(t=null!==e.charCode?e.charCode:e.keyCode),t},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var e=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},defaults:function(){var e=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},createLink:function(e,t,n,r){var i=e.createElement("a");return a.moveTextRangeIntoElement(t[0],t[t.length-1],i),i.setAttribute("href",n),r&&i.setAttribute("target",r),i},findOrCreateMatchingTextNodes:function(e,t,n){for(var r=e.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1),i=[],o=0,s=!1,u=null,l=null;null!==(u=r.nextNode());)if(!(u.nodeType>3))if(3===u.nodeType){if(!s&&n.start<o+u.nodeValue.length&&(s=!0,l=a.splitStartNodeIfNeeded(u,n.start,o)),s&&a.splitEndNodeIfNeeded(u,l,n.end,o),s&&o===n.end)break;if(s&&o>n.end+1)throw new Error("PerformLinking overshot the target!");s&&i.push(l||u),o+=u.nodeValue.length,null!==l&&(o+=l.nodeValue.length,r.nextNode()),l=null}else"img"===u.tagName.toLowerCase()&&(!s&&n.start<=o&&(s=!0),s&&i.push(u));return i},splitStartNodeIfNeeded:function(e,t,n){return t!==n?e.splitText(t-n):null},splitEndNodeIfNeeded:function(e,t,n,r){var i,o;i=r+e.nodeValue.length+(t?t.nodeValue.length:0)-1,o=n-r-(t?e.nodeValue.length:0),i>=n&&r!==i&&0!==o&&(t||e).splitText(o)},splitByBlockElements:function(t){if(3!==t.nodeType&&1!==t.nodeType)return[];var n=[],r=e.util.blockContainerElementNames.join(",");if(3===t.nodeType||0===t.querySelectorAll(r).length)return[t];for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];if(3===o.nodeType)n.push(o);else if(1===o.nodeType){0===o.querySelectorAll(r).length?n.push(o):n=n.concat(e.util.splitByBlockElements(o))}}return n},findAdjacentTextNodeWithContent:function(e,t,n){var r,i=!1,o=n.createNodeIterator(e,NodeFilter.SHOW_TEXT,null,!1);for(r=o.nextNode();r;){if(r===t)i=!0;else if(i&&3===r.nodeType&&r.nodeValue&&r.nodeValue.trim().length>0)break;r=o.nextNode()}return r},findPreviousSibling:function(e){if(!e||a.isMediumEditorElement(e))return!1;for(var t=e.previousSibling;!t&&!a.isMediumEditorElement(e.parentNode);)t=(e=e.parentNode).previousSibling;return t},isDescendant:function(e,t,n){if(!e||!t)return!1;if(e===t)return!!n;if(1!==e.nodeType)return!1;if(r||3!==t.nodeType)return e.contains(t);for(var i=t.parentNode;null!==i;){if(i===e)return!0;i=i.parentNode}return!1},isElement:function(e){return!(!e||1!==e.nodeType)},throttle:function(e,t){var n,r,i,o=null,a=0,s=function(){a=Date.now(),o=null,i=e.apply(n,r),o||(n=r=null)};return t||0===t||(t=50),function(){var u=Date.now(),l=t-(u-a);return n=this,r=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),a=u,i=e.apply(n,r),o||(n=r=null)):o||(o=setTimeout(s,l)),i}},traverseUp:function(e,t){if(!e)return!1;do{if(1===e.nodeType){if(t(e))return e;if(a.isMediumEditorElement(e))return!1}e=e.parentNode}while(e);return!1},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(t,n){var r,i,o,s,u,l,c,d=!1,f=["insertHTML",!1,n];if(!e.util.isEdge&&t.queryCommandSupported("insertHTML"))try{return t.execCommand.apply(t,f)}catch(e){}if((r=t.getSelection()).rangeCount){if(c=(i=r.getRangeAt(0)).commonAncestorContainer,a.isMediumEditorElement(c)&&!c.firstChild)i.selectNode(c.appendChild(t.createTextNode("")));else if(3===c.nodeType&&0===i.startOffset&&i.endOffset===c.nodeValue.length||3!==c.nodeType&&c.innerHTML===i.toString()){for(;!a.isMediumEditorElement(c)&&c.parentNode&&1===c.parentNode.childNodes.length&&!a.isMediumEditorElement(c.parentNode);)c=c.parentNode;i.selectNode(c)}for(i.deleteContents(),(o=t.createElement("div")).innerHTML=n,s=t.createDocumentFragment();o.firstChild;)u=o.firstChild,l=s.appendChild(u);i.insertNode(s),l&&((i=i.cloneRange()).setStartAfter(l),i.collapse(!0),e.selection.selectRange(t,i)),d=!0}return t.execCommand.callListeners&&t.execCommand.callListeners(f,d),d},execFormatBlock:function(t,n){var r=a.getTopBlockContainer(e.selection.getSelectionStart(t));if("blockquote"===n){if(r&&Array.prototype.slice.call(r.childNodes).some(function(e){return a.isBlockContainer(e)}))return t.execCommand("outdent",!1,null);if(a.isIE)return t.execCommand("indent",!1,n)}if(r&&n===r.nodeName.toLowerCase()&&(n="p"),a.isIE&&(n="<"+n+">"),r&&"blockquote"===r.nodeName.toLowerCase()){if(a.isIE&&"<p>"===n)return t.execCommand("outdent",!1,n);if((a.isFF||a.isEdge)&&"p"===n)return Array.prototype.slice.call(r.childNodes).some(function(e){return!a.isBlockContainer(e)})&&t.execCommand("formatBlock",!1,n),t.execCommand("outdent",!1,n)}return t.execCommand("formatBlock",!1,n)},setTargetBlank:function(e,t){var n,r=t||!1;if("a"===e.nodeName.toLowerCase())e.target="_blank";else for(e=e.getElementsByTagName("a"),n=0;n<e.length;n+=1)!1!==r&&r!==e[n].attributes.href.value||(e[n].target="_blank")},removeTargetBlank:function(e,t){var n;if("a"===e.nodeName.toLowerCase())e.removeAttribute("target");else for(e=e.getElementsByTagName("a"),n=0;n<e.length;n+=1)t===e[n].attributes.href.value&&e[n].removeAttribute("target")},addClassToAnchors:function(e,t){var n,r,i=t.split(" ");if("a"===e.nodeName.toLowerCase())for(r=0;r<i.length;r+=1)e.classList.add(i[r]);else{var o=e.getElementsByTagName("a");if(0===o.length){var s=a.getClosestTag(e,"a");e=s?[s]:[]}else e=o;for(n=0;n<e.length;n+=1)for(r=0;r<i.length;r+=1)e[n].classList.add(i[r])}},isListItem:function(e){if(!e)return!1;if("li"===e.nodeName.toLowerCase())return!0;for(var t=e.parentNode,n=t.nodeName.toLowerCase();"li"===n||!a.isBlockContainer(t)&&"div"!==n;){if("li"===n)return!0;if(!(t=t.parentNode))return!1;n=t.nodeName.toLowerCase()}return!1},cleanListDOM:function(t,n){if("li"===n.nodeName.toLowerCase()){var r=n.parentElement;"p"===r.parentElement.nodeName.toLowerCase()&&(a.unwrap(r.parentElement,t),e.selection.moveCursor(t,n.firstChild,n.firstChild.textContent.length))}},splitOffDOMTree:function(e,t,n){for(var r=t,i=null,o=!n;r!==e;){var a,s=r.parentNode,u=s.cloneNode(!1),l=o?r:s.firstChild;for(i&&(o?u.appendChild(i):a=i),i=u;l;){var c=l.nextSibling;l===r?(l.hasChildNodes()?l=l.cloneNode(!1):l.parentNode.removeChild(l),l.textContent&&i.appendChild(l),l=o?c:null):(l.parentNode.removeChild(l),(l.hasChildNodes()||l.textContent)&&i.appendChild(l),l=c)}a&&i.appendChild(a),r=s}return i},moveTextRangeIntoElement:function(e,t,n){if(!e||!t)return!1;var r=a.findCommonRoot(e,t);if(!r)return!1;if(t===e){var i=e.parentNode,o=e.nextSibling;return i.removeChild(e),n.appendChild(e),o?i.insertBefore(n,o):i.appendChild(n),n.hasChildNodes()}for(var s,u,l,c=[],d=0;d<r.childNodes.length;d++)if(l=r.childNodes[d],s){if(a.isDescendant(l,t,!0)){u=l;break}c.push(l)}else a.isDescendant(l,e,!0)&&(s=l);var f=u.nextSibling,h=r.ownerDocument.createDocumentFragment();return s===e?(s.parentNode.removeChild(s),h.appendChild(s)):h.appendChild(a.splitOffDOMTree(s,e)),c.forEach(function(e){e.parentNode.removeChild(e),h.appendChild(e)}),u===t?(u.parentNode.removeChild(u),h.appendChild(u)):h.appendChild(a.splitOffDOMTree(u,t,!0)),n.appendChild(h),u.parentNode===r?r.insertBefore(n,u):f?r.insertBefore(n,f):r.appendChild(n),n.hasChildNodes()},depthOfNode:function(e){for(var t=0,n=e;null!==n.parentNode;)n=n.parentNode,t++;return t},findCommonRoot:function(e,t){for(var n=a.depthOfNode(e),r=a.depthOfNode(t),i=e,o=t;n!==r;)n>r?(i=i.parentNode,n-=1):(o=o.parentNode,r-=1);for(;i!==o;)i=i.parentNode,o=o.parentNode;return i},isElementAtBeginningOfBlock:function(e){for(var t;!a.isBlockContainer(e)&&!a.isMediumEditorElement(e);){for(t=e;t=t.previousSibling;)if((3===t.nodeType?t.nodeValue:t.textContent).length>0)return!1;e=e.parentNode}return!0},isMediumEditorElement:function(e){return e&&e.getAttribute&&!!e.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(e){return a.traverseUp(e,function(e){return a.isMediumEditorElement(e)})},isBlockContainer:function(e){return e&&3!==e.nodeType&&-1!==a.blockContainerElementNames.indexOf(e.nodeName.toLowerCase())},getClosestBlockContainer:function(e){return a.traverseUp(e,function(e){return a.isBlockContainer(e)||a.isMediumEditorElement(e)})},getTopBlockContainer:function(e){var t=!!a.isBlockContainer(e)&&e;return a.traverseUp(e,function(e){return a.isBlockContainer(e)&&(t=e),!(t||!a.isMediumEditorElement(e))&&(t=e,!0)}),t},getFirstSelectableLeafNode:function(e){for(;e&&e.firstChild;)e=e.firstChild;if("table"===(e=a.traverseUp(e,function(e){return-1===a.emptyElementNames.indexOf(e.nodeName.toLowerCase())})).nodeName.toLowerCase()){var t=e.querySelector("th, td");t&&(e=t)}return e},getFirstTextNode:function(e){return a.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),a._getFirstTextNode(e)},_getFirstTextNode:function(e){if(3===e.nodeType)return e;for(var t=0;t<e.childNodes.length;t++){var n=a._getFirstTextNode(e.childNodes[t]);if(null!==n)return n}return null},ensureUrlHasProtocol:function(e){return-1===e.indexOf("://")?"http://"+e:e},warn:function(){void 0!==t.console&&"function"==typeof t.console.warn&&t.console.warn.apply(t.console,arguments)},deprecated:function(e,t,n){var r=e+" is deprecated, please use "+t+" instead.";n&&(r+=" Will be removed in "+n),a.warn(r)},deprecatedMethod:function(e,t,n,r){a.deprecated(e,t,r),"function"==typeof this[t]&&this[t].apply(this,n)},cleanupAttrs:function(e,t){t.forEach(function(t){e.removeAttribute(t)})},cleanupTags:function(e,t){-1!==t.indexOf(e.nodeName.toLowerCase())&&e.parentNode.removeChild(e)},unwrapTags:function(t,n){-1!==n.indexOf(t.nodeName.toLowerCase())&&e.util.unwrap(t,document)},getClosestTag:function(e,t){return a.traverseUp(e,function(e){return e.nodeName.toLowerCase()===t.toLowerCase()})},unwrap:function(e,t){for(var n=t.createDocumentFragment(),r=Array.prototype.slice.call(e.childNodes),i=0;i<r.length;i++)n.appendChild(r[i]);n.childNodes.length?e.parentNode.replaceChild(n,e):e.parentNode.removeChild(e)},guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};e.util=a}(window),(t=function(t){e.util.extend(this,t)}).extend=function(t){var n,r=this;n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return r.apply(this,arguments)},e.util.extend(n,r);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,t&&e.util.extend(n.prototype,t),n},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(e){return this.base.options[e]}},["execAction","on","off","subscribe","trigger"].forEach(function(e){t.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}}),e.Extension=t,function(){function t(t){return e.util.isBlockContainer(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(t,n){var r,i=n.getSelection();return 0!==i.rangeCount&&(r=i.getRangeAt(0).commonAncestorContainer,e.util.traverseUp(r,t))},getSelectionElement:function(t){return this.findMatchingSelectionParent(function(t){return e.util.isMediumEditorElement(t)},t)},exportSelection:function(e,t){if(!e)return null;var n=null,r=t.getSelection();if(r.rangeCount>0){var i,o=r.getRangeAt(0),a=o.cloneRange();a.selectNodeContents(e),a.setEnd(o.startContainer,o.startOffset),n={start:i=a.toString().length,end:i+o.toString().length},this.doesRangeStartWithImages(o,t)&&(n.startsWithImage=!0);var s=this.getTrailingImageCount(e,n,o.endContainer,o.endOffset);if(s&&(n.trailingImageCount=s),0!==i){var u=this.getIndexRelativeToAdjacentEmptyBlocks(t,e,o.startContainer,o.startOffset);-1!==u&&(n.emptyBlocksIndex=u)}}return n},importSelection:function(e,t,n,r){if(e&&t){var i=n.createRange();i.setStart(t,0),i.collapse(!0);var o,a=t,s=[],u=0,l=!1,c=!1,d=0,f=!1,h=!1,m=null;for((r||e.startsWithImage||void 0!==e.emptyBlocksIndex)&&(h=!0);!f&&a;)if(a.nodeType>3)a=s.pop();else{if(3!==a.nodeType||c){if(e.trailingImageCount&&c&&("img"===a.nodeName.toLowerCase()&&d++,d===e.trailingImageCount)){for(var p=0;a.parentNode.childNodes[p]!==a;)p++;i.setEnd(a.parentNode,p+1),f=!0}if(!f&&1===a.nodeType)for(var g=a.childNodes.length-1;g>=0;)s.push(a.childNodes[g]),g-=1}else o=u+a.length,!l&&e.start>=u&&e.start<=o&&(h||e.start<o?(i.setStart(a,e.start-u),l=!0):m=a),l&&e.end>=u&&e.end<=o&&(e.trailingImageCount?c=!0:(i.setEnd(a,e.end-u),f=!0)),u=o;f||(a=s.pop())}!l&&m&&(i.setStart(m,m.length),i.setEnd(m,m.length)),void 0!==e.emptyBlocksIndex&&(i=this.importSelectionMoveCursorPastBlocks(n,t,e.emptyBlocksIndex,i)),r&&(i=this.importSelectionMoveCursorPastAnchor(e,i)),this.selectRange(n,i)}},importSelectionMoveCursorPastAnchor:function(t,n){if(t.start===t.end&&3===n.startContainer.nodeType&&n.startOffset===n.startContainer.nodeValue.length&&e.util.traverseUp(n.startContainer,function(e){return"a"===e.nodeName.toLowerCase()})){for(var r=n.startContainer,i=n.startContainer.parentNode;null!==i&&"a"!==i.nodeName.toLowerCase();)i.childNodes[i.childNodes.length-1]!==r?i=null:(r=i,i=i.parentNode);if(null!==i&&"a"===i.nodeName.toLowerCase()){for(var o=null,a=0;null===o&&a<i.parentNode.childNodes.length;a++)i.parentNode.childNodes[a]===i&&(o=a);n.setStart(i.parentNode,o+1),n.collapse(!0)}}return n},importSelectionMoveCursorPastBlocks:function(n,r,i,o){var a,s,u=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),l=o.startContainer,c=0;for(i=i||1,a=3===l.nodeType&&e.util.isBlockContainer(l.previousSibling)?l.previousSibling:e.util.getClosestBlockContainer(l);u.nextNode();)if(s){if(s=u.currentNode,++c===i)break;if(s.textContent.length>0)break}else a===u.currentNode&&(s=u.currentNode);return s||(s=a),o.setStart(e.util.getFirstSelectableLeafNode(s),0),o},getIndexRelativeToAdjacentEmptyBlocks:function(n,r,i,o){if(i.textContent.length>0&&o>0)return-1;var a=i;if(3!==a.nodeType&&(a=i.childNodes[o]),a){if(!e.util.isElementAtBeginningOfBlock(a))return-1;var s=e.util.findPreviousSibling(a);if(!s)return-1;if(s.nodeValue)return-1}for(var u=e.util.getClosestBlockContainer(i),l=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),c=0;l.nextNode();){var d=""===l.currentNode.textContent;if((d||c>0)&&(c+=1),l.currentNode===u)return c;d||(c=0)}return c},doesRangeStartWithImages:function(e,t){if(0!==e.startOffset||1!==e.startContainer.nodeType)return!1;if("img"===e.startContainer.nodeName.toLowerCase())return!0;var n=e.startContainer.querySelector("img");if(!n)return!1;for(var r=t.createTreeWalker(e.startContainer,NodeFilter.SHOW_ALL,null,!1);r.nextNode();){var i=r.currentNode;if(i===n)break;if(i.nodeValue)return!1}return!0},getTrailingImageCount:function(e,t,n,r){if(0===r||1!==n.nodeType)return 0;if("img"!==n.nodeName.toLowerCase()&&!n.querySelector("img"))return 0;for(var i=n.childNodes[r-1];i.hasChildNodes();)i=i.lastChild;for(var o,a=e,s=[],u=0,l=!1,c=!1,d=!1,f=0;!d&&a;)if(a.nodeType>3)a=s.pop();else{if(3!==a.nodeType||c){if("img"===a.nodeName.toLowerCase()&&f++,a===i)d=!0;else if(1===a.nodeType)for(var h=a.childNodes.length-1;h>=0;)s.push(a.childNodes[h]),h-=1}else f=0,o=u+a.length,!l&&t.start>=u&&t.start<=o&&(l=!0),l&&t.end>=u&&t.end<=o&&(c=!0),u=o;d||(a=s.pop())}return f},selectionContainsContent:function(e){var t=e.getSelection();if(!t||t.isCollapsed||!t.rangeCount)return!1;if(""!==t.toString().trim())return!0;var n=this.getSelectedParentElement(t.getRangeAt(0));return!(!n||!("img"===n.nodeName.toLowerCase()||1===n.nodeType&&n.querySelector("img")))},selectionInContentEditableFalse:function(e){var t,n=this.findMatchingSelectionParent(function(e){var n=e&&e.getAttribute("contenteditable");return"true"===n&&(t=!0),"#text"!==e.nodeName&&"false"===n},e);return!t&&n},getSelectionHtml:function(e){var t,n,r,i="",o=e.getSelection();if(o.rangeCount){for(r=e.createElement("div"),t=0,n=o.rangeCount;t<n;t+=1)r.appendChild(o.getRangeAt(t).cloneContents());i=r.innerHTML}return i},getCaretOffsets:function(e,t){var n,r;return t||(t=window.getSelection().getRangeAt(0)),n=t.cloneRange(),r=t.cloneRange(),n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset),r.selectNodeContents(e),r.setStart(t.endContainer,t.endOffset),{left:n.toString().length,right:r.toString().length}},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(e){return e?this.rangeSelectsSingleNode(e)&&3!==e.startContainer.childNodes[e.startOffset].nodeType?e.startContainer.childNodes[e.startOffset]:3===e.startContainer.nodeType?e.startContainer.parentNode:e.startContainer:null},getSelectedElements:function(e){var t,n,r,i=e.getSelection();if(!i.rangeCount||i.isCollapsed||!i.getRangeAt(0).commonAncestorContainer)return[];if(3===(t=i.getRangeAt(0)).commonAncestorContainer.nodeType){for(n=[],r=t.commonAncestorContainer;r.parentNode&&1===r.parentNode.childNodes.length;)n.push(r.parentNode),r=r.parentNode;return n}return[].filter.call(t.commonAncestorContainer.getElementsByTagName("*"),function(e){return"function"!=typeof i.containsNode||i.containsNode(e,!0)})},selectNode:function(e,t){var n=t.createRange();n.selectNodeContents(e),this.selectRange(t,n)},select:function(e,t,n,r,i){var o=e.createRange();return o.setStart(t,n),r?o.setEnd(r,i):o.collapse(!0),this.selectRange(e,o),o},clearSelection:function(e,t){t?e.getSelection().collapseToStart():e.getSelection().collapseToEnd()},moveCursor:function(e,t,n){this.select(e,t,n)},getSelectionRange:function(e){var t=e.getSelection();return 0===t.rangeCount?null:t.getRangeAt(0)},selectRange:function(e,t){var n=e.getSelection();n.removeAllRanges(),n.addRange(t)},getSelectionStart:function(e){var t=e.getSelection().anchorNode;return t&&3===t.nodeType?t.parentNode:t}};e.selection=n}(),function(){function t(t,n){return t.some(function(t){if("function"!=typeof t.getInteractionElements)return!1;var r=t.getInteractionElements();return!!r&&(Array.isArray(r)||(r=[r]),r.some(function(t){return e.util.isDescendant(t,n,!0)}))})}var n=function(e){this.base=e,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(t,n,r,i){var o=this.base.options.contentWindow,a=this.base.options.ownerDocument;t=e.util.isElement(t)||[o,a].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){e.addEventListener(n,r,i),this.events.push([e,n,r,i])}.bind(this))},detachDOMEvent:function(t,n,r,i){var o,a,s=this.base.options.contentWindow,u=this.base.options.ownerDocument;null!==t&&(t=e.util.isElement(t)||[s,u].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){-1!==(o=this.indexOfListener(e,n,r,i))&&(a=this.events.splice(o,1)[0])[0].removeEventListener(a[1],a[2],a[3])}.bind(this)))},indexOfListener:function(e,t,n,r){var i,o,a;for(i=0,o=this.events.length;i<o;i+=1)if((a=this.events[i])[0]===e&&a[1]===t&&a[2]===n&&a[3]===r)return i;return-1},detachAllDOMEvents:function(){for(var e=this.events.pop();e;)e[0].removeEventListener(e[1],e[2],e[3]),e=this.events.pop()},detachAllEventsFromElement:function(e){for(var t=this.events.filter(function(t){return t&&t[0].getAttribute&&t[0].getAttribute("medium-editor-index")===e.getAttribute("medium-editor-index")}),n=0,r=t.length;n<r;n++){var i=t[n];this.detachDOMEvent(i[0],i[1],i[2],i[3])}},attachAllEventsToElement:function(e){this.listeners.editableInput&&(this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(t){this.attachDOMEvent(e,t.name,t.handler.bind(this))},this)},enableCustomEvent:function(e){void 0!==this.disabledEvents[e]&&delete this.disabledEvents[e]},disableCustomEvent:function(e){this.disabledEvents[e]=!0},attachCustomEvent:function(e,t){this.setupListener(e),this.customEvents[e]||(this.customEvents[e]=[]),this.customEvents[e].push(t)},detachCustomEvent:function(e,t){var n=this.indexOfCustomListener(e,t);-1!==n&&this.customEvents[e].splice(n,1)},indexOfCustomListener:function(e,t){return this.customEvents[e]&&this.customEvents[e].length?this.customEvents[e].indexOf(t):-1},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(e,t,n){this.customEvents[e]&&!this.disabledEvents[e]&&this.customEvents[e].forEach(function(e){e(t,n)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(e){e.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=function(e){this.handleDocumentExecCommand(e)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var e=this.options.ownerDocument;if(this.execCommandListener&&e.execCommand.listeners){var t=e.execCommand.listeners.indexOf(this.execCommandListener);-1!==t&&e.execCommand.listeners.splice(t,1),e.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var e=this.options.ownerDocument;if(!e.execCommand.listeners){var t=function(t,n){e.execCommand.listeners&&e.execCommand.listeners.forEach(function(e){e({command:t[0],value:t[2],args:t,result:n})})},n=function(){var n=e.execCommand.orig.apply(this,arguments);if(!e.execCommand.listeners)return n;var r=Array.prototype.slice.call(arguments);return t(r,n),n};n.orig=e.execCommand,n.listeners=[],n.callListeners=t,e.execCommand=n}},unwrapExecCommand:function(){var e=this.options.ownerDocument;e.execCommand.orig&&(e.execCommand=e.execCommand.orig)},setupListener:function(e){if(!this.listeners[e]){switch(e){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(e){this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":case"editableKeydownEnter":case"editableKeydownTab":case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[e]=!0}},attachToEachElement:function(e,t){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(n){this.attachDOMEvent(n,e,t.bind(this))},this),this.eventsCache.push({name:e,handler:t})},cleanupElement:function(e){var t=e.getAttribute("medium-editor-index");t&&(this.detachAllEventsFromElement(e),this.contentCache&&delete this.contentCache[t])},focusElement:function(e){e.focus(),this.updateFocus(e,{target:e,type:"focus"})},updateFocus:function(n,r){var i,o=this.base.getFocusedElement();o&&"click"===r.type&&this.lastMousedownTarget&&(e.util.isDescendant(o,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(i=o),i||this.base.elements.some(function(t){return!i&&e.util.isDescendant(t,n,!0)&&(i=t),!!i},this);var a=!e.util.isDescendant(o,n,!0)&&!t(this.base.extensions,n);i!==o&&(o&&a&&(o.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",r,o)),i&&(i.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",r,i))),a&&this.triggerCustomEvent("externalInteraction",r)},updateInput:function(e,t){if(this.contentCache){var n=e.getAttribute("medium-editor-index"),r=e.innerHTML;r!==this.contentCache[n]&&this.triggerCustomEvent("editableInput",t,e),this.contentCache[n]=r}},handleDocumentSelectionChange:function(t){if(t.currentTarget&&t.currentTarget.activeElement){var n,r=t.currentTarget.activeElement;this.base.elements.some(function(t){return!!e.util.isDescendant(t,r,!0)&&(n=t,!0)},this),n&&this.updateInput(n,{target:r,currentTarget:n})}},handleDocumentExecCommand:function(){var e=this.base.getFocusedElement();e&&this.updateInput(e,{target:e,currentTarget:e})},handleBodyClick:function(e){this.updateFocus(e.target,e)},handleBodyFocus:function(e){this.updateFocus(e.target,e)},handleBodyMousedown:function(e){this.lastMousedownTarget=e.target},handleInput:function(e){this.updateInput(e.currentTarget,e)},handleClick:function(e){this.triggerCustomEvent("editableClick",e,e.currentTarget)},handleBlur:function(e){this.triggerCustomEvent("editableBlur",e,e.currentTarget)},handleKeypress:function(e){if(this.triggerCustomEvent("editableKeypress",e,e.currentTarget),this.keypressUpdateInput){var t={target:e.target,currentTarget:e.currentTarget};setTimeout(function(){this.updateInput(t.currentTarget,t)}.bind(this),0)}},handleKeyup:function(e){this.triggerCustomEvent("editableKeyup",e,e.currentTarget)},handleMouseover:function(e){this.triggerCustomEvent("editableMouseover",e,e.currentTarget)},handleDragging:function(e){this.triggerCustomEvent("editableDrag",e,e.currentTarget)},handleDrop:function(e){this.triggerCustomEvent("editableDrop",e,e.currentTarget)},handlePaste:function(e){this.triggerCustomEvent("editablePaste",e,e.currentTarget)},handleKeydown:function(t){return this.triggerCustomEvent("editableKeydown",t,t.currentTarget),e.util.isKey(t,e.util.keyCode.SPACE)?this.triggerCustomEvent("editableKeydownSpace",t,t.currentTarget):e.util.isKey(t,e.util.keyCode.ENTER)||t.ctrlKey&&e.util.isKey(t,e.util.keyCode.M)?this.triggerCustomEvent("editableKeydownEnter",t,t.currentTarget):e.util.isKey(t,e.util.keyCode.TAB)?this.triggerCustomEvent("editableKeydownTab",t,t.currentTarget):e.util.isKey(t,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE])?this.triggerCustomEvent("editableKeydownDelete",t,t.currentTarget):void 0}},e.Events=n}(),(n=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(t){n.isBuiltInButton(t)?e.Extension.call(this,this.defaults[t]):e.Extension.call(this,t)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return"function"==typeof this.action?this.action(this.base.options):this.action},getAria:function(){return"function"==typeof this.aria?this.aria(this.base.options):this.aria},getTagNames:function(){return"function"==typeof this.tagNames?this.tagNames(this.base.options):this.tagNames},createButton:function(){var e=this.document.createElement("button"),t=this.contentDefault,n=this.getAria(),r=this.getEditorOption("buttonLabels");return e.classList.add("medium-editor-action"),e.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(t){e.classList.add(t)}),e.setAttribute("data-action",this.getAction()),n&&(e.setAttribute("title",n),e.setAttribute("aria-label",n)),this.attrs&&Object.keys(this.attrs).forEach(function(t){e.setAttribute(t,this.attrs[t])},this),"fontawesome"===r&&this.contentFA&&(t=this.contentFA),e.innerHTML=t,e},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.getAction();t&&this.execAction(t)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var e=null;return this.useQueryState&&(e=this.base.queryCommandState(this.getAction())),e},isAlreadyApplied:function(e){var t,n,r=!1,i=this.getTagNames();return!1===this.knownState||!0===this.knownState?this.knownState:(i&&i.length>0&&(r=-1!==i.indexOf(e.nodeName.toLowerCase())),!r&&this.style&&(t=this.style.value.split("|"),n=this.window.getComputedStyle(e,null).getPropertyValue(this.style.prop),t.forEach(function(e){this.knownState||((r=-1!==n.indexOf(e))||"text-decoration"!==this.style.prop)&&(this.knownState=r)},this)),r)}})).isBuiltInButton=function(t){return"string"==typeof t&&e.extensions.button.prototype.defaults.hasOwnProperty(t)},e.extensions.button=n,e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}},r=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return!!this.hasForm&&this.getForm().classList.contains(this.activeClass)},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.hideToolbarDefaultActions()},setToolbarPosition:function(){var e=this.base.getExtensionByName("toolbar");e&&e.setToolbarPosition()}}),e.extensions.form=r,i=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(t){t.preventDefault(),t.stopPropagation();var n=e.selection.getSelectionRange(this.document);return"a"===n.startContainer.nodeName.toLowerCase()||"a"===n.endContainer.nodeName.toLowerCase()||e.util.getClosestTag(e.selection.getSelectedParentElement(n),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(t){e.util.isKey(t,e.util.keyCode.K)&&e.util.isMetaCtrlKey(t)&&!t.shiftKey&&this.handleClick(t)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var e=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return e.push('<a href="#" class="medium-editor-toolbar-save">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),e.push('<a href="#" class="medium-editor-toolbar-close">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),e.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(t){var n=this.getInput(),r=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox();if("string"==typeof(t=t||{value:""})&&(t={value:t}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),n.value=t.value,n.focus(),r&&(r.checked="_blank"===t.target),i){var o=t.buttonClass?t.buttonClass.split(" "):[];i.checked=-1!==o.indexOf(this.customClassOption)}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var e=this.getAnchorTargetCheckbox(),t=this.getAnchorButtonCheckbox(),n={value:this.getInput().value.trim()};return this.linkValidation&&(n.value=this.checkLinkFormat(n.value)),n.target="_self",e&&e.checked&&(n.target="_blank"),t&&t.checked&&(n.buttonClass=this.customClassOption),n},doFormSave:function(){var e=this.getFormOpts();this.completeFormSave(e)},completeFormSave:function(e){this.base.restoreSelection(),this.execAction(this.action,e),this.base.checkSelection()},ensureEncodedUri:function(e){return e===decodeURI(e)?encodeURI(e):e},ensureEncodedUriComponent:function(e){return e===decodeURIComponent(e)?encodeURIComponent(e):e},ensureEncodedParam:function(e){var t=e.split("="),n=t[0],r=t[1];return n+(void 0===r?"":"="+this.ensureEncodedUriComponent(r))},ensureEncodedQuery:function(e){return e.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(e){var t=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i.test(e),n="",r=e.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),i=r[1],o=r[2],a=r[3];if(/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/.test(e))return"tel:"+e;if(!t){var s=i.split("/")[0];(s.match(/.+(\.|:).+/)||"localhost"===s)&&(n="http://")}return n+this.ensureEncodedUri(i)+(void 0===o?"":"?"+this.ensureEncodedQuery(o))+(void 0===a?"":"#"+a)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(e){var t=e.querySelector(".medium-editor-toolbar-close"),n=e.querySelector(".medium-editor-toolbar-save"),r=e.querySelector(".medium-editor-toolbar-input");this.on(e,"click",this.handleFormClick.bind(this)),this.on(r,"keyup",this.handleTextboxKeyup.bind(this)),this.on(t,"click",this.handleCloseClick.bind(this)),this.on(n,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var e=this.document.createElement("div");return e.className="medium-editor-toolbar-form",e.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),e.innerHTML=this.getTemplate(),this.attachFormEvents(e),e},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(t){if(t.keyCode===e.util.keyCode.ENTER)return t.preventDefault(),void this.doFormSave();t.keyCode===e.util.keyCode.ESCAPE&&(t.preventDefault(),this.doFormCancel())},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.anchor=i,o=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var e=this.document.createElement("div");return e.id="medium-editor-anchor-preview-"+this.getEditorId(),e.className="medium-editor-anchor-preview",e.innerHTML=this.getTemplate(),this.on(e,"click",this.handleClick.bind(this)),e},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(e){return!(!this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&!e.getAttribute("data-disable-preview"))||(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=e.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=e.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=e,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(e){e=e||this.activeAnchor;var t,n,r,i,o,a=this.window.innerWidth,s=this.anchorPreview.offsetHeight,u=e.getBoundingClientRect(),l=this.diffLeft,c=this.diffTop,d=this.getEditorOption("elementsContainer"),f=["absolute","fixed"].indexOf(window.getComputedStyle(d).getPropertyValue("position"))>-1,h={};t=this.anchorPreview.offsetWidth/2;var m=this.base.getExtensionByName("toolbar");m&&(l=m.diffLeft,c=m.diffTop),n=l-t,f?(i=d.getBoundingClientRect(),["top","left"].forEach(function(e){h[e]=u[e]-i[e]}),h.width=u.width,h.height=u.height,u=h,a=i.width,o=d.scrollTop):o=this.window.pageYOffset,r=u.left+u.width/2,o+=s+u.top+u.height-c-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(o)+"px",this.anchorPreview.style.right="initial",r<t?(this.anchorPreview.style.left=n+t+"px",this.anchorPreview.style.right="initial"):a-r<t?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=n+r+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(e){var t=this.base.getExtensionByName("anchor"),n=this.activeAnchor;t&&n&&(e.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(n){var e={value:n.attributes.href.value,target:n.getAttribute("target"),buttonClass:n.getAttribute("class")};t.showForm(e),n=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(t){var n=e.util.getClosestTag(t.target,"a");if(!1!==n){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(n.outerHTML)||/href=["']#\S+["']/.test(n.outerHTML)))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==n&&this.detachPreviewHandlers(),this.anchorToPreview=n,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))}},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;(new Date).getTime()-this.lastOver>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}}),e.extensions.anchorPreview=o,function(){var t,n,r,i,o;t=[" ","\t","\n","\r","","","","","","\u2028","\u2029"],r="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+(n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw")+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",i=new RegExp("^("+n+")$","i"),o=new RegExp(r,"gi");var a=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var e=0,t=0;t<this.window._mediumEditors.length;t++){var n=this.window._mediumEditors[t];null!==n&&void 0!==n.getExtensionByName("autoLink")&&e++}return 1===e},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(e,t){this.performLinking(t)},onKeypress:function(t){this.disableEventHandling||e.util.isKey(t,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var e=this.base.exportSelection();this.performLinking(t.target)&&this.base.importSelection(e,!0)}catch(e){window.console&&window.console.error("Failed to perform linking",e),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(t){var n=e.util.splitByBlockElements(t),r=!1;0===n.length&&(n=[t]);for(var i=0;i<n.length;i++)r=this.removeObsoleteAutoLinkSpans(n[i])||r,r=this.performLinkingWithinElement(n[i])||r;return this.base.events.updateInput(t,{target:t,currentTarget:t}),r},removeObsoleteAutoLinkSpans:function(t){if(!t||3===t.nodeType)return!1;for(var n,r=t.querySelectorAll('span[data-auto-link="true"]'),i=!1,o=0;o<r.length;o++){var a=r[o].textContent;if(-1===a.indexOf("://")&&(a=e.util.ensureUrlHasProtocol(a)),r[o].getAttribute("data-href")!==a&&(n=r[o],!e.util.getClosestTag(n,"a"))){i=!0;var s=a.replace(/\s+$/,"");if(r[o].getAttribute("data-href")===s){var u=a.length-s.length,l=e.util.splitOffDOMTree(r[o],this.splitTextBeforeEnd(r[o],u));r[o].parentNode.insertBefore(l,r[o].nextSibling)}else e.util.unwrap(r[o],this.document)}}return i},splitTextBeforeEnd:function(e,t){for(var n,r,i,o=this.document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),a=!0;a;)a=null!==o.lastChild();for(;t>0&&null!==i;)(r=(n=o.currentNode).nodeValue).length>t?(i=n.splitText(r.length-t),t=0):(i=o.previousNode(),t-=r.length);return i},performLinkingWithinElement:function(t){for(var n=this.findLinkableText(t),r=0;r<n.length;r++){var i=e.util.findOrCreateMatchingTextNodes(this.document,t,n[r]);this.shouldNotLink(i)||this.createAutoLink(i,n[r].href)}return!1},shouldNotLink:function(t){for(var n=!1,r=0;r<t.length&&!1===n;r++)n=!!e.util.traverseUp(t[r],function(e){return"a"===e.nodeName.toLowerCase()||e.getAttribute&&"true"===e.getAttribute("data-auto-link")});return n},findLinkableText:function(e){for(var n=e.textContent,r=null,a=[];null!==(r=o.exec(n));){var s=r.index+r[0].length;!(0!==r.index&&-1===t.indexOf(n[r.index-1])||s!==n.length&&-1===t.indexOf(n[s]))&&(-1!==r[0].indexOf("/")||i.test(r[0].split(".").pop().split("?").shift()))&&a.push({href:r[0],start:r.index,end:s})}return a},createAutoLink:function(t,n){n=e.util.ensureUrlHasProtocol(n);var r=e.util.createLink(this.document,t,n,this.getEditorOption("targetBlank")?"_blank":null),i=this.document.createElement("span");for(i.setAttribute("data-auto-link","true"),i.setAttribute("data-href",n),r.insertBefore(i,r.firstChild);r.childNodes.length>1;)i.appendChild(r.childNodes[1])}});e.extensions.autoLink=a}(),function(){var t="medium-editor-dragover";function n(n){var r=e.util.getContainerEditorElement(n);Array.prototype.slice.call(r.parentElement.querySelectorAll("."+t)).forEach(function(e){e.classList.remove(t)})}var r=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy";var r=e.target.classList?e.target:e.target.parentElement;n(r),"dragover"===e.type&&r.classList.add(t)},handleDrop:function(e){e.preventDefault(),e.stopPropagation(),this.base.selectElement(e.target);var t=this.base.exportSelection();t.start=t.end,this.base.importSelection(t),e.dataTransfer.files&&Array.prototype.slice.call(e.dataTransfer.files).forEach(function(e){this.isAllowedFile(e)&&e.type.match("image")&&this.insertImageFile(e)},this),n(e.target)},isAllowedFile:function(e){return this.allowedTypes.some(function(t){return!!e.type.match(t)})},insertImageFile:function(t){if("function"==typeof FileReader){var n=new FileReader;n.readAsDataURL(t),n.addEventListener("load",function(t){var n=this.document.createElement("img");n.src=t.target.result,e.util.insertHTMLCommand(this.document,n.outerHTML)}.bind(this))}}});e.extensions.fileDragging=r}(),a=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(e){var t=e.key.charCodeAt(0);this.keys[t]||(this.keys[t]=[]),this.keys[t].push(e)},this)},handleKeydown:function(t){var n=e.util.getKeyCode(t);if(this.keys[n]){var r=e.util.isMetaCtrlKey(t),i=!!t.shiftKey,o=!!t.altKey;this.keys[n].forEach(function(e){e.meta!==r||e.shift!==i||e.alt!==o&&void 0!==e.alt||(t.preventDefault(),t.stopPropagation(),"function"==typeof e.command?e.command.apply(this):!1!==e.command&&this.execAction(e.command))},this)}}}),e.extensions.keyboardCommands=a,s=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var t=this.document.queryCommandValue("fontName")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(e){var t=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var e,t=this.document,n=t.createElement("div"),r=t.createElement("select"),i=t.createElement("a"),o=t.createElement("a");n.className="medium-editor-toolbar-form",n.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(n,"click",this.handleFormClick.bind(this));for(var a=0;a<this.fonts.length;a++)(e=t.createElement("option")).innerHTML=this.fonts[a],e.value=this.fonts[a],r.appendChild(e);return r.className="medium-editor-toolbar-select",n.appendChild(r),this.on(r,"change",this.handleFontChange.bind(this)),o.setAttribute("href","#"),o.className="medium-editor-toobar-save",o.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",n.appendChild(o),this.on(o,"click",this.handleSaveClick.bind(this),!0),i.setAttribute("href","#"),i.className="medium-editor-toobar-close",i.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",n.appendChild(i),this.on(i,"click",this.handleCloseClick.bind(this)),n},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("face")&&e.removeAttribute("face")})},handleFontChange:function(){var e=this.getSelect().value;""===e?this.clearFontName():this.execAction("fontName",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.fontName=s,u=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var t=this.document.queryCommandValue("fontSize")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(e){var t=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("input"),r=e.createElement("a"),i=e.createElement("a");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this)),n.setAttribute("type","range"),n.setAttribute("min","1"),n.setAttribute("max","7"),n.className="medium-editor-toolbar-input",t.appendChild(n),this.on(n,"change",this.handleSliderChange.bind(this)),i.setAttribute("href","#"),i.className="medium-editor-toobar-save",i.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(i),this.on(i,"click",this.handleSaveClick.bind(this),!0),r.setAttribute("href","#"),r.className="medium-editor-toobar-close",r.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",t.appendChild(r),this.on(r,"click",this.handleCloseClick.bind(this)),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("size")&&e.removeAttribute("size")})},handleSliderChange:function(){var e=this.getInput().value;"4"===e?this.clearFontSize():this.execAction("fontSize",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.fontSize=u,function(){var t=null,n=null,r=function(e){e.stopPropagation()};function i(e,t,n){var r=e.clipboardData||t.clipboardData||n.dataTransfer,i={};if(!r)return i;if(r.getData){var o=r.getData("Text");o&&o.length>0&&(i["text/plain"]=o)}if(r.types)for(var a=0;a<r.types.length;a++){var s=r.types[a];i[s]=r.getData(s)}return i}var o=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(e){this.on(e,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(e,t){this.on(t,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(e,t){if(!e.defaultPrevented){var n=i(e,this.window,this.document),r=n["text/html"],o=n["text/plain"];this.window.clipboardData&&void 0===e.clipboardData&&!r&&(r=o),(r||o)&&(e.preventDefault(),this.doPaste(r,o,t))}},doPaste:function(t,n,r){var i,o,a="";if(this.cleanPastedHTML&&t)return this.cleanPaste(t);if(this.getEditorOption("disableReturn")||r&&r.getAttribute("data-disable-return"))a=e.util.htmlEntities(n);else if((i=n.split(/[\r\n]+/g)).length>1)for(o=0;o<i.length;o+=1)""!==i[o]&&(a+="<p>"+e.util.htmlEntities(i[o])+"</p>");else a=e.util.htmlEntities(i[0]);e.util.insertHTMLCommand(this.document,a)},handlePasteBinPaste:function(e){if(e.defaultPrevented)this.removePasteBin();else{var t=i(e,this.window,this.document),r=t["text/html"],o=t["text/plain"],a=n;if(!this.cleanPastedHTML||r)return e.preventDefault(),this.removePasteBin(),this.doPaste(r,o,a),void this.trigger("editablePaste",{currentTarget:a,target:a},a);setTimeout(function(){this.cleanPastedHTML&&(r=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(r,o,a),this.trigger("editablePaste",{currentTarget:a,target:a},a)}.bind(this),0)}},handleKeydown:function(t,n){e.util.isKey(t,e.util.keyCode.V)&&e.util.isMetaCtrlKey(t)&&(t.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(n))},createPasteBin:function(i){var o,a=e.selection.getSelectionRange(this.document),s=this.window.pageYOffset;n=i,a&&((o=a.getClientRects()).length?s+=o[0].top:s+=a.startContainer.getBoundingClientRect().top),t=a;var u=this.document.createElement("div");u.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),u.setAttribute("style","border: 1px red solid; position: absolute; top: "+s+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),u.setAttribute("contentEditable",!0),u.innerHTML="%ME_PASTEBIN%",this.document.body.appendChild(u),this.on(u,"focus",r),this.on(u,"focusin",r),this.on(u,"focusout",r),u.focus(),e.selection.selectNode(u,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(u,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==t&&(e.selection.selectRange(this.document,t),t=null),null!==n&&(n=null);var i=this.getPasteBin();i&&i&&(this.off(i,"focus",r),this.off(i,"focusin",r),this.off(i,"focusout",r),this.off(i,"paste",this.boundHandlePaste),i.parentElement.removeChild(i))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var e=this.getPasteBin();if(!e)return!1;if(e.firstChild&&"mcepastebin"===e.firstChild.id)return!1;var t=e.innerHTML;return!(!t||"%ME_PASTEBIN%"===t)&&t},cleanPaste:function(e){var t,n,r,i,o=/<p|<br|<div/.test(e),a=[].concat(this.preCleanReplacements||[],[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"||)(((?!&quot;|&rdquo;|&ldquo;|"||).)*)(?:&quot;|&rdquo;|&ldquo;|"||)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]],this.cleanReplacements||[]);for(t=0;t<a.length;t+=1)e=e.replace(a[t][0],a[t][1]);if(!o)return this.pasteHTML(e);for((r=this.document.createElement("div")).innerHTML="<p>"+e.split("<br><br>").join("</p><p>")+"</p>",n=r.querySelectorAll("a,p,div,br"),t=0;t<n.length;t+=1)switch((i=n[t]).innerHTML=i.innerHTML.replace(/\n/gi," "),i.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(i);break;case"br":this.filterLineBreak(i)}this.pasteHTML(r.innerHTML)},pasteHTML:function(t,n){n=e.util.defaults({},n,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var r,i,o,a,s=this.document.createDocumentFragment();for(s.appendChild(this.document.createElement("body")),(a=s.querySelector("body")).innerHTML=t,this.cleanupSpans(a),r=a.querySelectorAll("*"),o=0;o<r.length;o+=1)"a"===(i=r[o]).nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(i),e.util.cleanupAttrs(i,n.cleanAttrs),e.util.cleanupTags(i,n.cleanTags),e.util.unwrapTags(i,n.unwrapTags);e.util.insertHTMLCommand(this.document,a.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&("p"===e.nodeName.toLowerCase()||"div"===e.nodeName.toLowerCase())},filterCommonBlocks:function(e){/^\s*$/.test(e.textContent)&&e.parentNode&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?this.removeWithParent(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?e.parentNode&&1===e.parentNode.childElementCount&&""===e.parentNode.textContent&&this.removeWithParent(e):this.removeWithParent(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&1===e.parentNode.childElementCount?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e))},cleanupSpans:function(t){var n,r,i,o=t.querySelectorAll(".replace-with"),a=function(e){return e&&"#text"!==e.nodeName&&"false"===e.getAttribute("contenteditable")};for(n=0;n<o.length;n+=1)r=o[n],i=this.document.createElement(r.classList.contains("bold")?"b":"i"),r.classList.contains("bold")&&r.classList.contains("italic")?i.innerHTML="<i>"+r.innerHTML+"</i>":i.innerHTML=r.innerHTML,r.parentNode.replaceChild(i,r);for(o=t.querySelectorAll("span"),n=0;n<o.length;n+=1){if(r=o[n],e.util.traverseUp(r,a))return!1;e.util.unwrap(r,this.document)}}});e.extensions.paste=o}(),l=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(e,t){this.initElement(t)},initElement:function(e){e.getAttribute("data-placeholder")||e.setAttribute("data-placeholder",this.text),this.updatePlaceholder(e)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(e,t){this.cleanupElement(t)},cleanupElement:function(e){e.getAttribute("data-placeholder")===this.text&&e.removeAttribute("data-placeholder")},showPlaceholder:function(t){t&&(e.util.isFF&&0===t.childNodes.length?(t.classList.add("medium-editor-placeholder-relative"),t.classList.remove("medium-editor-placeholder")):(t.classList.add("medium-editor-placeholder"),t.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(e){e&&(e.classList.remove("medium-editor-placeholder"),e.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(e,t){if(e.querySelector("img, blockquote, ul, ol, table")||""!==e.textContent.replace(/^\s+|\s+$/g,""))return this.hidePlaceholder(e);t||this.showPlaceholder(e)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(e,t){var n=this.hideOnClick&&t===this.base.getFocusedElement();this.updatePlaceholder(t,n)},handleFocus:function(e,t){this.hidePlaceholder(t)},handleBlur:function(e,t){this.updatePlaceholder(t)}}),e.extensions.placeholder=l,c=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(e,t){return this.base.extensions.forEach(function(n){if(n!==this)return e.apply(t||this,arguments)},this)},createToolbar:function(){var e=this.document.createElement("div");return e.id="medium-editor-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e},createToolbarButtons:function(){var t,n,r,i,o,a,s=this.document.createElement("ul");return s.id="medium-editor-toolbar-actions"+this.getEditorId(),s.className="medium-editor-toolbar-actions",s.style.display="block",this.buttons.forEach(function(r){"string"==typeof r?(o=r,a=null):(o=r.name,a=r),(i=this.base.addBuiltInExtension(o,a))&&"function"==typeof i.getButton&&(n=i.getButton(this.base),t=this.document.createElement("li"),e.util.isElement(n)?t.appendChild(n):t.innerHTML=n,s.appendChild(t))},this),(r=s.querySelectorAll("button")).length>0&&(r[0].classList.add(this.firstButtonClass),r[r.length-1].classList.add(this.lastButtonClass)),s},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(t){if(t&&t.target&&e.util.isDescendant(this.getToolbarElement(),t.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return"block"===this.getToolbarActionsElement().style.display},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(e){e.hasForm&&e.isDisplayed()&&e.hideForm()})},multipleBlockElementsSelected:function(){var t=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),n=e.selection.getSelectionHtml(this.document).replace(/<[^\/>][^>]*><\/[^>]+>/gim,"").match(t);return!!n&&n.length>1},modifySelection:function(){var t=this.window.getSelection().getRangeAt(0);if(this.standardizeSelectionStart&&t.startContainer.nodeValue&&t.startOffset===t.startContainer.nodeValue.length){var n=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),t.startContainer,this.document);if(n){for(var r=0;0===n.nodeValue.substr(r,1).trim().length;)r+=1;t=e.selection.select(this.document,n,r,t.endContainer,t.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var t=e.selection.getSelectionElement(this.window);return!t||-1===this.getEditorElements().indexOf(t)||t.getAttribute("data-disable-toolbar")?this.hideToolbar():this.updateOnEmptySelection&&this.static?this.showAndUpdateToolbar():!e.selection.selectionContainsContent(this.document)||!1===this.allowMultiParagraphSelection&&this.multipleBlockElementsSelected()?this.hideToolbar():void this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(e){"function"==typeof e.isActive&&"function"==typeof e.setInactive&&e.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var t,n=[],r=null,i=e.selection.getSelectionRange(this.document),o=function(e){"function"==typeof e.checkState?e.checkState(t):"function"==typeof e.isActive&&"function"==typeof e.isAlreadyApplied&&"function"==typeof e.setActive&&!e.isActive()&&e.isAlreadyApplied(t)&&e.setActive()};if(i&&(this.forEachExtension(function(e){"function"!=typeof e.queryCommandState||null===(r=e.queryCommandState())?n.push(e):r&&"function"==typeof e.setActive&&e.setActive()}),t=e.selection.getSelectedParentElement(i),this.getEditorElements().some(function(n){return e.util.isDescendant(n,t,!0)})))for(;t&&(n.forEach(o),!e.util.isMediumEditorElement(t));)t=t.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var e=this.base.getFocusedElement(),t=this.window.getSelection();if(!e)return this;!this.static&&t.isCollapsed||(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(e):this.positionToolbar(t)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(e){this.getToolbarElement().style.left="0";var t,n=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,r=this.window.innerWidth,i=this.getToolbarElement(),o=e.getBoundingClientRect(),a=o.top+n,s=o.left+o.width/2,u=i.offsetHeight,l=i.offsetWidth,c=l/2;switch(this.sticky?n>a+e.offsetHeight-u-this.stickyTopOffset?(i.style.top=a+e.offsetHeight-u+"px",i.classList.remove("medium-editor-sticky-toolbar")):n>a-u-this.stickyTopOffset?(i.classList.add("medium-editor-sticky-toolbar"),i.style.top=this.stickyTopOffset+"px"):(i.classList.remove("medium-editor-sticky-toolbar"),i.style.top=a-u+"px"):i.style.top=a-u+"px",this.align){case"left":t=o.left;break;case"right":t=o.right-l;break;case"center":t=s-c}t<0?t=0:t+l>r&&(t=r-Math.ceil(l)-1),i.style.left=t+"px"},positionToolbar:function(e){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var t=e.getRangeAt(0),n=t.getBoundingClientRect();(!n||0===n.height&&0===n.width&&t.startContainer===t.endContainer)&&(n=1===t.startContainer.nodeType&&t.startContainer.querySelector("img")?t.startContainer.querySelector("img").getBoundingClientRect():t.startContainer.getBoundingClientRect());var r,i,o=this.window.innerWidth,a=this.getToolbarElement(),s=a.offsetHeight,u=a.offsetWidth/2,l=this.diffLeft-u,c=this.getEditorOption("elementsContainer"),d={},f={};["absolute","fixed"].indexOf(window.getComputedStyle(c).getPropertyValue("position"))>-1?(i=c.getBoundingClientRect(),["top","left"].forEach(function(e){f[e]=n[e]-i[e]}),f.width=n.width,f.height=n.height,n=f,o=i.width,d.top=c.scrollTop):d.top=this.window.pageYOffset,r=n.left+n.width/2,d.top+=n.top-s,n.top<50?(a.classList.add("medium-toolbar-arrow-over"),a.classList.remove("medium-toolbar-arrow-under"),d.top+=50+n.height-this.diffTop):(a.classList.add("medium-toolbar-arrow-under"),a.classList.remove("medium-toolbar-arrow-over"),d.top+=this.diffTop),r<u?(d.left=l+u,d.right="initial"):o-r<u?(d.left="auto",d.right=0):(d.left=l+r,d.right="initial"),["top","left","right"].forEach(function(e){a.style[e]=d[e]+(isNaN(d[e])?"":"px")})}}),e.extensions.toolbar=c,d=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy","dragover"===e.type?e.target.classList.add("medium-editor-dragover"):"dragleave"===e.type&&e.target.classList.remove("medium-editor-dragover")},handleDrop:function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&Array.prototype.slice.call(t.dataTransfer.files,0).some(function(t){var n,r;t.type.match("image")&&((n=new FileReader).readAsDataURL(t),r="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+r+'" />'),n.onload=function(){var e=this.document.getElementById(r);e&&(e.removeAttribute("id"),e.removeAttribute("class"),e.src=n.result)}.bind(this))}.bind(this)),t.target.classList.remove("medium-editor-dragover")}}),e.extensions.imageDragging=d,function(){function t(t,n){if(this.options.disableReturn||n.getAttribute("data-disable-return"))t.preventDefault();else if(this.options.disableDoubleReturn||n.getAttribute("data-disable-double-return")){var r=e.selection.getSelectionStart(this.options.ownerDocument);(r&&""===r.textContent.trim()&&"li"!==r.nodeName.toLowerCase()||r.previousElementSibling&&"br"!==r.previousElementSibling.nodeName.toLowerCase()&&""===r.previousElementSibling.textContent.trim())&&t.preventDefault()}}function n(t){var n,r=e.selection.getSelectionStart(this.options.ownerDocument),i=r.nodeName.toLowerCase(),o=/^(\s+|<br\/?>)?$/i,a=/h\d/i;e.util.isKey(t,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&r.previousElementSibling&&a.test(i)&&0===e.selection.getCaretOffsets(r).left?e.util.isKey(t,e.util.keyCode.BACKSPACE)&&o.test(r.previousElementSibling.innerHTML)?(r.previousElementSibling.parentNode.removeChild(r.previousElementSibling),t.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(t,e.util.keyCode.ENTER)&&((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",r.previousElementSibling.parentNode.insertBefore(n,r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.DELETE)&&r.nextElementSibling&&r.previousElementSibling&&!a.test(i)&&o.test(r.innerHTML)&&a.test(r.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,r.nextElementSibling),r.previousElementSibling.parentNode.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&"li"===i&&o.test(r.innerHTML)&&!r.previousElementSibling&&!r.parentElement.previousElementSibling&&r.nextElementSibling&&"li"===r.nextElementSibling.nodeName.toLowerCase()?((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",r.parentElement.parentElement.insertBefore(n,r.parentElement),e.selection.moveCursor(this.options.ownerDocument,n),r.parentElement.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&!1!==e.util.getClosestTag(r,"blockquote")&&0===e.selection.getCaretOffsets(r).left?(t.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(t,e.util.keyCode.ENTER)&&!1!==e.util.getClosestTag(r,"blockquote")&&0===e.selection.getCaretOffsets(r).right?((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",r.parentElement.insertBefore(n,r.nextSibling),e.selection.moveCursor(this.options.ownerDocument,n),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(r.parentElement)&&!r.previousElementSibling&&r.nextElementSibling&&o.test(r.innerHTML)&&(t.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,r.nextSibling),r.parentElement.removeChild(r))}function r(t,n,r){var i=[];if(t||(t=[]),"string"==typeof t&&(t=n.querySelectorAll(t)),e.util.isElement(t)&&(t=[t]),r)for(var o=0;o<t.length;o++){var a=t[o];!e.util.isElement(a)||a.getAttribute("data-medium-editor-element")||a.getAttribute("medium-editor-textarea-id")||i.push(a)}else i=Array.prototype.slice.apply(t);return i}function i(e){var t=e.parentNode.querySelector('textarea[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]');t&&(t.classList.remove("medium-editor-hidden"),t.removeAttribute("medium-editor-textarea-id")),e.parentNode&&e.parentNode.removeChild(e)}function o(e,t,n){return"function"==typeof(e=function(e,t){return Object.keys(t).forEach(function(n){void 0===e[n]&&(e[n]=t[n])}),e}(e,{window:n.options.contentWindow,document:n.options.ownerDocument,base:n})).init&&e.init(),e.name||(e.name=t),e}function a(){return!this.elements.every(function(e){return!!e.getAttribute("data-disable-toolbar")})&&!1!==this.options.toolbar}function s(n,r){if(!n.getAttribute("data-medium-editor-element")){"textarea"===n.nodeName.toLowerCase()&&(n=function(e){for(var t=this.options.ownerDocument.createElement("div"),n=Date.now(),r="medium-editor-"+n,i=e.attributes;this.options.ownerDocument.getElementById(r);)r="medium-editor-"+ ++n;t.className=e.className,t.id=r,t.innerHTML=e.value,e.setAttribute("medium-editor-textarea-id",r);for(var o=0,a=i.length;o<a;o++)t.hasAttribute(i[o].nodeName)||t.setAttribute(i[o].nodeName,i[o].nodeValue);return e.form&&this.on(e.form,"reset",function(e){e.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(r))}.bind(this)),e.classList.add("medium-editor-hidden"),e.parentNode.insertBefore(t,e),t}.call(this,n),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=function(e,t){var n=t.parentNode.querySelector('textarea[medium-editor-textarea-id="'+t.getAttribute("medium-editor-textarea-id")+'"]');n&&(n.value=t.innerHTML.trim())}.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),this.options.disableEditing||n.getAttribute("data-disable-editing")||(n.setAttribute("contentEditable",!0),n.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(n.getAttribute("data-disable-return")||n.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=t.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),this.options.disableReturn||n.getAttribute("data-disable-return")||this.on(n,"keyup",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument);n&&(e.util.isMediumEditorElement(n)&&0===n.children.length&&!e.util.isBlockContainer(n)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),!e.util.isKey(t,e.util.keyCode.ENTER)||e.util.isListItem(n)||e.util.isBlockContainer(n)||("a"===n.nodeName.toLowerCase()?this.options.ownerDocument.execCommand("unlink",!1,null):t.shiftKey||t.ctrlKey||this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}.bind(this));var i=e.util.guid();n.setAttribute("data-medium-editor-element",!0),n.classList.add("medium-editor-element"),n.setAttribute("role","textbox"),n.setAttribute("aria-multiline",!0),n.setAttribute("data-medium-editor-editor-index",r),n.setAttribute("medium-editor-index",i),d[i]=n.innerHTML,this.events.attachAllEventsToElement(n)}return n}function u(){this.subscribe("editableKeydownTab",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument);"pre"===(n&&n.nodeName.toLowerCase())&&(t.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(n)&&(t.preventDefault(),t.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}.bind(this)),this.subscribe("editableKeydownDelete",n.bind(this)),this.subscribe("editableKeydownEnter",n.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r=n.textContent,i=e.selection.getCaretOffsets(n);(void 0===r[i.left-1]||""===r[i.left-1].trim()||void 0!==r[i.left]&&""===r[i.left].trim())&&t.preventDefault()}.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=t.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function l(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(e){"toolbar"!==e&&this.options.extensions[e]&&this.extensions.push(o(this.options.extensions[e],e,this))},this),function(){return!this.options.extensions.imageDragging}.call(this)){var t=this.options.fileDragging;t||(t={},function(){return!1!==this.options.imageDragging}.call(this)||(t.allowedTypes=[])),this.addBuiltInExtension("fileDragging",t)}var n={paste:!0,"anchor-preview":function(){return!!a.call(this)&&!1!==this.options.anchorPreview}.call(this),autoLink:function(){return!1!==this.options.autoLink}.call(this),keyboardCommands:function(){return!1!==this.options.keyboardCommands}.call(this),placeholder:function(){return!1!==this.options.placeholder}.call(this)};Object.keys(n).forEach(function(e){n[e]&&this.addBuiltInExtension(e)},this);var r=this.options.extensions.toolbar;if(!r&&a.call(this)){var i=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});r=new e.extensions.toolbar(i)}r&&this.extensions.push(o(r,"toolbar",this))}function c(t,n){var r,i;if(r=/^append-(.+)$/gi.exec(t))return e.util.execFormatBlock(this.options.ownerDocument,r[1]);if("fontSize"===t)return n.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),i=n.value||n.size,this.options.ownerDocument.execCommand("fontSize",!1,i);if("fontName"===t)return n.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),i=n.value||n.name,this.options.ownerDocument.execCommand("fontName",!1,i);if("createLink"===t)return this.createLink(n);if("image"===t){var o=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,o)}if("html"===t){var a=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,a)}if(/justify([A-Za-z]*)$/g.exec(t)){var s=this.options.ownerDocument.execCommand(t,!1,null),u=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return u&&function(t){if(!t)return;var n,r=Array.prototype.slice.call(t.childNodes).filter(function(e){var t="div"===e.nodeName.toLowerCase();return t&&!n&&(n=e.style.textAlign),t});r.length&&(this.saveSelection(),r.forEach(function(t){if(t.style.textAlign===n){var r=t.lastChild;if(r){e.util.unwrap(t,this.options.ownerDocument);var i=this.options.ownerDocument.createElement("BR");r.parentNode.insertBefore(i,r.nextSibling)}}},this),t.style.textAlign=n,this.restoreSelection())}.call(this,e.util.getTopBlockContainer(u)),s}return i=n&&n.value,this.options.ownerDocument.execCommand(t,!1,i)}var d={};e.prototype={init:function(t,n){return this.options=function(t,n){return n&&[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]].forEach(function(t){n.hasOwnProperty(t[0])&&void 0!==n[t[0]]&&e.util.deprecated(t[0],t[1],"v6.0.0")}),e.util.defaults({},n,t)}.call(this,this.defaults,n),this.origElements=t,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(function(e){e._mediumEditors||(e._mediumEditors=[null]),this.id||(this.id=e._mediumEditors.length),e._mediumEditors[this.id]=this}.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),0!==this.elements.length&&(this.isActive=!0,l.call(this),u.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(e){"function"==typeof e.destroy&&e.destroy()},this),this.events.destroy(),this.elements.forEach(function(e){this.options.spellcheck&&(e.innerHTML=e.innerHTML),e.removeAttribute("contentEditable"),e.removeAttribute("spellcheck"),e.removeAttribute("data-medium-editor-element"),e.classList.remove("medium-editor-element"),e.removeAttribute("role"),e.removeAttribute("aria-multiline"),e.removeAttribute("medium-editor-index"),e.removeAttribute("data-medium-editor-editor-index"),e.getAttribute("medium-editor-textarea-id")&&i(e)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,function(e){e._mediumEditors&&e._mediumEditors[this.id]&&(e._mediumEditors[this.id]=null)}.call(this,this.options.contentWindow))},on:function(e,t,n,r){return this.events.attachDOMEvent(e,t,n,r),this},off:function(e,t,n,r){return this.events.detachDOMEvent(e,t,n,r),this},subscribe:function(e,t){return this.events.attachCustomEvent(e,t),this},unsubscribe:function(e,t){return this.events.detachCustomEvent(e,t),this},trigger:function(e,t,n){return this.events.triggerCustomEvent(e,t,n),this},delay:function(e){var t=this;return setTimeout(function(){t.isActive&&e()},this.options.delay)},serialize:function(){var e,t={},n=this.elements.length;for(e=0;e<n;e+=1)t[""!==this.elements[e].id?this.elements[e].id:"element-"+e]={value:this.elements[e].innerHTML.trim()};return t},getExtensionByName:function(e){var t;return this.extensions&&this.extensions.length&&this.extensions.some(function(n){return n.name===e&&(t=n,!0)}),t},addBuiltInExtension:function(t,n){var r,i=this.getExtensionByName(t);if(i)return i;switch(t){case"anchor":r=e.util.extend({},this.options.anchor,n),i=new e.extensions.anchor(r);break;case"anchor-preview":i=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":i=new e.extensions.autoLink;break;case"fileDragging":i=new e.extensions.fileDragging(n);break;case"fontname":i=new e.extensions.fontName(this.options.fontName);break;case"fontsize":i=new e.extensions.fontSize(n);break;case"keyboardCommands":i=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":i=new e.extensions.paste(this.options.paste);break;case"placeholder":i=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(t)&&(n?(r=e.util.defaults({},n,e.extensions.button.prototype.defaults[t]),i=new e.extensions.button(r)):i=new e.extensions.button(t))}return i&&this.extensions.push(o(i,t,this)),i},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var e=this.getExtensionByName("toolbar");return e&&e.checkState(),this},queryCommandState:function(e){var t,n=null;(t=/^full-(.+)$/gi.exec(e))&&(e=t[1]);try{n=this.options.ownerDocument.queryCommandState(e)}catch(e){n=null}return n},execAction:function(t,n){var r,i;return(r=/^full-(.+)$/gi.exec(t))?(this.saveSelection(),this.selectAllContents(),i=c.call(this,r[1],n),this.restoreSelection()):i=c.call(this,t,n),"insertunorderedlist"!==t&&"insertorderedlist"!==t||e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),i},getSelectedParentElement:function(t){return void 0===t&&(t=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(t)},selectAllContents:function(){var t=e.selection.getSelectionElement(this.options.contentWindow);if(t){for(;1===t.children.length;)t=t.children[0];this.selectElement(t)}},selectElement:function(t){e.selection.selectNode(t,this.options.ownerDocument);var n=e.selection.getSelectionElement(this.options.contentWindow);n&&this.events.focusElement(n)},getFocusedElement:function(){var e;return this.elements.some(function(t){return!e&&t.getAttribute("data-medium-focused")&&(e=t),!!e},this),e},exportSelection:function(){var t=e.selection.getSelectionElement(this.options.contentWindow),n=this.elements.indexOf(t),r=null;return n>=0&&(r=e.selection.exportSelection(t,this.options.ownerDocument)),null!==r&&0!==n&&(r.editableElementIndex=n),r},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(t,n){if(t){var r=this.elements[t.editableElementIndex||0];e.selection.importSelection(t,r,this.options.ownerDocument,n)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(t){var n,r=e.selection.getSelectionElement(this.options.contentWindow),i={};if(-1!==this.elements.indexOf(r)){try{if(this.events.disableCustomEvent("editableInput"),t.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),(n=t.url||t.value)&&n.trim().length>0){var o=this.options.contentWindow.getSelection();if(o){var a,s,u,l,c=o.getRangeAt(0),d=c.commonAncestorContainer;if(3===c.endContainer.nodeType&&3!==c.startContainer.nodeType&&0===c.startOffset&&c.startContainer.firstChild===c.endContainer&&(d=c.endContainer),s=e.util.getClosestBlockContainer(c.startContainer),u=e.util.getClosestBlockContainer(c.endContainer),3!==d.nodeType&&0!==d.textContent.length&&s===u){var f=s||r,h=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),a=this.exportSelection(),h.appendChild(f.cloneNode(!0)),r===f?e.selection.select(this.options.ownerDocument,f.firstChild,0,f.lastChild,3===f.lastChild.nodeType?f.lastChild.nodeValue.length:f.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,f,0,f,f.childNodes.length);var m=this.exportSelection();0===(l=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,h,{start:a.start-m.start,end:a.end-m.start,editableElementIndex:a.editableElementIndex})).length&&((h=this.options.ownerDocument.createDocumentFragment()).appendChild(d.cloneNode(!0)),l=[h.firstChild.firstChild,h.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,l,n.trim());var p=(h.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,h.firstChild.innerHTML.replace(/^\s+/,"")),a.start-=p,a.end-=p,this.importSelection(a)}else this.options.ownerDocument.execCommand("createLink",!1,n);this.options.targetBlank||"_blank"===t.target?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),n):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),n),t.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),t.buttonClass)}}if(this.options.targetBlank||"_blank"===t.target||t.buttonClass){(i=this.options.ownerDocument.createEvent("HTMLEvents")).initEvent("input",!0,!0,this.options.contentWindow);for(var g=0,v=this.elements.length;g<v;g+=1)this.elements[g].dispatchEvent(i)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",i,r)}},cleanPaste:function(e){this.getExtensionByName("paste").cleanPaste(e)},pasteHTML:function(e,t){this.getExtensionByName("paste").pasteHTML(e,t)},setContent:function(e,t){if(t=t||0,this.elements[t]){var n=this.elements[t];n.innerHTML=e,this.checkContentChanged(n)}},getContent:function(e){return e=e||0,this.elements[e]?this.elements[e].innerHTML.trim():null},checkContentChanged:function(t){t=t||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(t,{target:t,currentTarget:t})},resetContent:function(e){if(e){var t=this.elements.indexOf(e);-1!==t&&this.setContent(d[e.getAttribute("medium-editor-index")],t)}else this.elements.forEach(function(e,t){this.setContent(d[e.getAttribute("medium-editor-index")],t)},this)},addElements:function(e){var t=r(e,this.options.ownerDocument,!0);if(0===t.length)return!1;t.forEach(function(e){e=s.call(this,e,this.id),this.elements.push(e),this.trigger("addElement",{target:e,currentTarget:e},e)},this)},removeElements:function(e){var t=r(e,this.options.ownerDocument).map(function(e){return e.getAttribute("medium-editor-textarea-id")&&e.parentNode?e.parentNode.querySelector('div[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]'):e});this.elements=this.elements.filter(function(e){return-1===t.indexOf(e)||(this.events.cleanupElement(e),e.getAttribute("medium-editor-textarea-id")&&i(e),this.trigger("removeElement",{target:e,currentTarget:e},e),!1)},this)}},e.getEditorFromElement=function(e){var t=e.getAttribute("data-medium-editor-editor-index"),n=e&&e.ownerDocument&&(e.ownerDocument.defaultView||e.ownerDocument.parentWindow);return n&&n._mediumEditors&&n._mediumEditors[t]?n._mediumEditors[t]:null}}(),e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0},e.parseVersionString=function(e){var t=e.split("-"),n=t[0].split("."),r=t.length>1?t[1]:"";return{major:parseInt(n[0],10),minor:parseInt(n[1],10),revision:parseInt(n[2],10),preRelease:r,toString:function(){return[n[0],n[1],n[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,"5.23.1"),e}(),"undefined"!=typeof process&&process&&process.versions&&process.versions.electron?t.MediumEditor=n:e.exports=n}),FireHtml={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"inline"},[t(this.customTag,{ref:"element",tag:"component",class:{hide:this.shouldHide}})],1)},staticRenderFns:[],_scopeId:"data-v-fc49c29e",name:"fire-html",props:{async:{type:[Boolean],default:()=>!1},path:{type:[String],default:()=>void 0},defaultValue:{type:[String],default:()=>null},customTag:{type:[String],default:()=>"div"},editable:{type:[Boolean],default:()=>!1},mediumEditingOptions:{type:[Object],default:()=>({toolbar:!0,placeholder:!1})}},data:()=>({innerHtml:"",updatedValue:null}),mounted(e){null!==this.defaultValue?this.innerHtml=this.defaultValue:null!==this.firebaseReference&&this.updateValueFromReference(),this.refreshMediumEditor()},beforeDestroy(){this.editable&&this.updateFirebaseWithValue(this.updatedValue),this.tearDownEditor()},methods:{updateValueFromReference(){void 0===this.isListening&&(this.isListening=this.firebaseReference.on("value",e=>{this.innerHtml=e.val()||""}))},tearDownEditor(){this.api&&(this.api.unsubscribe("editableInput",this.onEdit),this.api.destroy())},createWithOptions(e){this.updateInnerHtml(this.innerHtml),this.api=new mediumEditor(this.$refs.element,e),this.api.subscribe("editableInput",this.onEdit)},setUpdatedValue(e){this.updatedValue=e},onEdit(e){this.setUpdatedValue(e.target.innerHTML),this.async&&this.updateFirebaseWithValue(this.updatedValue)},updateFirebaseWithValue(e){null!==this.firebaseReference&&null!==this.updatedValue?this.firebaseReference.set(e).catch(e=>{console.error(e)}):console.warn("Firebase Reference is null, cannot update data")},refreshMediumEditor(){this.tearDownEditor(),this.editable?this.createWithOptions(this.mediumEditingOptions):this.createWithOptions({toolbar:!1,disableEditing:!0,placeholder:!1})},updateInnerHtml(e){e!==this.$refs.element.innerHTML&&(this.$refs.element.innerHTML=e)}},computed:{firebaseReference(){return this.$firebase.database().ref(this.path)},shouldHide(){return(!this.plainText.length||null!==this.updatedValue&&!this.updatedValue.replace(/<\/?[^>]+(>|$)/g,"").length)&&!this.editable},plainText(){return this.innerHtml.replace(/<\/?[^>]+(>|$)/g,"")}},watch:{async(e){e&&void 0!==this.isListening&&this.isListening()},innerHtml(e){this.updateInnerHtml(e)},editable(e){e||null===this.updatedValue||this.updateFirebaseWithValue(this.updatedValue),this.refreshMediumEditor()},mediumEditorOptions(e){this.refreshMediumEditor()},defaultValue(e){void 0!==this.isListening&&console.log("was listening"),this.updateInnerHtml(e)}}};const component={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._t("edit",[n(e.customTag,{tag:"component",class:{hide:e.hasLoaded,placeholder:!0}},[e._v("...")])]),e._v(" "),e._t("display",[n(e.customTag,{ref:"element",tag:"component",class:{hide:e.shouldHide}})])],2)},staticRenderFns:[],_scopeId:"data-v-5a21cb33",name:"fire-text",props:{async:{type:[Boolean],default:()=>!1},path:{type:[String],default:()=>void 0},defaultValue:{type:[String],default:()=>null},isNumber:{type:[Boolean],default:()=>!1},customTag:{type:[String],default:()=>"p"},editable:{type:[Boolean],default:()=>!1}},data:()=>({innerText:"",updatedText:null,hasLoaded:!1}),mounted(e){this.$messenger.bus.$on("save",()=>{this.editable&&this.updateFirebaseWithValue(this.updatedText)}),this.$messenger.bus.$on("reset",()=>{this.editable&&this.discardEdits()}),null!==this.defaultValue?(this.innerText=this.defaultValue,this.hasLoaded=!0):null!==this.firebaseReference&&this.updateValueFromReference(),this.refreshMediumEditor()},beforeDestroy(){this.tearDownEditor()},methods:{discardEdits(){this.api.resetContent()},updateValueFromReference(){void 0===this.isListening&&(this.isListening=this.firebaseReference.on("value",e=>{this.innerText=e.val()||"",this.hasLoaded=!0}))},tearDownEditor(){this.api&&(this.api.unsubscribe("editableInput",this.onEdit),this.api.destroy())},createWithOptions(e){this.updateInnerHtml(this.innerText),this.api=new mediumEditor(this.$refs.element,e),this.api.subscribe("editableInput",this.onEdit)},setUpdatedValue(e){this.updatedText=e},onEdit(e){this.setUpdatedValue(e.target.innerHTML),this.async&&this.updateFirebaseWithValue(this.updatedText)},updateFirebaseWithValue(e){null!==this.firebaseReference&&null!==this.updatedText?(this.isNumber&&(e=Number(e)),this.firebaseReference.set(e).catch(e=>{console.error(e)})):console.warn("Firebase Reference is null, cannot update data")},refreshMediumEditor(){this.tearDownEditor(),this.editable?this.createWithOptions({toolbar:!0,disableEditing:!1,disableReturn:!0,placeholder:!1}):this.createWithOptions({toolbar:!1,disableEditing:!0,placeholder:!1})},updateInnerHtml(e){e!==this.$refs.element.innerHTML&&(this.$refs.element.innerHTML=e)}},computed:{firebaseReference(){return this.$firebase.database().ref(this.path)},shouldHide(){return!this.innerText.length&&!this.editable}},watch:{async(e){e&&void 0!==this.isListening&&this.isListening()},innerText(e){this.updateInnerHtml(e)},editable(e){this.refreshMediumEditor()},mediumEditorOptions(e){this.refreshMediumEditor()},defaultValue(e){void 0!==this.isListening&&console.log("was listening"),this.updateInnerHtml(e)}}};var FireImage={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"root",staticClass:"firecomponent--fire-image--container"},[e._t("display",[n("div",{staticClass:"firecomponent--fire-image--display"},[n("div",{staticClass:"firecomponent--fire-image--ratio-enforcer",style:{paddingTop:100*e.padding+"%"}}),e._v(" "),n("div",{staticClass:"firecomponent--fire-image--content",style:{backgroundImage:"url("+e.imageLocation+")"}})])],{src:e.imageLocation}),e._v(" "),e.editable?n("div",{staticClass:"firecomponent--fire-image--edit-controller"},[e._t("edit-controller",[n("label",{staticClass:"firecomponent--button firecomponent--fire-image-change-label",attrs:{for:e.uniqueName,title:"Click to upload new image"}},[e._v(" Change ")])],{for:e.uniqueName}),e._v(" "),n("input",{attrs:{type:"file",id:e.uniqueName},on:{change:e.imageUploaded}})],2):e._e()],2)},staticRenderFns:[],_scopeId:"data-v-138f7b76",name:"fire-image",props:{storageRef:{type:[Object,String],default:()=>null},editable:{type:[Boolean],default:()=>!1},aspectRatio:{type:[Number],default:()=>1},widths:{type:[Array],default:()=>[320,500]},quality:{type:[Number],default:()=>1},circle:{type:[Boolean],default:()=>!1},enforceBoundary:{type:[Boolean],default:()=>!0},allowRotations:{type:[Boolean],default:()=>!0}},data:()=>({uploadedImage:null,croppieInstance:null,croppedImage:null,newUpload:!1,uploading:!1,uploadTasks:[],imageLocation:null,index:null}),mounted(){this._storageRef&&this.loadFromStorage(this._storageRef)},computed:{uniqueName:()=>Math.random().toString(36).substring(4),width(){return this.$el&&this.$el.clientWidth?this.$el.clientWidth:null},height(){return this.width/this.aspectRatio},padding(){return 1/this.aspectRatio},format(){return this.quality<1?"jpeg":"png"},_storageRef(){if(this.storageRef)try{return"string"==typeof this.storageRef?this.$firebase.storage().ref(this.storageRef):this.$firebase.storage().refFromURL(this.storageRef.toString())}catch(e){return console.error(e),null}}},watch:{_storageRef(e){e&&this.loadFromStorage(e)}},methods:{loadFromStorage(e){(e=e.child(""+this.getIndexToDisplay())).getDownloadURL().then(t=>{e.parent.toString()===this._storageRef.toString()&&(this.imageLocation=t)},()=>{console.error("No Image at specified location.")})},getIndexToDisplay(){const e=this.$refs.root.clientWidth;var t={index:0,offset:null};return this.widths.forEach((n,r)=>{const i=Math.abs(n-e);(null===t.offset||i<t.offset)&&(t={index:r,offset:i})}),this.index=t.index,t.index},imageUploaded(e){const t=this._storageRef.toString(),n={widths:this.widths,aspectRatio:this.aspectRatio,enforceBoundary:this.enforceBoundary,allowRotations:this.allowRotations,circle:this.circle,format:this.format};this.$imageBus.bus.$on(t+"-cancelled",this.newCancelledCallback(t)),this.$imageBus.bus.$on(t+"-completed",this.newCompletedCallback(t)),this.$imageBus.newUpload(t,e,n)},newCancelledCallback(e){const t=()=>{this.$imageBus.bus.$off(e+"-cancelled",t)};return t},newCompletedCallback(e){const t=(n,r)=>{this.$imageBus.bus.$off(e+"-completed",t);const i=this.getIndexToDisplay();this.imageLocation=r[i]};return t}}},FireInput={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.customTag,{tag:"component"},[e.editable?n("span",{key:e.editorKey,ref:"editor",staticClass:"editor",style:e.editorStyle,attrs:{contenteditable:"true"},on:{input:e.contentChangeEventHandler}},[e._v(" "+e._s(e.content)+" ")]):e._t("display",[e._v(" "+e._s(e.content)+" ")],{content:e.content})],2)},staticRenderFns:[],_scopeId:"data-v-df63bd98",name:"fire-input",props:{path:{required:!0,type:[String]},editable:{required:!0,type:[Boolean]},useTransaction:{type:[Boolean],default:!1},customTag:{type:[String],default:"span"},editorStyle:{type:[Object],default:()=>Object.create(null)}},data(){return{content:null,snapshotVal:null,editableContentSnapshot:null,unsub:null,hasChanges:!1,saving:!1,error:null,startTime:null,isLoaded:!1,firebaseRef:this.$firebase.database().ref(this.path),editorKey:"editor-"+Math.random().toString(36).substring(4)}},watch:{editable(e){e||this.updateContent()},snapshotVal(e){this.editable&&this.isLoaded||(this.isLoaded=!0,this.updateContent())}},methods:{updateContent(){this.hasChanges=!1,this.content=this.snapshotVal,this.editableContentSnapshot=this.snapshotVal},finished(){this.$nextTick(()=>{this.error||this.reset(),this.saving=!1})},save(){this.saving=!0,this.useTransaction&&"number"==typeof this.snapshotVal?this.firebaseRef.transaction(e=>{return e+(this.snapshotVal.constructor(this.editableContentSnapshot)-this.content)},(e,t,n)=>{e?this.error=e:t||(this.error="Did not save."),this.finished()},!1):this.firebaseRef.set(this.snapshotVal.constructor(this.editableContentSnapshot)).catch(e=>{this.error=e}).then(this.finished)},reset(){this.updateContent(),this.$nextTick(()=>{this.$refs.editor.innerText!==this.editableContentSnapshot&&(this.$refs.editor.innerText=this.editableContentSnapshot)})},contentChangeEventHandler(e){this.editableContentSnapshot=e.target.innerText}},mounted:function(){this.isLoaded=!1,this.unsub=this.firebaseRef.on("value",e=>{this.hasChanges=!0,this.snapshotVal=e.exists()?e.val():null}),this.$messenger.bus.$on("save",this.save),this.$messenger.bus.$on("reset",this.reset)},beforeDestroy(){this.unsub&&this.firebaseRef.off("value",this.unsub)}},croppie=createCommonjsModule(function(e,t){var n,r;n=commonjsGlobal,r=function(t){"function"!=typeof Promise&&function(t){function n(e,t){return function(){e.apply(t,arguments)}}function r(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,n(o,this),n(a,this))}function i(e){var t=this;return null===this._state?void this._deferreds.push(e):void c(function(){var n=t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void e.reject(t)}e.resolve(r)}else(t._state?e.resolve:e.reject)(t._value)})}function o(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void u(n(t,e),n(o,this),n(a,this))}this._state=!0,this._value=e,s.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;t>e;e++)i.call(this,this._deferreds[e]);this._deferreds=null}function u(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(e){if(r)return;r=!0,n(e)}}var l=setTimeout,c="function"==typeof setImmediate&&setImmediate||function(e){l(e,1)},d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var n=this;return new r(function(r,o){i.call(n,new function(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}(e,t,r,o))})},r.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&d(arguments[0])?arguments[0]:arguments);return new r(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){r(o,e)},n)}e[o]=a,0==--i&&t(e)}catch(e){n(e)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,n){n(e)})},r.race=function(e){return new r(function(t,n){for(var r=0,i=e.length;i>r;r++)e[r].then(t,n)})},r._setImmediateFn=function(e){c=e},e.exports?e.exports=r:t.Promise||(t.Promise=r)}(this),"function"!=typeof window.CustomEvent&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}(),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var r=atob(this.toDataURL(t,n).split(",")[1]),i=r.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=r.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}))}});var n,r,i,o=["Webkit","Moz","ms"],a=document.createElement("div").style;function s(e){if(e in a)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=o.length;n--;)if((e=o[n]+t)in a)return e}function u(e,t){for(var n in e=e||{},t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},u(e[n],t[n])):e[n]=t[n];return e}function l(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function c(e,t,n){if("string"==typeof t){var r=t;(t={})[r]=n}for(var i in t)e.style[i]=t[i]}function d(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function f(e){return parseInt(e,10)}r=s("transform"),n=s("transformOrigin"),i=s("userSelect");var h={translate3d:{suffix:", 0px"},translate:{suffix:""}},m=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};m.parse=function(e){return e.style?m.parse(e.style[r]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?m.fromMatrix(e):m.fromString(e)},m.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new m(f(t[4]),f(t[5]),parseFloat(t[0]))},m.fromString=function(e){var t=e.split(") "),n=t[0].substring(q.globals.translate.length+1).split(","),r=t.length>1?t[1].substring(6):1,i=n.length>1?n[0]:0,o=n.length>1?n[1]:0;return new m(i,o,r)},m.prototype.toString=function(){var e=h[q.globals.translate].suffix||"";return q.globals.translate+"("+this.x+"px, "+this.y+"px"+e+") scale("+this.scale+")"};var p=function(e){if(!e||!e.style[n])return this.x=0,void(this.y=0);var t=e.style[n].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};function g(e,t,n){var r=t.width,i=t.height,o=e.getContext("2d");switch(e.width=t.width,e.height=t.height,o.save(),n){case 2:o.translate(r,0),o.scale(-1,1);break;case 3:o.translate(r,i),o.rotate(180*Math.PI/180);break;case 4:o.translate(0,i),o.scale(1,-1);break;case 5:e.width=i,e.height=r,o.rotate(90*Math.PI/180),o.scale(1,-1);break;case 6:e.width=i,e.height=r,o.rotate(90*Math.PI/180),o.translate(0,-i);break;case 7:e.width=i,e.height=r,o.rotate(-90*Math.PI/180),o.translate(-r,i),o.scale(1,-1);break;case 8:e.width=i,e.height=r,o.translate(0,r),o.rotate(-90*Math.PI/180)}o.drawImage(t,0,0,r,i),o.restore()}function v(){var e,t,n,o,a,s=this.options.viewport.type?"cr-vp-"+this.options.viewport.type:null;this.options.useCanvas=this.options.enableOrientation||b.call(this),this.data={},this.elements={},e=this.elements.boundary=document.createElement("div"),t=this.elements.viewport=document.createElement("div"),this.elements.img=document.createElement("img"),n=this.elements.overlay=document.createElement("div"),this.options.useCanvas?(this.elements.canvas=document.createElement("canvas"),this.elements.preview=this.elements.canvas):this.elements.preview=this.elements.img,d(e,"cr-boundary"),o=this.options.boundary.width,a=this.options.boundary.height,c(e,{width:o+(isNaN(o)?"":"px"),height:a+(isNaN(a)?"":"px")}),d(t,"cr-viewport"),s&&d(t,s),c(t,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),t.setAttribute("tabindex",0),d(this.elements.preview,"cr-image"),d(n,"cr-overlay"),this.element.appendChild(e),e.appendChild(this.elements.preview),e.appendChild(t),e.appendChild(n),d(this.element,"croppie-container"),this.options.customClass&&d(this.element,this.options.customClass),function(){var e,t,n,o,a,s=this,u=!1;function d(e,t){var n=s.elements.preview.getBoundingClientRect(),r=a.y+t,i=a.x+e;s.options.enforceBoundary?(o.top>n.top+t&&o.bottom<n.bottom+t&&(a.y=r),o.left>n.left+e&&o.right<n.right+e&&(a.x=i)):(a.y=r,a.x=i)}function f(n){if((void 0===n.button||0===n.button)&&(n.preventDefault(),!u)){if(u=!0,e=n.pageX,t=n.pageY,n.touches){var r=n.touches[0];e=r.pageX,t=r.pageY}a=m.parse(s.elements.preview),window.addEventListener("mousemove",h),window.addEventListener("touchmove",h),window.addEventListener("mouseup",p),window.addEventListener("touchend",p),document.body.style[i]="none",o=s.elements.viewport.getBoundingClientRect()}}function h(i){i.preventDefault();var o=i.pageX,u=i.pageY;if(i.touches){var f=i.touches[0];o=f.pageX,u=f.pageY}var h=o-e,m=u-t,p={};if("touchmove"==i.type&&i.touches.length>1){var g=i.touches[0],v=i.touches[1],b=Math.sqrt((g.pageX-v.pageX)*(g.pageX-v.pageX)+(g.pageY-v.pageY)*(g.pageY-v.pageY));n||(n=b/s._currentZoom);var C=b/n;return y.call(s,C),void l(s.elements.zoomer)}d(h,m),p[r]=a.toString(),c(s.elements.preview,p),E.call(s),t=u,e=o}function p(){u=!1,window.removeEventListener("mousemove",h),window.removeEventListener("touchmove",h),window.removeEventListener("mouseup",p),window.removeEventListener("touchend",p),document.body.style[i]="",w.call(s),A.call(s),n=0}s.elements.overlay.addEventListener("mousedown",f),s.elements.viewport.addEventListener("keydown",function(e){var t=37,u=38,l=39,f=40;if(!e.shiftKey||e.keyCode!=u&&e.keyCode!=f){if(s.options.enableKeyMovement&&e.keyCode>=37&&e.keyCode<=40){e.preventDefault();var h=function(e){switch(e){case t:return[1,0];case u:return[0,1];case l:return[-1,0];case f:return[0,-1]}}(e.keyCode);a=m.parse(s.elements.preview),document.body.style[i]="none",o=s.elements.viewport.getBoundingClientRect(),function(e){var t=e[0],o=e[1],u={};d(t,o),u[r]=a.toString(),c(s.elements.preview,u),E.call(s),document.body.style[i]="",w.call(s),A.call(s),n=0}(h)}}else{var p=0;p=e.keyCode==u?parseFloat(s.elements.zoomer.value,10)+parseFloat(s.elements.zoomer.step,10):parseFloat(s.elements.zoomer.value,10)-parseFloat(s.elements.zoomer.step,10),s.setZoom(p)}}),s.elements.overlay.addEventListener("touchstart",f)}.call(this),this.options.enableZoom&&function(){var e=this,t=e.elements.zoomerWrap=document.createElement("div"),n=e.elements.zoomer=document.createElement("input");function r(){C.call(e,{value:parseFloat(n.value),origin:new p(e.elements.preview),viewportRect:e.elements.viewport.getBoundingClientRect(),transform:m.parse(e.elements.preview)})}function i(t){var n,i;n=t.wheelDelta?t.wheelDelta/1200:t.deltaY?t.deltaY/1060:t.detail?t.detail/-60:0,i=e._currentZoom+n*e._currentZoom,t.preventDefault(),y.call(e,i),r.call(e)}d(t,"cr-slider-wrap"),d(n,"cr-slider"),n.type="range",n.step="0.0001",n.value=1,n.style.display=e.options.showZoomer?"":"none",e.element.appendChild(t),t.appendChild(n),e._currentZoom=1,e.elements.zoomer.addEventListener("input",r),e.elements.zoomer.addEventListener("change",r),e.options.mouseWheelZoom&&(e.elements.boundary.addEventListener("mousewheel",i),e.elements.boundary.addEventListener("DOMMouseScroll",i))}.call(this),this.options.enableResize&&function(){var e,t,n,r,o,a,s,u=this,l=document.createElement("div"),f=!1,h=50;d(l,"cr-resizer"),c(l,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(d(a=document.createElement("div"),"cr-resizer-vertical"),l.appendChild(a));this.options.resizeControls.width&&(d(s=document.createElement("div"),"cr-resizer-horisontal"),l.appendChild(s));function m(a){if((void 0===a.button||0===a.button)&&(a.preventDefault(),!f)){var s=u.elements.overlay.getBoundingClientRect();if(f=!0,t=a.pageX,n=a.pageY,e=-1!==a.currentTarget.className.indexOf("vertical")?"v":"h",r=s.width,o=s.height,a.touches){var l=a.touches[0];t=l.pageX,n=l.pageY}window.addEventListener("mousemove",p),window.addEventListener("touchmove",p),window.addEventListener("mouseup",g),window.addEventListener("touchend",g),document.body.style[i]="none"}}function p(i){var a=i.pageX,s=i.pageY;if(i.preventDefault(),i.touches){var d=i.touches[0];a=d.pageX,s=d.pageY}var f=a-t,m=s-n,p=u.options.viewport.height+m,g=u.options.viewport.width+f;"v"===e&&p>=h&&p<=o?(c(l,{height:p+"px"}),u.options.boundary.height+=m,c(u.elements.boundary,{height:u.options.boundary.height+"px"}),u.options.viewport.height+=m,c(u.elements.viewport,{height:u.options.viewport.height+"px"})):"h"===e&&g>=h&&g<=r&&(c(l,{width:g+"px"}),u.options.boundary.width+=f,c(u.elements.boundary,{width:u.options.boundary.width+"px"}),u.options.viewport.width+=f,c(u.elements.viewport,{width:u.options.viewport.width+"px"})),E.call(u),R.call(u),w.call(u),A.call(u),n=s,t=a}function g(){f=!1,window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p),window.removeEventListener("mouseup",g),window.removeEventListener("touchend",g),document.body.style[i]=""}a&&a.addEventListener("mousedown",m);s&&s.addEventListener("mousedown",m);this.elements.boundary.appendChild(l)}.call(this)}function b(){return this.options.enableExif&&window.EXIF}function y(e){if(this.options.enableZoom){var t=this.elements.zoomer,n=O(e,4);t.value=Math.max(t.min,Math.min(t.max,n))}}function C(e){var t=this,i=e?e.transform:m.parse(t.elements.preview),o=e?e.viewportRect:t.elements.viewport.getBoundingClientRect(),a=e?e.origin:new p(t.elements.preview);function s(){var e={};e[r]=i.toString(),e[n]=a.toString(),c(t.elements.preview,e)}if(t._currentZoom=e?e.value:t._currentZoom,i.scale=t._currentZoom,s(),t.options.enforceBoundary){var u=function(e){var t=this._currentZoom,n=e.width,r=e.height,i=this.elements.boundary.clientWidth/2,o=this.elements.boundary.clientHeight/2,a=this.elements.preview.getBoundingClientRect(),s=a.width,u=a.height,l=n/2,c=r/2,d=-1*(l/t-i),f=-1*(c/t-o),h=1/t*l,m=1/t*c;return{translate:{maxX:d,minX:d-(s*(1/t)-n*(1/t)),maxY:f,minY:f-(u*(1/t)-r*(1/t))},origin:{maxX:s*(1/t)-h,minX:h,maxY:u*(1/t)-m,minY:m}}}.call(t,o),l=u.translate,d=u.origin;i.x>=l.maxX&&(a.x=d.minX,i.x=l.maxX),i.x<=l.minX&&(a.x=d.maxX,i.x=l.minX),i.y>=l.maxY&&(a.y=d.minY,i.y=l.maxY),i.y<=l.minY&&(a.y=d.maxY,i.y=l.minY)}s(),T.call(t),A.call(t)}function w(){var e=this._currentZoom,t=this.elements.preview.getBoundingClientRect(),i=this.elements.viewport.getBoundingClientRect(),o=m.parse(this.elements.preview.style[r]),a=new p(this.elements.preview),s=i.top-t.top+i.height/2,u=i.left-t.left+i.width/2,l={},d={};l.y=s/e,l.x=u/e,d.y=(l.y-a.y)*(1-e),d.x=(l.x-a.x)*(1-e),o.x-=d.x,o.y-=d.y;var f={};f[n]=l.x+"px "+l.y+"px",f[r]=o.toString(),c(this.elements.preview,f)}function E(){var e=this.elements.boundary.getBoundingClientRect(),t=this.elements.preview.getBoundingClientRect();c(this.elements.overlay,{width:t.width+"px",height:t.height+"px",top:t.top-e.top+"px",left:t.left-e.left+"px"})}p.prototype.toString=function(){return this.x+"px "+this.y+"px"};var x,N,S,k,T=(x=E,N=500,function(){var e=this,t=arguments,n=S&&!k;clearTimeout(k),k=setTimeout(function(){k=null,S||x.apply(e,t)},N),n&&x.apply(e,t)});function A(){var e,t=this.get();D.call(this)&&(this.options.update.call(this,t),this.$&&"undefined"==typeof Prototype?this.$(this.element).trigger("update",t):(window.CustomEvent?e=new CustomEvent("update",{detail:t}):(e=document.createEvent("CustomEvent")).initCustomEvent("update",!0,!0,t),this.element.dispatchEvent(e)))}function D(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function B(){var e={},t=this.elements.preview,i=this.elements.preview.getBoundingClientRect(),o=new m(0,0,1),a=new p;D.call(this)&&!this.data.bound&&(this.data.bound=!0,e[r]=o.toString(),e[n]=a.toString(),e.opacity=1,c(t,e),this._originalImageWidth=i.width,this._originalImageHeight=i.height,this.options.enableZoom?R.call(this,!0):this._currentZoom=1,o.scale=this._currentZoom,e[r]=o.toString(),c(t,e),this.data.points.length?function(e){if(4!=e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=e[2]-e[0],i=this.elements.viewport.getBoundingClientRect(),o=this.elements.boundary.getBoundingClientRect(),a={left:i.left-o.left,top:i.top-o.top},s=i.width/t,u=e[1],l=e[0],d=-1*e[1]+a.top,f=-1*e[0]+a.left,h={};h[n]=l+"px "+u+"px",h[r]=new m(f,d,s).toString(),c(this.elements.preview,h),y.call(this,s),this._currentZoom=s}.call(this,this.data.points):function(){var e=this.elements.preview.getBoundingClientRect(),t=this.elements.viewport.getBoundingClientRect(),n=this.elements.boundary.getBoundingClientRect(),i=t.left-n.left,o=t.top-n.top,a=i-(e.width-t.width)/2,s=o-(e.height-t.height)/2,u=new m(a,s,this._currentZoom);c(this.elements.preview,r,u.toString())}.call(this),w.call(this),E.call(this))}function R(e){var t,n,r,i,o=0,a=1.5,s=this.elements.zoomer,u=parseFloat(s.value),c=this.elements.boundary.getBoundingClientRect(),d=this.elements.preview.getBoundingClientRect(),f=this.elements.viewport.getBoundingClientRect();this.options.enforceBoundary&&(r=f.width/(e?d.width:d.width/u),i=f.height/(e?d.height:d.height/u),o=Math.max(r,i)),o>=a&&(a=o+1),s.min=O(o,4),s.max=O(a,4),e&&(n=Math.max(c.width/d.width,c.height/d.height),t=null!==this.data.boundZoom?this.data.boundZoom:n,y.call(this,t)),l(s)}function _(e){var t=e.points,n=f(t[0]),r=f(t[1]),i=f(t[2]),o=f(t[3]),a=i-n,s=o-r,u=e.circle,l=document.createElement("canvas"),c=l.getContext("2d"),d=a,h=s,m=0,p=0,g=d,v=h,b=1;return e.outputWidth&&e.outputHeight&&(g=e.outputWidth,v=e.outputHeight,b=g/d),l.width=g,l.height=v,e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(0,0,d,h)),this.options.enforceBoundary||(n<0&&(m=Math.abs(n),n=0),r<0&&(p=Math.abs(r),r=0),i>this._originalImageWidth&&(d=a=this._originalImageWidth-n),o>this._originalImageHeight&&(h=s=this._originalImageHeight-r)),1!==b&&(m*=b,p*=b,d*=b,h*=b),c.drawImage(this.elements.preview,n,r,Math.min(a,this._originalImageWidth),Math.min(s,this._originalImageHeight),m,p,d,h),u&&(c.fillStyle="#fff",c.globalCompositeOperation="destination-in",c.beginPath(),c.arc(d/2,h/2,d/2,0,2*Math.PI,!0),c.closePath(),c.fill()),l}function L(e,t){var n,r,i,o,a,s=this,u=[],l=null,c=b.call(s);if("string"==typeof e)n=e,e={};else if(Array.isArray(e))u=e.slice();else{if(void 0===e&&s.data.url)return B.call(s),A.call(s),null;n=e.url,u=e.points||[],l=void 0===e.zoom?null:e.zoom}return s.data.bound=!1,s.data.url=n||s.data.url,s.data.boundZoom=l,(r=n,i=s.elements.img,o=c,a=i||new Image,a.style.opacity=0,new Promise(function(e){function t(){setTimeout(function(){e(a)},1)}a.src!==r?(a.exifdata=null,a.removeAttribute("crossOrigin"),r.match(/^https?:\/\/|^\/\//)&&a.setAttribute("crossOrigin","anonymous"),a.onload=function(){o?EXIF.getData(a,function(){t()}):t()},a.src=r):t()})).then(function(n){if(u.length)s.options.relative&&(u=[u[0]*n.naturalWidth/100,u[1]*n.naturalHeight/100,u[2]*n.naturalWidth/100,u[3]*n.naturalHeight/100]);else{var r,i,o=function(e){var t=e.naturalWidth,n=e.naturalHeight;if(e.exifdata&&e.exifdata.Orientation>=5){var r=t;t=n,n=r}return{width:t,height:n}}(n),a=s.elements.viewport.getBoundingClientRect(),l=a.width/a.height;o.width/o.height>l?r=(i=o.height)*l:i=(r=o.width)/l;var c=(o.width-r)/2,d=(o.height-i)/2,h=c+r,m=d+i;s.data.points=[c,d,h,m]}s.data.points=u.map(function(e){return parseFloat(e)}),s.options.useCanvas&&function(e){var t=this.elements.canvas,n=this.elements.img,r=t.getContext("2d"),i=b.call(this);e=this.options.enableOrientation&&e,r.clearRect(0,0,t.width,t.height),t.width=n.width,t.height=n.height,i&&!e?g(t,n,f(function(e){return e.exifdata.Orientation}(n)||0)):e&&g(t,n,e)}.call(s,e.orientation||1),B.call(s),A.call(s),t&&t()})}function O(e,t){return parseFloat(e).toFixed(t||0)}function P(){var e=this.elements.preview.getBoundingClientRect(),t=this.elements.viewport.getBoundingClientRect(),n=t.left-e.left,r=t.top-e.top,i=(t.width-this.elements.viewport.offsetWidth)/2,o=(t.height-this.elements.viewport.offsetHeight)/2,a=n+this.elements.viewport.offsetWidth+i,s=r+this.elements.viewport.offsetHeight+o,u=this._currentZoom;(u===1/0||isNaN(u))&&(u=1);var l=this.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return n=Math.max(l,n/u),r=Math.max(l,r/u),a=Math.max(l,a/u),s=Math.max(l,s/u),{points:[O(n),O(r),O(a),O(s)],zoom:u}}var I={type:"canvas",format:"png",quality:1},F=["jpeg","webp","png"];function M(e){var t=this,n=P.call(t),r=u(I,u({},e)),i="string"==typeof e?e:r.type||"base64",o=r.size||"viewport",a=r.format,s=r.quality,l=r.backgroundColor,f="boolean"==typeof r.circle?r.circle:"circle"===t.options.viewport.type,h=t.elements.viewport.getBoundingClientRect(),m=h.width/h.height;return"viewport"===o?(n.outputWidth=h.width,n.outputHeight=h.height):"object"==typeof o&&(o.width&&o.height?(n.outputWidth=o.width,n.outputHeight=o.height):o.width?(n.outputWidth=o.width,n.outputHeight=o.width/m):o.height&&(n.outputWidth=o.height*m,n.outputHeight=o.height)),F.indexOf(a)>-1&&(n.format="image/"+a,n.quality=s),n.circle=f,n.url=t.data.url,n.backgroundColor=l,new Promise(function(e,r){switch(i.toLowerCase()){case"rawcanvas":e(_.call(t,n));break;case"canvas":case"base64":e(function(e){return _.call(this,e).toDataURL(e.format,e.quality)}.call(t,n));break;case"blob":(function(e){var t=this;return new Promise(function(n,r){_.call(t,e).toBlob(function(e){n(e)},e.format,e.quality)})}).call(t,n).then(e);break;default:e(function(e){var t=e.points,n=document.createElement("div"),r=document.createElement("img"),i=t[2]-t[0],o=t[3]-t[1];return d(n,"croppie-result"),n.appendChild(r),c(r,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),r.src=e.url,c(n,{width:i+"px",height:o+"px"}),n}.call(t,n))}})}if(window.jQuery){var H=window.jQuery;H.fn.croppie=function(e){if("string"===typeof e){var t=Array.prototype.slice.call(arguments,1),n=H(this).data("croppie");return"get"===e?n.get():"result"===e?n.result.apply(n,t):"bind"===e?n.bind.apply(n,t):this.each(function(){var n=H(this).data("croppie");if(n){var r=n[e];if(!H.isFunction(r))throw"Croppie "+e+" method not found";r.apply(n,t),"destroy"===e&&H(this).removeData("croppie")}})}return this.each(function(){var t=new q(this,e);t.$=H,H(this).data("croppie",t)})}}function q(e,t){if(this.element=e,this.options=u(u({},q.defaults),t),"img"===this.element.tagName.toLowerCase()){var n=this.element;d(n,"cr-original-image");var r=document.createElement("div");this.element.parentNode.appendChild(r),r.appendChild(n),this.element=r,this.options.url=this.options.url||n.src}if(v.call(this),this.options.url){var i={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,L.call(this,i)}}q.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},q.globals={translate:"translate3d"},u(q.prototype,{bind:function(e,t){return L.call(this,e,t)},get:function(){var e=P.call(this),t=e.points;return this.options.relative&&(t[0]/=this.elements.img.naturalWidth/100,t[1]/=this.elements.img.naturalHeight/100,t[2]/=this.elements.img.naturalWidth/100,t[3]/=this.elements.img.naturalHeight/100),e},result:function(e){return M.call(this,e)},refresh:function(){return function(){B.call(this)}.call(this)},setZoom:function(e){y.call(this,e),l(this.elements.zoomer)},rotate:function(e){(function(e){if(!this.options.useCanvas)throw"Croppie: Cannot rotate without enableOrientation";var t=this.elements.canvas,n=document.createElement("canvas"),r=1;n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),90!==e&&-270!==e||(r=6),-90!==e&&270!==e||(r=8),180!==e&&-180!==e||(r=3),g(t,n,r),C.call(this),n=null}).call(this,e)},destroy:function(){return function(){var e,t;this.element.removeChild(this.elements.boundary),e=this.element,t="croppie-container",e.classList?e.classList.remove(t):e.className=e.className.replace(t,""),this.options.enableZoom&&this.element.removeChild(this.elements.zoomerWrap),delete this.elements}.call(this)}}),t.Croppie=window.Croppie=q,e.exports&&(e.exports=q)},"string"!=typeof t.nodeName?r(t):r(n.commonJsStrict={})}),ImageEditor={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.event,expression:"event"}],ref:"root",staticClass:"firecomponent--image-editor--container"},[n("div",{staticClass:"firecomponent--image-editor--vertical-aligner"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploading,expression:"!uploading"}]},[e._t("croppie-header",[n("h1",{staticClass:"firecomponent--image-editor--header"},[e._v("Crop Photo")])]),e._v(" "),n("div",{staticClass:"firecomponent--image-editor--croppie-wrapper"},[n("div",{ref:"croppie"})]),e._v(" "),n("div",{staticClass:"firecomponent--image-editor--controls"},[e._t("croppie-controls",[e.allowOrientation?n("button",{staticClass:"firecomponent--button",on:{click:function(t){e.rotate(-90)}}},[e._v("Rotate Left")]):e._e(),e._v(" "),e.allowOrientation?n("button",{staticClass:"firecomponent--button",on:{click:function(t){e.rotate(90)}}},[e._v("Rotate Right")]):e._e(),e._v(" "),n("button",{staticClass:"firecomponent--button",on:{click:e.cancel}},[e._v("Cancel")]),e._v(" "),n("button",{staticClass:"firecomponent--button",on:{click:e.upload}},[e._v("Complete")])],{rotate:e.rotate,cancel:e.cancel,upload:e.upload})],2)],2),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}],staticClass:"firecomponent--image-editor--uploading-controls"},[e._t("uploading",[n("button",{staticClass:"firecomponent--button",on:{click:e.cancel}},[e._v("Cancel Upload")]),e._v(" "),n("button",{staticClass:"firecomponent--button",on:{click:e.continueWithoutWaiting}},[e._v("Continue Without Waiting")])],{cancel:e.cancel,noWait:e.continueWithoutWaiting})],2)])])},staticRenderFns:[],name:"FireImageEditor",data:()=>({event:null,croppie:null,location:null,task:null,config:null,tasks:{},uploading:!1,watchers:{}}),created(){this.$imageBus.bus.$on("newUpload",this.handleUpload)},computed:{storageRef(){return this.$firebase.storage().refFromURL(this.location||"")},fileURL(){return this.files.length?window.URL.createObjectURL(this.files[0]):""},files(){return this.event?this.event.target.files:[]},viewport(){if(!this.config)return null;const e=.8*this.boundary.width,t={type:this.config.circle?"circle":"square"};return this.config.aspectRatio>1?(t.width=e,t.height=e/this.config.aspectRatio):(t.width=e/this.config.aspectRatio,t.height=e),t},boundary(){const e=.8*window.innerWidth,t=.5*window.innerHeight,n=Math.min(e,t);return{width:n,height:n}},imageFormat(){return this.config?this.config.circle?"png":this.config.format:null},allowOrientation(){return!!this.config&&this.config.enableOrientation}},methods:{initializeCroppie(){this.$nextTick(()=>{this.croppie=new window.Croppie(this.$refs.croppie,{enforceBoundary:this.config.enforceBoundary,enableOrientation:this.config.enableOrientation,viewport:this.viewport,boundary:this.boundary}),this.croppie.bind({url:this.fileURL})})},handleUpload(e,t,n){if(this.event||t.target.files.length<=0)return this.$imageBus.bus.$emit(e+"-cancelled",t);this.event=t,this.location=e,this.config=n,this.initializeCroppie()},rotate(e){this.croppie&&this.allowOrientation&&this.croppie.rotate(e)},cancel(){this.$imageBus.bus.$emit(this.location+"-cancelled",this.e);const e=this.tasks[this.location];e&&e.length&&e.forEach(e=>{e.cancel()}),this.teardown()},teardown(){this.destroyCroppie(),this.location=null,this.event=null,this.config=null},destroyCroppie(){this.croppie&&(this.croppie.destroy(),this.croppie=null)},upload(){const e=this.location,t=this.event;this.tasks[e]=[],this.uploading=!0,Promise.all(this.config.widths.map((e,t)=>{const n=this.storageRef.child(t+"");return this.getCroppedImage(e).then(e=>this.uploadToCloudStorage(e,n))})).then(n=>{e===this.location&&(this.teardown(),this.uploading=!1),this.tasks[e]=null,this.$imageBus.bus.$emit(e+"-completed",t,n.map(e=>e.downloadURL))})},getCroppedImage(e){return this.croppie.result({type:"blob",size:{width:e},format:this.imageFormat,circle:this.config.circle,quality:this.config.quality||1})},uploadToCloudStorage(e,t){var n=t.put(e);return this.tasks[this.location].push(n),n},continueWithoutWaiting(){this.teardown(),this.uploading=!1}}},tinymce=createCommonjsModule(function(e){!function(){var t,n,r,i,o,a,s,u,l,c,d,f,h,m=function(e){return function(){return e}},p={noop:function(){},noarg:function(e){return function(){return e()}},compose:function(e,t){return function(){return e(t.apply(null,arguments))}},constant:m,identity:function(e){return e},tripleEquals:function(e,t){return e===t},curry:function(e){for(var t=new Array(arguments.length-1),n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];var i=t.concat(n);return e.apply(null,i)}},not:function(e){return function(){return!e.apply(null,arguments)}},die:function(e){return function(){throw new Error(e)}},apply:function(e){return e()},call:function(e){e()},never:m(!1),always:m(!0)},g=p.never,v=p.always,b=function(){return y},y=function(){var e=function(e){return e.isNone()},t=function(e){return e()},n=function(e){return e},r={fold:function(e,t){return e()},is:g,isSome:g,isNone:v,getOr:n,getOrThunk:t,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},or:n,orThunk:t,map:b,ap:b,each:function(){},bind:b,flatten:b,exists:g,forall:v,filter:b,equals:e,equals_:e,toArray:function(){return[]},toString:p.constant("none()")};return Object.freeze&&Object.freeze(r),r}(),C=function(e){var t=function(){return e},n=function(){return i},r=function(t){return t(e)},i={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:v,isNone:g,getOr:t,getOrThunk:t,getOrDie:t,or:n,orThunk:n,map:function(t){return C(t(e))},ap:function(t){return t.fold(b,function(t){return C(t(e))})},each:function(t){t(e)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(e)?i:y},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(g,function(t){return n(e,t)})},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return i},w={some:C,none:b,from:function(e){return null===e||void 0===e?y:C(e)}},E=void 0===(t=Array.prototype.indexOf)?function(e,t){return D(e,t)}:function(e,n){return t.call(e,n)},x=function(e,t){return E(e,t)>-1},N=function(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;i++){var o=e[i];r[i]=t(o,i,e)}return r},S=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n,e)},k=function(e,t){for(var n=e.length-1;n>=0;n--)t(e[n],n,e)},T=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];t(o,r,e)&&n.push(o)}return n},A=function(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n],n,e))return w.some(n);return w.none()},D=function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1},B=Array.prototype.push,R=function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!Array.prototype.isPrototypeOf(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);B.apply(t,e[n])}return t},_=function(e,t){for(var n=0,r=e.length;n<r;++n)if(!0!==t(e[n],n,e))return!1;return!0},L=Array.prototype.slice,O={map:N,each:S,eachr:k,partition:function(e,t){for(var n=[],r=[],i=0,o=e.length;i<o;i++){var a=e[i];(t(a,i,e)?n:r).push(a)}return{pass:n,fail:r}},filter:T,groupBy:function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],i=[],o=0,a=e.length;o<a;o++){var s=e[o],u=t(s);u!==n&&(r.push(i),i=[]),n=u,i.push(s)}return 0!==i.length&&r.push(i),r},indexOf:function(e,t){var n=E(e,t);return-1===n?w.none():w.some(n)},foldr:function(e,t,n){return k(e,function(e){n=t(n,e)}),n},foldl:function(e,t,n){return S(e,function(e){n=t(n,e)}),n},find:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(t(i,n,e))return w.some(i)}return w.none()},findIndex:A,flatten:R,bind:function(e,t){var n=N(e,t);return R(n)},forall:_,exists:function(e,t){return A(e,t).isSome()},contains:x,equal:function(e,t){return e.length===t.length&&_(e,function(e,n){return e===t[n]})},reverse:function(e){var t=L.call(e,0);return t.reverse(),t},chunk:function(e,t){for(var n=[],r=0;r<e.length;r+=t){var i=e.slice(r,r+t);n.push(i)}return n},difference:function(e,t){return T(e,function(e){return!x(t,e)})},mapToObject:function(e,t){for(var n={},r=0,i=e.length;r<i;r++){var o=e[r];n[String(o)]=t(o,r)}return n},pure:function(e){return[e]},sort:function(e,t){var n=L.call(e,0);return n.sort(t),n},range:function(e,t){for(var n=[],r=0;r<e;r++)n.push(t(r));return n},head:function(e){return 0===e.length?w.none():w.some(e[0])},last:function(e){return 0===e.length?w.none():w.some(e[e.length-1])}},P="undefined"!=typeof window?window:Function("return this;")(),I=function(e,t){for(var n=void 0!==t&&null!==t?t:P,r=0;r<e.length&&void 0!==n&&null!==n;++r)n=n[e[r]];return n},F=function(e,t){var n=e.split(".");return I(n,t)},M={getOrDie:function(e,t){var n=function(e,t){return F(e,t)}(e,t);if(void 0===n||null===n)throw e+" not available on this browser";return n}},H=function(){return M.getOrDie("URL")},q={createObjectURL:function(e){return H().createObjectURL(e)},revokeObjectURL:function(e){H().revokeObjectURL(e)}},z=navigator,U=z.userAgent,j=function(e){return"matchMedia"in window&&matchMedia(e).matches};l=/Android/.test(U),r=(r=!(n=/WebKit/.test(U))&&/MSIE/gi.test(U)&&/Explorer/gi.test(z.appName))&&/MSIE (\w+)\./.exec(U)[1],i=-1!==U.indexOf("Trident/")&&(-1!==U.indexOf("rv:")||-1!==z.appName.indexOf("Netscape"))&&11,o=-1!==U.indexOf("Edge/")&&!r&&!i&&12,r=r||i||o,a=!n&&!i&&/Gecko/.test(U),s=-1!==U.indexOf("Mac"),u=/(iPad|iPhone)/.test(U),c="FormData"in window&&"FileReader"in window&&"URL"in window&&!!q.createObjectURL,d=j("only screen and (max-device-width: 480px)")&&(l||u),f=j("only screen and (min-width: 800px)")&&(l||u),h=-1!==U.indexOf("Windows Phone"),o&&(n=!1);var V,$,W,K,X,Y,G,Z,Q,J,ee,te,ne,re,ie,oe,ae,se,ue,le={opera:!1,webkit:n,ie:r,gecko:a,mac:s,iOS:u,android:l,contentEditable:!u||c||parseInt(U.match(/AppleWebKit\/(\d*)/)[1],10)>=534,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!==r,range:window.getSelection&&"Range"in window,documentMode:r&&!o?document.documentMode||7:10,fileApi:c,ceFalse:!1===r||r>8,cacheSuffix:"",container:null,overrideViewPort:null,experimentalShadowDom:!1,canHaveCSP:!1===r||r>11,desktop:!d&&!f,windowsPhone:h},ce=window.Promise?window.Promise:function(){function e(e,t){return function(){e.apply(t,arguments)}}var t=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=function(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(t,e(o,this),e(a,this))},r=n.immediateFn||"function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,1)};function i(e){var t=this;null!==this._state?r(function(){var n=t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void e.reject(t)}e.resolve(r)}else(t._state?e.resolve:e.reject)(t._value)}):this._deferreds.push(e)}function o(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void u(e(n,t),e(o,this),e(a,this))}this._state=!0,this._value=t,s.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;e<t;e++)i.call(this,this._deferreds[e]);this._deferreds=null}function u(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(e){if(r)return;r=!0,n(e)}}return n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var r=this;return new n(function(n,o){i.call(r,new function(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}(e,t,n,o))})},n.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&t(arguments[0])?arguments[0]:arguments);return new n(function(t,n){if(0===e.length)return t([]);var r=e.length;function i(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){i(o,e)},n)}e[o]=a,0==--r&&t(e)}catch(e){n(e)}}for(var o=0;o<e.length;o++)i(o,e[o])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},n}(),de=function(e,t){return"number"!=typeof t&&(t=0),setTimeout(e,t)},fe=function(e,t){return"number"!=typeof t&&(t=1),setInterval(e,t)},he=function(e,t){var n,r;return(r=function(){var r=arguments;clearTimeout(n),n=de(function(){e.apply(this,r)},t)}).stop=function(){clearTimeout(n)},r},me={requestAnimationFrame:function(e,t){V?V.then(e):V=new ce(function(e){t||(t=document.body),function(e,t){var n,r=window.requestAnimationFrame,i=["ms","moz","webkit"];for(n=0;n<i.length&&!r;n++)r=window[i[n]+"RequestAnimationFrame"];r||(r=function(e){window.setTimeout(e,0)}),r(e,t)}(e,t)}).then(e)},setTimeout:de,setInterval:fe,setEditorTimeout:function(e,t,n){return de(function(){e.removed||t()},n)},setEditorInterval:function(e,t,n){var r;return r=fe(function(){e.removed?clearInterval(r):t()},n)},debounce:he,throttle:he,clearInterval:function(e){return clearInterval(e)},clearTimeout:function(e){return clearTimeout(e)}},pe=/^(?:mouse|contextmenu)|click/,ge={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1},ve=function(){return!1},be=function(){return!0},ye=function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n)},Ce=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n)},we=function(e,t){var n,r=t||{};for(n in e)ge[n]||(r[n]=e[n]);if(r.target||(r.target=r.srcElement||document),le.experimentalShadowDom&&(r.target=function(e,t){var n,r=t;return(n=e.path)&&n.length>0&&(r=n[0]),e.composedPath&&(n=e.composedPath())&&n.length>0&&(r=n[0]),r}(e,r.target)),e&&pe.test(e.type)&&void 0===e.pageX&&void 0!==e.clientX){var i=r.target.ownerDocument||document,o=i.documentElement,a=i.body;r.pageX=e.clientX+(o&&o.scrollLeft||a&&a.scrollLeft||0)-(o&&o.clientLeft||a&&a.clientLeft||0),r.pageY=e.clientY+(o&&o.scrollTop||a&&a.scrollTop||0)-(o&&o.clientTop||a&&a.clientTop||0)}return r.preventDefault=function(){r.isDefaultPrevented=be,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},r.stopPropagation=function(){r.isPropagationStopped=be,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)},r.stopImmediatePropagation=function(){r.isImmediatePropagationStopped=be,r.stopPropagation()},!1===function(e){return e.isDefaultPrevented===be||e.isDefaultPrevented===ve}(r)&&(r.isDefaultPrevented=ve,r.isPropagationStopped=ve,r.isImmediatePropagationStopped=ve),void 0===r.metaKey&&(r.metaKey=!1),r},Ee=function(e,t,n){var r=e.document,i={type:"ready"};if(n.domLoaded)t(i);else{var o=function(){return"complete"===r.readyState||"interactive"===r.readyState&&r.body},a=function(){n.domLoaded||(n.domLoaded=!0,t(i))},s=function(){o()&&(Ce(r,"readystatechange",s),a())},u=function(){try{r.documentElement.doScroll("left")}catch(e){return void me.setTimeout(u)}a()};!r.addEventListener||le.ie&&le.ie<11?(ye(r,"readystatechange",s),r.documentElement.doScroll&&e.self===e.top&&u()):o()?a():ye(e,"DOMContentLoaded",a),ye(e,"load",a)}},xe=function(){var e,t,n,r,i,o=this,a={};t="mce-data-"+(+new Date).toString(32),r="onmouseenter"in document.documentElement,n="onfocusin"in document.documentElement,i={mouseenter:"mouseover",mouseleave:"mouseout"},e=1,o.domLoaded=!1,o.events=a;var s=function(e,t){var n,r,i,o,s=a[t];if(n=s&&s[e.type])for(r=0,i=n.length;r<i;r++)if((o=n[r])&&!1===o.func.call(o.scope,e)&&e.preventDefault(),e.isImmediatePropagationStopped())return};o.bind=function(u,l,c,d){var f,h,m,p,g,v,b,y=window,C=function(e){s(we(e||y.event),f)};if(u&&3!==u.nodeType&&8!==u.nodeType){for(u[t]?f=u[t]:(f=e++,u[t]=f,a[f]={}),d=d||u,m=(l=l.split(" ")).length;m--;)v=C,g=b=!1,"DOMContentLoaded"===(p=l[m])&&(p="ready"),o.domLoaded&&"ready"===p&&"complete"===u.readyState?c.call(d,we({type:p})):(r||(g=i[p])&&(v=function(e){var t,n;if(t=e.currentTarget,(n=e.relatedTarget)&&t.contains)n=t.contains(n);else for(;n&&n!==t;)n=n.parentNode;n||((e=we(e||y.event)).type="mouseout"===e.type?"mouseleave":"mouseenter",e.target=t,s(e,f))}),n||"focusin"!==p&&"focusout"!==p||(b=!0,g="focusin"===p?"focus":"blur",v=function(e){(e=we(e||y.event)).type="focus"===e.type?"focusin":"focusout",s(e,f)}),(h=a[f][p])?"ready"===p&&o.domLoaded?c({type:p}):h.push({func:c,scope:d}):(a[f][p]=h=[{func:c,scope:d}],h.fakeName=g,h.capture=b,h.nativeHandler=v,"ready"===p?Ee(u,v,o):ye(u,g||p,v,b)));return u=h=0,c}},o.unbind=function(e,n,r){var i,s,u,l,c,d;if(!e||3===e.nodeType||8===e.nodeType)return o;if(i=e[t]){if(d=a[i],n){for(u=(n=n.split(" ")).length;u--;)if(s=d[c=n[u]]){if(r)for(l=s.length;l--;)if(s[l].func===r){var f=s.nativeHandler,h=s.fakeName,m=s.capture;(s=s.slice(0,l).concat(s.slice(l+1))).nativeHandler=f,s.fakeName=h,s.capture=m,d[c]=s}r&&0!==s.length||(delete d[c],Ce(e,s.fakeName||c,s.nativeHandler,s.capture))}}else{for(c in d)s=d[c],Ce(e,s.fakeName||c,s.nativeHandler,s.capture);d={}}for(c in d)return o;delete a[i];try{delete e[t]}catch(n){e[t]=null}}return o},o.fire=function(e,n,r){var i;if(!e||3===e.nodeType||8===e.nodeType)return o;(r=we(null,r)).type=n,r.target=e;do{(i=e[t])&&s(r,i),e=e.parentNode||e.ownerDocument||e.defaultView||e.parentWindow}while(e&&!r.isPropagationStopped());return o},o.clean=function(e){var n,r,i=o.unbind;if(!e||3===e.nodeType||8===e.nodeType)return o;if(e[t]&&i(e),e.getElementsByTagName||(e=e.document),e&&e.getElementsByTagName)for(i(e),n=(r=e.getElementsByTagName("*")).length;n--;)(e=r[n])[t]&&i(e);return o},o.destroy=function(){a={}},o.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}};(xe.Event=new xe).bind(window,"ready",function(){});var Ne="sizzle"+-new Date,Se=window.document,ke=0,Te=0,Ae=st(),De=st(),Be=st(),Re=function(e,t){return e===t&&(te=!0),0},_e="undefined",Le=1<<31,Oe={}.hasOwnProperty,Pe=[],Ie=Pe.pop,Fe=Pe.push,Me=Pe.push,He=Pe.slice,qe=Pe.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},ze="[\\x20\\t\\r\\n\\f]",Ue="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",je="\\["+ze+"*("+Ue+")(?:"+ze+"*([*^$|!~]?=)"+ze+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+Ue+"))|)"+ze+"*\\]",Ve=":("+Ue+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+je+")*)|.*)\\)|)",$e=new RegExp("^"+ze+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ze+"+$","g"),We=new RegExp("^"+ze+"*,"+ze+"*"),Ke=new RegExp("^"+ze+"*([>+~]|"+ze+")"+ze+"*"),Xe=new RegExp("="+ze+"*([^\\]'\"]*?)"+ze+"*\\]","g"),Ye=new RegExp(Ve),Ge=new RegExp("^"+Ue+"$"),Ze={ID:new RegExp("^#("+Ue+")"),CLASS:new RegExp("^\\.("+Ue+")"),TAG:new RegExp("^("+Ue+"|[*])"),ATTR:new RegExp("^"+je),PSEUDO:new RegExp("^"+Ve),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ze+"*(even|odd|(([+-]|)(\\d*)n|)"+ze+"*(?:([+-]|)"+ze+"*(\\d+)|))"+ze+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+ze+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ze+"*((?:-\\d)?\\d*)"+ze+"*\\)|)(?=[^-]|$)","i")},Qe=/^(?:input|select|textarea|button)$/i,Je=/^h\d$/i,et=/^[^{]+\{\s*\[native \w/,tt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,nt=/[+~]/,rt=/'|\\/g,it=new RegExp("\\\\([\\da-f]{1,6}"+ze+"?|("+ze+")|.)","ig"),ot=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{Me.apply(Pe=He.call(Se.childNodes),Se.childNodes),Pe[Se.childNodes.length].nodeType}catch(e){Me={apply:Pe.length?function(e,t){Fe.apply(e,He.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}var at=function(e,t,n,r){var i,o,a,s,u,l,c,d,f,h;if((t?t.ownerDocument||t:Se)!==re&&ne(t),t=t||re,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(oe&&!r){if(i=tt.exec(e))if(a=i[1]){if(9===s){if(!(o=t.getElementById(a))||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&ue(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return Me.apply(n,t.getElementsByTagName(e)),n;if((a=i[3])&&W.getElementsByClassName)return Me.apply(n,t.getElementsByClassName(a)),n}if(W.qsa&&(!ae||!ae.test(e))){if(d=c=Ne,f=t,h=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(l=G(e),(c=t.getAttribute("id"))?d=c.replace(rt,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",u=l.length;u--;)l[u]=d+pt(l[u]);f=nt.test(e)&&ht(t.parentNode)||t,h=l.join(",")}if(h)try{return Me.apply(n,f.querySelectorAll(h)),n}catch(e){}finally{c||t.removeAttribute("id")}}}return Q(e.replace($e,"$1"),t,n,r)};function st(){var e=[];return function t(n,r){return e.push(n+" ")>K.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function ut(e){return e[Ne]=!0,e}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Le)-(~e.sourceIndex||Le);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ft(e){return ut(function(t){return t=+t,ut(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e){return e&&typeof e.getElementsByTagName!==_e&&e}for($ in W=at.support={},Y=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},ne=at.setDocument=function(e){var t,n=e?e.ownerDocument||e:Se,r=n.defaultView;return n!==re&&9===n.nodeType&&n.documentElement?(re=n,ie=n.documentElement,oe=!Y(n),r&&r!==function(e){try{return e.top}catch(e){}return null}(r)&&(r.addEventListener?r.addEventListener("unload",function(){ne()},!1):r.attachEvent&&r.attachEvent("onunload",function(){ne()})),W.attributes=!0,W.getElementsByTagName=!0,W.getElementsByClassName=et.test(n.getElementsByClassName),W.getById=!0,K.find.ID=function(e,t){if(typeof t.getElementById!==_e&&oe){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},K.filter.ID=function(e){var t=e.replace(it,ot);return function(e){return e.getAttribute("id")===t}},K.find.TAG=W.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==_e)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},K.find.CLASS=W.getElementsByClassName&&function(e,t){if(oe)return t.getElementsByClassName(e)},se=[],ae=[],W.disconnectedMatch=!0,ae=ae.length&&new RegExp(ae.join("|")),se=se.length&&new RegExp(se.join("|")),t=et.test(ie.compareDocumentPosition),ue=t||et.test(ie.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},Re=t?function(e,t){if(e===t)return te=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!W.sortDetached&&t.compareDocumentPosition(e)===r?e===n||e.ownerDocument===Se&&ue(Se,e)?-1:t===n||t.ownerDocument===Se&&ue(Se,t)?1:ee?qe.call(ee,e)-qe.call(ee,t):0:4&r?-1:1)}:function(e,t){if(e===t)return te=!0,0;var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],u=[t];if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:ee?qe.call(ee,e)-qe.call(ee,t):0;if(o===a)return lt(e,t);for(r=e;r=r.parentNode;)s.unshift(r);for(r=t;r=r.parentNode;)u.unshift(r);for(;s[i]===u[i];)i++;return i?lt(s[i],u[i]):s[i]===Se?-1:u[i]===Se?1:0},n):re},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==re&&ne(e),t=t.replace(Xe,"='$1']"),W.matchesSelector&&oe&&(!se||!se.test(t))&&(!ae||!ae.test(t)))try{var n=(void 0).call(e,t);if(n||W.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return at(t,re,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==re&&ne(e),ue(e,t)},at.attr=function(e,t){(e.ownerDocument||e)!==re&&ne(e);var n=K.attrHandle[t.toLowerCase()],r=n&&Oe.call(K.attrHandle,t.toLowerCase())?n(e,t,!oe):void 0;return void 0!==r?r:W.attributes||!oe?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},at.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],r=0,i=0;if(te=!W.detectDuplicates,ee=!W.sortStable&&e.slice(0),e.sort(Re),te){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return ee=null,e},X=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=X(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=X(t);return n},(K=at.selectors={cacheLength:50,createPseudo:ut,match:Ze,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(it,ot),e[3]=(e[3]||e[4]||e[5]||"").replace(it,ot),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Ze.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Ye.test(n)&&(t=G(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(it,ot).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=Ae[e+" "];return t||(t=new RegExp("(^|"+ze+")"+e+"("+ze+"|$)"))&&Ae(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==_e&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,d,f,h,m,p=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),b=!u&&!s;if(g){if(o){for(;p;){for(d=t;d=d[p];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;m=p="only"===e&&!m&&"nextSibling"}return!0}if(m=[a?g.firstChild:g.lastChild],a&&b){for(h=(l=(c=g[Ne]||(g[Ne]={}))[e]||[])[0]===ke&&l[1],f=l[0]===ke&&l[2],d=h&&g.childNodes[h];d=++h&&d&&d[p]||(f=h=0)||m.pop();)if(1===d.nodeType&&++f&&d===t){c[e]=[ke,h,f];break}}else if(b&&(l=(t[Ne]||(t[Ne]={}))[e])&&l[0]===ke)f=l[1];else for(;(d=++h&&d&&d[p]||(f=h=0)||m.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++f||(b&&((d[Ne]||(d[Ne]={}))[e]=[ke,f]),d!==t)););return(f-=i)===r||f%r==0&&f/r>=0}}},PSEUDO:function(e,t){var n,r=K.pseudos[e]||K.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[Ne]?r(t):r.length>1?(n=[e,e,"",t],K.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){for(var i,o=r(e,t),a=o.length;a--;)e[i=qe.call(e,o[a])]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=Z(e.replace($e,"$1"));return r[Ne]?ut(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ut(function(e){return function(t){return at(e,t).length>0}}),contains:ut(function(e){return e=e.replace(it,ot),function(t){return(t.textContent||t.innerText||X(t)).indexOf(e)>-1}}),lang:ut(function(e){return Ge.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(it,ot).toLowerCase(),function(t){var n;do{if(n=oe?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(e){var t=window.location&&window.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===ie},focus:function(e){return e===re.activeElement&&(!re.hasFocus||re.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!K.pseudos.empty(e)},header:function(e){return Je.test(e.nodeName)},input:function(e){return Qe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ft(function(){return[0]}),last:ft(function(e,t){return[t-1]}),eq:ft(function(e,t,n){return[n<0?n+t:n]}),even:ft(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ft(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ft(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:ft(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=K.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})K.pseudos[$]=ct($);for($ in{submit:!0,reset:!0})K.pseudos[$]=dt($);function mt(){}function pt(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,o=Te++;return t.first?function(t,n,o){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,o)}:function(t,n,a){var s,u,l=[ke,o];if(a){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||i){if((s=(u=t[Ne]||(t[Ne]={}))[r])&&s[0]===ke&&s[1]===o)return l[2]=s[2];if(u[r]=l,l[2]=e(t,n,a))return!0}}}function vt(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function yt(e,t,n,r,i,o){return r&&!r[Ne]&&(r=yt(r)),i&&!i[Ne]&&(i=yt(i,o)),ut(function(o,a,s,u){var l,c,d,f=[],h=[],m=a.length,p=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)at(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),g=!e||!o&&t?p:bt(p,f,e,s,u),v=n?i||(o?e:m||r)?[]:a:g;if(n&&n(g,v,s,u),r)for(l=bt(v,h),r(l,[],s,u),c=l.length;c--;)(d=l[c])&&(v[h[c]]=!(g[h[c]]=d));if(o){if(i||e){if(i){for(l=[],c=v.length;c--;)(d=v[c])&&l.push(g[c]=d);i(null,v=[],l,u)}for(c=v.length;c--;)(d=v[c])&&(l=i?qe.call(o,d):f[c])>-1&&(o[l]=!(a[l]=d))}}else v=bt(v===a?v.splice(m,v.length):v),i?i(null,a,v,u):Me.apply(a,v)})}function Ct(e){for(var t,n,r,i=e.length,o=K.relative[e[0].type],a=o||K.relative[" "],s=o?1:0,u=gt(function(e){return e===t},a,!0),l=gt(function(e){return qe.call(t,e)>-1},a,!0),c=[function(e,n,r){return!o&&(r||n!==J)||((t=n).nodeType?u(e,n,r):l(e,n,r))}];s<i;s++)if(n=K.relative[e[s].type])c=[gt(vt(c),n)];else{if((n=K.filter[e[s].type].apply(null,e[s].matches))[Ne]){for(r=++s;r<i&&!K.relative[e[r].type];r++);return yt(s>1&&vt(c),s>1&&pt(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($e,"$1"),n,s<r&&Ct(e.slice(s,r)),r<i&&Ct(e=e.slice(r)),r<i&&pt(e))}c.push(n)}return vt(c)}mt.prototype=K.filters=K.pseudos,K.setFilters=new mt,G=at.tokenize=function(e,t){var n,r,i,o,a,s,u,l=De[e+" "];if(l)return t?0:l.slice(0);for(a=e,s=[],u=K.preFilter;a;){for(o in n&&!(r=We.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=Ke.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($e," ")}),a=a.slice(n.length)),K.filter)!(r=Ze[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?at.error(e):De(e,s).slice(0)},Z=at.compile=function(e,t){var n,r=[],i=[],o=Be[e+" "];if(!o){for(t||(t=G(e)),n=t.length;n--;)(o=Ct(t[n]))[Ne]?r.push(o):i.push(o);(o=Be(e,function(e,t){var n=t.length>0,r=e.length>0,i=function(i,o,a,s,u){var l,c,d,f=0,h="0",m=i&&[],p=[],g=J,v=i||r&&K.find.TAG("*",u),b=ke+=null==g?1:Math.random()||.1,y=v.length;for(u&&(J=o!==re&&o);h!==y&&null!=(l=v[h]);h++){if(r&&l){for(c=0;d=e[c++];)if(d(l,o,a)){s.push(l);break}u&&(ke=b)}n&&((l=!d&&l)&&f--,i&&m.push(l))}if(f+=h,n&&h!==f){for(c=0;d=t[c++];)d(m,p,o,a);if(i){if(f>0)for(;h--;)m[h]||p[h]||(p[h]=Ie.call(s));p=bt(p)}Me.apply(s,p),u&&!i&&p.length>0&&f+t.length>1&&at.uniqueSort(s)}return u&&(ke=b,J=g),m};return n?ut(i):i}(i,r))).selector=e}return o},Q=at.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&G(e=l.selector||e);if(n=n||[],1===c.length){if((o=c[0]=c[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&W.getById&&9===t.nodeType&&oe&&K.relative[o[1].type]){if(!(t=(K.find.ID(a.matches[0].replace(it,ot),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=Ze.needsContext.test(e)?0:o.length;i--&&(a=o[i],!K.relative[s=a.type]);)if((u=K.find[s])&&(r=u(a.matches[0].replace(it,ot),nt.test(o[0].type)&&ht(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&pt(o)))return Me.apply(n,r),n;break}}return(l||Z(e,c))(r,t,!oe,n,nt.test(e)&&ht(t.parentNode)||t),n},W.sortStable=Ne.split("").sort(Re).join("")===Ne,W.detectDuplicates=!!te,ne(),W.sortDetached=!0;var wt=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Et=function(e,t,n){var r,i;if(!e)return 0;if(n=n||e,void 0!==e.length){for(r=0,i=e.length;r<i;r++)if(!1===t.call(n,e[r],r,e))return 0}else for(r in e)if(e.hasOwnProperty(r)&&!1===t.call(n,e[r],r,e))return 0;return 1},xt=function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e))return r;return-1},Nt={isArray:wt,toArray:function(e){var t,n,r=e;if(!wt(e))for(r=[],t=0,n=e.length;t<n;t++)r[t]=e[t];return r},each:Et,map:function(e,t){var n=[];return Et(e,function(r,i){n.push(t(r,i,e))}),n},filter:function(e,t){var n=[];return Et(e,function(r,i){t&&!t(r,i,e)||n.push(r)}),n},indexOf:function(e,t){var n,r;if(e)for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},reduce:function(e,t,n,r){var i=0;for(arguments.length<3&&(n=e[0]);i<e.length;i++)n=t.call(r,n,e[i],i);return n},findIndex:xt,find:function(e,t,n){var r=xt(e,t,n);if(-1!==r)return e[r]},last:function(e){return e[e.length-1]}},St=/^\s*|\s*$/g,kt=function(e){return null===e||void 0===e?"":(""+e).replace(St,"")},Tt=function(e,t){return t?!("array"!==t||!Nt.isArray(e))||typeof e===t:void 0!==e},At=function(e,t,n,r){r=r||this,e&&(n&&(e=e[n]),Nt.each(e,function(e,i){if(!1===t.call(r,e,i,n))return!1;At(e,t,n,r)}))},Dt={trim:kt,isArray:Nt.isArray,is:Tt,toArray:Nt.toArray,makeMap:function(e,t,n){var r;for(e=e||[],t=t||",","string"==typeof e&&(e=e.split(t)),n=n||{},r=e.length;r--;)n[e[r]]={};return n},each:Nt.each,map:Nt.map,grep:Nt.filter,inArray:Nt.indexOf,hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},extend:function(e,t){for(var n,r,i,o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];var s,u=arguments;for(n=1,r=u.length;n<r;n++)for(i in t=u[n])t.hasOwnProperty(i)&&void 0!==(s=t[i])&&(e[i]=s);return e},create:function(e,t,n){var r,i,o,a,s,u=0;if(e=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(e),o=e[3].match(/(^|\.)(\w+)$/i)[2],!(i=this.createNS(e[3].replace(/\.\w+$/,""),n))[o]){if("static"===e[2])return i[o]=t,void(this.onCreate&&this.onCreate(e[2],e[3],i[o]));t[o]||(t[o]=function(){},u=1),i[o]=t[o],this.extend(i[o].prototype,t),e[5]&&(r=this.resolve(e[5]).prototype,a=e[5].match(/\.(\w+)$/i)[1],s=i[o],i[o]=u?function(){return r[a].apply(this,arguments)}:function(){return this.parent=r[a],s.apply(this,arguments)},i[o].prototype[o]=i[o],this.each(r,function(e,t){i[o].prototype[t]=r[t]}),this.each(t,function(e,t){r[t]?i[o].prototype[t]=function(){return this.parent=r[t],e.apply(this,arguments)}:t!==o&&(i[o].prototype[t]=e)})),this.each(t.static,function(e,t){i[o][t]=e})}},walk:At,createNS:function(e,t){var n,r;for(t=t||window,e=e.split("."),n=0;n<e.length;n++)t[r=e[n]]||(t[r]={}),t=t[r];return t},resolve:function(e,t){var n,r;for(t=t||window,n=0,r=(e=e.split(".")).length;n<r&&(t=t[e[n]]);n++);return t},explode:function(e,t){return!e||Tt(e,"array")?e:Nt.map(e.split(t||","),kt)},_addCacheSuffix:function(e){var t=le.cacheSuffix;return t&&(e+=(-1===e.indexOf("?")?"?":"&")+t),e}},Bt=document,Rt=Array.prototype.push,_t=Array.prototype.slice,Lt=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Ot=xe.Event,Pt=Dt.makeMap("children,contents,next,prev"),It=function(e){return void 0!==e},Ft=function(e){return"string"==typeof e},Mt=function(e,t){var n,r,i;for(i=(t=t||Bt).createElement("div"),n=t.createDocumentFragment(),i.innerHTML=e;r=i.firstChild;)n.appendChild(r);return n},Ht=function(e,t,n,r){var i;if(Ft(t))t=Mt(t,Jt(e[0]));else if(t.length&&!t.nodeType){if(t=Xt.makeArray(t),r)for(i=t.length-1;i>=0;i--)Ht(e,t[i],n,r);else for(i=0;i<t.length;i++)Ht(e,t[i],n,r);return e}if(t.nodeType)for(i=e.length;i--;)n.call(e[i],t);return e},qt=function(e,t){return e&&t&&-1!==(" "+e.className+" ").indexOf(" "+t+" ")},zt=function(e,t,n){var r,i;return t=Xt(t)[0],e.each(function(){n&&r===this.parentNode?i.appendChild(this):(r=this.parentNode,i=t.cloneNode(!1),this.parentNode.insertBefore(i,this),i.appendChild(this))}),e},Ut=Dt.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),jt=Dt.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),Vt={for:"htmlFor",class:"className",readonly:"readOnly"},$t={float:"cssFloat"},Wt={},Kt={},Xt=function(e,t){return new Xt.fn.init(e,t)},Yt=/^\s*|\s*$/g,Gt=function(e){return null===e||void 0===e?"":(""+e).replace(Yt,"")},Zt=function(e,t){var n,r,i,o;if(e)if(void 0===(n=e.length)){for(r in e)if(e.hasOwnProperty(r)&&(o=e[r],!1===t.call(o,r,o)))break}else for(i=0;i<n&&(o=e[i],!1!==t.call(o,i,o));i++);return e},Qt=function(e,t){var n=[];return Zt(e,function(e,r){t(r,e)&&n.push(r)}),n},Jt=function(e){return e?9===e.nodeType?e:e.ownerDocument:Bt};Xt.fn=Xt.prototype={constructor:Xt,selector:"",context:null,length:0,init:function(e,t){var n,r;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(t&&t.nodeType)this.context=t;else{if(t)return Xt(e).attr(t);this.context=t=document}if(Ft(e)){if(this.selector=e,!(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:Lt.exec(e)))return Xt(t).find(e);if(n[1])for(r=Mt(e,Jt(t)).firstChild;r;)Rt.call(this,r),r=r.nextSibling;else{if(!(r=Jt(t).getElementById(n[2])))return this;if(r.id!==n[2])return this.find(e);this.length=1,this[0]=r}}else this.add(e,!1);return this},toArray:function(){return Dt.toArray(this)},add:function(e,t){var n,r;if(Ft(e))return this.add(Xt(e));if(!1!==t)for(n=Xt.unique(this.toArray().concat(Xt.makeArray(e))),this.length=n.length,r=0;r<n.length;r++)this[r]=n[r];else Rt.apply(this,Xt.makeArray(e));return this},attr:function(e,t){var n,r=this;if("object"==typeof e)Zt(e,function(e,t){r.attr(e,t)});else{if(!It(t)){if(r[0]&&1===r[0].nodeType){if((n=Wt[e])&&n.get)return n.get(r[0],e);if(jt[e])return r.prop(e)?e:void 0;null===(t=r[0].getAttribute(e,2))&&(t=void 0)}return t}this.each(function(){var n;if(1===this.nodeType){if((n=Wt[e])&&n.set)return void n.set(this,t);null===t?this.removeAttribute(e,2):this.setAttribute(e,t,2)}})}return r},removeAttr:function(e){return this.attr(e,null)},prop:function(e,t){var n=this;if("object"==typeof(e=Vt[e]||e))Zt(e,function(e,t){n.prop(e,t)});else{if(!It(t))return n[0]&&n[0].nodeType&&e in n[0]?n[0][e]:t;this.each(function(){1===this.nodeType&&(this[e]=t)})}return n},css:function(e,t){var n,r,i=this,o=function(e){return e.replace(/-(\D)/g,function(e,t){return t.toUpperCase()})},a=function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e})};if("object"==typeof e)Zt(e,function(e,t){i.css(e,t)});else if(It(t))e=o(e),"number"!=typeof t||Ut[e]||(t=t.toString()+"px"),i.each(function(){var n=this.style;if((r=Kt[e])&&r.set)r.set(this,t);else{try{this.style[$t[e]||e]=t}catch(e){}null!==t&&""!==t||(n.removeProperty?n.removeProperty(a(e)):n.removeAttribute(e))}});else{if(n=i[0],(r=Kt[e])&&r.get)return r.get(n);if(n.ownerDocument.defaultView)try{return n.ownerDocument.defaultView.getComputedStyle(n,null).getPropertyValue(a(e))}catch(e){return}else if(n.currentStyle)return n.currentStyle[o(e)]}return i},remove:function(){for(var e,t=this.length;t--;)e=this[t],Ot.clean(e),e.parentNode&&e.parentNode.removeChild(e);return this},empty:function(){for(var e,t=this.length;t--;)for(e=this[t];e.firstChild;)e.removeChild(e.firstChild);return this},html:function(e){var t;if(It(e)){t=this.length;try{for(;t--;)this[t].innerHTML=e}catch(n){Xt(this[t]).empty().append(e)}return this}return this[0]?this[0].innerHTML:""},text:function(e){var t;if(It(e)){for(t=this.length;t--;)"innerText"in this[t]?this[t].innerText=e:this[0].textContent=e;return this}return this[0]?this[0].innerText||this[0].textContent:""},append:function(){return Ht(this,arguments,function(e){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(e)})},prepend:function(){return Ht(this,arguments,function(e){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(e,this.firstChild)},!0)},before:function(){return this[0]&&this[0].parentNode?Ht(this,arguments,function(e){this.parentNode.insertBefore(e,this)}):this},after:function(){return this[0]&&this[0].parentNode?Ht(this,arguments,function(e){this.parentNode.insertBefore(e,this.nextSibling)},!0):this},appendTo:function(e){return Xt(e).append(this),this},prependTo:function(e){return Xt(e).prepend(this),this},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return zt(this,e)},wrapAll:function(e){return zt(this,e,!0)},wrapInner:function(e){return this.each(function(){Xt(this).contents().wrapAll(e)}),this},unwrap:function(){return this.parent().each(function(){Xt(this).replaceWith(this.childNodes)})},clone:function(){var e=[];return this.each(function(){e.push(this.cloneNode(!0))}),Xt(e)},addClass:function(e){return this.toggleClass(e,!0)},removeClass:function(e){return this.toggleClass(e,!1)},toggleClass:function(e,t){var n=this;return"string"!=typeof e?n:(-1!==e.indexOf(" ")?Zt(e.split(" "),function(){n.toggleClass(this,t)}):n.each(function(n,r){var i,o;(o=qt(r,e))!==t&&(i=r.className,o?r.className=Gt((" "+i+" ").replace(" "+e+" "," ")):r.className+=i?" "+e:e)}),n)},hasClass:function(e){return qt(this[0],e)},each:function(e){return Zt(this,e)},on:function(e,t){return this.each(function(){Ot.bind(this,e,t)})},off:function(e,t){return this.each(function(){Ot.unbind(this,e,t)})},trigger:function(e){return this.each(function(){"object"==typeof e?Ot.fire(this,e.type,e):Ot.fire(this,e)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new Xt(_t.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(e){var t,n,r=[];for(t=0,n=this.length;t<n;t++)Xt.find(e,this[t],r);return Xt(r)},filter:function(e){return Xt("function"==typeof e?Qt(this.toArray(),function(t,n){return e(n,t)}):Xt.filter(e,this.toArray()))},closest:function(e){var t=[];return e instanceof Xt&&(e=e[0]),this.each(function(n,r){for(;r;){if("string"==typeof e&&Xt(r).is(e)){t.push(r);break}if(r===e){t.push(r);break}r=r.parentNode}}),Xt(t)},offset:function(e){var t,n,r,i,o=0,a=0;return e?this.css(e):((t=this[0])&&(r=(n=t.ownerDocument).documentElement,t.getBoundingClientRect&&(o=(i=t.getBoundingClientRect()).left+(r.scrollLeft||n.body.scrollLeft)-r.clientLeft,a=i.top+(r.scrollTop||n.body.scrollTop)-r.clientTop)),{left:o,top:a})},push:Rt,sort:[].sort,splice:[].splice},Dt.extend(Xt,{extend:Dt.extend,makeArray:function(e){return(t=e)&&t===t.window||e.nodeType?[e]:Dt.toArray(e);var t},inArray:function(e,t){var n;if(t.indexOf)return t.indexOf(e);for(n=t.length;n--;)if(t[n]===e)return n;return-1},isArray:Dt.isArray,each:Zt,trim:Gt,grep:Qt,find:at,expr:at.selectors,unique:at.uniqueSort,text:at.getText,contains:at.contains,filter:function(e,t,n){var r=t.length;for(n&&(e=":not("+e+")");r--;)1!==t[r].nodeType&&t.splice(r,1);return t=1===t.length?Xt.find.matchesSelector(t[0],e)?[t[0]]:[]:Xt.find.matches(e,t)}});var en=function(e,t,n){var r=[],i=e[t];for("string"!=typeof n&&n instanceof Xt&&(n=n[0]);i&&9!==i.nodeType;){if(void 0!==n){if(i===n)break;if("string"==typeof n&&Xt(i).is(n))break}1===i.nodeType&&r.push(i),i=i[t]}return r},tn=function(e,t,n,r){var i=[];for(r instanceof Xt&&(r=r[0]);e;e=e[t])if(!n||e.nodeType===n){if(void 0!==r){if(e===r)break;if("string"==typeof r&&Xt(e).is(r))break}i.push(e)}return i},nn=function(e,t,n){for(e=e[t];e;e=e[t])if(e.nodeType===n)return e;return null};Zt({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return en(e,"parentNode")},next:function(e){return nn(e,"nextSibling",1)},prev:function(e){return nn(e,"previousSibling",1)},children:function(e){return tn(e.firstChild,"nextSibling",1)},contents:function(e){return Dt.toArray(("iframe"===e.nodeName?e.contentDocument||e.contentWindow.document:e).childNodes)}},function(e,t){Xt.fn[e]=function(n){var r=[];return this.each(function(){var e=t.call(r,this,n,r);e&&(Xt.isArray(e)?r.push.apply(r,e):r.push(e))}),this.length>1&&(Pt[e]||(r=Xt.unique(r)),0===e.indexOf("parents")&&(r=r.reverse())),r=Xt(r),n?r.filter(n):r}}),Zt({parentsUntil:function(e,t){return en(e,"parentNode",t)},nextUntil:function(e,t){return tn(e,"nextSibling",1,t).slice(1)},prevUntil:function(e,t){return tn(e,"previousSibling",1,t).slice(1)}},function(e,t){Xt.fn[e]=function(n,r){var i=[];return this.each(function(){var e=t.call(i,this,n,i);e&&(Xt.isArray(e)?i.push.apply(i,e):i.push(e))}),this.length>1&&(i=Xt.unique(i),0!==e.indexOf("parents")&&"prevUntil"!==e||(i=i.reverse())),i=Xt(i),r?i.filter(r):i}}),Xt.fn.is=function(e){return!!e&&this.filter(e).length>0},Xt.fn.init.prototype=Xt.fn,Xt.overrideDefaults=function(e){var t,n=function(r,i){return t=t||e(),0===arguments.length&&(r=t.element),i||(i=t.context),new n.fn.init(r,i)};return Xt.extend(n,this),n};var rn=function(e,t,n){Zt(n,function(n,r){e[n]=e[n]||{},e[n][t]=r})};le.ie&&le.ie<8&&(rn(Wt,"get",{maxlength:function(e){var t=e.maxLength;if(2147483647!==t)return t},size:function(e){var t=e.size;if(20!==t)return t},class:function(e){return e.className},style:function(e){var t=e.style.cssText;if(0!==t.length)return t}}),rn(Wt,"set",{class:function(e,t){e.className=t},style:function(e,t){e.style.cssText=t}})),le.ie&&le.ie<9&&($t.float="styleFloat",rn(Kt,"set",{opacity:function(e,t){var n=e.style;null===t||""===t?n.removeAttribute("filter"):(n.zoom=1,n.filter="alpha(opacity="+100*t+")")}})),Xt.attrHooks=Wt,Xt.cssHooks=Kt;var on,an=function(e){var t,n=!1;return function(){return n||(n=!0,t=e.apply(null,arguments)),t}},sn=function(){return un(0,0)},un=function(e,t){return{major:e,minor:t}},ln={nu:un,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?sn():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return un(r(1),r(2))}(e,n)},unknown:sn},cn=function(e,t){return function(){return t===e}},dn=function(e){var t=e.current;return{current:t,version:e.version,isEdge:cn("Edge",t),isChrome:cn("Chrome",t),isIE:cn("IE",t),isOpera:cn("Opera",t),isFirefox:cn("Firefox",t),isSafari:cn("Safari",t)}},fn={unknown:function(){return dn({current:void 0,version:ln.unknown()})},nu:dn,edge:p.constant("Edge"),chrome:p.constant("Chrome"),ie:p.constant("IE"),opera:p.constant("Opera"),firefox:p.constant("Firefox"),safari:p.constant("Safari")},hn=function(e,t){return function(){return t===e}},mn=function(e){var t=e.current;return{current:t,version:e.version,isWindows:hn("Windows",t),isiOS:hn("iOS",t),isAndroid:hn("Android",t),isOSX:hn("OSX",t),isLinux:hn("Linux",t),isSolaris:hn("Solaris",t),isFreeBSD:hn("FreeBSD",t)}},pn={unknown:function(){return mn({current:void 0,version:ln.unknown()})},nu:mn,windows:p.constant("Windows"),ios:p.constant("iOS"),android:p.constant("Android"),linux:p.constant("Linux"),osx:p.constant("OSX"),solaris:p.constant("Solaris"),freebsd:p.constant("FreeBSD")},gn=function(e,t){var n=String(t).toLowerCase();return O.find(e,function(e){return e.search(n)})},vn=function(e,t){return gn(e,t).map(function(e){var n=ln.detect(e.versionRegexes,t);return{current:e.name,version:n}})},bn=function(e,t){return gn(e,t).map(function(e){var n=ln.detect(e.versionRegexes,t);return{current:e.name,version:n}})},yn=function(e,t){return-1!==e.indexOf(t)},Cn=function(e){return e.replace(/^\s+|\s+$/g,"")},wn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,En=function(e){return function(t){return yn(t,e)}},xn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return yn(e,"edge/")&&yn(e,"chrome")&&yn(e,"safari")&&yn(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,wn],search:function(e){return yn(e,"chrome")&&!yn(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return yn(e,"msie")||yn(e,"trident")}},{name:"Opera",versionRegexes:[wn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:En("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:En("firefox")},{name:"Safari",versionRegexes:[wn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(yn(e,"safari")||yn(e,"mobile/"))&&yn(e,"applewebkit")}}],Nn=[{name:"Windows",search:En("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return yn(e,"iphone")||yn(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:En("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:En("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:En("linux"),versionRegexes:[]},{name:"Solaris",search:En("sunos"),versionRegexes:[]},{name:"FreeBSD",search:En("freebsd"),versionRegexes:[]}],Sn={browsers:p.constant(xn),oses:p.constant(Nn)},kn=function(e){var t=Sn.browsers(),n=Sn.oses(),r=vn(t,e).fold(fn.unknown,fn.nu),i=bn(n,e).fold(pn.unknown,pn.nu);return{browser:r,os:i,deviceType:function(e,t,n){var r=e.isiOS()&&!0===/ipad/i.test(n),i=e.isiOS()&&!r,o=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,s=r||o||a&&!0===/mobile/i.test(n),u=e.isiOS()||e.isAndroid(),l=u&&!s,c=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n);return{isiPad:p.constant(r),isiPhone:p.constant(i),isTablet:p.constant(s),isPhone:p.constant(l),isTouch:p.constant(u),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:p.constant(c)}}(i,r,e)}},Tn={detect:an(function(){var e=navigator.userAgent;return kn(e)})},An=function(e){if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:p.constant(e)}},Dn={fromHtml:function(e,t){var n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1)throw console.error("HTML does not have a single root node",e),"HTML must have a single root node";return An(n.childNodes[0])},fromTag:function(e,t){var n=(t||document).createElement(e);return An(n)},fromText:function(e,t){var n=(t||document).createTextNode(e);return An(n)},fromDom:An,fromPoint:function(e,t,n){return w.from(e.dom().elementFromPoint(t,n)).map(An)}},Bn=8,Rn=9,_n=1,Ln=3,On=function(e){return e.dom().nodeName.toLowerCase()},Pn=function(e){return e.dom().nodeType},In=function(e){return function(t){return Pn(t)===e}},Fn=In(_n),Mn=In(Ln),Hn=In(Rn),qn={name:On,type:Pn,value:function(e){return e.dom().nodeValue},isElement:Fn,isText:Mn,isDocument:Hn,isComment:function(e){return Pn(e)===Bn||"#comment"===On(e)}},zn=function(e){return function(t){return function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&Array.prototype.isPrototypeOf(e)?"array":"object"===t&&String.prototype.isPrototypeOf(e)?"string":t}(t)===e}},Un={isString:zn("string"),isObject:zn("object"),isArray:zn("array"),isNull:zn("null"),isBoolean:zn("boolean"),isUndefined:zn("undefined"),isFunction:zn("function"),isNumber:zn("number")},jn=void 0===(on=Object.keys)?function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}:on,Vn=function(e,t){for(var n=jn(e),r=0,i=n.length;r<i;r++){var o=n[r];t(e[o],o,e)}},$n=function(e,t){var n={};return Vn(e,function(r,i){var o=t(r,i,e);n[o.k]=o.v}),n},Wn=function(e,t){var n=[];return Vn(e,function(e,r){n.push(t(e,r))}),n},Kn=function(e){return Wn(e,function(e){return e})},Xn={bifilter:function(e,t){var n={},r={};return Vn(e,function(e,i){(t(e,i)?n:r)[i]=e}),{t:n,f:r}},each:Vn,map:function(e,t){return $n(e,function(e,n,r){return{k:n,v:t(e,n,r)}})},mapToArray:Wn,tupleMap:$n,find:function(e,t){for(var n=jn(e),r=0,i=n.length;r<i;r++){var o=n[r],a=e[o];if(t(a,o,e))return w.some(a)}return w.none()},keys:jn,values:Kn,size:function(e){return Kn(e).length}},Yn=function(e,t,n){if(!(Un.isString(n)||Un.isBoolean(n)||Un.isNumber(n)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},Gn=function(e,t,n){Yn(e.dom(),t,n)},Zn=function(e,t){var n=e.dom().getAttribute(t);return null===n?void 0:n},Qn=function(e,t){var n=e.dom();return!(!n||!n.hasAttribute)&&n.hasAttribute(t)},Jn={clone:function(e){return O.foldl(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},set:Gn,setAll:function(e,t){var n=e.dom();Xn.each(t,function(e,t){Yn(n,t,e)})},get:Zn,has:Qn,remove:function(e,t){e.dom().removeAttribute(t)},hasNone:function(e){var t=e.dom().attributes;return void 0===t||null===t||0===t.length},transfer:function(e,t,n){qn.isElement(e)&&qn.isElement(t)&&O.each(n,function(n){!function(e,t,n){Qn(e,n)&&!Qn(t,n)&&Gn(t,n,Zn(e,n))}(e,t,n)})}},er=an(function(){return tr(Dn.fromDom(document))}),tr=function(e){var t=e.dom().body;if(null===t||void 0===t)throw"Body is not available yet";return Dn.fromDom(t)},nr={body:er,getBody:tr,inBody:function(e){var t=qn.isText(e)?e.dom().parentNode:e.dom();return void 0!==t&&null!==t&&t.ownerDocument.body.contains(t)}},rr=function(e){return void 0!==e.style},ir=function(e,t,n){if(!Un.isString(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);rr(e)&&e.style.setProperty(t,n)},or=function(e,t){return rr(e)?e.style.getPropertyValue(t):""},ar=function(e,t){var n=e.dom();Xn.each(t,function(e,t){ir(n,t,e)})},sr=function(e,t){var n=e.dom(),r=window.getComputedStyle(n).getPropertyValue(t),i=""!==r||nr.inBody(e)?r:or(n,t);return null===i?void 0:i},ur=function(e){return e.slice(0).sort()},lr={sort:ur,reqMessage:function(e,t){throw new Error("All required keys ("+ur(e).join(", ")+") were not specified. Specified keys were: "+ur(t).join(", ")+".")},unsuppMessage:function(e){throw new Error("Unsupported keys for object: "+ur(e).join(", "))},validateStrArr:function(e,t){if(!Un.isArray(t))throw new Error("The "+e+" fields must be an array. Was: "+t+".");O.each(t,function(t){if(!Un.isString(t))throw new Error("The value "+t+" in the "+e+" fields was not a string.")})},invalidTypeMessage:function(e,t){throw new Error("All values need to be of type: "+t+". Keys ("+ur(e).join(", ")+") were not.")},checkDupes:function(e){var t=ur(e);O.find(t,function(e,n){return n<t.length-1&&e===t[n+1]}).each(function(e){throw new Error("The field: "+e+" occurs more than once in the combined fields: ["+t.join(", ")+"].")})}},cr={immutable:function(){var e=arguments;return function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var r={};return O.each(e,function(e,n){r[e]=p.constant(t[n])}),r}},immutableBag:function(e,t){var n=e.concat(t);if(0===n.length)throw new Error("You must specify at least one required or optional field.");return lr.validateStrArr("required",e),lr.validateStrArr("optional",t),lr.checkDupes(n),function(r){var i=Xn.keys(r);O.forall(e,function(e){return O.contains(i,e)})||lr.reqMessage(e,i);var o=O.filter(i,function(e){return!O.contains(n,e)});o.length>0&&lr.unsuppMessage(o);var a={};return O.each(e,function(e){a[e]=p.constant(r[e])}),O.each(t,function(e){a[e]=p.constant(Object.prototype.hasOwnProperty.call(r,e)?w.some(r[e]):w.none())}),a}}},dr=function(e,t){var n=[],r=function(e){return n.push(e),t(e)},i=t(e);do{i=i.bind(r)}while(i.isSome());return n},fr=function(){return M.getOrDie("Node")},hr=function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)},mr=function(e,t){return hr(e,t,fr().DOCUMENT_POSITION_CONTAINED_BY)},pr=_n,gr=Rn,vr=function(e){return e.nodeType!==pr&&e.nodeType!==gr||0===e.childElementCount},br={all:function(e,t){var n=void 0===t?document:t.dom();return vr(n)?[]:O.map(n.querySelectorAll(e),Dn.fromDom)},is:function(e,t){var n=e.dom();if(n.nodeType!==pr)return!1;if(void 0!==n.matches)return n.matches(t);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(t);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},one:function(e,t){var n=void 0===t?document:t.dom();return vr(n)?w.none():w.from(n.querySelector(e)).map(Dn.fromDom)}},yr=function(e,t){return e.dom()===t.dom()},Cr=Tn.detect().browser.isIE()?function(e,t){return mr(e.dom(),t.dom())}:function(e,t){var n=e.dom(),r=t.dom();return n!==r&&n.contains(r)},wr={eq:yr,isEqualNode:function(e,t){return e.dom().isEqualNode(t.dom())},member:function(e,t){return O.exists(t,p.curry(yr,e))},contains:Cr,is:br.is},Er=function(e){return Dn.fromDom(e.dom().ownerDocument)},xr=function(e){var t=e.dom();return w.from(t.parentNode).map(Dn.fromDom)},Nr=function(e){var t=e.dom();return w.from(t.previousSibling).map(Dn.fromDom)},Sr=function(e){var t=e.dom();return w.from(t.nextSibling).map(Dn.fromDom)},kr=function(e){var t=e.dom();return O.map(t.childNodes,Dn.fromDom)},Tr=function(e,t){var n=e.dom().childNodes;return w.from(n[t]).map(Dn.fromDom)},Ar=cr.immutable("element","offset"),Dr={owner:Er,defaultView:function(e){var t=e.dom().ownerDocument.defaultView;return Dn.fromDom(t)},documentElement:function(e){var t=Er(e);return Dn.fromDom(t.dom().documentElement)},parent:xr,findIndex:function(e){return xr(e).bind(function(t){var n=kr(t);return O.findIndex(n,function(t){return wr.eq(e,t)})})},parents:function(e,t){for(var n=Un.isFunction(t)?t:p.constant(!1),r=e.dom(),i=[];null!==r.parentNode&&void 0!==r.parentNode;){var o=r.parentNode,a=Dn.fromDom(o);if(i.push(a),!0===n(a))break;r=o}return i},siblings:function(e){return xr(e).map(kr).map(function(t){return O.filter(t,function(t){return!wr.eq(e,t)})}).getOr([])},prevSibling:Nr,offsetParent:function(e){var t=e.dom();return w.from(t.offsetParent).map(Dn.fromDom)},prevSiblings:function(e){return O.reverse(dr(e,Nr))},nextSibling:Sr,nextSiblings:function(e){return dr(e,Sr)},children:kr,child:Tr,firstChild:function(e){return Tr(e,0)},lastChild:function(e){return Tr(e,e.dom().childNodes.length-1)},childNodesCount:function(e){return e.dom().childNodes.length},hasChildNodes:function(e){return e.dom().hasChildNodes()},leaf:function(e,t){var n=kr(e);return n.length>0&&t<n.length?Ar(n[t],0):Ar(e,t)}},Br=Tn.detect().browser,Rr=function(e){return O.find(e,qn.isElement)},_r=function(e,t,n){var r,i,o=0,a=0,s=e.ownerDocument;if(n=n||e,t){if(n===e&&t.getBoundingClientRect&&"static"===sr(Dn.fromDom(e),"position"))return{x:o=(i=t.getBoundingClientRect()).left+(s.documentElement.scrollLeft||e.scrollLeft)-s.documentElement.clientLeft,y:a=i.top+(s.documentElement.scrollTop||e.scrollTop)-s.documentElement.clientTop};for(r=t;r&&r!==n&&r.nodeType;)o+=r.offsetLeft||0,a+=r.offsetTop||0,r=r.offsetParent;for(r=t.parentNode;r&&r!==n&&r.nodeType;)o-=r.scrollLeft||0,a-=r.scrollTop||0,r=r.parentNode;a+=function(e){return Br.isFirefox()&&"table"===qn.name(e)?Rr(Dr.children(e)).filter(function(e){return"caption"===qn.name(e)}).bind(function(e){return Rr(Dr.nextSiblings(e)).map(function(t){var n=t.dom().offsetTop,r=e.dom().offsetTop,i=e.dom().offsetHeight;return n<=r?-i:0})}).getOr(0):0}(Dn.fromDom(t))}return{x:o,y:a}},Lr=function(e){var t=w.none(),n=[],r=function(e){i()?a(e):n.push(e)},i=function(){return t.isSome()},o=function(e){O.each(e,a)},a=function(e){t.each(function(t){setTimeout(function(){e(t)},0)})};return e(function(e){t=w.some(e),o(n),n=[]}),{get:r,map:function(e){return Lr(function(t){r(function(n){t(e(n))})})},isReady:i}},Or={nu:Lr,pure:function(e){return Lr(function(t){t(e)})}},Pr=function(e){return function(){var t=Array.prototype.slice.call(arguments),n=this;setTimeout(function(){e.apply(n,t)},0)}},Ir=function(e){var t=function(t){e(Pr(t))};return{map:function(e){return Ir(function(n){t(function(t){var r=e(t);n(r)})})},bind:function(e){return Ir(function(n){t(function(t){e(t).get(n)})})},anonBind:function(e){return Ir(function(n){t(function(t){e.get(n)})})},toLazy:function(){return Or.nu(t)},get:t}},Fr={nu:Ir,pure:function(e){return Ir(function(t){t(e)})}},Mr=function(e,t){return t(function(t){var n=[],r=0;0===e.length?t([]):O.each(e,function(i,o){i.get(function(i){return function(o){n[i]=o,++r>=e.length&&t(n)}}(o))})})},Hr=function(e){return Mr(e,Fr.nu)},qr={par:Hr,mapM:function(e,t){var n=O.map(e,t);return Hr(n)},compose:function(e,t){return function(n){return t(n).bind(e)}}},zr=function(e){return{is:function(t){return e===t},isValue:p.always,isError:p.never,getOr:p.constant(e),getOrThunk:p.constant(e),getOrDie:p.constant(e),or:function(t){return zr(e)},orThunk:function(t){return zr(e)},fold:function(t,n){return n(e)},map:function(t){return zr(t(e))},each:function(t){t(e)},bind:function(t){return t(e)},exists:function(t){return t(e)},forall:function(t){return t(e)},toOption:function(){return w.some(e)}}},Ur=function(e){return{is:p.never,isValue:p.never,isError:p.always,getOr:p.identity,getOrThunk:function(e){return e()},getOrDie:function(){return p.die(e)()},or:function(e){return e},orThunk:function(e){return e()},fold:function(t,n){return t(e)},map:function(t){return Ur(e)},each:p.noop,bind:function(t){return Ur(e)},exists:p.never,forall:p.always,toOption:w.none}},jr={value:zr,error:Ur};function Vr(e,t){var n=e,r=function(e,n,r,i){var o,a;if(e){if(!i&&e[n])return e[n];if(e!==t){if(o=e[r])return o;for(a=e.parentNode;a&&a!==t;a=a.parentNode)if(o=a[r])return o}}};this.current=function(){return n},this.next=function(e){return n=r(n,"firstChild","nextSibling",e)},this.prev=function(e){return n=r(n,"lastChild","previousSibling",e)},this.prev2=function(e){return n=function(e,n,r,i){var o,a,s;if(e){if(o=e[r],t&&o===t)return;if(o){if(!i)for(s=o[n];s;s=s[n])if(!s[n])return s;return o}if((a=e.parentNode)&&a!==t)return a}}(n,"lastChild","previousSibling",e)}}var $r,Wr,Kr,Xr=function(e){var t;return function(n){return(t=t||O.mapToObject(e,p.constant(!0))).hasOwnProperty(qn.name(n))}},Yr=Xr(["h1","h2","h3","h4","h5","h6"]),Gr=Xr(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]),Zr=function(e){return qn.isElement(e)&&!Gr(e)},Qr=function(e){return qn.isElement(e)&&"br"===qn.name(e)},Jr=Xr(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),ei=Xr(["ul","ol","dl"]),ti=Xr(["li","dd","dt"]),ni=Xr(["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","source","wbr","track"]),ri=Xr(["thead","tbody","tfoot"]),ii=Xr(["td","th"]),oi=function(e){return function(t){return!!t&&t.nodeType===e}},ai=oi(1),si=function(e){var t=e.toLowerCase().split(" ");return function(e){var n,r;if(e&&e.nodeType)for(r=e.nodeName.toLowerCase(),n=0;n<t.length;n++)if(r===t[n])return!0;return!1}},ui=function(e){return function(t){if(ai(t)){if(t.contentEditable===e)return!0;if(t.getAttribute("data-mce-contenteditable")===e)return!0}return!1}},li=oi(3),ci=oi(8),di=oi(9),fi=si("br"),hi=ui("true"),mi=ui("false"),pi={isText:li,isElement:ai,isComment:ci,isDocument:di,isBr:fi,isContentEditableTrue:hi,isContentEditableFalse:mi,matchNodeNames:si,hasPropValue:function(e,t){return function(n){return ai(n)&&n[e]===t}},hasAttribute:function(e,t){return function(t){return ai(t)&&t.hasAttribute(e)}},hasAttributeValue:function(e,t){return function(n){return ai(n)&&n.getAttribute(e)===t}},matchStyleValues:function(e,t){var n=t.toLowerCase().split(" ");return function(t){var r;if(ai(t))for(r=0;r<n.length;r++)if(t.ownerDocument.defaultView.getComputedStyle(t,null).getPropertyValue(e)===n[r])return!0;return!1}},isBogus:function(e){return ai(e)&&e.hasAttribute("data-mce-bogus")},isBogusAll:function(e){return ai(e)&&"all"===e.getAttribute("data-mce-bogus")},isTable:function(e){return ai(e)&&"TABLE"===e.tagName}},gi=function(e){return e&&"SPAN"===e.tagName&&"bookmark"===e.getAttribute("data-mce-type")},vi=function(e,t){var n,r=t.childNodes;if(!pi.isElement(t)||!gi(t)){for(n=r.length-1;n>=0;n--)vi(e,r[n]);if(!1===pi.isDocument(t)){if(pi.isText(t)&&t.nodeValue.length>0){var i=Dt.trim(t.nodeValue).length;if(e.isBlock(t.parentNode)||i>0)return;if(0===i&&function(e){var t=e.previousSibling&&"SPAN"===e.previousSibling.nodeName,n=e.nextSibling&&"SPAN"===e.nextSibling.nodeName;return t&&n}(t))return}else if(pi.isElement(t)&&(1===(r=t.childNodes).length&&gi(r[0])&&t.parentNode.insertBefore(r[0],t),r.length||ni(Dn.fromDom(t))))return;e.remove(t)}return t}},bi={trimNode:vi},yi=Dt.makeMap,Ci=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,wi=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ei=/[<>&\"\']/g,xi=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,Ni={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""};Wr={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},Kr={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};var Si=function(e,t){var n,r,i,o={};if(e){for(e=e.split(","),t=t||10,n=0;n<e.length;n+=2)r=String.fromCharCode(parseInt(e[n],t)),Wr[r]||(i="&"+e[n+1]+";",o[r]=i,o[i]=r);return o}};$r=Si("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var ki=function(e,t){return e.replace(t?Ci:wi,function(e){return Wr[e]||e})},Ti=function(e,t){return e.replace(t?Ci:wi,function(e){return e.length>1?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":Wr[e]||"&#"+e.charCodeAt(0)+";"})},Ai=function(e,t,n){return n=n||$r,e.replace(t?Ci:wi,function(e){return Wr[e]||n[e]||e})},Di={encodeRaw:ki,encodeAllRaw:function(e){return(""+e).replace(Ei,function(e){return Wr[e]||e})},encodeNumeric:Ti,encodeNamed:Ai,getEncodeFunc:function(e,t){var n=Si(t)||$r,r=yi(e.replace(/\+/g,","));return r.named&&r.numeric?function(e,t){return e.replace(t?Ci:wi,function(e){return void 0!==Wr[e]?Wr[e]:void 0!==n[e]?n[e]:e.length>1?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":"&#"+e.charCodeAt(0)+";"})}:r.named?t?function(e,t){return Ai(e,t,n)}:Ai:r.numeric?Ti:ki},decode:function(e){return e.replace(xi,function(e,t){return t?(t="x"===t.charAt(0).toLowerCase()?parseInt(t.substr(1),16):parseInt(t,10))>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):Ni[t]||String.fromCharCode(t):Kr[e]||$r[e]||(n=e,(r=Dn.fromTag("div").dom()).innerHTML=n,r.textContent||r.innerText||n);var n,r})}},Bi={},Ri={},_i=Dt.makeMap,Li=Dt.each,Oi=Dt.extend,Pi=Dt.explode,Ii=Dt.inArray,Fi=function(e,t){return(e=Dt.trim(e))?e.split(t||" "):[]},Mi=function(e){var t,n,r,i,o,a,s={},u=function(e,n,r){var i,o,a,u=function(e,t){var n,r,i={};for(n=0,r=e.length;n<r;n++)i[e[n]]=t||{};return i};for(r=r||[],n=n||"","string"==typeof r&&(r=Fi(r)),i=(e=Fi(e)).length;i--;)a={attributes:u(o=Fi([t,n].join(" "))),attributesOrder:o,children:u(r,Ri)},s[e[i]]=a},l=function(e,t){var n,r,i,o;for(n=(e=Fi(e)).length,t=Fi(t);n--;)for(r=s[e[n]],i=0,o=t.length;i<o;i++)r.attributes[t[i]]={},r.attributesOrder.push(t[i])};return Bi[e]?Bi[e]:(t="id accesskey class dir lang style tabindex title role",n="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",r="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==e&&(t+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",n+=" article aside details dialog figure header footer hgroup section nav",r+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==e&&(t+=" xml:lang",r=[r,a="acronym applet basefont big font strike tt"].join(" "),Li(Fi(a),function(e){u(e,"",r)}),n=[n,o="center dir isindex noframes"].join(" "),i=[n,r].join(" "),Li(Fi(o),function(e){u(e,"",i)})),i=i||[n,r].join(" "),u("html","manifest","head body"),u("head","","base command link meta noscript script style title"),u("title hr noscript br"),u("base","href target"),u("link","href rel media hreflang type sizes hreflang"),u("meta","name http-equiv content charset"),u("style","media type scoped"),u("script","src async defer type charset"),u("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",i),u("address dt dd div caption","",i),u("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",r),u("blockquote","cite",i),u("ol","reversed start type","li"),u("ul","","li"),u("li","value",i),u("dl","","dt dd"),u("a","href target rel media hreflang type",r),u("q","cite",r),u("ins del","cite datetime",i),u("img","src sizes srcset alt usemap ismap width height"),u("iframe","src name width height",i),u("embed","src type width height"),u("object","data type typemustmatch name usemap form width height",[i,"param"].join(" ")),u("param","name value"),u("map","name",[i,"area"].join(" ")),u("area","alt coords shape href target rel media hreflang type"),u("table","border","caption colgroup thead tfoot tbody tr"+("html4"===e?" col":"")),u("colgroup","span","col"),u("col","span"),u("tbody thead tfoot","","tr"),u("tr","","td th"),u("td","colspan rowspan headers",i),u("th","colspan rowspan headers scope abbr",i),u("form","accept-charset action autocomplete enctype method name novalidate target",i),u("fieldset","disabled form name",[i,"legend"].join(" ")),u("label","form for",r),u("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),u("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===e?i:r),u("select","disabled form multiple name required size","option optgroup"),u("optgroup","disabled label","option"),u("option","disabled label selected value"),u("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),u("menu","type label",[i,"li"].join(" ")),u("noscript","",i),"html4"!==e&&(u("wbr"),u("ruby","",[r,"rt rp"].join(" ")),u("figcaption","",i),u("mark rt rp summary bdi","",r),u("canvas","width height",i),u("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[i,"track source"].join(" ")),u("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[i,"track source"].join(" ")),u("picture","","img source"),u("source","src srcset type media sizes"),u("track","kind src srclang label default"),u("datalist","",[r,"option"].join(" ")),u("article section nav aside header footer","",i),u("hgroup","","h1 h2 h3 h4 h5 h6"),u("figure","",[i,"figcaption"].join(" ")),u("time","datetime",r),u("dialog","open",i),u("command","type label icon disabled checked radiogroup command"),u("output","for form name",r),u("progress","value max",r),u("meter","value min max low high optimum",r),u("details","open",[i,"summary"].join(" ")),u("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==e&&(l("script","language xml:space"),l("style","xml:space"),l("object","declare classid code codebase codetype archive standby align border hspace vspace"),l("embed","align name hspace vspace"),l("param","valuetype type"),l("a","charset name rev shape coords"),l("br","clear"),l("applet","codebase archive code object alt name width height align hspace vspace"),l("img","name longdesc align border hspace vspace"),l("iframe","longdesc frameborder marginwidth marginheight scrolling align"),l("font basefont","size color face"),l("input","usemap align"),l("select","onchange"),l("textarea"),l("h1 h2 h3 h4 h5 h6 div p legend caption","align"),l("ul","type compact"),l("li","type"),l("ol dl menu dir","compact"),l("pre","width xml:space"),l("hr","align noshade size width"),l("isindex","prompt"),l("table","summary width frame rules cellspacing cellpadding align bgcolor"),l("col","width align char charoff valign"),l("colgroup","width align char charoff valign"),l("thead","align char charoff valign"),l("tr","align char charoff valign bgcolor"),l("th","axis align char charoff valign nowrap bgcolor width height"),l("form","accept"),l("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),l("tfoot","align char charoff valign"),l("tbody","align char charoff valign"),l("area","nohref"),l("body","background bgcolor text link vlink alink")),"html4"!==e&&(l("input button select textarea","autofocus"),l("input textarea","placeholder"),l("a","download"),l("link script img","crossorigin"),l("iframe","sandbox seamless allowfullscreen")),Li(Fi("a form meter progress dfn"),function(e){s[e]&&delete s[e].children[e]}),delete s.caption.children.table,delete s.script,Bi[e]=s,s)},Hi=function(e,t){var n;return e&&(n={},"string"==typeof e&&(e={"*":e}),Li(e,function(e,r){n[r]=n[r.toUpperCase()]="map"===t?_i(e,/[, ]/):Pi(e,/[, ]/)})),n};function qi(e){var t,n,r,i,o,a,s,u,l,c,d,f,h,m={},p={},g=[],v={},b={},y=function(t,n,r){var i=e[t];return i?i=_i(i,/[, ]/,_i(i.toUpperCase(),/[, ]/)):(i=Bi[t])||(i=_i(n," ",_i(n.toUpperCase()," ")),i=Oi(i,r),Bi[t]=i),i};r=Mi((e=e||{}).schema),!1===e.verify_html&&(e.valid_elements="*[*]"),t=Hi(e.valid_styles),n=Hi(e.invalid_styles,"map"),u=Hi(e.valid_classes,"map"),i=y("whitespace_elements","pre script noscript style textarea video audio iframe object code"),o=y("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),a=y("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),s=y("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),c=y("non_empty_elements","td th iframe video audio object script pre code",a),d=y("move_caret_before_on_enter_elements","table",c),f=y("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),l=y("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption",f),h=y("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),Li((e.special||"script noscript noframes noembed title style textarea xmp").split(" "),function(e){b[e]=new RegExp("</"+e+"[^>]*>","gi")});var C=function(e){return new RegExp("^"+e.replace(/([?+*])/g,".$1")+"$")},w=function(e){var t,n,r,i,o,a,s,u,l,c,d,f,h,p,v,b,y,w,E,x=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,N=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,S=/[*?+]/;if(e)for(e=Fi(e,","),m["@"]&&(b=m["@"].attributes,y=m["@"].attributesOrder),t=0,n=e.length;t<n;t++)if(o=x.exec(e[t])){if(p=o[1],l=o[2],v=o[3],u=o[5],a={attributes:f={},attributesOrder:h=[]},"#"===p&&(a.paddEmpty=!0),"-"===p&&(a.removeEmpty=!0),"!"===o[4]&&(a.removeEmptyAttrs=!0),b){for(w in b)f[w]=b[w];h.push.apply(h,y)}if(u)for(r=0,i=(u=Fi(u,"|")).length;r<i;r++)if(o=N.exec(u[r])){if(s={},d=o[1],c=o[2].replace(/[\\:]:/g,":"),p=o[3],E=o[4],"!"===d&&(a.attributesRequired=a.attributesRequired||[],a.attributesRequired.push(c),s.required=!0),"-"===d){delete f[c],h.splice(Ii(h,c),1);continue}p&&("="===p&&(a.attributesDefault=a.attributesDefault||[],a.attributesDefault.push({name:c,value:E}),s.defaultValue=E),":"===p&&(a.attributesForced=a.attributesForced||[],a.attributesForced.push({name:c,value:E}),s.forcedValue=E),"<"===p&&(s.validValues=_i(E,"?"))),S.test(c)?(a.attributePatterns=a.attributePatterns||[],s.pattern=C(c),a.attributePatterns.push(s)):(f[c]||h.push(c),f[c]=s)}b||"@"!==l||(b=f,y=h),v&&(a.outputName=l,m[v]=a),S.test(l)?(a.pattern=C(l),g.push(a)):m[l]=a}},E=function(e){m={},g=[],w(e),Li(r,function(e,t){p[t]=e.children})},x=function(e){var t=/^(~)?(.+)$/;e&&(Bi.text_block_elements=Bi.block_elements=null,Li(Fi(e,","),function(e){var n=t.exec(e),r="~"===n[1],i=r?"span":"div",o=n[2];if(p[o]=p[i],v[o]=i,r||(l[o.toUpperCase()]={},l[o]={}),!m[o]){var a=m[i];delete(a=Oi({},a)).removeEmptyAttrs,delete a.removeEmpty,m[o]=a}Li(p,function(e,t){e[i]&&(p[t]=e=Oi({},p[t]),e[o]=e[i])})}))},N=function(t){var n=/^([+\-]?)(\w+)\[([^\]]+)\]$/;Bi[e.schema]=null,t&&Li(Fi(t,","),function(e){var t,r,i=n.exec(e);i&&(r=i[1],t=r?p[i[2]]:p[i[2]]={"#comment":{}},t=p[i[2]],Li(Fi(i[3],"|"),function(e){"-"===r?delete t[e]:t[e]={}}))})},S=function(e){var t,n=m[e];if(n)return n;for(t=g.length;t--;)if((n=g[t]).pattern.test(e))return n};return e.valid_elements?E(e.valid_elements):(Li(r,function(e,t){m[t]={attributes:e.attributes,attributesOrder:e.attributesOrder},p[t]=e.children}),"html5"!==e.schema&&Li(Fi("strong/b em/i"),function(e){e=Fi(e,"/"),m[e[1]].outputName=e[0]}),Li(Fi("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(e){m[e]&&(m[e].removeEmpty=!0)}),Li(Fi("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),function(e){m[e].paddEmpty=!0}),Li(Fi("span"),function(e){m[e].removeEmptyAttrs=!0})),x(e.custom_elements),N(e.valid_children),w(e.extended_valid_elements),N("+ol[ul|ol],+ul[ul|ol]"),Li({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(e,t){m[t]&&(m[t].parentsRequired=Fi(e))}),e.invalid_elements&&Li(Pi(e.invalid_elements),function(e){m[e]&&delete m[e]}),S("span")||w("span[!data-mce-type|*]"),{children:p,elements:m,getValidStyles:function(){return t},getValidClasses:function(){return u},getBlockElements:function(){return l},getInvalidStyles:function(){return n},getShortEndedElements:function(){return a},getTextBlockElements:function(){return f},getTextInlineElements:function(){return h},getBoolAttrs:function(){return s},getElementRule:S,getSelfClosingElements:function(){return o},getNonEmptyElements:function(){return c},getMoveCaretBeforeOnEnterElements:function(){return d},getWhiteSpaceElements:function(){return i},getSpecialElements:function(){return b},isValidChild:function(e,t){var n=p[e.toLowerCase()];return!(!n||!n[t.toLowerCase()])},isValid:function(e,t){var n,r,i=S(e);if(i){if(!t)return!0;if(i.attributes[t])return!0;if(n=i.attributePatterns)for(r=n.length;r--;)if(n[r].pattern.test(e))return!0}return!1},getCustomElements:function(){return v},addValidElements:w,setValidElements:E,addCustomElements:x,addValidChildren:N}}var zi=function(e,t,n,r){var i=function(e){return(e=parseInt(e,10).toString(16)).length>1?e:"0"+e};return"#"+i(t)+i(n)+i(r)};function Ui(e,t){var n,r,i,o,a=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,s=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,u=/\s*([^:]+):\s*([^;]+);?/g,l=/\s+$/,c={};for(e=e||{},t&&(i=t.getValidStyles(),o=t.getInvalidStyles()),r="\\\" \\' \\; \\: ; : \ufeff".split(" "),n=0;n<r.length;n++)c[r[n]]="\ufeff"+n,c["\ufeff"+n]=r[n];return{toHex:function(e){return e.replace(a,zi)},parse:function(t){var r,i,o,d,f,h,m,p,g={},v=e.url_converter,b=e.url_converter_scope||this,y=function(e,t,r){var i,o,a,s;if((i=g[e+"-top"+t])&&(o=g[e+"-right"+t])&&(a=g[e+"-bottom"+t])&&(s=g[e+"-left"+t])){var u=[i,o,a,s];for(n=u.length-1;n--&&u[n]===u[n+1];);n>-1&&r||(g[e+t]=-1===n?u[0]:u.join(" "),delete g[e+"-top"+t],delete g[e+"-right"+t],delete g[e+"-bottom"+t],delete g[e+"-left"+t])}},C=function(e){var t,n=g[e];if(n){for(t=(n=n.split(" ")).length;t--;)if(n[t]!==n[0])return!1;return g[e]=n[0],!0}},w=function(e){return d=!0,c[e]},E=function(e,t){return d&&(e=e.replace(/\uFEFF[0-9]/g,function(e){return c[e]})),t||(e=e.replace(/\\([\'\";:])/g,"$1")),e},x=function(e){return String.fromCharCode(parseInt(e.slice(1),16))},N=function(e){return e.replace(/\\[0-9a-f]+/gi,x)},S=function(t,n,r,i,o,a){if(o=o||a)return"'"+(o=E(o)).replace(/\'/g,"\\'")+"'";if(n=E(n||r||i),!e.allow_script_urls){var s=n.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(s))return"";if(!e.allow_svg_data_urls&&/^data:image\/svg/i.test(s))return""}return v&&(n=v.call(b,n,"style")),"url('"+n.replace(/\'/g,"\\'")+"')"};if(t){for(t=(t=t.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,w).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(e){return e.replace(/[;:]/g,w)});r=u.exec(t);)if(u.lastIndex=r.index+r[0].length,i=r[1].replace(l,"").toLowerCase(),o=r[2].replace(l,""),i&&o){if(i=N(i),o=N(o),-1!==i.indexOf("\ufeff")||-1!==i.indexOf('"'))continue;if(!e.allow_script_urls&&("behavior"===i||/expression\s*\(|\/\*|\*\//.test(o)))continue;"font-weight"===i&&"700"===o?o="bold":"color"!==i&&"background-color"!==i||(o=o.toLowerCase()),o=(o=o.replace(a,zi)).replace(s,S),g[i]=d?E(o,!0):o}y("border","",!0),y("border","-width"),y("border","-color"),y("border","-style"),y("padding",""),y("margin",""),f="border",m="border-style",p="border-color",C(h="border-width")&&C(m)&&C(p)&&(g[f]=g[h]+" "+g[m]+" "+g[p],delete g[h],delete g[m],delete g[p]),"medium none"===g.border&&delete g.border,"none"===g["border-image"]&&delete g["border-image"]}return g},serialize:function(e,t){var n,r,a="",s=function(t){var n,r,o,s;if(n=i[t])for(r=0,o=n.length;r<o;r++)t=n[r],(s=e[t])&&(a+=(a.length>0?" ":"")+t+": "+s+";")},u=function(e,t){var n;return!((n=o["*"])&&n[e]||(n=o[t])&&n[e])};if(t&&i)s("*"),s(t);else for(n in e)!(r=e[n])||o&&!u(n,t)||(a+=(a.length>0?" ":"")+n+": "+r+";");return a}}}var ji=Dt.each,Vi=Dt.is,$i=Dt.grep,Wi=le.ie,Ki=/^([a-z0-9],?)+$/i,Xi=/^[ \t\r\n]*$/,Yi=function(e,t){var n=t.attr("style");(n=e.serializeStyle(e.parseStyle(n),t[0].nodeName))||(n=null),t.attr("data-mce-style",n)},Gi=function(e,t){var n,r,i=0;if(e)for(n=e.nodeType,e=e.previousSibling;e;e=e.previousSibling)r=e.nodeType,(!t||3!==r||r!==n&&e.nodeValue.length)&&(i++,n=r);return i},Zi=function(e,t){var n,r=this;r.doc=e,r.win=window,r.files={},r.counter=0,r.stdMode=!Wi||e.documentMode>=8,r.boxModel=!Wi||"CSS1Compat"===e.compatMode||r.stdMode,r.styleSheetLoader=function(e,t){var n,r=0,i={};n=(t=t||{}).maxLoadTime||5e3;var o=function(t){e.getElementsByTagName("head")[0].appendChild(t)},a=function(t,a,s){var u,l,c,d,f=function(){for(var e=d.passed,t=e.length;t--;)e[t]();d.status=2,d.passed=[],d.failed=[]},h=function(){for(var e=d.failed,t=e.length;t--;)e[t]();d.status=3,d.passed=[],d.failed=[]},m=function(e,t){e()||((new Date).getTime()-c<n?me.setTimeout(t):h())},p=function(){m(function(){for(var t,n,r=e.styleSheets,i=r.length;i--;)if((n=(t=r[i]).ownerNode?t.ownerNode:t.owningElement)&&n.id===u.id)return f(),!0},p)},g=function(){m(function(){try{var e=l.sheet.cssRules;return f(),!!e}catch(e){}},g)};if(t=Dt._addCacheSuffix(t),i[t]?d=i[t]:(d={passed:[],failed:[]},i[t]=d),a&&d.passed.push(a),s&&d.failed.push(s),1!==d.status)if(2!==d.status)if(3!==d.status){if(d.status=1,(u=e.createElement("link")).rel="stylesheet",u.type="text/css",u.id="u"+r++,u.async=!1,u.defer=!1,c=(new Date).getTime(),"onload"in u&&!((v=navigator.userAgent.match(/WebKit\/(\d*)/))&&parseInt(v[1],10)<536))u.onload=p,u.onerror=h;else{if(navigator.userAgent.indexOf("Firefox")>0)return(l=e.createElement("style")).textContent='@import "'+t+'"',g(),void o(l);p()}var v;o(u),u.href=t}else h();else f()},s=function(e){return Fr.nu(function(t){a(e,p.compose(t,p.constant(jr.value(e))),p.compose(t,p.constant(jr.error(e))))})},u=function(e){return e.fold(p.identity,p.identity)};return{load:a,loadAll:function(e,t,n){qr.par(O.map(e,s)).get(function(e){var r=O.partition(e,function(e){return e.isValue()});r.fail.length>0?n(r.fail.map(u)):t(r.pass.map(u))})}}}(e),r.boundEvents=[],r.settings=t=t||{},r.schema=t.schema?t.schema:qi({}),r.styles=Ui({url_converter:t.url_converter,url_converter_scope:t.url_converter_scope},t.schema),r.fixDoc(e),r.events=t.ownEvents?new xe(t.proxy):xe.Event,r.attrHooks=function(e,t){var n,r={},i=t.keep_values;return n={set:function(n,r,i){t.url_converter&&(r=t.url_converter.call(t.url_converter_scope||e,r,i,n[0])),n.attr("data-mce-"+i,r).attr(i,r)},get:function(e,t){return e.attr("data-mce-"+t)||e.attr(t)}},r={style:{set:function(e,t){null===t||"object"!=typeof t?(i&&e.attr("data-mce-style",t),e.attr("style",t)):e.css(t)},get:function(t){var n=t.attr("data-mce-style")||t.attr("style");return n=e.serializeStyle(e.parseStyle(n),t[0].nodeName)}}},i&&(r.href=r.src=n),r}(r,t),n=r.schema.getBlockElements(),r.$=Xt.overrideDefaults(function(){return{context:e,element:r.getRoot()}}),r.isBlock=function(e){if(!e)return!1;var t=e.nodeType;return t?!(1!==t||!n[e.nodeName]):!!n[e]}};Zi.prototype={$$:function(e){return"string"==typeof e&&(e=this.get(e)),this.$(e)},root:null,fixDoc:function(e){},clone:function(e,t){var n,r,i=this;return!Wi||1!==e.nodeType||t?e.cloneNode(t):(r=i.doc,t?n.firstChild:(n=r.createElement(e.nodeName),ji(i.getAttribs(e),function(t){i.setAttrib(n,t.nodeName,i.getAttrib(e,t.nodeName))}),n))},getRoot:function(){return this.settings.root_element||this.doc.body},getViewPort:function(e){var t,n;return t=(e=e||this.win).document,n=this.boxModel?t.documentElement:t.body,{x:e.pageXOffset||n.scrollLeft,y:e.pageYOffset||n.scrollTop,w:e.innerWidth||n.clientWidth,h:e.innerHeight||n.clientHeight}},getRect:function(e){var t,n;return e=this.get(e),t=this.getPos(e),n=this.getSize(e),{x:t.x,y:t.y,w:n.w,h:n.h}},getSize:function(e){var t,n;return e=this.get(e),t=this.getStyle(e,"width"),n=this.getStyle(e,"height"),-1===t.indexOf("px")&&(t=0),-1===n.indexOf("px")&&(n=0),{w:parseInt(t,10)||e.offsetWidth||e.clientWidth,h:parseInt(n,10)||e.offsetHeight||e.clientHeight}},getParent:function(e,t,n){return this.getParents(e,t,n,!1)},getParents:function(e,t,n,r){var i,o=this,a=[];for(e=o.get(e),r=void 0===r,n=n||("BODY"!==o.getRoot().nodeName?o.getRoot().parentNode:null),Vi(t,"string")&&(i=t,t="*"===t?function(e){return 1===e.nodeType}:function(e){return o.is(e,i)});e&&e!==n&&e.nodeType&&9!==e.nodeType;){if(!t||t(e)){if(!r)return e;a.push(e)}e=e.parentNode}return r?a:null},get:function(e){var t;return e&&this.doc&&"string"==typeof e&&(t=e,(e=this.doc.getElementById(e))&&e.id!==t)?this.doc.getElementsByName(t)[1]:e},getNext:function(e,t){return this._findSib(e,t,"nextSibling")},getPrev:function(e,t){return this._findSib(e,t,"previousSibling")},select:function(e,t){return at(e,this.get(t)||this.settings.root_element||this.doc,[])},is:function(e,t){var n;if(!e)return!1;if(void 0===e.length){if("*"===t)return 1===e.nodeType;if(Ki.test(t)){for(t=t.toLowerCase().split(/,/),e=e.nodeName.toLowerCase(),n=t.length-1;n>=0;n--)if(t[n]===e)return!0;return!1}}if(e.nodeType&&1!==e.nodeType)return!1;var r=e.nodeType?[e]:e;return at(t,r[0].ownerDocument||r[0],null,r).length>0},add:function(e,t,n,r,i){var o=this;return this.run(e,function(e){var a;return a=Vi(t,"string")?o.doc.createElement(t):t,o.setAttribs(a,n),r&&(r.nodeType?a.appendChild(r):o.setHTML(a,r)),i?a:e.appendChild(a)})},create:function(e,t,n){return this.add(this.doc.createElement(e),e,t,n,1)},createHTML:function(e,t,n){var r,i="";for(r in i+="<"+e,t)t.hasOwnProperty(r)&&null!==t[r]&&void 0!==t[r]&&(i+=" "+r+'="'+this.encode(t[r])+'"');return void 0!==n?i+">"+n+"</"+e+">":i+" />"},createFragment:function(e){var t,n,r,i=this.doc;for(r=i.createElement("div"),t=i.createDocumentFragment(),e&&(r.innerHTML=e);n=r.firstChild;)t.appendChild(n);return t},remove:function(e,t){return e=this.$$(e),t?e.each(function(){for(var e;e=this.firstChild;)3===e.nodeType&&0===e.data.length?this.removeChild(e):this.parentNode.insertBefore(e,this)}).remove():e.remove(),e.length>1?e.toArray():e[0]},setStyle:function(e,t,n){e=this.$$(e).css(t,n),this.settings.update_styles&&Yi(this,e)},getStyle:function(e,t,n){return e=this.$$(e),n?e.css(t):("float"===(t=t.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}))&&(t=le.ie&&le.ie<12?"styleFloat":"cssFloat"),e[0]&&e[0].style?e[0].style[t]:void 0)},setStyles:function(e,t){e=this.$$(e).css(t),this.settings.update_styles&&Yi(this,e)},removeAllAttribs:function(e){return this.run(e,function(e){var t,n=e.attributes;for(t=n.length-1;t>=0;t--)e.removeAttributeNode(n.item(t))})},setAttrib:function(e,t,n){var r,i,o=this.settings;""===n&&(n=null),r=(e=this.$$(e)).attr(t),e.length&&((i=this.attrHooks[t])&&i.set?i.set(e,n,t):e.attr(t,n),r!==n&&o.onSetAttrib&&o.onSetAttrib({attrElm:e,attrName:t,attrValue:n}))},setAttribs:function(e,t){var n=this;n.$$(e).each(function(e,r){ji(t,function(e,t){n.setAttrib(r,t,e)})})},getAttrib:function(e,t,n){var r,i;return(e=this.$$(e)).length&&(i=(r=this.attrHooks[t])&&r.get?r.get(e,t):e.attr(t)),void 0===i&&(i=n||""),i},getPos:function(e,t){return _r(this.doc.body,this.get(e),t)},parseStyle:function(e){return this.styles.parse(e)},serializeStyle:function(e,t){return this.styles.serialize(e,t)},addStyle:function(e){var t,n,r=this.doc;if(this!==Zi.DOM&&r===document){var i=Zi.DOM.addedStyles;if((i=i||[])[e])return;i[e]=!0,Zi.DOM.addedStyles=i}(n=r.getElementById("mceDefaultStyles"))||((n=r.createElement("style")).id="mceDefaultStyles",n.type="text/css",(t=r.getElementsByTagName("head")[0]).firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(r.createTextNode(e))},loadCSS:function(e){var t,n=this,r=n.doc;n===Zi.DOM||r!==document?(e||(e=""),t=r.getElementsByTagName("head")[0],ji(e.split(","),function(e){var i;e=Dt._addCacheSuffix(e),n.files[e]||(n.files[e]=!0,i=n.create("link",{rel:"stylesheet",href:e}),Wi&&r.documentMode&&r.recalc&&(i.onload=function(){r.recalc&&r.recalc(),i.onload=null}),t.appendChild(i))})):Zi.DOM.loadCSS(e)},addClass:function(e,t){this.$$(e).addClass(t)},removeClass:function(e,t){this.toggleClass(e,t,!1)},hasClass:function(e,t){return this.$$(e).hasClass(t)},toggleClass:function(e,t,n){this.$$(e).toggleClass(t,n).each(function(){""===this.className&&Xt(this).attr("class",null)})},show:function(e){this.$$(e).show()},hide:function(e){this.$$(e).hide()},isHidden:function(e){return"none"===this.$$(e).css("display")},uniqueId:function(e){return(e||"mce_")+this.counter++},setHTML:function(e,t){e=this.$$(e),Wi?e.each(function(e,n){if(!1!==n.canHaveHTML){for(;n.firstChild;)n.removeChild(n.firstChild);try{n.innerHTML="<br>"+t,n.removeChild(n.firstChild)}catch(e){Xt("<div></div>").html("<br>"+t).contents().slice(1).appendTo(n)}return t}}):e.html(t)},getOuterHTML:function(e){return 1===(e=this.get(e)).nodeType&&"outerHTML"in e?e.outerHTML:Xt("<div></div>").append(Xt(e).clone()).html()},setOuterHTML:function(e,t){var n=this;n.$$(e).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=t)}catch(e){}n.remove(Xt(this).html(t),!0)})},decode:Di.decode,encode:Di.encodeAllRaw,insertAfter:function(e,t){return t=this.get(t),this.run(e,function(e){var n,r;return n=t.parentNode,(r=t.nextSibling)?n.insertBefore(e,r):n.appendChild(e),e})},replace:function(e,t,n){return this.run(t,function(t){return Vi(t,"array")&&(e=e.cloneNode(!0)),n&&ji($i(t.childNodes),function(t){e.appendChild(t)}),t.parentNode.replaceChild(e,t)})},rename:function(e,t){var n,r=this;return e.nodeName!==t.toUpperCase()&&(n=r.create(t),ji(r.getAttribs(e),function(t){r.setAttrib(n,t.nodeName,r.getAttrib(e,t.nodeName))}),r.replace(n,e,1)),n||e},findCommonAncestor:function(e,t){for(var n,r=e;r;){for(n=t;n&&r!==n;)n=n.parentNode;if(r===n)break;r=r.parentNode}return!r&&e.ownerDocument?e.ownerDocument.documentElement:r},toHex:function(e){return this.styles.toHex(Dt.trim(e))},run:function(e,t,n){var r,i=this;return"string"==typeof e&&(e=i.get(e)),!!e&&(n=n||this,e.nodeType||!e.length&&0!==e.length?t.call(n,e):(r=[],ji(e,function(e,o){e&&("string"==typeof e&&(e=i.get(e)),r.push(t.call(n,e,o)))}),r))},getAttribs:function(e){var t;return(e=this.get(e))?Wi?(t=[],"OBJECT"===e.nodeName?e.attributes:("OPTION"===e.nodeName&&this.getAttrib(e,"selected")&&t.push({specified:1,nodeName:"selected"}),e.cloneNode(!1).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(e){t.push({specified:1,nodeName:e})}),t)):e.attributes:[]},isEmpty:function(e,t){var n,r,i,o,a,s,u=0;if(e=e.firstChild){a=new Vr(e,e.parentNode),t=t||(this.schema?this.schema.getNonEmptyElements():null),o=this.schema?this.schema.getWhiteSpaceElements():{};do{if(1===(i=e.nodeType)){var l=e.getAttribute("data-mce-bogus");if(l){e=a.next("all"===l);continue}if(s=e.nodeName.toLowerCase(),t&&t[s]){if("br"===s){u++,e=a.next();continue}return!1}for(n=(r=this.getAttribs(e)).length;n--;)if("name"===(s=r[n].nodeName)||"data-mce-bookmark"===s)return!1}if(8===i)return!1;if(3===i&&!Xi.test(e.nodeValue))return!1;if(3===i&&e.parentNode&&o[e.parentNode.nodeName]&&Xi.test(e.nodeValue))return!1;e=a.next()}while(e)}return u<=1},createRng:function(){return this.doc.createRange()},nodeIndex:Gi,split:function(e,t,n){var r,i,o,a=this.createRng();if(e&&t)return a.setStart(e.parentNode,this.nodeIndex(e)),a.setEnd(t.parentNode,this.nodeIndex(t)),r=a.extractContents(),(a=this.createRng()).setStart(t.parentNode,this.nodeIndex(t)+1),a.setEnd(e.parentNode,this.nodeIndex(e)+1),i=a.extractContents(),(o=e.parentNode).insertBefore(bi.trimNode(this,r),e),n?o.insertBefore(n,e):o.insertBefore(t,e),o.insertBefore(bi.trimNode(this,i),e),this.remove(e),n||t},bind:function(e,t,n,r){if(Dt.isArray(e)){for(var i=e.length;i--;)e[i]=this.bind(e[i],t,n,r);return e}return!this.settings.collect||e!==this.doc&&e!==this.win||this.boundEvents.push([e,t,n,r]),this.events.bind(e,t,n,r||this)},unbind:function(e,t,n){var r;if(Dt.isArray(e)){for(r=e.length;r--;)e[r]=this.unbind(e[r],t,n);return e}if(this.boundEvents&&(e===this.doc||e===this.win))for(r=this.boundEvents.length;r--;){var i=this.boundEvents[r];e!==i[0]||t&&t!==i[1]||n&&n!==i[2]||this.events.unbind(i[0],i[1],i[2])}return this.events.unbind(e,t,n)},fire:function(e,t,n){return this.events.fire(e,t,n)},getContentEditable:function(e){var t;return e&&1===e.nodeType?(t=e.getAttribute("data-mce-contenteditable"))&&"inherit"!==t?t:"inherit"!==e.contentEditable?e.contentEditable:null:null},getContentEditableParent:function(e){for(var t=this.getRoot(),n=null;e&&e!==t&&null===(n=this.getContentEditable(e));e=e.parentNode);return n},destroy:function(){if(this.boundEvents){for(var e=this.boundEvents.length;e--;){var t=this.boundEvents[e];this.events.unbind(t[0],t[1],t[2])}this.boundEvents=null}at.setDocument&&at.setDocument(),this.win=this.doc=this.root=this.events=this.frag=null},isChildOf:function(e,t){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},dumpRng:function(e){return"startContainer: "+e.startContainer.nodeName+", startOffset: "+e.startOffset+", endContainer: "+e.endContainer.nodeName+", endOffset: "+e.endOffset},_findSib:function(e,t,n){var r=this,i=t;if(e)for("string"==typeof i&&(i=function(e){return r.is(e,t)}),e=e[n];e;e=e[n])if(i(e))return e;return null}},Zi.DOM=new Zi(document),Zi.nodeIndex=Gi;var Qi=Zi.DOM,Ji=Dt.each,eo=Dt.grep,to=function(e){return"function"==typeof e},no=function(){var e={},t=[],n={},r=[],i=0;this.isDone=function(t){return 2===e[t]},this.markDone=function(t){e[t]=2},this.add=this.load=function(r,i,o,a){void 0===e[r]&&(t.push(r),e[r]=0),i&&(n[r]||(n[r]=[]),n[r].push({success:i,failure:a,scope:o||this}))},this.remove=function(t){delete e[t],delete n[t]},this.loadQueue=function(e,n,r){this.loadScripts(t,e,n,r)},this.loadScripts=function(t,o,a,s){var u,l=[],c=function(e,t){Ji(n[t],function(t){to(t[e])&&t[e].call(t.scope)}),n[t]=void 0};r.push({success:o,failure:s,scope:a||this}),(u=function(){var n=eo(t);if(t.length=0,Ji(n,function(t){2!==e[t]?3!==e[t]?1!==e[t]&&(e[t]=1,i++,function(e,t,n){var r,i,o=Qi,a=function(){o.remove(i),r&&(r.onreadystatechange=r.onload=r=null),t()};i=o.uniqueId(),(r=document.createElement("script")).id=i,r.type="text/javascript",r.src=Dt._addCacheSuffix(e),"onreadystatechange"in r?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&a()}:r.onload=a,r.onerror=function(){to(n)?n():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+e)},(document.getElementsByTagName("head")[0]||document.body).appendChild(r)}(t,function(){e[t]=2,i--,c("success",t),u()},function(){e[t]=3,i--,l.push(t),c("failure",t),u()})):c("failure",t):c("success",t)}),!i){var o=r.slice(0);r.length=0,Ji(o,function(e){0===l.length?to(e.success)&&e.success.call(e.scope):to(e.failure)&&e.failure.call(e.scope,l)})}})()}};no.ScriptLoader=new no;var ro=Dt.each,io=function(){this.items=[],this.urls={},this.lookup={},this._listeners=[]};io.prototype={get:function(e){if(this.lookup[e])return this.lookup[e].instance},dependencies:function(e){var t;return this.lookup[e]&&(t=this.lookup[e].dependencies),t||[]},requireLangPack:function(e,t){var n=io.language;if(n&&!1!==io.languageLoad){if(t)if(-1!==(t=","+t+",").indexOf(","+n.substr(0,2)+","))n=n.substr(0,2);else if(-1===t.indexOf(","+n+","))return;no.ScriptLoader.add(this.urls[e]+"/langs/"+n+".js")}},add:function(e,t,n){this.items.push(t),this.lookup[e]={instance:t,dependencies:n};var r=O.partition(this._listeners,function(t){return t.name===e});return this._listeners=r.fail,ro(r.pass,function(e){e.callback()}),t},remove:function(e){delete this.urls[e],delete this.lookup[e]},createUrl:function(e,t){return"object"==typeof t?t:{prefix:e.prefix,resource:t,suffix:e.suffix}},addComponents:function(e,t){var n=this.urls[e];ro(t,function(e){no.ScriptLoader.add(n+"/"+e)})},load:function(e,t,n,r,i){var o=this,a=t,s=function(){var i=o.dependencies(e);ro(i,function(e){var n=o.createUrl(t,e);o.load(n.resource,n,void 0,void 0)}),n&&(r?n.call(r):n.call(no))};o.urls[e]||("object"==typeof t&&(a=t.prefix+t.resource+t.suffix),0!==a.indexOf("/")&&-1===a.indexOf("://")&&(a=io.baseURL+"/"+a),o.urls[e]=a.substring(0,a.lastIndexOf("/")),o.lookup[e]?s():no.ScriptLoader.add(a,s,r,i))},waitFor:function(e,t){this.lookup.hasOwnProperty(e)?t():this._listeners.push({name:e,callback:t})}},io.PluginManager=new io,io.ThemeManager=new io;var oo=function(e){return"\ufeff"===e},ao="\ufeff",so=function(e){return e.replace(new RegExp("\ufeff","g"),"")},uo=pi.isElement,lo=pi.isText,co=function(e){return lo(e)&&(e=e.parentNode),uo(e)&&e.hasAttribute("data-mce-caret")},fo=function(e){return lo(e)&&oo(e.data)},ho=function(e){return co(e)||fo(e)},mo=function(e){return e.firstChild!==e.lastChild||!pi.isBr(e.firstChild)},po=function(e){var t=e.container();return e&&pi.isText(t)&&t.data.charAt(e.offset())===ao},go=function(e){var t=e.container();return e&&pi.isText(t)&&t.data.charAt(e.offset()-1)===ao},vo=function(e,t,n){var r,i,o;return(r=t.ownerDocument.createElement(e)).setAttribute("data-mce-caret",n?"before":"after"),r.setAttribute("data-mce-bogus","all"),r.appendChild(((o=document.createElement("br")).setAttribute("data-mce-bogus","1"),o)),i=t.parentNode,n?i.insertBefore(r,t):t.nextSibling?i.insertBefore(r,t.nextSibling):i.appendChild(r),r},bo=function(e){return lo(e)&&e.data[0]===ao},yo=function(e){return lo(e)&&e.data[e.data.length-1]===ao},Co=function(e){return e&&e.hasAttribute("data-mce-caret")?(t=e.getElementsByTagName("br"),n=t[t.length-1],pi.isBogus(n)&&n.parentNode.removeChild(n),e.removeAttribute("data-mce-caret"),e.removeAttribute("data-mce-bogus"),e.removeAttribute("style"),e.removeAttribute("_moz_abspos"),e):null;var t,n},wo=pi.isContentEditableTrue,Eo=pi.isContentEditableFalse,xo=pi.isBr,No=pi.isText,So=pi.matchNodeNames("script style textarea"),ko=pi.matchNodeNames("img input textarea hr iframe video audio object"),To=pi.matchNodeNames("table"),Ao=ho,Do=function(e){return!Ao(e)&&(No(e)?!So(e.parentNode):ko(e)||xo(e)||To(e)||Eo(e))},Bo=function(e,t){return Do(e)&&function(e,t){for(e=e.parentNode;e&&e!==t;e=e.parentNode){if(Eo(e))return!1;if(wo(e))return!0}return!0}(e,t)},Ro=Math.round,_o=function(e){return e?{left:Ro(e.left),top:Ro(e.top),bottom:Ro(e.bottom),right:Ro(e.right),width:Ro(e.width),height:Ro(e.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},Lo=function(e,t){return e=_o(e),t?e.right=e.left:(e.left=e.left+e.width,e.right=e.left),e.width=0,e},Oo=function(e,t,n){return e>=0&&e<=Math.min(t.height,n.height)/2},Po=function(e,t){return e.bottom-e.height/2<t.top||!(e.top>t.bottom)&&Oo(t.top-e.bottom,e,t)},Io=function(e,t){return e.top>t.bottom||!(e.bottom<t.top)&&Oo(t.bottom-e.top,e,t)},Fo=function(e){var t=e.startContainer,n=e.startOffset;return t.hasChildNodes()&&e.endOffset===n+1?t.childNodes[n]:null},Mo=function(e,t){return 1===e.nodeType&&e.hasChildNodes()&&(t>=e.childNodes.length&&(t=e.childNodes.length-1),e=e.childNodes[t]),e},Ho=new RegExp("[-----------------------------------------------------------------------------------------------------------------------------------]"),qo=function(e){return"string"==typeof e&&e.charCodeAt(0)>=768&&Ho.test(e)},zo=[].slice,Uo=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=zo.call(arguments);return r.length-1>=e.length?e.apply(this,r.slice(1)):function(){var e=r.concat([].slice.call(arguments));return Uo.apply(this,e)}},jo={constant:function(e){return function(){return e}},negate:function(e){return function(t){return!e(t)}},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zo.call(arguments);return function(e){for(var t=0;t<n.length;t++)if(!n[t](e))return!1;return!0}},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zo.call(arguments);return function(e){for(var t=0;t<n.length;t++)if(n[t](e))return!0;return!1}},curry:Uo,compose:function(e,t){return function(n){return e(t(n))}},noop:function(){}},Vo=pi.isElement,$o=Do,Wo=pi.matchStyleValues("display","block table"),Ko=pi.matchStyleValues("float","left right"),Xo=jo.and(Vo,$o,jo.negate(Ko)),Yo=jo.negate(pi.matchStyleValues("white-space","pre pre-line pre-wrap")),Go=pi.isText,Zo=pi.isBr,Qo=Zi.nodeIndex,Jo=Mo,ea=function(e){return"createRange"in e?e.createRange():Zi.DOM.createRng()},ta=function(e){return e&&/[\r\n\t ]/.test(e)},na=function(e){return!!e.setStart&&!!e.setEnd},ra=function(e){var t,n=e.startContainer,r=e.startOffset;return!!(ta(e.toString())&&Yo(n.parentNode)&&pi.isText(n)&&(t=n.data,ta(t[r-1])||ta(t[r+1])))},ia=function(e){return 0===e.left&&0===e.right&&0===e.top&&0===e.bottom},oa=function(e){var t,n;return t=(n=e.getClientRects()).length>0?_o(n[0]):_o(e.getBoundingClientRect()),!na(e)&&Zo(e)&&ia(t)?function(e){var t,n=e.ownerDocument,r=ea(n),i=n.createTextNode(""),o=e.parentNode;return o.insertBefore(i,e),r.setStart(i,0),r.setEnd(i,1),t=_o(r.getBoundingClientRect()),o.removeChild(i),t}(e):ia(t)&&na(e)?function(e){var t=e.startContainer,n=e.endContainer,r=e.startOffset,i=e.endOffset;if(t===n&&pi.isText(n)&&0===r&&1===i){var o=e.cloneRange();return o.setEndAfter(n),oa(o)}return null}(e):t},aa=function(e,t){var n=Lo(e,t);return n.width=1,n.right=n.left+1,n},sa=function(e){var t,n,r=[],i=function(e){var t,n;0!==e.height&&(r.length>0&&(t=e,n=r[r.length-1],t.left===n.left&&t.top===n.top&&t.bottom===n.bottom&&t.right===n.right)||r.push(e))},o=function(e,t){var n=ea(e.ownerDocument);if(t<e.data.length){if(qo(e.data[t]))return r;if(qo(e.data[t-1])&&(n.setStart(e,t),n.setEnd(e,t+1),!ra(n)))return i(aa(oa(n),!1)),r}t>0&&(n.setStart(e,t-1),n.setEnd(e,t),ra(n)||i(aa(oa(n),!1))),t<e.data.length&&(n.setStart(e,t),n.setEnd(e,t+1),ra(n)||i(aa(oa(n),!0)))};if(Go(e.container()))return o(e.container(),e.offset()),r;if(Vo(e.container()))if(e.isAtEnd())n=Jo(e.container(),e.offset()),Go(n)&&o(n,n.data.length),Xo(n)&&!Zo(n)&&i(aa(oa(n),!1));else{if(n=Jo(e.container(),e.offset()),Go(n)&&o(n,0),Xo(n)&&e.isAtEnd())return i(aa(oa(n),!1)),r;t=Jo(e.container(),e.offset()-1),Xo(t)&&!Zo(t)&&(Wo(t)||Wo(n)||!Xo(n))&&i(aa(oa(t),!1)),Xo(n)&&i(aa(oa(n),!0))}return r};function ua(e,t,n){var r=function(){return n||(n=sa(ua(e,t))),n};return{container:jo.constant(e),offset:jo.constant(t),toRange:function(){var n;return(n=ea(e.ownerDocument)).setStart(e,t),n.setEnd(e,t),n},getClientRects:r,isVisible:function(){return r().length>0},isAtStart:function(){return Go(e),0===t},isAtEnd:function(){return Go(e)?t>=e.data.length:t>=e.childNodes.length},isEqual:function(n){return n&&e===n.container()&&t===n.offset()},getNode:function(n){return Jo(e,n?t-1:t)}}}!function(e){e.fromRangeStart=function(t){return e(t.startContainer,t.startOffset)},e.fromRangeEnd=function(t){return e(t.endContainer,t.endOffset)},e.after=function(t){return e(t.parentNode,Qo(t)+1)},e.before=function(t){return e(t.parentNode,Qo(t))},e.isAtStart=function(e){return!!e&&e.isAtStart()},e.isAtEnd=function(e){return!!e&&e.isAtEnd()},e.isTextPosition=function(e){return!!e&&pi.isText(e.container())}}(ua||(ua={}));var la,ca=ua,da=pi.isElement,fa=pi.isText,ha=function(e){var t=e.parentNode;t&&t.removeChild(e)},ma=function(e,t){0===t.length?ha(e):e.nodeValue=t},pa=function(e){var t=so(e);return{count:e.length-t.length,text:t}},ga=function(e,t){return ya(e),t},va=function(e,t){return fa(e)&&t.container()===e?function(e,t){var n=pa(e.data.substr(0,t.offset())),r=pa(e.data.substr(t.offset())),i=n.text+r.text;return i.length>0?(ma(e,i),ca(e,t.offset()-n.count)):t}(e,t):ga(e,t)},ba=function(e,t){return t.container()===e.parentNode?function(e,t){var n=t.container(),r=O.indexOf(n.childNodes,e).map(function(e){return e<t.offset()?ca(n,t.offset()-1):t}).getOr(t);return ya(e),r}(e,t):ga(e,t)},ya=function(e){if(da(e)&&ho(e)&&(mo(e)?e.removeAttribute("data-mce-caret"):ha(e)),fa(e)){var t=so(function(e){try{return e.nodeValue}catch(e){return""}}(e));ma(e,t)}},Ca={removeAndReposition:function(e,t){return ca.isTextPosition(t)?va(e,t):ba(e,t)},remove:ya},wa=function(e){return ca.isTextPosition(e)?0===e.offset():Do(e.getNode())},Ea=function(e){if(ca.isTextPosition(e)){var t=e.container();return e.offset()===t.data.length}return Do(e.getNode(!0))},xa=function(e,t){return!ca.isTextPosition(e)&&!ca.isTextPosition(t)&&e.getNode()===t.getNode(!0)},Na=function(e,t,n){return e?!xa(t,n)&&(r=t,!(!ca.isTextPosition(r)&&pi.isBr(r.getNode())))&&Ea(t)&&wa(n):!xa(n,t)&&wa(t)&&Ea(n);var r},Sa=function(e,t,n){var r=Ys(t);return w.from(e?r.next(n):r.prev(n))},ka=function(e,t){var n,r=e?t.firstChild:t.lastChild;return pi.isText(r)?w.some(ca(r,e?0:r.data.length)):r?Do(r)?w.some(e?ca.before(r):(n=r,pi.isBr(n)?ca.before(n):ca.after(n))):function(e,t,n){var r=e?ca.before(n):ca.after(n);return Sa(e,t,r)}(e,t,r):w.none()},Ta={fromPosition:Sa,nextPosition:p.curry(Sa,!0),prevPosition:p.curry(Sa,!1),navigate:function(e,t,n){return Sa(e,t,n).bind(function(r){return xs(n,r,t)&&Na(e,n,r)?Sa(e,t,r):w.some(r)})},positionIn:ka,firstPositionIn:p.curry(ka,!0),lastPositionIn:p.curry(ka,!1)},Aa=pi.isContentEditableTrue,Da=pi.isContentEditableFalse,Ba=function(e,t,n,r,i){return t._selectionOverrides.showCaret(e,n,r,i)},Ra=function(e,t){return e.fire("BeforeObjectSelected",{target:t}).isDefaultPrevented()?null:function(e){var t=e.ownerDocument.createRange();return t.selectNode(e),t}(t)},_a=function(e,t,n){var r,i;return t=Bs(1,e.getBody(),t),r=ca.fromRangeStart(t),Da(r.getNode())?Ba(1,e,r.getNode(),!r.isAtEnd(),!1):Da(r.getNode(!0))?Ba(1,e,r.getNode(!0),!1,!1):(i=e.dom.getParent(r.getNode(),function(e){return Da(e)||Aa(e)}),Da(i)?Ba(1,e,i,!1,n):null)},La=function(e,t,n){return t&&t.collapsed&&_a(e,t,n)||t},Oa=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];if(!i.isSome())return w.none();n.push(i.getOrDie())}return w.some(t.apply(null,n))};!function(e){e[e.Br=0]="Br",e[e.Block=1]="Block",e[e.Wrap=2]="Wrap",e[e.Eol=3]="Eol"}(la||(la={}));var Pa,Ia=function(e,t){return e===Pa.Backwards?t.reverse():t},Fa=function(e,t,n){return e===Pa.Forwards?t.next(n):t.prev(n)},Ma=function(e,t,n,r){return pi.isBr(r.getNode(t===Pa.Forwards))?la.Br:!1===xs(n,r)?la.Block:la.Wrap},Ha=function(e,t,n,r){for(var i,o=Ys(n),a=r,s=[];a&&(i=Fa(t,o,a));){if(pi.isBr(i.getNode(!1)))return t===Pa.Forwards?{positions:Ia(t,s).concat([i]),breakType:la.Br,breakAt:w.some(i)}:{positions:Ia(t,s),breakType:la.Br,breakAt:w.some(i)};if(i.isVisible()){if(e(a,i)){var u=Ma(0,t,a,i);return{positions:Ia(t,s),breakType:u,breakAt:w.some(i)}}s.push(i),a=i}else a=i}return{positions:Ia(t,s),breakType:la.Eol,breakAt:w.none()}},qa=function(e,t,n,r){return t(n,r).breakAt.map(function(r){var i=t(n,r).positions;return e===Pa.Backwards?i.concat(r):[r].concat(i)}).getOr([])},za=function(e,t){return O.foldl(e,function(e,n){return e.fold(function(){return w.some(n)},function(r){return Oa([O.head(r.getClientRects()),O.head(n.getClientRects())],function(e,i){var o=Math.abs(t-e.left);return Math.abs(t-i.left)<=o?n:r}).or(e)})},w.none())},Ua=function(e,t){return O.head(t.getClientRects()).bind(function(t){return za(e,t.left)})},ja=p.curry(Ha,function(e,t){return Oa([O.head(t.getClientRects()),O.last(e.getClientRects())],Po).getOr(!1)},-1),Va=p.curry(Ha,function(e,t){return Oa([O.last(t.getClientRects()),O.head(e.getClientRects())],function(e,t){return Io(e,t)}).getOr(!1)},1),$a=p.curry(qa,-1,ja),Wa=p.curry(qa,1,Va),Ka=function(e,t){return br.all(t,e)},Xa=function(e,t,n,r,i){var o=Ka(Dn.fromDom(n),"td,th").map(function(e){return e.dom()});return function(e,t,n){return O.foldl(e,function(e,r){return e.fold(function(){return w.some(r)},function(e){var i=Math.sqrt(Math.abs(e.x-t)+Math.abs(e.y-n)),o=Math.sqrt(Math.abs(r.x-t)+Math.abs(r.y-n));return w.some(o<i?r:e)})},w.none())}(O.filter(function(e,t){return O.bind(t,function(t){var n=function(e,t){return{left:e.left-t,top:e.top-t,right:e.right+2*t,bottom:e.bottom+2*t,width:e.width+t,height:e.height+t}}(t.getBoundingClientRect(),-1);return[{x:n.left,y:e(n),cell:t},{x:n.right,y:e(n),cell:t}]})}(e,o),function(e){return t(e,i)}),r,i).map(function(e){return e.cell})},Ya=p.curry(Xa,function(e){return e.bottom},function(e,t){return e.y<t}),Ga=p.curry(Xa,function(e){return e.top},function(e,t){return e.y>t}),Za=function(e,t){return O.head(t.getClientRects()).bind(function(t){return Ya(e,t.left,t.top)}).bind(function(e){return Ua((n=e,Ta.lastPositionIn(n).map(function(e){return ja(n,e).positions.concat(e)}).getOr([])),t);var n})},Qa=function(e,t){return O.last(t.getClientRects()).bind(function(t){return Ga(e,t.left,t.top)}).bind(function(e){return Ua((n=e,Ta.firstPositionIn(n).map(function(e){return[e].concat(Va(n,e).positions)}).getOr([])),t);var n})},Ja=Tn.detect().browser,es=function(){return Ja.isIE()||Ja.isEdge()||Ja.isFirefox()},ts=function(e,t,n){var r=e(t,n);return r.breakType===la.Wrap&&0===r.positions.length?r.breakAt.map(function(n){return e(t,n).breakAt.isNone()}).getOr(!0):r.breakAt.isNone()},ns=jo.curry(ts,ja),rs=jo.curry(ts,Va),is=function(e,t,n,r){var i=e.selection.getRng(),o=t?1:-1;if(es()&&function(e,t,n){var r=ca.fromRangeStart(t);return Ta.positionIn(!e,n).map(function(e){return e.isEqual(r)}).getOr(!1)}(t,i,n)){var a=Ba(o,e,n,!t,!0);return e.selection.setRng(a),!0}return!1},os=function(e,t,n,r){var i=e.selection.getRng(),o=ca.fromRangeStart(i),a=e.getBody();if(!t&&ns(r,o)){var s=function(e,t,n){return Za(t,n).orThunk(function(){return O.head(n.getClientRects()).bind(function(n){return za($a(e,ca.before(t)),n.left)})}).getOr(ca.before(t))}(a,n,o);return e.selection.setRng(s.toRange()),!0}return!(!t||!rs(r,o))&&(s=function(e,t,n){return Qa(t,n).orThunk(function(){return O.head(n.getClientRects()).bind(function(n){return za(Wa(e,ca.after(t)),n.left)})}).getOr(ca.after(t))}(a,n,o),e.selection.setRng(s.toRange()),!0)},as=function(e,t){return function(){return w.from(e.dom.getParent(e.selection.getNode(),"td,th")).bind(function(n){return w.from(e.dom.getParent(n,"table")).map(function(n){return is(e,t,n)})}).getOr(!1)}},ss=function(e,t){return function(){return w.from(e.dom.getParent(e.selection.getNode(),"td,th")).bind(function(n){return w.from(e.dom.getParent(n,"table")).map(function(r){return os(e,t,r,n)})}).getOr(!1)}},us=pi.isContentEditableFalse,ls=function(e,t,n){var r,i,o=null,a=function(){!function(e){var t,n,r,i,o;for(t=Xt("*[contentEditable=false]",e),i=0;i<t.length;i++)r=(n=t[i]).previousSibling,yo(r)&&(1===(o=r.data).length?r.parentNode.removeChild(r):r.deleteData(o.length-1,1)),r=n.nextSibling,bo(r)&&(1===(o=r.data).length?r.parentNode.removeChild(r):r.deleteData(0,1))}(e),i&&(Ca.remove(i),i=null),o&&(o.remove(),o=null),clearInterval(r)},s=function(){r=me.setInterval(function(){n()?Xt("div.mce-visual-caret",e).toggleClass("mce-visual-caret-hidden"):Xt("div.mce-visual-caret",e).addClass("mce-visual-caret-hidden")},500)};return{show:function(n,r){var u,l,c;return a(),c=r,pi.isElement(c)&&/^(TD|TH)$/i.test(c.tagName)?null:t(r)?(i=vo("p",r,n),u=function(e,t,n){var r,i,o,a,s,u=Lo(t.getBoundingClientRect(),n);return"BODY"===e.tagName?(r=e.ownerDocument.documentElement,i=e.scrollLeft||r.scrollLeft,o=e.scrollTop||r.scrollTop):(s=e.getBoundingClientRect(),i=e.scrollLeft-s.left,o=e.scrollTop-s.top),u.left+=i,u.right+=i,u.top+=o,u.bottom+=o,u.width=1,(a=t.offsetWidth-t.clientWidth)>0&&(n&&(a*=-1),u.left+=a,u.right+=a),u}(e,r,n),Xt(i).css("top",u.top),o=Xt('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(u).appendTo(e),n&&o.addClass("mce-visual-caret-before"),s(),(l=r.ownerDocument.createRange()).setStart(i,0),l.setEnd(i,0),l):(i=function(e,t){var n,r,i;if(r=e.ownerDocument.createTextNode(ao),i=e.parentNode,t){if(n=e.previousSibling,lo(n)){if(ho(n))return n;if(yo(n))return n.splitText(n.data.length-1)}i.insertBefore(r,e)}else{if(n=e.nextSibling,lo(n)){if(ho(n))return n;if(bo(n))return n.splitText(1),n}e.nextSibling?i.insertBefore(r,e.nextSibling):i.appendChild(r)}return r}(r,n),l=r.ownerDocument.createRange(),us(i.nextSibling)?(l.setStart(i,0),l.setEnd(i,0)):(l.setStart(i,1),l.setEnd(i,1)),l)},hide:a,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},destroy:function(){return me.clearInterval(r)}}},cs=function(e){return us(e)||pi.isTable(e)&&es()},ds=pi.isContentEditableFalse,fs=pi.matchStyleValues("display","block table table-cell table-caption list-item"),hs=ho,ms=co,ps=jo.curry,gs=pi.isElement,vs=Do,bs=function(e){return e>0},ys=function(e){return e<0},Cs=function(e,t){for(var n;n=e(t);)if(!ms(n))return n;return null},ws=function(e,t,n,r,i){var o=new Vr(e,r);if(ys(t)){if((ds(e)||ms(e))&&n(e=Cs(o.prev,!0)))return e;for(;e=Cs(o.prev,i);)if(n(e))return e}if(bs(t)){if((ds(e)||ms(e))&&n(e=Cs(o.next,!0)))return e;for(;e=Cs(o.next,i);)if(n(e))return e}return null},Es=function(e,t){for(;e&&e!==t;){if(fs(e))return e;e=e.parentNode}return null},xs=function(e,t,n){return Es(e.container(),n)===Es(t.container(),n)},Ns=function(e,t){var n,r;return t?(n=t.container(),r=t.offset(),gs(n)?n.childNodes[r+e]:null):null},Ss=function(e,t){var n=t.ownerDocument.createRange();return e?(n.setStartBefore(t),n.setEndBefore(t)):(n.setStartAfter(t),n.setEndAfter(t)),n},ks=function(e,t,n){return Es(t,e)===Es(n,e)},Ts=function(e,t,n){var r,i;for(i=e?"previousSibling":"nextSibling";n&&n!==t;){if(r=n[i],hs(r)&&(r=r[i]),ds(r)){if(ks(t,r,n))return r;break}if(vs(r))break;n=n.parentNode}return null},As=ps(Ss,!0),Ds=ps(Ss,!1),Bs=function(e,t,n){var r,i,o,a,s=ps(Ts,!0,t),u=ps(Ts,!1,t);if(i=n.startContainer,o=n.startOffset,co(i)){if(gs(i)||(i=i.parentNode),"before"===(a=i.getAttribute("data-mce-caret"))&&(r=i.nextSibling,cs(r)))return As(r);if("after"===a&&(r=i.previousSibling,cs(r)))return Ds(r)}if(!n.collapsed)return n;if(pi.isText(i)){if(hs(i)){if(1===e){if(r=u(i))return As(r);if(r=s(i))return Ds(r)}if(-1===e){if(r=s(i))return Ds(r);if(r=u(i))return As(r)}return n}if(yo(i)&&o>=i.data.length-1)return 1===e&&(r=u(i))?As(r):n;if(bo(i)&&o<=1)return-1===e&&(r=s(i))?Ds(r):n;if(o===i.data.length)return(r=u(i))?As(r):n;if(0===o)return(r=s(i))?Ds(r):n}return n},Rs=function(e,t){var n=Ns(e,t);return ds(n)&&!pi.isBogusAll(n)},_s=function(e,t){return pi.isTable(Ns(e,t))},Ls=function(e,t){return w.from(Ns(e?0:-1,t)).filter(ds)},Os=function(e,t,n){var r=Bs(e,t,n);return-1===e?ua.fromRangeStart(r):ua.fromRangeEnd(r)},Ps=ps(Rs,0),Is=ps(Rs,-1),Fs=ps(_s,0),Ms=ps(_s,-1);!function(e){e[e.Backwards=-1]="Backwards",e[e.Forwards=1]="Forwards"}(Pa||(Pa={}));var Hs=pi.isContentEditableFalse,qs=pi.isText,zs=pi.isElement,Us=pi.isBr,js=Do,Vs=function(e){return ko(e)||function(e){return!!Eo(e)&&!0!==Nt.reduce(e.getElementsByTagName("*"),function(e,t){return e||wo(t)},!1)}(e)},$s=Bo,Ws=function(e,t){return e.hasChildNodes()&&t<e.childNodes.length?e.childNodes[t]:null},Ks=function(e,t){if(bs(e)){if(js(t.previousSibling)&&!qs(t.previousSibling))return ca.before(t);if(qs(t))return ca(t,0)}if(ys(e)){if(js(t.nextSibling)&&!qs(t.nextSibling))return ca.after(t);if(qs(t))return ca(t,t.data.length)}return ys(e)?Us(t)?ca.before(t):ca.after(t):ca.before(t)},Xs=function(e,t,n){var r,i,o,a,s;if(!zs(n)||!t)return null;if(t.isEqual(ca.after(n))&&n.lastChild){if(s=ca.after(n.lastChild),ys(e)&&js(n.lastChild)&&zs(n.lastChild))return Us(n.lastChild)?ca.before(n.lastChild):s}else s=t;var u=s.container(),l=s.offset();if(qs(u)){if(ys(e)&&l>0)return ca(u,--l);if(bs(e)&&l<u.length)return ca(u,++l);r=u}else{if(ys(e)&&l>0&&(i=Ws(u,l-1),js(i)))return!Vs(i)&&(o=ws(i,e,$s,i))?qs(o)?ca(o,o.data.length):ca.after(o):qs(i)?ca(i,i.data.length):ca.before(i);if(bs(e)&&l<u.childNodes.length&&(i=Ws(u,l),js(i)))return function(e,t){var n;return!!pi.isBr(e)&&!!(n=Xs(1,ca.after(e),t))&&!xs(ca.before(e),ca.before(n),t)}(i,n)?Xs(e,ca.after(i),n):!Vs(i)&&(o=ws(i,e,$s,i))?qs(o)?ca(o,0):ca.before(o):qs(i)?ca(i,0):ca.after(i);r=i||s.getNode()}return(bs(e)&&s.isAtEnd()||ys(e)&&s.isAtStart())&&(r=ws(r,e,jo.constant(!0),n,!0),$s(r,n))?Ks(e,r):(i=ws(r,e,$s,n),!(a=Nt.last(Nt.filter(function(e,t){for(var n=[];e&&e!==t;)n.push(e),e=e.parentNode;return n}(u,n),Hs)))||i&&a.contains(i)?i?Ks(e,i):null:s=bs(e)?ca.after(a):ca.before(a))},Ys=function(e){return{next:function(t){return Xs(Pa.Forwards,t,e)},prev:function(t){return Xs(Pa.Backwards,t,e)}}},Gs=function(e){return Dt.grep(e.childNodes,function(e){return"LI"===e.nodeName})},Zs=function(e){return e&&e.firstChild&&e.firstChild===e.lastChild&&function(e){return""===e.data||pi.isBr(e)}(e.firstChild)},Qs=function(e){return e.length>0&&(!(t=e[e.length-1]).firstChild||Zs(t))?e.slice(0,-1):e;var t},Js=function(e,t){var n=e.getParent(t,e.isBlock);return n&&"LI"===n.nodeName?n:null},eu=function(e,t){var n=ca.after(e),r=Ys(t).prev(n);return r?r.toRange():null},tu=function(e,t,n){var r=e.parentNode;return Dt.each(t,function(t){r.insertBefore(t,e)}),function(e,t){var n=ca.before(e),r=Ys(t).next(n);return r?r.toRange():null}(e,n)},nu=function(e,t){var n=t.firstChild,r=t.lastChild;return n&&"meta"===n.name&&(n=n.next),r&&"mce_marker"===r.attr("id")&&(r=r.prev),function(e,t){var n=e.getNonEmptyElements();return t&&(t.isEmpty(n)||function(e,t){return e.getBlockElements()[t.name]&&function(e){return e.firstChild&&e.firstChild===e.lastChild}(t)&&function(e){return"br"===e.name||""===e.value}(t.firstChild)}(e,t))}(e,r)&&(r=r.prev),!(!n||n!==r||"ul"!==n.name&&"ol"!==n.name)},ru=function(e,t,n,r){var i=function(e,t,n){var r=t.serialize(n);return function(e){var t=e.firstChild,n=e.lastChild;return t&&"META"===t.nodeName&&t.parentNode.removeChild(t),n&&"mce_marker"===n.id&&n.parentNode.removeChild(n),e}(e.createFragment(r))}(t,e,r),o=Js(t,n.startContainer),a=Qs(Gs(i.firstChild)),s=t.getRoot(),u=function(e){var r=ca.fromRangeStart(n),i=Ys(t.getRoot()),a=1===e?i.prev(r):i.next(r);return!a||Js(t,a.getNode())!==o};return u(1)?tu(o,a,s):u(2)?function(e,t,n,r){return r.insertAfter(t.reverse(),e),eu(t[0],n)}(o,a,s,t):function(e,t,n,r){var i=function(e,t){var n=t.cloneRange(),r=t.cloneRange();return n.setStartBefore(e),r.setEndAfter(e),[n.cloneContents(),r.cloneContents()]}(e,r),o=e.parentNode;return o.insertBefore(i[0],e),Dt.each(t,function(t){o.insertBefore(t,e)}),o.insertBefore(i[1],e),o.removeChild(e),eu(t[t.length-1],n)}(o,a,s,n)},iu=function(e,t){return!!Js(e,t)},ou=pi.isText,au=pi.isBogus,su=Zi.nodeIndex,uu=function(e){var t=e.parentNode;return au(t)?uu(t):t},lu=function(e){return e?Nt.reduce(e.childNodes,function(e,t){return au(t)&&"BR"!==t.nodeName?e=e.concat(lu(t)):e.push(t),e},[]):[]},cu=function(e){return function(t){return e===t}},du=function(e){return(ou(e)?"text()":e.nodeName.toLowerCase())+"["+function(e){var t,n,r;return t=lu(uu(e)),n=Nt.findIndex(t,cu(e),e),t=t.slice(0,n+1),r=Nt.reduce(t,function(e,n,r){return ou(n)&&ou(t[r-1])&&e++,e},0),t=Nt.filter(t,pi.matchNodeNames(e.nodeName)),(n=Nt.findIndex(t,cu(e),e))-r}(e)+"]"},fu=function(e,t){var n,r,i,o,a,s=[];return n=t.container(),r=t.offset(),ou(n)?i=function(e,t){for(;(e=e.previousSibling)&&ou(e);)t+=e.data.length;return t}(n,r):(r>=(o=n.childNodes).length?(i="after",r=o.length-1):i="before",n=o[r]),s.push(du(n)),a=function(e,t,n){var r=[];for(t=t.parentNode;!(t===e||n&&n(t));t=t.parentNode)r.push(t);return r}(e,n),a=Nt.filter(a,jo.negate(pi.isBogus)),(s=s.concat(Nt.map(a,function(e){return du(e)}))).reverse().join("/")+","+i},hu=function(e,t){var n,r,i;return t?(t=(n=t.split(","))[0].split("/"),i=n.length>1?n[1]:"before",(r=Nt.reduce(t,function(e,t){return(t=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(t))?("text()"===t[1]&&(t[1]="#text"),n=e,r=t[1],i=parseInt(t[2],10),o=lu(n),o=Nt.filter(o,function(e,t){return!ou(e)||!ou(o[t-1])}),(o=Nt.filter(o,pi.matchNodeNames(r)))[i]):null;var n,r,i,o},e))?ou(r)?function(e,t){for(var n,r=e,i=0;ou(r);){if(n=r.data.length,t>=i&&t<=i+n){e=r,t-=i;break}if(!ou(r.nextSibling)){e=r,t=n;break}i+=n,r=r.nextSibling}return ou(e)&&t>e.data.length&&(t=e.data.length),ca(e,t)}(r,parseInt(i,10)):(i="after"===i?su(r)+1:su(r),ca(r.parentNode,i)):null):null},mu=pi.isContentEditableFalse,pu=function(e,t,n,r,i){var o,a=r[i?"startContainer":"endContainer"],s=r[i?"startOffset":"endOffset"],u=[],l=0,c=e.getRoot();for(pi.isText(a)?u.push(n?function(e,t,n){var r,i;for(i=e(t.data.slice(0,n)).length,r=t.previousSibling;r&&pi.isText(r);r=r.previousSibling)i+=e(r.data).length;return i}(t,a,s):s):(s>=(o=a.childNodes).length&&o.length&&(l=1,s=Math.max(0,o.length-1)),u.push(e.nodeIndex(o[s],n)+l));a&&a!==c;a=a.parentNode)u.push(e.nodeIndex(a,n));return u},gu=function(e){pi.isText(e)&&0===e.data.length&&e.parentNode.removeChild(e)},vu=function(e,t,n){var r=0;return Dt.each(e.select(t),function(e){if("all"!==e.getAttribute("data-mce-bogus"))return e!==n&&void r++}),r},bu=function(e,t){var n,r,i,o=t?"start":"end";n=e[o+"Container"],r=e[o+"Offset"],pi.isElement(n)&&"TR"===n.nodeName&&(n=(i=n.childNodes)[Math.min(t?r:r-1,i.length-1)])&&(r=t?0:n.childNodes.length,e["set"+(t?"Start":"End")](n,r))},yu=function(e){return bu(e,!0),bu(e,!1),e},Cu=function(e,t){var n;if(pi.isElement(e)&&(e=Mo(e,t),mu(e)))return e;if(ho(e)){if(pi.isText(e)&&co(e)&&(e=e.parentNode),n=e.previousSibling,mu(n))return n;if(n=e.nextSibling,mu(n))return n}},wu=function(e,t,n){var r=n.getNode(),i=r?r.nodeName:null,o=n.getRng();return mu(r)||"IMG"===i?{name:i,index:vu(n.dom,i,r)}:(r=function(e){return Cu(e.startContainer,e.startOffset)||Cu(e.endContainer,e.endOffset)}(o))?{name:i=r.tagName,index:vu(n.dom,i,r)}:function(e,t,n,r){var i=t.dom,o={};return o.start=pu(i,e,n,r,!0),t.isCollapsed()||(o.end=pu(i,e,n,r,!1)),o}(e,n,t,o)},Eu={getBookmark:function(e,t,n){return 2===t?wu(so,n,e):3===t?function(e){var t=e.getRng();return{start:fu(e.dom.getRoot(),ca.fromRangeStart(t)),end:fu(e.dom.getRoot(),ca.fromRangeEnd(t))}}(e):t?function(e){return{rng:e.getRng()}}(e):function(e){var t=e.dom,n=e.getRng(),r=t.uniqueId(),i=e.isCollapsed(),o="overflow:hidden;line-height:0px",a=e.getNode(),s=a.nodeName;if("IMG"===s)return{name:s,index:vu(t,s,a)};var u=yu(n.cloneRange());if(!i){u.collapse(!1);var l=t.create("span",{"data-mce-type":"bookmark",id:r+"_end",style:o},"&#xFEFF;");u.insertNode(l),gu(l.nextSibling)}(n=yu(n)).collapse(!0);var c=t.create("span",{"data-mce-type":"bookmark",id:r+"_start",style:o},"&#xFEFF;");return n.insertNode(c),gu(c.previousSibling),e.moveToBookmark({id:r,keep:1}),{id:r}}(e)},getUndoBookmark:p.curry(wu,p.identity,!0)},xu=function(e,t){return!e.isBlock(t)||t.innerHTML||le.ie||(t.innerHTML='<br data-mce-bogus="1" />'),t},Nu=function(e,t,n,r){var i,o,a,s,u=n[t?"start":"end"],l=e.getRoot();if(u){for(a=u[0],o=l,i=u.length-1;i>=1;i--){if(s=o.childNodes,u[i]>s.length-1)return;o=s[u[i]]}3===o.nodeType&&(a=Math.min(u[0],o.nodeValue.length)),1===o.nodeType&&(a=Math.min(u[0],o.childNodes.length)),t?r.setStart(o,a):r.setEnd(o,a)}return!0},Su=function(e,t,n){var r,i,o,a,s,u,l=e.get(n.id+"_"+t),c=n.keep;if(l){if(r=l.parentNode,c?(r=l.firstChild,i=1):i=e.nodeIndex(l),s=r,u=i,!c){for(a=l.previousSibling,o=l.nextSibling,Dt.each(Dt.grep(l.childNodes),function(e){pi.isText(e)&&(e.nodeValue=e.nodeValue.replace(/\uFEFF/g,""))});l=e.get(n.id+"_"+t);)e.remove(l,1);a&&o&&a.nodeType===o.nodeType&&pi.isText(a)&&!le.opera&&(i=a.nodeValue.length,a.appendData(o.nodeValue),e.remove(o),s=a,u=i)}return w.some(ca(s,u))}return w.none()},ku=function(e,t){var n=e.dom;if(t){if(Dt.isArray(t.start))return function(e,t){var n=e.createRng();return Nu(e,!0,t,n)&&Nu(e,!1,t,n)?w.some(n):w.none()}(n,t);if("string"==typeof t.start)return w.some(function(e,t){var n,r;return n=e.createRng(),r=hu(e.getRoot(),t.start),n.setStart(r.container(),r.offset()),r=hu(e.getRoot(),t.end),n.setEnd(r.container(),r.offset()),n}(n,t));if(t.id)return function(e,t){var n,r,i=Su(e,"start",t),o=Su(e,"end",t);return Oa([i,(n=o,r=i,n.isSome()?n:r)],function(t,n){var r=e.createRng();return r.setStart(xu(e,t.container()),t.offset()),r.setEnd(xu(e,n.container()),n.offset()),r})}(n,t);if(t.name)return function(e,t){return w.from(e.select(t.name)[t.index]).map(function(t){var n=e.createRng();return n.selectNode(t),n})}(n,t);if(t.rng)return w.some(t.rng)}return w.none()},Tu={getBookmark:function(e,t,n){return Eu.getBookmark(e,t,n)},moveToBookmark:function(e,t){ku(e,t).each(function(t){e.setRng(t)})},isBookmarkNode:function(e){return pi.isElement(e)&&"SPAN"===e.tagName&&"bookmark"===e.getAttribute("data-mce-type")}},Au=Dt.each,Du=function(e){this.compare=function(t,n){if(t.nodeName!==n.nodeName)return!1;var r=function(t){var n={};return Au(e.getAttribs(t),function(r){var i=r.nodeName.toLowerCase();0!==i.indexOf("_")&&"style"!==i&&0!==i.indexOf("data-")&&(n[i]=e.getAttrib(t,i))}),n},i=function(e,t){var n,r;for(r in e)if(e.hasOwnProperty(r)){if(void 0===(n=t[r]))return!1;if(e[r]!==n)return!1;delete t[r]}for(r in t)if(t.hasOwnProperty(r))return!1;return!0};return!(!i(r(t),r(n))||!i(e.parseStyle(e.getAttrib(t,"style")),e.parseStyle(e.getAttrib(n,"style")))||Tu.isBookmarkNode(t)||Tu.isBookmarkNode(n))}},Bu=function(e,t){Dr.parent(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})},Ru=function(e,t){e.dom().appendChild(t.dom())},_u={before:Bu,after:function(e,t){Dr.nextSibling(e).fold(function(){Dr.parent(e).each(function(e){Ru(e,t)})},function(e){Bu(e,t)})},prepend:function(e,t){Dr.firstChild(e).fold(function(){Ru(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},append:Ru,appendAt:function(e,t,n){Dr.child(e,n).fold(function(){Ru(e,t)},function(e){Bu(e,t)})},wrap:function(e,t){Bu(e,t),Ru(t,e)}},Lu=function(e,t){O.each(t,function(t){_u.before(e,t)})},Ou=function(e,t){O.each(t,function(t){_u.append(e,t)})},Pu=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Iu={empty:function(e){e.dom().textContent="",O.each(Dr.children(e),function(e){Pu(e)})},remove:Pu,unwrap:function(e){var t=Dr.children(e);t.length>0&&Lu(e,t),Pu(e)}},Fu=function(e,t){var n=function(t){return e(t)?w.from(t.dom().nodeValue):w.none()},r=Tn.detect().browser,i=r.isIE()&&10===r.version.major?function(e){try{return n(e)}catch(e){return w.none()}}:n;return{get:function(n){if(!e(n))throw new Error("Can only get "+t+" value of a "+t+" node");return i(n).getOr("")},getOption:i,set:function(n,r){if(!e(n))throw new Error("Can only set raw "+t+" value of a "+t+" node");n.dom().nodeValue=r}}}(qn.isText,"text"),Mu=function(e){return Fu.get(e)},Hu=function(e){var t=Ka(e,"br"),n=O.filter(function(e){for(var t=[],n=e.dom();n;)t.push(Dn.fromDom(n)),n=n.lastChild;return t}(e).slice(-1),Qr);t.length===n.length&&O.each(n,Iu.remove)},qu=function(e){Iu.empty(e),_u.append(e,Dn.fromHtml('<br data-mce-bogus="1">'))},zu=function(e){Dr.lastChild(e).each(function(t){Dr.prevSibling(t).each(function(n){Gr(e)&&Qr(t)&&Gr(n)&&Iu.remove(t)})})},Uu=Dt.makeMap;function ju(e){var t,n,r,i,o,a=[];return t=(e=e||{}).indent,n=Uu(e.indent_before||""),r=Uu(e.indent_after||""),i=Di.getEncodeFunc(e.entity_encoding||"raw",e.entities),o="html"===e.element_format,{start:function(e,s,u){var l,c,d,f;if(t&&n[e]&&a.length>0&&(f=a[a.length-1]).length>0&&"\n"!==f&&a.push("\n"),a.push("<",e),s)for(l=0,c=s.length;l<c;l++)d=s[l],a.push(" ",d.name,'="',i(d.value,!0),'"');a[a.length]=!u||o?">":" />",u&&t&&r[e]&&a.length>0&&(f=a[a.length-1]).length>0&&"\n"!==f&&a.push("\n")},end:function(e){var n;a.push("</",e,">"),t&&r[e]&&a.length>0&&(n=a[a.length-1]).length>0&&"\n"!==n&&a.push("\n")},text:function(e,t){e.length>0&&(a[a.length]=t?e:i(e))},cdata:function(e){a.push("<![CDATA[",e,"]]>")},comment:function(e){a.push("\x3c!--",e,"--\x3e")},pi:function(e,n){n?a.push("<?",e," ",i(n),"?>"):a.push("<?",e,"?>"),t&&a.push("\n")},doctype:function(e){a.push("<!DOCTYPE",e,">",t?"\n":"")},reset:function(){a.length=0},getContent:function(){return a.join("").replace(/\n$/,"")}}}function Vu(e,t){void 0===t&&(t=qi());var n=ju(e);return(e=e||{}).validate=!("validate"in e)||e.validate,{serialize:function(r){var i,o;o=e.validate,i={3:function(e){n.text(e.value,e.raw)},8:function(e){n.comment(e.value)},7:function(e){n.pi(e.name,e.value)},10:function(e){n.doctype(e.value)},4:function(e){n.cdata(e.value)},11:function(e){if(e=e.firstChild)do{a(e)}while(e=e.next)}},n.reset();var a=function(e){var r,s,u,l,c,d,f,h,m,p=i[e.type];if(p)p(e);else{if(r=e.name,s=e.shortEnded,u=e.attributes,o&&u&&u.length>1&&((d=[]).map={},m=t.getElementRule(e.name))){for(f=0,h=m.attributesOrder.length;f<h;f++)(l=m.attributesOrder[f])in u.map&&(c=u.map[l],d.map[l]=c,d.push({name:l,value:c}));for(f=0,h=u.length;f<h;f++)(l=u[f].name)in d.map||(c=u.map[l],d.map[l]=c,d.push({name:l,value:c}));u=d}if(n.start(e.name,u,s),!s){if(e=e.firstChild)do{a(e)}while(e=e.next);n.end(r)}}};return 1!==r.type||e.inner?i[11](r):a(r),n.getContent()}}}var $u=function(e){var t=ca.fromRangeStart(e),n=ca.fromRangeEnd(e),r=e.commonAncestorContainer;return Ta.fromPosition(!1,r,n).map(function(i){return!xs(t,n,r)&&xs(t,i,r)?function(e,t,n,r){var i=document.createRange();return i.setStart(e,t),i.setEnd(n,r),i}(t.container(),t.offset(),i.container(),i.offset()):e}).getOr(e)},Wu=function(e){return function(e){return e.collapsed?e:$u(e)}(e)},Ku=pi.matchNodeNames("td th"),Xu=function(e,t,n){var r,i,o,a,s,u,l,c,d,f,h,m,p=e.schema.getTextInlineElements(),g=e.selection,v=e.dom;if(/^ | $/.test(t)&&(t=function(e){var t,n,r;t=g.getRng(),n=t.startContainer,r=t.startOffset;var i=function(e){return n[e]&&3===n[e].nodeType};return 3===n.nodeType&&(r>0?e=e.replace(/^&nbsp;/," "):i("previousSibling")||(e=e.replace(/^ /,"&nbsp;")),r<n.length?e=e.replace(/&nbsp;(<br>|)$/," "):i("nextSibling")||(e=e.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),e}(t)),r=e.parser,m=n.merge,i=Vu({validate:e.settings.validate},e.schema),h='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',u={content:t,format:"html",selection:!0,paste:n.paste},(u=e.fire("BeforeSetContent",u)).isDefaultPrevented())e.fire("SetContent",{content:u.content,format:"html",selection:!0,paste:n.paste});else{-1===(t=u.content).indexOf("{$caret}")&&(t+="{$caret}"),t=t.replace(/\{\$caret\}/,h);var b=(c=g.getRng()).startContainer||(c.parentElement?c.parentElement():null),y=e.getBody();b===y&&g.isCollapsed()&&v.isBlock(y.firstChild)&&function(t){return t&&!e.schema.getShortEndedElements()[t.nodeName]}(y.firstChild)&&v.isEmpty(y.firstChild)&&((c=v.createRng()).setStart(y.firstChild,0),c.setEnd(y.firstChild,0),g.setRng(c)),g.isCollapsed()||(e.selection.setRng(Wu(e.selection.getRng())),e.getDoc().execCommand("Delete",!1,null),function(){var e,n,r;n=(e=g.getRng()).startContainer,r=e.startOffset,3===n.nodeType&&e.collapsed&&(""===n.data[r]?(n.deleteData(r,1),/[\u00a0| ]$/.test(t)||(t+=" ")):""===n.data[r-1]&&(n.deleteData(r-1,1),/[\u00a0| ]$/.test(t)||(t=" "+t)))}());var C,E={context:(o=g.getNode()).nodeName.toLowerCase(),data:n.data,insert:!0};if(s=r.parse(t,E),!0===n.paste&&nu(e.schema,s)&&iu(v,o))return c=ru(i,v,e.selection.getRng(!0),s),e.selection.setRng(c),void e.fire("SetContent",u);if(function(e){for(var t=e;t=t.walk();)1===t.type&&t.attr("data-mce-fragment","1")}(s),"mce_marker"===(d=s.lastChild).attr("id"))for(l=d,d=d.prev;d;d=d.walk(!0))if(3===d.type||!v.isBlock(d.name)){e.schema.isValidChild(d.parent.name,"span")&&d.parent.insert(l,d,"br"===d.name);break}if(e._selectionOverrides.showBlockCaretContainer(o),E.invalid){for(g.setContent(h),o=g.getNode(),a=e.getBody(),9===o.nodeType?o=d=a:d=o;d!==a;)o=d,d=d.parentNode;t=o===a?a.innerHTML:v.getOuterHTML(o),t=i.serialize(r.parse(t.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return i.serialize(s)}))),o===a?v.setHTML(a,t):v.setOuterHTML(o,t)}else t=i.serialize(s),function(e,t,n){if("all"===n.getAttribute("data-mce-bogus"))n.parentNode.insertBefore(e.dom.createFragment(t),n);else{var r=n.firstChild,i=n.lastChild;!r||r===i&&"BR"===r.nodeName?e.dom.setHTML(n,t):e.selection.setContent(t)}}(e,t,o);!function(){if(m){var t=e.getBody(),n=new Du(v);Dt.each(v.select("*[data-mce-fragment]"),function(e){for(var r=e.parentNode;r&&r!==t;r=r.parentNode)p[e.nodeName.toLowerCase()]&&n.compare(r,e)&&v.remove(e,!0)})}}(),function(t){var n,r,i;if(t){if(g.scrollIntoView(t),n=function(t){for(var n=e.getBody();t&&t!==n;t=t.parentNode)if("false"===e.dom.getContentEditable(t))return t;return null}(t))return v.remove(t),void g.select(n);c=v.createRng(),(d=t.previousSibling)&&3===d.nodeType?(c.setStart(d,d.nodeValue.length),le.ie||(f=t.nextSibling)&&3===f.nodeType&&(d.appendData(f.data),f.parentNode.removeChild(f))):(c.setStartBefore(t),c.setEndBefore(t)),r=v.getParent(t,v.isBlock),v.remove(t),r&&v.isEmpty(r)&&(e.$(r).empty(),c.setStart(r,0),c.setEnd(r,0),Ku(r)||function(e){return!!e.getAttribute("data-mce-fragment")}(r)||!(i=function(t){var n=ca.fromRangeStart(t);if(n=Ys(e.getBody()).next(n))return n.toRange()}(c))?v.add(r,v.create("br",{"data-mce-bogus":"1"})):(c=i,v.remove(r))),g.setRng(c)}}(v.get("mce_marker")),C=e.getBody(),Dt.each(C.getElementsByTagName("*"),function(e){e.removeAttribute("data-mce-fragment")}),function(e,t){w.from(e.getParent(t,"td,th")).map(Dn.fromDom).each(zu)}(e.dom,e.selection.getStart()),e.fire("SetContent",u),e.addVisual()}},Yu={insertAtCaret:function(e,t){var n=function(e){var t;return"string"!=typeof e?(t=Dt.extend({paste:e.paste,data:{paste:e.paste}},e),{content:e.content,details:t}):{content:e,details:{}}}(t);Xu(e,n.content,n.details)}};function Gu(e,t,n,r,i){return e(n,r)?w.some(n):Un.isFunction(i)&&i(n)?w.none():t(n,r,i)}var Zu=function(e,t,n){for(var r=e.dom(),i=Un.isFunction(n)?n:p.constant(!1);r.parentNode;){r=r.parentNode;var o=Dn.fromDom(r);if(t(o))return w.some(o);if(i(o))break}return w.none()},Qu=function(e,t){return O.find(e.dom().childNodes,p.compose(t,Dn.fromDom)).map(Dn.fromDom)},Ju=function(e,t){var n=function(e){for(var r=0;r<e.childNodes.length;r++){if(t(Dn.fromDom(e.childNodes[r])))return w.some(Dn.fromDom(e.childNodes[r]));var i=n(e.childNodes[r]);if(i.isSome())return i}return w.none()};return n(e.dom())},el={first:function(e){return Ju(nr.body(),e)},ancestor:Zu,closest:function(e,t,n){return Gu(function(e){return t(e)},Zu,e,t,n)},sibling:function(e,t){var n=e.dom();return n.parentNode?Qu(Dn.fromDom(n.parentNode),function(n){return!wr.eq(e,n)&&t(n)}):w.none()},child:Qu,descendant:Ju},tl=cr.immutable("sections","settings"),nl=Tn.detect().deviceType.isTouch(),rl=["lists","autolink","autosave"],il={theme:"mobile"},ol=function(e){var t=Un.isArray(e)?e.join(" "):e,n=O.map(Un.isString(t)?t.split(" "):[],Cn);return O.filter(n,function(e){return e.length>0})},al=function(e,t){var n=Xn.bifilter(t,function(t,n){return O.contains(e,n)});return tl(n.t,n.f)},sl=function(e,t){return e.sections().hasOwnProperty(t)},ul=function(e,t,n,r){var i=ol(n.forced_plugins),o=ol(r.plugins),a=function(e,t){return[].concat(ol(e)).concat(ol(t))}(i,e&&sl(t,"mobile")?function(e){return O.filter(e,p.curry(O.contains,rl))}(o):o);return Dt.extend(r,{plugins:a.join(" ")})},ll=function(e,t,n,r){var i=al(["mobile"],r),o=Dt.extend(t,n,i.settings(),function(e,t){var n=t.settings().inline;return e&&sl(t,"mobile")&&!n}(e,i)?function(e,t,n){var r=e.sections(),i=r.hasOwnProperty(t)?r[t]:{};return Dt.extend({},n,i)}(i,"mobile",il):{},{validate:!0,content_editable:i.settings().inline,external_plugins:function(e,t){var n=t.external_plugins?t.external_plugins:{};return e&&e.external_plugins?Dt.extend({},e.external_plugins,n):n}(n,i.settings())});return ul(e,i,n,o)},cl=function(e,t,n){return w.from(t.settings[n]).filter(e)},dl=p.curry(cl,Un.isString),fl=function(e,t,n,r){var i=t in e.settings?e.settings[t]:n;return"hash"===r?function(e){var t={};return"string"==typeof e?O.each(e.indexOf("=")>0?e.split(/[;,](?![^=;,]*(?:[;,]|$))/):e.split(","),function(e){(e=e.split("=")).length>1?t[Dt.trim(e[0])]=Dt.trim(e[1]):t[Dt.trim(e[0])]=Dt.trim(e)}):t=e,t}(i):"string"===r?cl(Un.isString,e,t).getOr(n):"number"===r?cl(Un.isNumber,e,t).getOr(n):"boolean"===r?cl(Un.isBoolean,e,t).getOr(n):"object"===r?cl(Un.isObject,e,t).getOr(n):"array"===r?cl(Un.isArray,e,t).getOr(n):"function"===r?cl(Un.isFunction,e,t).getOr(n):i},hl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,ml=function(e,t){var n=t.container(),r=t.offset();return e?fo(n)?pi.isText(n.nextSibling)?ca(n.nextSibling,0):ca.after(n):po(t)?ca(n,r+1):t:fo(n)?pi.isText(n.previousSibling)?ca(n.previousSibling,n.previousSibling.data.length):ca.before(n):go(t)?ca(n,r-1):t},pl={isInlineTarget:function(e,t){var n=dl(e,"inline_boundaries_selector").getOr("a[href],code");return br.is(Dn.fromDom(t),n)},findRootInline:function(e,t,n){var r=function(e,t,n){return O.filter(Zi.DOM.getParents(n.container(),"*",t),e)}(e,t,n);return w.from(r[r.length-1])},isRtl:function(e){return"rtl"===Zi.DOM.getStyle(e,"direction",!0)||(t=e.textContent,hl.test(t));var t},isAtZwsp:function(e){return po(e)||go(e)},normalizePosition:ml,normalizeForwards:p.curry(ml,!0),normalizeBackwards:p.curry(ml,!1),hasSameParentBlock:function(e,t,n){var r=Es(t,e),i=Es(n,e);return r&&r===i}},gl=function(e,t){return wr.contains(e,t)?el.closest(t,function(e){return Jr(e)||ti(e)},function(e){return function(t){return wr.eq(e,Dn.fromDom(t.dom().parentNode))}}(e)):w.none()},vl=function(e){e.dom.isEmpty(e.getBody())&&(e.setContent(""),function(e){var t=e.getBody(),n=t.firstChild&&e.dom.isBlock(t.firstChild)?t.firstChild:t;e.selection.setCursorLocation(n,0)}(e))},bl=function(e,t,n){return Oa([Ta.firstPositionIn(n),Ta.lastPositionIn(n)],function(r,i){var o=pl.normalizePosition(!0,r),a=pl.normalizePosition(!1,i),s=pl.normalizePosition(!1,t);return e?Ta.nextPosition(n,s).map(function(e){return e.isEqual(a)&&t.isEqual(o)}).getOr(!1):Ta.prevPosition(n,s).map(function(e){return e.isEqual(o)&&t.isEqual(a)}).getOr(!1)}).getOr(!0)},yl=function(e,t,n){return el.ancestor(e,function(e){return br.is(e,t)},n)},Cl=yl,wl=function(e,t){return br.one(t,e)},El=function(e,t,n){return Gu(br.is,yl,e,t,n)},xl=function(e,t,n){return Cl(e,t,n).isSome()},Nl=function(e,t){return pi.isText(t)&&/^[ \t\r\n]*$/.test(t.data)&&!1===function(e,t){var n=Dn.fromDom(e),r=Dn.fromDom(t);return xl(r,"pre,code",p.curry(wr.eq,n))}(e,t)},Sl=function(e,t){return Do(t)&&!1===Nl(e,t)||function(e){return pi.isElement(e)&&"A"===e.nodeName&&e.hasAttribute("name")}(t)||kl(t)},kl=pi.hasAttribute("data-mce-bookmark"),Tl=pi.hasAttribute("data-mce-bogus"),Al=pi.hasAttributeValue("data-mce-bogus","all"),Dl=function(e){return function(e){var t,n,r=0;if(Sl(e,e))return!1;if(!(n=e.firstChild))return!0;t=new Vr(n,e);do{if(Al(n))n=t.next(!0);else if(Tl(n))n=t.next();else if(pi.isBr(n))r++,n=t.next();else{if(Sl(e,n))return!1;n=t.next()}}while(n);return r<=1}(e.dom())},Bl=cr.immutable("block","position"),Rl=cr.immutable("from","to"),_l=function(e,t){var n=Dn.fromDom(e),r=Dn.fromDom(t.container());return gl(n,r).map(function(e){return Bl(e,t)})},Ll=function(e,t,n){var r=_l(e,ca.fromRangeStart(n)),i=r.bind(function(n){return Ta.fromPosition(t,e,n.position()).bind(function(n){return _l(e,n).map(function(n){return function(e,t,n){return pi.isBr(n.position().getNode())&&!1===Dl(n.block())?Ta.positionIn(!1,n.block().dom()).bind(function(r){return r.isEqual(n.position())?Ta.fromPosition(t,e,r).bind(function(t){return _l(e,t)}):w.some(n)}).getOr(n):n}(e,t,n)})})});return Oa([r,i],Rl).filter(function(e){return function(e){return!1===wr.eq(e.from().block(),e.to().block())}(e)&&function(e){return Dr.parent(e.from().block()).bind(function(t){return Dr.parent(e.to().block()).filter(function(e){return wr.eq(t,e)})}).isSome()}(e)&&function(e){return!1===pi.isContentEditableFalse(e.from().block())&&!1===pi.isContentEditableFalse(e.to().block())}(e)})},Ol=function(e,t,n){return n.collapsed?Ll(e,t,n):w.none()},Pl=function(e,t,n){return wr.contains(t,e)?Dr.parents(e,function(e){return n(e)||wr.eq(e,t)}).slice(0,-1):[]},Il=function(e,t){return Pl(e,t,p.constant(!1))},Fl=Il,Ml=function(e,t){return[e].concat(Il(e,t))},Hl=function(e){var t=function(e){var t=Dr.children(e);return O.findIndex(t,Gr).fold(function(){return t},function(e){return t.slice(0,e)})}(e);return O.each(t,function(e){Iu.remove(e)}),t},ql=function(e,t){Ta.positionIn(e,t.dom()).each(function(e){var t=e.getNode();pi.isBr(t)&&Iu.remove(Dn.fromDom(t))})},zl=function(e,t){var n=Ml(t,e);return O.find(n.reverse(),Dl).each(Iu.remove)},Ul=function(e,t){return wr.contains(t,e)?Dr.parent(e).bind(function(n){return wr.eq(n,t)?w.some(e):function(e,t){var n=Dr.parents(t,function(t){return wr.eq(t,e)});return w.from(n[n.length-2])}(t,e)}):w.none()},jl=function(e,t,n){if(Dl(n))return Iu.remove(n),Dl(t)&&qu(t),Ta.firstPositionIn(t.dom());ql(!0,t),ql(!1,n);var r=Hl(t);return Ul(t,n).fold(function(){zl(e,t);var i=Ta.lastPositionIn(n.dom());return O.each(r,function(e){_u.append(n,e)}),i},function(i){var o=Ta.prevPosition(n.dom(),ca.before(i.dom()));return O.each(r,function(e){_u.before(i,e)}),zl(e,t),o})},Vl=function(e,t,n,r){return t?jl(e,r,n):jl(e,n,r)},$l=function(e,t){var n,r=Dn.fromDom(e.getBody());return(n=Ol(r.dom(),t,e.selection.getRng()).bind(function(e){return Vl(r,t,e.from().block(),e.to().block())})).each(function(t){e.selection.setRng(t.toRange())}),n.isSome()},Wl=function(e,t){var n=Dn.fromDom(t),r=p.curry(wr.eq,e);return el.ancestor(n,ii,r).isSome()},Kl=function(e,t){var n=Ta.prevPosition(e.dom(),ca.fromRangeStart(t)).isNone(),r=Ta.nextPosition(e.dom(),ca.fromRangeEnd(t)).isNone();return!function(e,t){return Wl(e,t.startContainer)||Wl(e,t.endContainer)}(e,t)&&n&&r},Xl=function(e){var t=Dn.fromDom(e.getBody()),n=e.selection.getRng();return Kl(t,n)?function(e){return e.setContent(""),e.selection.setCursorLocation(),!0}(e):function(e,t){var n=t.getRng();return Oa([gl(e,Dn.fromDom(n.startContainer)),gl(e,Dn.fromDom(n.endContainer))],function(r,i){return!1===wr.eq(r,i)&&(n.deleteContents(),Vl(e,!0,r,i).each(function(e){t.setRng(e.toRange())}),!0)}).getOr(!1)}(t,e.selection)},Yl=function(e,t){return!e.selection.isCollapsed()&&Xl(e)},Gl=function(e){if(!Un.isArray(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");var t=[],n={};return O.each(e,function(r,i){var o=Xn.keys(r);if(1!==o.length)throw new Error("one and only one name per case");var a=o[0],s=r[a];if(void 0!==n[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!Un.isArray(s))throw new Error("case arguments must be an array");t.push(a),n[a]=function(){var n=arguments.length;if(n!==s.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+s.length+" ("+s+"), got "+n);for(var r=new Array(n),o=0;o<r.length;o++)r[o]=arguments[o];return{fold:function(){if(arguments.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+arguments.length);return arguments[i].apply(null,r)},match:function(e){var n=Xn.keys(e);if(t.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+n.join(","));if(!O.forall(t,function(e){return O.contains(n,e)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+t.join(", "));return e[a].apply(null,r)},log:function(e){console.log(e,{constructors:t,constructor:a,params:r})}}}}),n},Zl=Gl([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),Ql=function(e,t,n,r){var i=r.getNode(!1===t);return gl(Dn.fromDom(e),Dn.fromDom(n.getNode())).map(function(e){return Dl(e)?Zl.remove(e.dom()):Zl.moveToElement(i)}).orThunk(function(){return w.some(Zl.moveToElement(i))})},Jl=function(e,t,n){return Ta.fromPosition(t,e,n).bind(function(r){return i=r.getNode(),ii(Dn.fromDom(i))||ti(Dn.fromDom(i))?w.none():function(e,t,n,r){var i=function(t){return Zr(Dn.fromDom(t))&&!xs(n,r,e)};return Ls(!t,n).fold(function(){return Ls(t,r).fold(p.constant(!1),i)},i)}(e,t,n,r)?w.none():t&&pi.isContentEditableFalse(r.getNode())?Ql(e,t,n,r):!1===t&&pi.isContentEditableFalse(r.getNode(!0))?Ql(e,t,n,r):t&&Is(n)?w.some(Zl.moveToPosition(r)):!1===t&&Ps(n)?w.some(Zl.moveToPosition(r)):w.none();var i})},ec=function(e,t,n){return function(e,t){var n=t.getNode(!1===e),r=e?"after":"before";return pi.isElement(n)&&n.getAttribute("data-mce-caret")===r}(t,n)?function(e,t){return e&&pi.isContentEditableFalse(t.nextSibling)?w.some(Zl.moveToElement(t.nextSibling)):!1===e&&pi.isContentEditableFalse(t.previousSibling)?w.some(Zl.moveToElement(t.previousSibling)):w.none()}(t,n.getNode(!1===t)).fold(function(){return Jl(e,t,n)},w.some):Jl(e,t,n).bind(function(t){return function(e,t,n){return n.fold(function(e){return w.some(Zl.remove(e))},function(e){return w.some(Zl.moveToElement(e))},function(n){return xs(t,n,e)?w.none():w.some(Zl.moveToPosition(n))})}(e,n,t)})},tc=function(e,t){return function(e,t){var n=e.container(),r=e.offset();return!1===ca.isTextPosition(e)&&n===t.parentNode&&r>ca.before(t).offset()}(t,e)?ca(t.container(),t.offset()-1):t},nc=function(e){return Do(e.previousSibling)?w.some((t=e.previousSibling,pi.isText(t)?ca(t,t.data.length):ca.after(t))):e.previousSibling?Ta.lastPositionIn(e.previousSibling):w.none();var t},rc=function(e){return Do(e.nextSibling)?w.some((t=e.nextSibling,pi.isText(t)?ca(t,0):ca.before(t))):e.nextSibling?Ta.firstPositionIn(e.nextSibling):w.none();var t},ic=function(e,t){return nc(t).orThunk(function(){return rc(t)}).orThunk(function(){return function(e,t){var n=ca.before(t.previousSibling?t.previousSibling:t.parentNode);return Ta.prevPosition(e,n).fold(function(){return Ta.nextPosition(e,ca.after(t))},w.some)}(e,t)})},oc=function(e,t){return rc(t).orThunk(function(){return nc(t)}).orThunk(function(){return function(e,t){return Ta.nextPosition(e,ca.after(t)).fold(function(){return Ta.prevPosition(e,ca.before(t))},w.some)}(e,t)})},ac=function(e,t,n){return function(e,t,n){return e?oc(t,n):ic(t,n)}(e,t,n).map(p.curry(tc,n))},sc=function(e,t,n){n.fold(function(){e.focus()},function(n){e.selection.setRng(n.toRange(),t)})},uc=function(e,t){return t&&e.schema.getBlockElements().hasOwnProperty(qn.name(t))},lc=function(e){if(Dl(e)){var t=Dn.fromHtml('<br data-mce-bogus="1">');return Iu.empty(e),_u.append(e,t),w.some(ca.before(t.dom()))}return w.none()},cc=function(e,t,n){var r,i=ac(t,e.getBody(),n.dom()),o=el.ancestor(n,p.curry(uc,e),(r=e.getBody(),function(e){return e.dom()===r})),a=function(e,t){return Oa([Dr.prevSibling(e),Dr.nextSibling(e),t],function(t,n,r){var i,o=t.dom(),a=n.dom();return pi.isText(o)&&pi.isText(a)?(i=o.data.length,o.appendData(a.data),Iu.remove(n),Iu.remove(e),r.container()===a?ca(o,i):r):(Iu.remove(e),r)}).orThunk(function(){return Iu.remove(e),t})}(n,i);e.dom.isEmpty(e.getBody())?(e.setContent(""),e.selection.setCursorLocation()):o.bind(lc).fold(function(){sc(e,t,a)},function(n){sc(e,t,w.some(n))})},dc=function(e,t){return function(e,t,n){var r=Bs(t?1:-1,e,n),i=ca.fromRangeStart(r);return!1===t&&Is(i)?w.some(Zl.remove(i.getNode(!0))):t&&Ps(i)?w.some(Zl.remove(i.getNode())):ec(e,t,i)}(e.getBody(),t,e.selection.getRng()).map(function(n){return n.fold(function(e,t){return function(n){return e._selectionOverrides.hideFakeCaret(),cc(e,t,Dn.fromDom(n)),!0}}(e,t),function(e,t){return function(n){var r=t?ca.before(n):ca.after(n);return e.selection.setRng(r.toRange()),!0}}(e,t),function(e){return function(t){return e.selection.setRng(t.toRange()),!0}}(e))}).getOr(!1)},fc=function(e,t){var n,r=e.selection.getNode();return!!pi.isContentEditableFalse(r)&&(n=Dn.fromDom(e.getBody()),O.each(Ka(n,".mce-offscreen-selection"),Iu.remove),cc(e,t,Dn.fromDom(e.selection.getNode())),vl(e),!0)},hc=function(e,t){return e.selection.isCollapsed()?dc(e,t):fc(e,t)},mc=function(e){var t,n=function(e,t){for(;t&&t!==e;){if(pi.isContentEditableTrue(t)||pi.isContentEditableFalse(t))return t;t=t.parentNode}return null}(e.getBody(),e.selection.getNode());return pi.isContentEditableTrue(n)&&e.dom.isBlock(n)&&e.dom.isEmpty(n)&&(t=e.dom.create("br",{"data-mce-bogus":"1"}),e.dom.setHTML(n,""),n.appendChild(t),e.selection.setRng(ca.before(t).toRange())),!0},pc=pi.isText,gc=function(e){return pc(e)&&e.data[0]===ao},vc=function(e){return pc(e)&&e.data[e.data.length-1]===ao},bc=function(e){return e.ownerDocument.createTextNode(ao)},yc=function(e,t){return e?function(e){if(pc(e.previousSibling))return vc(e.previousSibling)?e.previousSibling:(e.previousSibling.appendData(ao),e.previousSibling);if(pc(e))return gc(e)?e:(e.insertData(0,ao),e);var t=bc(e);return e.parentNode.insertBefore(t,e),t}(t):function(e){if(pc(e.nextSibling))return gc(e.nextSibling)?e.nextSibling:(e.nextSibling.insertData(0,ao),e.nextSibling);if(pc(e))return vc(e)?e:(e.appendData(ao),e);var t=bc(e);return e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t),t}(t)},Cc=p.curry(yc,!0),wc=p.curry(yc,!1),Ec=function(e,t){return pi.isText(e.container())?yc(t,e.container()):yc(t,e.getNode())},xc=function(e,t){var n=t.get();return n&&e.container()===n&&fo(n)},Nc=function(e,t){return t.fold(function(t){Ca.remove(e.get());var n=Cc(t);return e.set(n),w.some(ca(n,n.length-1))},function(t){return Ta.firstPositionIn(t).map(function(t){if(xc(t,e))return ca(e.get(),1);Ca.remove(e.get());var n=Ec(t,!0);return e.set(n),ca(n,1)})},function(t){return Ta.lastPositionIn(t).map(function(t){if(xc(t,e))return ca(e.get(),e.get().length-1);Ca.remove(e.get());var n=Ec(t,!1);return e.set(n),ca(n,n.length-1)})},function(t){Ca.remove(e.get());var n=wc(t);return e.set(n),w.some(ca(n,1))})},Sc=function(e){return e&&/^(IMG)$/.test(e.nodeName)},kc=function(e){return e&&3===e.nodeType&&/^([\t \r\n]+|)$/.test(e.nodeValue)},Tc=function(e,t,n){return"color"!==n&&"backgroundColor"!==n||(t=e.toHex(t)),"fontWeight"===n&&700===t&&(t="bold"),"fontFamily"===n&&(t=t.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+t},Ac={isInlineBlock:Sc,moveStart:function(e,t,n){var r,i,o,a=n.startContainer,s=n.startOffset;if((n.startContainer!==n.endContainer||!Sc(n.startContainer.childNodes[n.startOffset]))&&(3===a.nodeType&&s>=a.nodeValue.length&&(s=e.nodeIndex(a),a=a.parentNode),1===a.nodeType))for(s<(o=a.childNodes).length?r=new Vr(a=o[s],e.getParent(a,e.isBlock)):(r=new Vr(a=o[o.length-1],e.getParent(a,e.isBlock))).next(!0),i=r.current();i;i=r.next())if(3===i.nodeType&&!kc(i))return n.setStart(i,0),void t.setRng(n)},getNonWhiteSpaceSibling:function(e,t,n){if(e)for(t=t?"nextSibling":"previousSibling",e=n?e:e[t];e;e=e[t])if(1===e.nodeType||!kc(e))return e},isTextBlock:function(e,t){return t.nodeType&&(t=t.nodeName),!!e.schema.getTextBlockElements()[t.toLowerCase()]},isValid:function(e,t,n){return e.schema.isValidChild(t,n)},isWhiteSpaceNode:kc,replaceVars:function(e,t){return"string"!=typeof e?e=e(t):t&&(e=e.replace(/%(\w+)/g,function(e,n){return t[n]||e})),e},isEq:function(e,t){return e=e||"",t=t||"",e=""+(e.nodeName||e),t=""+(t.nodeName||t),e.toLowerCase()===t.toLowerCase()},normalizeStyleValue:Tc,getStyle:function(e,t,n){return Tc(e,e.getStyle(t,n),n)},getTextDecoration:function(e,t){var n;return e.getParent(t,function(t){return(n=e.getStyle(t,"text-decoration"))&&"none"!==n}),n},getParents:function(e,t,n){return e.getParents(t,n,e.getRoot())}},Dc=Tu.isBookmarkNode,Bc=Ac.getParents,Rc=Ac.isWhiteSpaceNode,_c=Ac.isTextBlock,Lc=function(e,t){for(void 0===t&&(t=3===e.nodeType?e.length:e.childNodes.length);e&&e.hasChildNodes();)(e=e.childNodes[t])&&(t=3===e.nodeType?e.length:e.childNodes.length);return{node:e,offset:t}},Oc=function(e,t){for(var n=t;n;){if(1===n.nodeType&&e.getContentEditable(n))return"false"===e.getContentEditable(n)?n:t;n=n.parentNode}return t},Pc=function(e,t,n,r){var i,o,a=n.nodeValue;return void 0===r&&(r=e?a.length:0),e?-1===(i=(i=a.lastIndexOf(" ",r))>(o=a.lastIndexOf("",r))?i:o)||t||i++:(i=a.indexOf(" ",r),o=a.indexOf("",r),i=-1!==i&&(-1===o||i<o)?i:o),i},Ic=function(e,t,n,r,i,o){var a,s,u,l;if(3===n.nodeType){if(-1!==(u=Pc(i,o,n,r)))return{container:n,offset:u};l=n}for(a=new Vr(n,e.getParent(n,e.isBlock)||t);s=a[i?"prev":"next"]();)if(3===s.nodeType){if(l=s,-1!==(u=Pc(i,o,s)))return{container:s,offset:u}}else if(e.isBlock(s))break;if(l)return{container:l,offset:r=i?0:l.length}},Fc=function(e,t,n,r,i){var o,a,s,u;for(3===r.nodeType&&0===r.nodeValue.length&&r[i]&&(r=r[i]),o=Bc(e,r),a=0;a<o.length;a++)for(s=0;s<t.length;s++)if(!("collapsed"in(u=t[s])&&u.collapsed!==n.collapsed)&&e.is(o[a],u.selector))return o[a];return r},Mc=function(e,t,n,r){var i,o=e.dom,a=o.getRoot();if(t[0].wrapper||(i=o.getParent(n,t[0].block,a)),!i){var s=o.getParent(n,"LI,TD,TH");i=o.getParent(3===n.nodeType?n.parentNode:n,function(t){return t!==a&&_c(e,t)},s)}if(i&&t[0].wrapper&&(i=Bc(o,i,"ul,ol").reverse()[0]||i),!i)for(i=n;i[r]&&!o.isBlock(i[r])&&(i=i[r],!Ac.isEq(i,"br")););return i||n},Hc=function(e,t,n,r,i,o,a){var s,u,l,c,d,f;if(s=u=a?n:i,c=a?"previousSibling":"nextSibling",d=e.getRoot(),3===s.nodeType&&!Rc(s)&&(a?r>0:o<s.nodeValue.length))return s;for(;;){if(!t[0].block_expand&&e.isBlock(u))return u;for(l=u[c];l;l=l[c])if(!Dc(l)&&!Rc(l)&&("BR"!==(f=l).nodeName||!f.getAttribute("data-mce-bogus")||f.nextSibling))return u;if(u===d||u.parentNode===d){s=u;break}u=u.parentNode}return s},qc=function(e,t,n,r){var i,o=t.startContainer,a=t.startOffset,s=t.endContainer,u=t.endOffset,l=e.dom;return 1===o.nodeType&&o.hasChildNodes()&&3===(o=Mo(o,a)).nodeType&&(a=0),1===s.nodeType&&s.hasChildNodes()&&3===(s=Mo(s,t.collapsed?u:u-1)).nodeType&&(u=s.nodeValue.length),o=Oc(l,o),s=Oc(l,s),(Dc(o.parentNode)||Dc(o))&&3===(o=(o=Dc(o)?o:o.parentNode).nextSibling||o).nodeType&&(a=0),(Dc(s.parentNode)||Dc(s))&&3===(s=(s=Dc(s)?s:s.parentNode).previousSibling||s).nodeType&&(u=s.length),n[0].inline&&(t.collapsed&&((i=Ic(l,e.getBody(),o,a,!0,r))&&(o=i.container,a=i.offset),(i=Ic(l,e.getBody(),s,u,!1,r))&&(s=i.container,u=i.offset)),s=r?s:function(e,t){var n=Lc(e,t);if(n.node){for(;n.node&&0===n.offset&&n.node.previousSibling;)n=Lc(n.node.previousSibling);n.node&&n.offset>0&&3===n.node.nodeType&&" "===n.node.nodeValue.charAt(n.offset-1)&&n.offset>1&&(e=n.node).splitText(n.offset-1)}return e}(s,u)),(n[0].inline||n[0].block_expand)&&(n[0].inline&&3===o.nodeType&&0!==a||(o=Hc(l,n,o,a,s,u,!0)),n[0].inline&&3===s.nodeType&&u!==s.nodeValue.length||(s=Hc(l,n,o,a,s,u,!1))),n[0].selector&&!1!==n[0].expand&&!n[0].inline&&(o=Fc(l,n,t,o,"previousSibling"),s=Fc(l,n,t,s,"nextSibling")),(n[0].block||n[0].selector)&&(o=Mc(e,n,o,"previousSibling"),s=Mc(e,n,s,"nextSibling"),n[0].block&&(l.isBlock(o)||(o=Hc(l,n,o,a,s,u,!0)),l.isBlock(s)||(s=Hc(l,n,o,a,s,u,!1)))),1===o.nodeType&&(a=l.nodeIndex(o),o=o.parentNode),1===s.nodeType&&(u=l.nodeIndex(s)+1,s=s.parentNode),{startContainer:o,startOffset:a,endContainer:s,endOffset:u}},zc=Ac.isEq,Uc=function(e,t,n){var r=e.formatter.get(n);if(r)for(var i=0;i<r.length;i++)if(!1===r[i].inherit&&e.dom.is(t,r[i].selector))return!0;return!1},jc=function(e,t,n,r){var i=e.dom.getRoot();return t!==i&&(t=e.dom.getParent(t,function(t){return!!Uc(e,t,n)||t.parentNode===i||!!Wc(e,t,n,r,!0)}),Wc(e,t,n,r))},Vc=function(e,t,n){return!!zc(t,n.inline)||!!zc(t,n.block)||(n.selector?1===t.nodeType&&e.is(t,n.selector):void 0)},$c=function(e,t,n,r,i,o){var a,s,u,l=n[r];if(n.onmatch)return n.onmatch(t,n,r);if(l)if(void 0===l.length){for(a in l)if(l.hasOwnProperty(a)){if(s="attributes"===r?e.getAttrib(t,a):Ac.getStyle(e,t,a),i&&!s&&!n.exact)return;if((!i||n.exact)&&!zc(s,Ac.normalizeStyleValue(e,Ac.replaceVars(l[a],o),a)))return}}else for(u=0;u<l.length;u++)if("attributes"===r?e.getAttrib(t,l[u]):Ac.getStyle(e,t,l[u]))return n;return n},Wc=function(e,t,n,r,i){var o,a,s,u,l=e.formatter.get(n),c=e.dom;if(l&&t)for(a=0;a<l.length;a++)if(o=l[a],Vc(e.dom,t,o)&&$c(c,t,o,"attributes",i,r)&&$c(c,t,o,"styles",i,r)){if(u=o.classes)for(s=0;s<u.length;s++)if(!e.dom.hasClass(t,u[s]))return;return o}},Kc={matchNode:Wc,matchName:Vc,match:function(e,t,n,r){var i;return r?jc(e,r,t,n):(r=e.selection.getNode(),!!jc(e,r,t,n)||!((i=e.selection.getStart())===r||!jc(e,i,t,n)))},matchAll:function(e,t,n){var r,i=[],o={};return r=e.selection.getStart(),e.dom.getParent(r,function(r){var a,s;for(a=0;a<t.length;a++)s=t[a],!o[s]&&Wc(e,r,s,n)&&(o[s]=!0,i.push(s))},e.dom.getRoot()),i},canApply:function(e,t){var n,r,i,o,a,s=e.formatter.get(t),u=e.dom;if(s)for(n=e.selection.getStart(),r=Ac.getParents(u,n),o=s.length-1;o>=0;o--){if(!(a=s[o].selector)||s[o].defaultBlock)return!0;for(i=r.length-1;i>=0;i--)if(u.is(r[i],a))return!0}return!1},matchesUnInheritedFormatSelector:Uc},Xc=function(e,t){return e.splitText(t)},Yc={split:function(e){var t=e.startContainer,n=e.startOffset,r=e.endContainer,i=e.endOffset;return t===r&&pi.isText(t)?n>0&&n<t.nodeValue.length&&(t=(r=Xc(t,n)).previousSibling,i>n?(t=r=Xc(r,i-=n).previousSibling,i=r.nodeValue.length,n=0):i=0):(pi.isText(t)&&n>0&&n<t.nodeValue.length&&(t=Xc(t,n),n=0),pi.isText(r)&&i>0&&i<r.nodeValue.length&&(i=(r=Xc(r,i).previousSibling).nodeValue.length)),{startContainer:t,startOffset:n,endContainer:r,endOffset:i}}},Gc=ao,Zc=function(e){return 1===e.nodeType&&"_mce_caret"===e.id},Qc=function(e){return function(e){for(var t=[];e;){if(3===e.nodeType&&e.nodeValue!==Gc||e.childNodes.length>1)return[];1===e.nodeType&&t.push(e),e=e.firstChild}return t}(e).length>0},Jc=function(e){var t;if(e)for(e=(t=new Vr(e,e)).current();e;e=t.next())if(3===e.nodeType)return e;return null},ed=function(e){var t=Dn.fromTag("span");return Jn.setAll(t,{id:"_mce_caret","data-mce-bogus":"1","data-mce-type":"format-caret"}),e&&_u.append(t,Dn.fromText(Gc)),t},td=function(e,t){for(;t&&t!==e;){if("_mce_caret"===t.id)return t;t=t.parentNode}return null},nd=function(e,t,n,r){var i,o,a;i=t.getRng(!0),o=e.getParent(n,e.isBlock),Qc(n)?(!1!==r&&(i.setStartBefore(n),i.setEndBefore(n)),e.remove(n)):(a=function(e){var t=Jc(e);return t&&t.nodeValue.charAt(0)===Gc&&t.deleteData(0,1),t}(n),i.startContainer===a&&i.startOffset>0&&i.setStart(a,i.startOffset-1),i.endContainer===a&&i.endOffset>0&&i.setEnd(a,i.endOffset-1),e.remove(n,!0)),o&&e.isEmpty(o)&&qu(Dn.fromDom(o)),t.setRng(i)},rd=function(e,t,n,r,i){if(r)nd(t,n,r,i);else if(!(r=td(e,n.getStart())))for(;r=t.get("_mce_caret");)nd(t,n,r,!1)},id=function(e,t,n){var r=e.dom,i=r.getParent(n,jo.curry(Ac.isTextBlock,e));i&&r.isEmpty(i)?n.parentNode.replaceChild(t,n):(Hu(Dn.fromDom(n)),r.isEmpty(n)?n.parentNode.replaceChild(t,n):r.insertAfter(t,n))},od=function(e,t){return e.appendChild(t),t},ad=function(e,t){var n=O.foldr(e,function(e,t){return od(e,t.cloneNode(!1))},t);return od(n,n.ownerDocument.createTextNode(Gc))},sd={setup:function(e){var t=e.dom,n=e.selection,r=e.getBody();e.on("mouseup keydown",function(e){!function(e,t,n,r){rd(e,t,n,null,!1),8===r&&n.isCollapsed()&&n.getStart().innerHTML===Gc&&rd(e,t,n,td(e,n.getStart())),37!==r&&39!==r||rd(e,t,n,td(e,n.getStart()))}(r,t,n,e.keyCode)})},applyCaretFormat:function(e,t,n){var r,i,o,a,s,u,l=e.selection;a=(r=l.getRng(!0)).startOffset,u=r.startContainer.nodeValue,(i=td(e.getBody(),l.getStart()))&&(o=Jc(i));var c,d,f=/[^\s\u00a0\u00ad\u200b\ufeff]/;u&&a>0&&a<u.length&&f.test(u.charAt(a))&&f.test(u.charAt(a-1))?(s=l.getBookmark(),r.collapse(!0),r=qc(e,r,e.formatter.get(t)),r=Yc.split(r),e.formatter.apply(t,n,r),l.moveToBookmark(s)):(i&&o.nodeValue===Gc?e.formatter.apply(t,n,i):(c=e.getDoc(),d=ed(!0).dom(),o=(i=c.importNode(d,!0)).firstChild,r.insertNode(i),a=1,e.formatter.apply(t,n,i)),l.setCursorLocation(o,a))},removeCaretFormat:function(e,t,n,r){var i,o,a,s,u,l,c,d=e.dom,f=e.selection,h=[],m=f.getRng();for(i=m.startContainer,o=m.startOffset,u=i,3===i.nodeType&&(o!==i.nodeValue.length&&(s=!0),u=u.parentNode);u;){if(Kc.matchNode(e,u,t,n,r)){l=u;break}u.nextSibling&&(s=!0),h.push(u),u=u.parentNode}if(l)if(s){a=f.getBookmark(),m.collapse(!0);var p=qc(e,m,e.formatter.get(t),!0);p=Yc.split(p),e.formatter.remove(t,n,p),f.moveToBookmark(a)}else{c=td(e.getBody(),l);var g=ed(!1).dom(),v=ad(h,g);id(e,g,c||l),nd(d,f,c,!1),f.setCursorLocation(v,1),d.isEmpty(l)&&d.remove(l)}},isCaretNode:Zc,getParentCaretContainer:td,replaceWithCaretFormat:function(e,t){var n=ed(!1),r=ad(t,n.dom());return _u.before(Dn.fromDom(e),n),Iu.remove(Dn.fromDom(e)),ca(r,0)},isFormatElement:function(e,t){return e.schema.getTextInlineElements().hasOwnProperty(qn.name(t))&&!Zc(t.dom())&&!pi.isBogus(t.dom())}},ud=function(e,t){for(var n=0;n<e.length;n++){var r=e[n].apply(null,t);if(r.isSome())return r}return w.none()},ld=Gl([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),cd=function(e,t){var n=Es(t,e);return n||e},dd=function(e,t,n){var r=pl.normalizeForwards(n),i=cd(t,r.container());return pl.findRootInline(e,i,r).fold(function(){return Ta.nextPosition(i,r).bind(p.curry(pl.findRootInline,e,i)).map(function(e){return ld.before(e)})},w.none)},fd=function(e,t){return null===sd.getParentCaretContainer(e,t)},hd=function(e,t,n){return pl.findRootInline(e,t,n).filter(p.curry(fd,t))},md=function(e,t,n){var r=pl.normalizeBackwards(n);return hd(e,t,r).bind(function(e){return Ta.prevPosition(e,r).isNone()?w.some(ld.start(e)):w.none()})},pd=function(e,t,n){var r=pl.normalizeForwards(n);return hd(e,t,r).bind(function(e){return Ta.nextPosition(e,r).isNone()?w.some(ld.end(e)):w.none()})},gd=function(e,t,n){var r=pl.normalizeBackwards(n),i=cd(t,r.container());return pl.findRootInline(e,i,r).fold(function(){return Ta.prevPosition(i,r).bind(p.curry(pl.findRootInline,e,i)).map(function(e){return ld.after(e)})},w.none)},vd=function(e){return!1===pl.isRtl(yd(e))},bd=function(e,t,n){return ud([dd,md,pd,gd],[e,t,n]).filter(vd)},yd=function(e){return e.fold(p.identity,p.identity,p.identity,p.identity)},Cd=function(e){return e.fold(p.constant("before"),p.constant("start"),p.constant("end"),p.constant("after"))},wd=function(e){return e.fold(ld.before,ld.before,ld.after,ld.after)},Ed=function(e,t,n,r,i,o){return Oa([pl.findRootInline(t,n,r),pl.findRootInline(t,n,i)],function(t,r){return t!==r&&pl.hasSameParentBlock(n,t,r)?ld.after(e?t:r):o}).getOr(o)},xd=function(e,t){return e.fold(p.constant(!0),function(e){return r=t,!(Cd(n=e)===Cd(r)&&yd(n)===yd(r));var n,r})},Nd=function(e,t){return e?t.fold(p.compose(w.some,ld.start),w.none,p.compose(w.some,ld.after),w.none):t.fold(w.none,p.compose(w.some,ld.before),w.none,p.compose(w.some,ld.end))},Sd=function(e,t,n,r){var i=pl.normalizePosition(e,r),o=bd(t,n,i);return bd(t,n,i).bind(p.curry(Nd,e)).orThunk(function(){return function(e,t,n,r,i){var o=pl.normalizePosition(e,i);return Ta.fromPosition(e,n,o).map(p.curry(pl.normalizePosition,e)).fold(function(){return r.map(wd)},function(i){return bd(t,n,i).map(p.curry(Ed,e,t,n,o,i)).filter(p.curry(xd,r))}).filter(vd)}(e,t,n,o,r)})},kd=bd,Td=Sd,Ad=(p.curry(Sd,!1),p.curry(Sd,!0),wd),Dd=function(e){return e.fold(ld.start,ld.start,ld.end,ld.end)},Bd=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return Bd(n())}}},Rd=function(e){return Un.isFunction(e.selection.getSel().modify)},_d=function(e,t,n){var r=e?1:-1;return t.setRng(ca(n.container(),n.offset()+r).toRange()),t.getSel().modify("move",e?"forward":"backward","word"),!0},Ld=function(e,t){var n=t.selection.getRng(),r=e?ca.fromRangeEnd(n):ca.fromRangeStart(n);return!!Rd(t)&&(e&&po(r)?_d(!0,t.selection,r):!(e||!go(r))&&_d(!1,t.selection,r))},Od=function(e,t){var n=e.dom.createRng();n.setStart(t.container(),t.offset()),n.setEnd(t.container(),t.offset()),e.selection.setRng(n)},Pd=function(e){return!1!==e.settings.inline_boundaries},Id=function(e,t){e?t.setAttribute("data-mce-selected","inline-boundary"):t.removeAttribute("data-mce-selected")},Fd=function(e,t,n){return Nc(t,n).map(function(t){return Od(e,t),n})},Md=function(e,t,n){return function(){return!!Pd(t)&&Ld(e,t)}},Hd={move:function(e,t,n){return function(){return!!Pd(e)&&function(e,t,n){var r=e.getBody(),i=ca.fromRangeStart(e.selection.getRng()),o=p.curry(pl.isInlineTarget,e);return Td(n,o,r,i).bind(function(n){return Fd(e,t,n)})}(e,t,n).isSome()}},moveNextWord:p.curry(Md,!0),movePrevWord:p.curry(Md,!1),setupSelectedState:function(e){var t=Bd(null),n=p.curry(pl.isInlineTarget,e);return e.on("NodeChange",function(r){Pd(e)&&(function(e,t,n){var r=O.filter(t.select('*[data-mce-selected="inline-boundary"]'),e),i=O.filter(n,e);O.each(O.difference(r,i),p.curry(Id,!1)),O.each(O.difference(i,r),p.curry(Id,!0))}(n,e.dom,r.parents),function(e,t){if(e.selection.isCollapsed()&&!0!==e.composing&&t.get()){var n=ca.fromRangeStart(e.selection.getRng());ca.isTextPosition(n)&&!1===pl.isAtZwsp(n)&&(Od(e,Ca.removeAndReposition(t.get(),n)),t.set(null))}}(e,t),function(e,t,n,r){if(t.selection.isCollapsed()){var i=O.filter(r,e);O.each(i,function(r){var i=ca.fromRangeStart(t.selection.getRng());kd(e,t.getBody(),i).bind(function(e){return Fd(t,n,e)})})}}(n,e,t,r.parents))}),t},setCaretPosition:Od},qd=function(e,t){return function(n){return Nc(t,n).map(function(t){return Hd.setCaretPosition(e,t),!0}).getOr(!1)}},zd=function(e,t,n,r){var i=e.getBody(),o=p.curry(pl.isInlineTarget,e);e.undoManager.ignore(function(){e.selection.setRng(function(e,t){var n=document.createRange();return n.setStart(e.container(),e.offset()),n.setEnd(t.container(),t.offset()),n}(n,r)),e.execCommand("Delete"),kd(o,i,ca.fromRangeStart(e.selection.getRng())).map(Dd).map(qd(e,t))}),e.nodeChanged()},Ud=function(e,t,n,r){var i=function(e,t){var n=Es(t,e);return n||e}(e.getBody(),r.container()),o=p.curry(pl.isInlineTarget,e),a=kd(o,i,r);return a.bind(function(e){return n?e.fold(p.constant(w.some(Dd(e))),w.none,p.constant(w.some(Ad(e))),w.none):e.fold(w.none,p.constant(w.some(Ad(e))),w.none,p.constant(w.some(Dd(e))))}).map(qd(e,t)).getOrThunk(function(){var s=Ta.navigate(n,i,r),u=s.bind(function(e){return kd(o,i,e)});return a.isSome()&&u.isSome()?pl.findRootInline(o,i,r).map(function(t){return!!function(e){return Oa([Ta.firstPositionIn(e),Ta.lastPositionIn(e)],function(t,n){var r=pl.normalizePosition(!0,t),i=pl.normalizePosition(!1,n);return Ta.nextPosition(e,r).map(function(e){return e.isEqual(i)}).getOr(!0)}).getOr(!0)}(t)&&(cc(e,n,Dn.fromDom(t)),!0)}).getOr(!1):u.bind(function(i){return s.map(function(i){return n?zd(e,t,r,i):zd(e,t,i,r),!0})}).getOr(!1)})},jd=function(e,t,n){if(e.selection.isCollapsed()&&function(e){return!1!==e.settings.inline_boundaries}(e)){var r=ca.fromRangeStart(e.selection.getRng());return Ud(e,t,n,r)}return!1},Vd=cr.immutable("start","end"),$d=cr.immutable("rng","table","cells"),Wd=Gl([{removeTable:["element"]},{emptyCells:["cells"]}]),Kd=function(e,t){return El(Dn.fromDom(e),"td,th",t)},Xd=function(e,t){return Cl(e,"table",t)},Yd=function(e){return!1===wr.eq(e.start(),e.end())},Gd=function(e,t){return Xd(e.start(),t).bind(function(n){return Xd(e.end(),t).bind(function(e){return wr.eq(n,e)?w.some(n):w.none()})})},Zd=function(e){return Ka(e,"td,th")},Qd=function(e,t){var n=Kd(t.startContainer,e),r=Kd(t.endContainer,e);return t.collapsed?w.none():Oa([n,r],Vd).fold(function(){return n.fold(function(){return r.bind(function(t){return Xd(t,e).bind(function(e){return O.head(Zd(e)).map(function(e){return Vd(e,t)})})})},function(t){return Xd(t,e).bind(function(e){return O.last(Zd(e)).map(function(e){return Vd(t,e)})})})},function(t){return Jd(e,t)?w.none():function(e,t){return Xd(e.start(),t).bind(function(t){return O.last(Zd(t)).map(function(t){return Vd(e.start(),t)})})}(t,e)})},Jd=function(e,t){return Gd(t,e).isSome()},ef=function(e,t){var n=function(e){return p.curry(wr.eq,e)}(e);return function(e,t){var n=Kd(e.startContainer,t),r=Kd(e.endContainer,t);return Oa([n,r],Vd).filter(Yd).filter(function(e){return Jd(t,e)}).orThunk(function(){return Qd(t,e)})}(t,n).bind(function(e){return function(e,t){return Gd(e,t).map(function(t){return $d(e,t,Zd(t))})}(e,n)})},tf=function(e,t){return O.findIndex(e,function(e){return wr.eq(e,t)})},nf=function(e){return function(e){return Oa([tf(e.cells(),e.rng().start()),tf(e.cells(),e.rng().end())],function(t,n){return e.cells().slice(t,n+1)})}(e).map(function(t){var n=e.cells();return t.length===n.length?Wd.removeTable(e.table()):Wd.emptyCells(t)})},rf=function(e,t){return ef(e,t).bind(nf)},of=function(e){var t=[];if(e)for(var n=0;n<e.rangeCount;n++)t.push(e.getRangeAt(n));return t},af=of,sf=function(e){return O.bind(e,function(e){var t=Fo(e);return t?[Dn.fromDom(t)]:[]})},uf=function(e){return of(e).length>1},lf=function(e){return O.filter(sf(e),ii)},cf=function(e){return Ka(e,"td[data-mce-selected],th[data-mce-selected]")},df=function(e,t){var n=cf(t),r=lf(e);return n.length>0?n:r},ff=df,hf=function(e){return df(af(e.selection.getSel()),Dn.fromDom(e.getBody()))},mf=function(e,t){return O.each(t,qu),e.selection.setCursorLocation(t[0].dom(),0),!0},pf=function(e,t){return cc(e,!1,t),!0},gf=function(e,t,n,r){return bf(t,r).fold(function(){return function(e,t,n){return rf(t,n).map(function(t){return t.fold(p.curry(pf,e),p.curry(mf,e))})}(e,t,n)},function(t){return function(e,t){return yf(e,t)}(e,t)}).getOr(!1)},vf=function(e,t){return O.find(Ml(t,e),ii)},bf=function(e,t){return O.find(Ml(t,e),function(e){return"caption"===qn.name(e)})},yf=function(e,t){return qu(t),e.selection.setCursorLocation(t.dom(),0),w.some(!0)},Cf=function(e,t,n,r,i){return Ta.navigate(n,e.getBody(),i).bind(function(o){return function(e,t,n,r){return Ta.firstPositionIn(e.dom()).bind(function(i){return Ta.lastPositionIn(e.dom()).map(function(e){return t?n.isEqual(i)&&r.isEqual(e):n.isEqual(e)&&r.isEqual(i)})}).getOr(!0)}(r,n,i,o)?function(e,t){return yf(e,t)}(e,r):function(e,t,n){return bf(e,Dn.fromDom(n.getNode())).map(function(e){return!1===wr.eq(e,t)})}(t,r,o)}).or(w.some(!0))},wf=function(e,t,n,r){var i=ca.fromRangeStart(e.selection.getRng());return vf(n,r).bind(function(r){return Dl(r)?yf(e,r):function(e,t,n,r,i){return Ta.navigate(n,e.getBody(),i).bind(function(e){return vf(t,Dn.fromDom(e.getNode())).map(function(e){return!1===wr.eq(e,r)})})}(e,n,t,r,i)})},Ef=function(e,t,n){var r=Dn.fromDom(e.getBody());return bf(r,n).fold(function(){return wf(e,t,r,n)},function(n){return function(e,t,n,r){var i=ca.fromRangeStart(e.selection.getRng());return Dl(r)?yf(e,r):Cf(e,n,t,r,i)}(e,t,r,n)}).getOr(!1)},xf=function(e,t){var n=Dn.fromDom(e.selection.getStart(!0)),r=hf(e);return e.selection.isCollapsed()&&0===r.length?Ef(e,t,n):function(e,t){var n=Dn.fromDom(e.getBody()),r=e.selection.getRng(),i=hf(e);return 0!==i.length?mf(e,i):gf(e,n,r,t)}(e,n)},Nf=function(e,t){e.getDoc().execCommand(t,!1,null)},Sf={deleteCommand:function(e){hc(e,!1)||jd(e,!1)||$l(e,!1)||xf(e)||Yl(e,!1)||(Nf(e,"Delete"),vl(e))},forwardDeleteCommand:function(e){hc(e,!0)||jd(e,!0)||$l(e,!0)||xf(e)||Yl(e,!0)||Nf(e,"ForwardDelete")}},kf={isEq:function(e,t){return e&&t&&e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}},Tf=cr.immutable("container","offset"),Af=function(e,t,n){return null!==function(e,t,n){for(;e&&e!==t;){if(n(e))return e;e=e.parentNode}return null}(e,t,n)},Df=function(e,t,n){return Af(e,t,function(e){return e.nodeName===n})},Bf=function(e){return e&&"TABLE"===e.nodeName},Rf=function(e){return e&&/^(TD|TH|CAPTION)$/.test(e.nodeName)},_f=function(e,t){return ho(e)&&!1===Af(e,t,sd.isCaretNode)},Lf=function(e,t,n){for(var r=new Vr(t,e.getParent(t.parentNode,e.isBlock)||e.getRoot());t=r[n?"prev":"next"]();)if(pi.isBr(t))return!0},Of=function(e,t,n,r,i){var o,a,s,u,l=e.getRoot(),c=e.schema.getNonEmptyElements();if(s=e.getParent(i.parentNode,e.isBlock)||l,r&&pi.isBr(i)&&t&&e.isEmpty(s))return w.some(Tf(i.parentNode,e.nodeIndex(i)));for(o=new Vr(i,s);u=o[r?"prev":"next"]();){if("false"===e.getContentEditableParent(u)||_f(u,l))return w.none();if(pi.isText(u)&&u.nodeValue.length>0)return!1===Df(u,l,"A")?w.some(Tf(u,r?u.nodeValue.length:0)):w.none();if(e.isBlock(u)||c[u.nodeName.toLowerCase()])return w.none();a=u}return n&&a?w.some(Tf(a,0)):w.none()},Pf=function(e,t,n,r){var i,o,a,s,u,l,c,d=e.getRoot(),f=!1;if(i=r[(n?"start":"end")+"Container"],o=r[(n?"start":"end")+"Offset"],c=pi.isElement(i)&&o===i.childNodes.length,u=e.schema.getNonEmptyElements(),l=n,ho(i))return w.none();if(pi.isElement(i)&&o>i.childNodes.length-1&&(l=!1),pi.isDocument(i)&&(i=d,o=0),i===d){if(l&&(s=i.childNodes[o>0?o-1:0])){if(ho(s))return w.none();if(u[s.nodeName]||Bf(s))return w.none()}if(i.hasChildNodes()){if(o=Math.min(!l&&o>0?o-1:o,i.childNodes.length-1),i=i.childNodes[o],o=pi.isText(i)&&c?i.data.length:0,!t&&i===d.lastChild&&Bf(i))return w.none();if(function(e,t){for(;t&&t!==e;){if(pi.isContentEditableFalse(t))return!0;t=t.parentNode}return!1}(d,i)||ho(i))return w.none();if(i.hasChildNodes()&&!1===Bf(i)){s=i,a=new Vr(i,d);do{if(pi.isContentEditableFalse(s)||ho(s)){f=!1;break}if(pi.isText(s)&&s.nodeValue.length>0){o=l?0:s.nodeValue.length,i=s,f=!0;break}if(u[s.nodeName.toLowerCase()]&&!Rf(s)){o=e.nodeIndex(s),i=s.parentNode,"IMG"!==s.nodeName&&"PRE"!==s.nodeName||l||o++,f=!0;break}}while(s=l?a.next():a.prev())}}}return t&&(pi.isText(i)&&0===o&&Of(e,c,t,!0,i).each(function(e){i=e.container(),o=e.offset(),f=!0}),pi.isElement(i)&&((s=i.childNodes[o])||(s=i.childNodes[o-1]),!s||!pi.isBr(s)||function(e,t){return e.previousSibling&&e.previousSibling.nodeName===t}(s,"A")||Lf(e,s,!1)||Lf(e,s,!0)||Of(e,c,t,!0,s).each(function(e){i=e.container(),o=e.offset(),f=!0}))),l&&!t&&pi.isText(i)&&o===i.nodeValue.length&&Of(e,c,t,!1,i).each(function(e){i=e.container(),o=e.offset(),f=!0}),f?w.some(Tf(i,o)):w.none()},If={normalize:function(e,t){var n=t.collapsed,r=t.cloneRange();return Pf(e,n,!0,r).each(function(e){r.setStart(e.container(),e.offset())}),n||Pf(e,n,!1,r).each(function(e){r.setEnd(e.container(),e.offset())}),n&&r.collapse(!0),kf.isEq(t,r)?w.none():w.some(r)}},Ff=function(e,t,n){var r=e.create("span",{},"&nbsp;");n.parentNode.insertBefore(r,n),t.scrollIntoView(r),e.remove(r)},Mf=function(e,t,n,r){var i=e.createRng();r?(i.setStartBefore(n),i.setEndBefore(n)):(i.setStartAfter(n),i.setEndAfter(n)),t.setRng(i)},Hf=function(e,t){var n,r,i=e.selection,o=e.dom,a=i.getRng();If.normalize(o,a).each(function(e){a.setStart(e.startContainer,e.startOffset),a.setEnd(e.endContainer,e.endOffset)});var s=a.startOffset,u=a.startContainer;if(1===u.nodeType&&u.hasChildNodes()){var l=s>u.childNodes.length-1;u=u.childNodes[Math.min(s,u.childNodes.length-1)]||u,s=l&&3===u.nodeType?u.nodeValue.length:0}var c=o.getParent(u,o.isBlock),d=c?o.getParent(c.parentNode,o.isBlock):null,f=d?d.nodeName.toUpperCase():"",h=t&&t.ctrlKey;"LI"!==f||h||(c=d),u&&3===u.nodeType&&s>=u.nodeValue.length&&(function(e,t,n){for(var r,i=new Vr(t,n),o=e.getNonEmptyElements();r=i.next();)if(o[r.nodeName.toLowerCase()]||r.length>0)return!0}(e.schema,u,c)||(n=o.create("br"),a.insertNode(n),a.setStartAfter(n),a.setEndAfter(n),r=!0)),n=o.create("br"),a.insertNode(n),Ff(o,i,n),Mf(o,i,n,r),e.undoManager.add()},qf=function(e,t){var n=Dn.fromTag("br");_u.before(Dn.fromDom(t),n),e.undoManager.add()},zf=function(e,t){Uf(e.getBody(),t)||_u.after(Dn.fromDom(t),Dn.fromTag("br"));var n=Dn.fromTag("br");_u.after(Dn.fromDom(t),n),Ff(e.dom,e.selection,n.dom()),Mf(e.dom,e.selection,n.dom(),!1),e.undoManager.add()},Uf=function(e,t){return n=ca.after(t),!!pi.isBr(n.getNode())||Ta.nextPosition(e,ca.after(t)).map(function(e){return pi.isBr(e.getNode())}).getOr(!1);var n},jf=function(e){return e&&"A"===e.nodeName&&"href"in e},Vf=function(e){return e.fold(p.constant(!1),jf,jf,p.constant(!1))},$f=function(e,t){t.fold(p.noop,p.curry(qf,e),p.curry(zf,e),p.noop)},Wf={insert:function(e,t){var n=function(e){var t=p.curry(pl.isInlineTarget,e),n=ca.fromRangeStart(e.selection.getRng());return kd(t,e.getBody(),n).filter(Vf)}(e);n.isSome()?n.each(p.curry($f,e)):Hf(e,t)}},Kf=Gl([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Xf=(Kf.before,Kf.on,Kf.after,function(e){return e.fold(p.identity,p.identity,p.identity)}),Yf=Gl([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Gf=cr.immutable("start","soffset","finish","foffset"),Zf={domRange:Yf.domRange,relative:Yf.relative,exact:Yf.exact,exactFromRange:function(e){return Yf.exact(e.start(),e.soffset(),e.finish(),e.foffset())},range:Gf,getWin:function(e){var t=function(e){return e.match({domRange:function(e){return Dn.fromDom(e.startContainer)},relative:function(e,t){return Xf(e)},exact:function(e,t,n,r){return e}})}(e);return Dr.defaultView(t)}},Qf=Tn.detect().browser,Jf=function(e,t){var n=qn.isText(t)?Mu(t).length:Dr.children(t).length+1;return e>n?n:e<0?0:e},eh=function(e){return Zf.range(e.start(),Jf(e.soffset(),e.start()),e.finish(),Jf(e.foffset(),e.finish()))},th=function(e,t){return wr.contains(e,t)||wr.eq(e,t)},nh=function(e){return function(t){return th(e,t.start())&&th(e,t.finish())}},rh=function(e){return!0===e.inline||Qf.isIE()},ih=function(e){return Zf.range(Dn.fromDom(e.startContainer),e.startOffset,Dn.fromDom(e.endContainer),e.endOffset)},oh=function(e){var t=e.getSelection();return(t&&0!==t.rangeCount?w.from(t.getRangeAt(0)):w.none()).map(ih)},ah=function(e){var t=Dr.defaultView(e);return oh(t.dom()).filter(nh(e))},sh=function(e,t){return w.from(t).filter(nh(e)).map(eh)},uh=function(e){var t=document.createRange();return t.setStart(e.start().dom(),e.soffset()),t.setEnd(e.finish().dom(),e.foffset()),w.some(t)},lh=function(e){return(e.bookmark?e.bookmark:w.none()).bind(p.curry(sh,Dn.fromDom(e.getBody()))).bind(uh)},ch={store:function(e){var t=rh(e)?ah(Dn.fromDom(e.getBody())):w.none();e.bookmark=t.isSome()?t:e.bookmark},storeNative:function(e,t){var n=Dn.fromDom(e.getBody()),r=(rh(e)?w.from(t):w.none()).map(ih).filter(nh(n));e.bookmark=r.isSome()?r:e.bookmark},readRange:oh,restore:function(e){lh(e).each(function(t){e.selection.setRng(t)})},getRng:lh,getBookmark:ah,validate:sh},dh=function(e,t){var n=e.settings,r=e.dom,i=e.selection,o=e.formatter,a=/[a-z%]+$/i.exec(n.indentation)[0],s=parseInt(n.indentation,10),u=e.getParam("indent_use_margin",!1);e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList")||(n.forced_root_block||r.getParent(i.getNode(),r.isBlock)||o.apply("div"),O.each(i.getSelectedBlocks(),function(e){return function(e,t,n,r,i,o){if("false"!==e.getContentEditable(o)&&"LI"!==o.nodeName){var a=n?"margin":"padding";if(a="TABLE"===o.nodeName?"margin":a,a+="rtl"===e.getStyle(o,"direction",!0)?"Right":"Left","outdent"===t){var s=Math.max(0,parseInt(o.style[a]||0,10)-r);e.setStyle(o,a,s?s+i:"")}else s=parseInt(o.style[a]||0,10)+r+i,e.setStyle(o,a,s)}}(r,t,u,s,a,e)}))},fh=Dt.each,hh=Dt.extend,mh=Dt.map,ph=Dt.inArray,gh=Dt.explode,vh=!0,bh=!1;function yh(e){var t,n,r,i,o={state:{},exec:{},value:{}},a=e.settings;e.on("PreInit",function(){t=e.dom,n=e.selection,a=e.settings,r=e.formatter});var s=function(t){var n;if(!e.quirks.isHidden()&&!e.removed){if(t=t.toLowerCase(),n=o.state[t])return n(t);try{return e.getDoc().queryCommandState(t)}catch(e){}return!1}},u=function(e,t){t=t||"exec",fh(e,function(e,n){fh(n.toLowerCase().split(","),function(n){o[t][n]=e})})};hh(this,{execCommand:function(t,n,r,i){var a,s,u=!1;if(!e.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(t)||i&&i.skip_focus?ch.restore(e):e.focus(),(i=e.fire("BeforeExecCommand",{command:t,ui:n,value:r})).isDefaultPrevented())return!1;if(s=t.toLowerCase(),a=o.exec[s])return a(s,n,r),e.fire("ExecCommand",{command:t,ui:n,value:r}),!0;if(fh(e.plugins,function(i){if(i.execCommand&&i.execCommand(t,n,r))return e.fire("ExecCommand",{command:t,ui:n,value:r}),u=!0,!1}),u)return u;if(e.theme&&e.theme.execCommand&&e.theme.execCommand(t,n,r))return e.fire("ExecCommand",{command:t,ui:n,value:r}),!0;try{u=e.getDoc().execCommand(t,n,r)}catch(e){}return!!u&&(e.fire("ExecCommand",{command:t,ui:n,value:r}),!0)}},queryCommandState:s,queryCommandValue:function(t){var n;if(!e.quirks.isHidden()&&!e.removed){if(t=t.toLowerCase(),n=o.value[t])return n(t);try{return e.getDoc().queryCommandValue(t)}catch(e){}}},queryCommandSupported:function(t){if(t=t.toLowerCase(),o.exec[t])return!0;try{return e.getDoc().queryCommandSupported(t)}catch(e){}return!1},addCommands:u,addCommand:function(t,n,r){t=t.toLowerCase(),o.exec[t]=function(t,i,o,a){return n.call(r||e,i,o,a)}},addQueryStateHandler:function(t,n,r){t=t.toLowerCase(),o.state[t]=function(){return n.call(r||e)}},addQueryValueHandler:function(t,n,r){t=t.toLowerCase(),o.value[t]=function(){return n.call(r||e)}},hasCustomCommand:function(e){return e=e.toLowerCase(),!!o.exec[e]}});var l=function(t,n,r){return void 0===n&&(n=bh),void 0===r&&(r=null),e.getDoc().execCommand(t,n,r)},c=function(e){return r.match(e)},d=function(t,n){r.toggle(t,n?{value:n}:void 0),e.nodeChanged()},f=function(e){i=n.getBookmark(e)},h=function(){n.moveToBookmark(i)};u({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){e.undoManager.add()},"Cut,Copy,Paste":function(t){var n,r=e.getDoc();try{l(t)}catch(e){n=vh}if("paste"!==t||r.queryCommandEnabled(t)||(n=!0),n||!r.queryCommandSupported(t)){var i=e.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");le.mac&&(i=i.replace(/Ctrl\+/g,"+")),e.notificationManager.open({text:i,type:"error"})}},unlink:function(){if(n.isCollapsed()){var t=e.dom.getParent(e.selection.getStart(),"a");t&&e.dom.remove(t,!0)}else r.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(e){var t=e.substring(7);"full"===t&&(t="justify"),fh("left,center,right,justify".split(","),function(e){t!==e&&r.remove("align"+e)}),"none"!==t&&d("align"+t)},"InsertUnorderedList,InsertOrderedList":function(e){var r,i;l(e),(r=t.getParent(n.getNode(),"ol,ul"))&&(i=r.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(i.nodeName)&&(f(),t.split(i,r),h()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){d(e)},"ForeColor,HiliteColor,FontName":function(e,t,n){d(e,n)},FontSize:function(e,t,n){var r,i;n>=1&&n<=7&&(i=gh(a.font_size_style_values),n=(r=gh(a.font_size_classes))?r[n-1]||n:i[n-1]||n),d(e,n)},RemoveFormat:function(e){r.remove(e)},mceBlockQuote:function(){d("blockquote")},FormatBlock:function(e,t,n){return d(n||"p")},mceCleanup:function(){var t=n.getBookmark();e.setContent(e.getContent({cleanup:vh}),{cleanup:vh}),n.moveToBookmark(t)},mceRemoveNode:function(t,r,i){var o=i||n.getNode();o!==e.getBody()&&(f(),e.dom.remove(o,vh),h())},mceSelectNodeDepth:function(r,i,o){var a=0;t.getParent(n.getNode(),function(e){if(1===e.nodeType&&a++===o)return n.select(e),bh},e.getBody())},mceSelectNode:function(e,t,r){n.select(r)},mceInsertContent:function(t,n,r){Yu.insertAtCaret(e,r)},mceInsertRawHTML:function(t,r,i){n.setContent("tiny_mce_marker"),e.setContent(e.getContent().replace(/tiny_mce_marker/g,function(){return i}))},mceToggleFormat:function(e,t,n){d(n)},mceSetContent:function(t,n,r){e.setContent(r)},"Indent,Outdent":function(t){dh(e,t)},mceRepaint:function(){},InsertHorizontalRule:function(){e.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){e.hasVisual=!e.hasVisual,e.addVisual()},mceReplaceContent:function(t,r,i){e.execCommand("mceInsertContent",!1,i.replace(/\{\$selection\}/g,n.getContent({format:"text"})))},mceInsertLink:function(e,i,o){var a;"string"==typeof o&&(o={href:o}),a=t.getParent(n.getNode(),"a"),o.href=o.href.replace(" ","%20"),a&&o.href||r.remove("link"),o.href&&r.apply("link",o,a)},selectAll:function(){var e=t.getParent(n.getStart(),pi.isContentEditableTrue);if(e){var r=t.createRng();r.selectNodeContents(e),n.setRng(r)}},delete:function(){Sf.deleteCommand(e)},forwardDelete:function(){Sf.forwardDeleteCommand(e)},mceNewDocument:function(){e.setContent("")},InsertLineBreak:function(t,n,r){return Wf.insert(e,r),!0}}),u({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var i="align"+e.substring(7),o=n.isCollapsed()?[t.getParent(n.getNode(),t.isBlock)]:n.getSelectedBlocks(),a=mh(o,function(e){return!!r.matchNode(e,i)});return-1!==ph(a,vh)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){return c(e)},mceBlockQuote:function(){return c("blockquote")},Outdent:function(){var e;if(a.inline_styles){if((e=t.getParent(n.getStart(),t.isBlock))&&parseInt(e.style.paddingLeft,10)>0)return vh;if((e=t.getParent(n.getEnd(),t.isBlock))&&parseInt(e.style.paddingLeft,10)>0)return vh}return s("InsertUnorderedList")||s("InsertOrderedList")||!a.inline_styles&&!!t.getParent(n.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(e){var r=t.getParent(n.getNode(),"ul,ol");return r&&("insertunorderedlist"===e&&"UL"===r.tagName||"insertorderedlist"===e&&"OL"===r.tagName)}},"state"),u({"FontSize,FontName":function(e){var r,i=0;return(r=t.getParent(n.getNode(),"span"))&&(i="fontsize"===e?r.style.fontSize:r.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),i}},"value"),u({Undo:function(){e.undoManager.undo()},Redo:function(){e.undoManager.redo()}})}var Ch=Dt.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend"," "),wh=function(e){var t,n,r=this,i={},o=function(){return!1},a=function(){return!0};t=(e=e||{}).scope||r,n=e.toggleEvent||o;var s=function(e,t,a,s){var u,l,c;if(!1===t&&(t=o),t)for(t={func:t},s&&Dt.extend(t,s),c=(l=e.toLowerCase().split(" ")).length;c--;)e=l[c],(u=i[e])||(u=i[e]=[],n(e,!0)),a?u.unshift(t):u.push(t);return r},u=function(e,t){var o,a,s,u,l;if(e)for(o=(u=e.toLowerCase().split(" ")).length;o--;){if(e=u[o],a=i[e],!e){for(s in i)n(s,!1),delete i[s];return r}if(a){if(t)for(l=a.length;l--;)a[l].func===t&&(a=a.slice(0,l).concat(a.slice(l+1)),i[e]=a);else a.length=0;a.length||(n(e,!1),delete i[e])}}else{for(e in i)n(e,!1);i={}}return r};r.fire=function(n,r){var s,l,c,d;if(n=n.toLowerCase(),(r=r||{}).type=n,r.target||(r.target=t),r.preventDefault||(r.preventDefault=function(){r.isDefaultPrevented=a},r.stopPropagation=function(){r.isPropagationStopped=a},r.stopImmediatePropagation=function(){r.isImmediatePropagationStopped=a},r.isDefaultPrevented=o,r.isPropagationStopped=o,r.isImmediatePropagationStopped=o),e.beforeFire&&e.beforeFire(r),s=i[n])for(l=0,c=s.length;l<c;l++){if((d=s[l]).once&&u(n,d.func),r.isImmediatePropagationStopped())return r.stopPropagation(),r;if(!1===d.func.call(t,r))return r.preventDefault(),r}return r},r.on=s,r.off=u,r.once=function(e,t,n){return s(e,t,n,{once:!0})},r.has=function(e){return e=e.toLowerCase(),!(!i[e]||0===i[e].length)}};wh.isNative=function(e){return!!Ch[e.toLowerCase()]};var Eh,xh=function(e){return e._eventDispatcher||(e._eventDispatcher=new wh({scope:e,toggleEvent:function(t,n){wh.isNative(t)&&e.toggleNativeEvent&&e.toggleNativeEvent(t,n)}})),e._eventDispatcher},Nh={fire:function(e,t,n){if(this.removed&&"remove"!==e)return t;if(t=xh(this).fire(e,t,n),!1!==n&&this.parent)for(var r=this.parent();r&&!t.isPropagationStopped();)r.fire(e,t,!1),r=r.parent();return t},on:function(e,t,n){return xh(this).on(e,t,n)},off:function(e,t){return xh(this).off(e,t)},once:function(e,t){return xh(this).once(e,t)},hasEventListeners:function(e){return xh(this).has(e)}},Sh=Zi.DOM,kh=function(e,t){return"selectionchange"===t?e.getDoc():!e.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(t)?e.getDoc().documentElement:e.settings.event_root?(e.eventRoot||(e.eventRoot=Sh.select(e.settings.event_root)[0]),e.eventRoot):e.getBody()},Th=function(e,t){var n,r,i=function(e){return!e.hidden&&!e.readonly};if(e.delegates||(e.delegates={}),!e.delegates[t]&&!e.removed)if(n=kh(e,t),e.settings.event_root){if(Eh||(Eh={},e.editorManager.on("removeEditor",function(){var t;if(!e.editorManager.activeEditor&&Eh){for(t in Eh)e.dom.unbind(kh(e,t));Eh=null}})),Eh[t])return;r=function(n){for(var r=n.target,o=e.editorManager.get(),a=o.length;a--;){var s=o[a].getBody();(s===r||Sh.isChildOf(r,s))&&i(o[a])&&o[a].fire(t,n)}},Eh[t]=r,Sh.bind(n,t,r)}else r=function(n){i(e)&&e.fire(t,n)},Sh.bind(n,t,r),e.delegates[t]=r},Ah={bindPendingEventDelegates:function(){var e=this;Dt.each(e._pendingNativeEvents,function(t){Th(e,t)})},toggleNativeEvent:function(e,t){"focus"!==e&&"blur"!==e&&(t?this.initialized?Th(this,e):this._pendingNativeEvents?this._pendingNativeEvents.push(e):this._pendingNativeEvents=[e]:this.initialized&&(this.dom.unbind(kh(this,e),e,this.delegates[e]),delete this.delegates[e]))},unbindAllNativeEvents:function(){var e,t=this.getBody(),n=this.dom;if(this.delegates){for(e in this.delegates)this.dom.unbind(kh(this,e),e,this.delegates[e]);delete this.delegates}!this.inline&&t&&n&&(t.onload=null,n.unbind(this.getWin()),n.unbind(this.getDoc())),n&&(n.unbind(t),n.unbind(this.getContainer()))}},Dh=Ah=Dt.extend({},Nh,Ah),Bh=function(e,t,n){try{e.getDoc().execCommand(t,!1,n)}catch(e){}},Rh=function(e,t){e._clickBlocker&&(e._clickBlocker.unbind(),e._clickBlocker=null),t?(e._clickBlocker=function(e){var t,n;return t=e.getBody(),n=function(t){e.dom.getParents(t.target,"a").length>0&&t.preventDefault()},e.dom.bind(t,"click",n),{unbind:function(){e.dom.unbind(t,"click",n)}}}(e),e.selection.controlSelection.hideResizeRect(),e.readonly=!0,e.getBody().contentEditable=!1):(e.readonly=!1,e.getBody().contentEditable=!0,Bh(e,"StyleWithCSS",!1),Bh(e,"enableInlineTableEditing",!1),Bh(e,"enableObjectResizing",!1),e.focus(),e.nodeChanged())},_h=function(e,t){var n=e.readonly?"readonly":"design";t!==n&&(e.initialized?Rh(e,"readonly"===t):e.on("init",function(){Rh(e,"readonly"===t)}),e.fire("SwitchMode",{mode:t}))},Lh=Dt.each,Oh=Dt.explode,Ph={f9:120,f10:121,f11:122},Ih=Dt.makeMap("alt,ctrl,shift,meta,access");function Fh(e){var t={},n=[],r=function(e){var t,n,r={};for(n in Lh(Oh(e,"+"),function(e){e in Ih?r[e]=!0:/^[0-9]{2,}$/.test(e)?r.keyCode=parseInt(e,10):(r.charCode=e.charCodeAt(0),r.keyCode=Ph[e]||e.toUpperCase().charCodeAt(0))}),t=[r.keyCode],Ih)r[n]?t.push(n):r[n]=!1;return r.id=t.join(","),r.access&&(r.alt=!0,le.mac?r.ctrl=!0:r.shift=!0),r.meta&&(le.mac?r.meta=!0:(r.ctrl=!0,r.meta=!1)),r},i=function(t,n,i,o){var a;return(a=Dt.map(Oh(t,">"),r))[a.length-1]=Dt.extend(a[a.length-1],{func:i,scope:o||e}),Dt.extend(a[0],{desc:e.translate(n),subpatterns:a.slice(1)})},o=function(e,t){return!!t&&t.ctrl===e.ctrlKey&&t.meta===e.metaKey&&t.alt===e.altKey&&t.shift===e.shiftKey&&!!(e.keyCode===t.keyCode||e.charCode&&e.charCode===t.charCode)&&(e.preventDefault(),!0)},a=function(e){return e.func?e.func.call(e.scope):null};e.on("keyup keypress keydown",function(e){!function(e){return e.altKey||e.ctrlKey||e.metaKey}(e)&&!function(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123}(e)||e.isDefaultPrevented()||(Lh(t,function(t){if(o(e,t))return n=t.subpatterns.slice(0),"keydown"===e.type&&a(t),!0}),o(e,n[0])&&(1===n.length&&"keydown"===e.type&&a(n[0]),n.shift()))}),this.add=function(n,r,o,a){var s;return s=o,"string"==typeof o?o=function(){e.execCommand(s,!1,null)}:Dt.isArray(s)&&(o=function(){e.execCommand(s[0],s[1],s[2])}),Lh(Oh(Dt.trim(n.toLowerCase())),function(e){var n=i(e,r,o,a);t[n.id]=n}),!0},this.remove=function(e){var n=i(e);return!!t[n.id]&&(delete t[n.id],!0)}}var Mh=function(e){var t=void 0!==e?e.dom():document;return w.from(t.activeElement).map(Dn.fromDom)},Hh=function(e){var t=Dr.owner(e).dom();return e.dom()===t.activeElement},qh=function(e){return Mh(Dr.owner(e)).filter(function(t){return e.dom().contains(t.dom())})},zh=function(e,t){return function(e){return e.collapsed?w.from(Mo(e.startContainer,e.startOffset)).map(Dn.fromDom):w.none()}(t).bind(function(t){return ri(t)?w.some(t):!1===wr.contains(e,t)?w.some(e):w.none()})},Uh=function(e,t){zh(Dn.fromDom(e.getBody()),t).bind(function(e){return Ta.firstPositionIn(e.dom())}).fold(function(){return e.selection.normalize()},function(t){return e.selection.setRng(t.toRange())})},jh=function(e){if(e.setActive)try{e.setActive()}catch(t){e.focus()}else e.focus()},Vh=function(e){var t,n=e.getBody();return n&&(t=Dn.fromDom(n),Hh(t)||qh(t).isSome())},$h=function(e){return e.inline?Vh(e):function(e){return e.iframeElement&&Hh(Dn.fromDom(e.iframeElement))}(e)},Wh=function(e){e.editorManager.setActive(e)},Kh=function(e,t){e.removed||(t?Wh(e):function(e){var t,n=e.selection,r=e.settings.content_editable,i=e.getBody(),o=n.getRng();if(e.quirks.refreshContentEditable(),t=function(e,t){return e.dom.getParent(t,function(t){return"true"===e.dom.getContentEditable(t)})}(e,n.getNode()),e.$.contains(i,t))return jh(t),Uh(e,o),void Wh(e);void 0!==e.bookmark&&!1===$h(e)&&ch.getRng(e).each(function(t){e.selection.setRng(t),o=t}),r||(le.opera||jh(i),e.getWin().focus()),(le.gecko||r)&&(jh(i),Uh(e,o)),Wh(e)}(e))},Xh=$h,Yh=function(e,t){return t.dom()[e]},Gh=function(e,t){return parseInt(sr(t,e),10)},Zh=p.curry(Yh,"clientWidth"),Qh=p.curry(Yh,"clientHeight"),Jh=p.curry(Gh,"margin-top"),em=p.curry(Gh,"margin-left"),tm={isXYInContentArea:function(e,t,n){var r=Dn.fromDom(e.getBody()),i=e.inline?r:Dr.documentElement(r),o=function(e,t,n,r){var i=function(e){return e.dom().getBoundingClientRect()}(t);return{x:n-(e?i.left+t.dom().clientLeft+em(t):0),y:r-(e?i.top+t.dom().clientTop+Jh(t):0)}}(e.inline,i,t,n);return function(e,t,n){var r=Zh(e),i=Qh(e);return t>=0&&n>=0&&t<=r&&n<=i}(i,o.x,o.y)},isEditorAttachedToDom:function(e){var t,n=e.inline?e.getBody():e.getContentAreaContainer();return(t=n,w.from(t).map(Dn.fromDom)).map(function(e){return wr.contains(Dr.owner(e),e)}).getOr(!1)}};function nm(e){var t=[],n=function(){var t,n=e.theme;return n&&n.getNotificationManagerImpl?n.getNotificationManagerImpl():{open:t=function(){throw new Error("Theme did not provide a NotificationManager implementation.")},close:t,reposition:t,getArgs:t}},r=function(){t.length>0&&n().reposition(t)},i=function(e){O.findIndex(t,function(t){return t===e}).each(function(e){t.splice(e,1)})},o=function(o){if(!e.removed&&tm.isEditorAttachedToDom(e))return O.find(t,function(e){return t=n().getArgs(e),r=o,!(t.type!==r.type||t.text!==r.text||t.progressBar||t.timeout||r.progressBar||r.timeout);var t,r}).getOrThunk(function(){e.editorManager.setActive(e);var a=n().open(o,function(){i(a),r()});return function(e){t.push(e)}(a),r(),a})};return function(e){e.on("SkinLoaded",function(){var t=e.settings.service_message;t&&o({text:t,type:"warning",timeout:0,icon:""})}),e.on("ResizeEditor ResizeWindow",function(){me.requestAnimationFrame(r)}),e.on("remove",function(){O.each(t,function(e){n().close(e)})})}(e),{open:o,close:function(){w.from(t[0]).each(function(e){n().close(e),i(e),r()})},getNotifications:function(){return t}}}function rm(e){var t=[],n=function(){var t,n=e.theme;return n&&n.getWindowManagerImpl?n.getWindowManagerImpl():{open:t=function(){throw new Error("Theme did not provide a WindowManager implementation.")},alert:t,confirm:t,close:t,getParams:t,setParams:t}},r=function(e,t){return function(){return t?t.apply(e,arguments):void 0}},i=function(n){t.push(n),function(t){e.fire("OpenWindow",{win:t})}(n)},o=function(n){O.findIndex(t,function(e){return e===n}).each(function(r){t.splice(r,1),function(t){e.fire("CloseWindow",{win:t})}(n),0===t.length&&e.focus()})},a=function(){return w.from(t[t.length-1])};return e.on("remove",function(){O.each(t.slice(0),function(e){n().close(e)})}),{windows:t,open:function(t,r){e.editorManager.setActive(e),ch.store(e);var a=n().open(t,r,o);return i(a),a},alert:function(e,t,a){var s=n().alert(e,r(a||this,t),o);i(s)},confirm:function(e,t,a){var s=n().confirm(e,r(a||this,t),o);i(s)},close:function(){a().each(function(e){n().close(e),o(e)})},getParams:function(){return a().map(n().getParams).getOr(null)},setParams:function(e){a().each(function(t){n().setParams(t,e)})},getWindows:function(){return t}}}var im=io.PluginManager,om=function(e,t){var n=function(e,t){for(var n in im.urls)if(im.urls[n]+"/plugin"+t+".js"===e)return n;return null}(t,e.suffix);return n?"Failed to load plugin: "+n+" from url "+t:"Failed to load plugin url: "+t},am=function(e,t){e.notificationManager.open({type:"error",text:t})},sm=function(e,t){e._skinLoaded?am(e,t):e.on("SkinLoaded",function(){am(e,t)})},um={pluginLoadError:function(e,t){sm(e,om(e,t))},uploadError:function(e,t){sm(e,"Failed to upload image: "+t)},displayError:sm,initError:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=window.console;r&&(r.error?r.error.apply(r,arguments):r.log.apply(r,arguments))}},lm=io.PluginManager,cm=io.ThemeManager;function dm(){return new(M.getOrDie("XMLHttpRequest"))}function fm(e,t){var n={},r=function(e,n,r,i){var o,a;(o=new dm).open("POST",t.url),o.withCredentials=t.credentials,o.upload.onprogress=function(e){i(e.loaded/e.total*100)},o.onerror=function(){r("Image upload failed due to a XHR Transport error. Code: "+o.status)},o.onload=function(){var e,i,a;o.status<200||o.status>=300?r("HTTP Error: "+o.status):(e=JSON.parse(o.responseText))&&"string"==typeof e.location?n((i=t.basePath,a=e.location,i?i.replace(/\/$/,"")+"/"+a.replace(/^\//,""):a)):r("Invalid JSON: "+o.responseText)},(a=new FormData).append("file",e.blob(),e.filename()),o.send(a)},i=function(e,t){return{url:t,blobInfo:e,status:!0}},o=function(e,t){return{url:"",blobInfo:e,status:!1,error:t}},a=function(e,t){Dt.each(n[e],function(e){e(t)}),delete n[e]},s=function(r,s){return r=Dt.grep(r,function(t){return!e.isUploaded(t.blobUri())}),ce.all(Dt.map(r,function(r){return e.isPending(r.blobUri())?function(e){var t=e.blobUri();return new ce(function(e){n[t]=n[t]||[],n[t].push(e)})}(r):function(t,n,r){return e.markPending(t.blobUri()),new ce(function(s){var u;try{var l=function(){u&&u.close()};n(t,function(n){l(),e.markUploaded(t.blobUri(),n),a(t.blobUri(),i(t,n)),s(i(t,n))},function(n){l(),e.removeFailed(t.blobUri()),a(t.blobUri(),o(t,n)),s(o(t,n))},function(e){e<0||e>100||(u||(u=r()),u.progressBar.value(e))})}catch(e){s(o(t,e.message))}})}(r,t.handler,s)}))};return t=Dt.extend({credentials:!1,handler:r},t),{upload:function(e,n){return t.url||t.handler!==r?s(e,n):new ce(function(e){e([])})}}}function hm(e,t){return new(M.getOrDie("Blob"))(e,t)}var mm=function(e){return M.getOrDie("atob")(e)},pm=function(e){var t,n;return e=decodeURIComponent(e).split(","),(n=/data:([^;]+)/.exec(e[0]))&&(t=n[1]),{type:t,data:e[1]}},gm=function(e){return new ce(function(t){var n,r,i;e=pm(e);try{n=mm(e.data)}catch(e){return void t(new hm([]))}for(r=new function(e){return new(M.getOrDie("Uint8Array"))(e)}(n.length),i=0;i<r.length;i++)r[i]=n.charCodeAt(i);t(new hm([r],{type:e.type}))})},vm=function(e){return 0===e.indexOf("blob:")?function(e){return new ce(function(t,n){var r=function(){n("Cannot convert "+e+" to Blob. Resource might not exist or is inaccessible.")};try{var i=new dm;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){200===this.status?t(this.response):r()},i.onerror=r,i.send()}catch(e){r()}})}(e):0===e.indexOf("data:")?gm(e):null},bm=function(e){return new ce(function(t){var n=new function(){return new(M.getOrDie("FileReader"))};n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})},ym=pm,Cm=0,wm=function(e){return(e||"blobid")+Cm++},Em=function(e,t,n,r){var i,o;0!==t.src.indexOf("blob:")?(i=ym(t.src).data,(o=e.findFirst(function(e){return e.base64()===i}))?n({image:t,blobInfo:o}):vm(t.src).then(function(r){o=e.create(wm(),r,i),e.add(o),n({image:t,blobInfo:o})},function(e){r(e)})):(o=e.getByUri(t.src))?n({image:t,blobInfo:o}):vm(t.src).then(function(r){bm(r).then(function(a){i=ym(a).data,o=e.create(wm(),r,i),e.add(o),n({image:t,blobInfo:o})})},function(e){r(e)})},xm=function(e){return e?e.getElementsByTagName("img"):[]},Nm=0,Sm={uuid:function(e){return e+Nm+++(t=function(){return Math.round(4294967295*Math.random()).toString(36)},"s"+(new Date).getTime().toString(36)+t()+t()+t());var t}};function km(e){var t,n,r,i,o,a,s,u,l,c,d=(t=[],n=jo.constant,r=function(e){var t,r,i;if(!e.blob||!e.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");return t=e.id||Sm.uuid("blobid"),r=e.name||t,{id:n(t),name:n(r),filename:n(r+"."+(i=e.blob.type,{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"}[i.toLowerCase()]||"dat")),blob:n(e.blob),base64:n(e.base64),blobUri:n(e.blobUri||q.createObjectURL(e.blob)),uri:n(e.uri)}},{create:function(e,t,n,i){return r("object"==typeof e?e:{id:e,name:i,blob:t,base64:n})},add:function(e){i(e.id())||t.push(e)},get:i=function(e){return o(function(t){return t.id()===e})},getByUri:function(e){return o(function(t){return t.blobUri()===e})},findFirst:o=function(e){return Nt.filter(t,e)[0]},removeByUri:function(e){t=Nt.filter(t,function(t){return t.blobUri()!==e||(q.revokeObjectURL(t.blobUri()),!1)})},destroy:function(){Nt.each(t,function(e){q.revokeObjectURL(e.blobUri())}),t=[]}}),f=e.settings,h=(u={},l=function(e,t){return{status:e,resultUri:t}},{hasBlobUri:c=function(e){return e in u},getResultUri:function(e){var t=u[e];return t?t.resultUri:null},isPending:function(e){return!!c(e)&&1===u[e].status},isUploaded:function(e){return!!c(e)&&2===u[e].status},markPending:function(e){u[e]=l(1,null)},markUploaded:function(e,t){u[e]=l(2,t)},removeFailed:function(e){delete u[e]},destroy:function(){u={}}}),m=function(t){return function(n){return e.selection?t(n):[]}},p=function(e,t,n){var r=0;do{-1!==(r=e.indexOf(t,r))&&(e=e.substring(0,r)+n+e.substr(r+t.length),r+=n.length-t.length+1)}while(-1!==r);return e},g=function(e,t,n){return e=p(e,'src="'+t+'"','src="'+n+'"'),e=p(e,'data-mce-src="'+t+'"','data-mce-src="'+n+'"')},v=function(t,n){Nt.each(e.undoManager.data,function(e){"fragmented"===e.type?e.fragments=Nt.map(e.fragments,function(e){return g(e,t,n)}):e.content=g(e.content,t,n)})},b=function(){return e.notificationManager.open({text:e.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})},y=function(t,n){d.removeByUri(t.src),v(t.src,n),e.$(t).attr({src:f.images_reuse_filename?n+"?"+(new Date).getTime():n,"data-mce-src":e.convertURL(n,"src")})},C=function(t){return a||(a=fm(h,{url:f.images_upload_url,basePath:f.images_upload_base_path,credentials:f.images_upload_credentials,handler:f.images_upload_handler})),x().then(m(function(n){var r;return r=Nt.map(n,function(e){return e.blobInfo}),a.upload(r,b).then(m(function(r){var i=Nt.map(r,function(t,r){var i=n[r].image;return t.status&&!1!==e.settings.images_replace_blob_uris?y(i,t.url):t.error&&um.uploadError(e,t.error),{element:i,status:t.status}});return t&&t(i),i}))}))},w=function(e){if(!1!==f.automatic_uploads)return C(e)},E=function(e){return!f.images_dataimg_filter||f.images_dataimg_filter(e)},x=function(){return s||(s=function(e,t){var n={};return{findAll:function(r,i){var o;i||(i=jo.constant(!0)),o=Nt.filter(xm(r),function(t){var n=t.src;return!!le.fileApi&&!t.hasAttribute("data-mce-bogus")&&!t.hasAttribute("data-mce-placeholder")&&!(!n||n===le.transparentSrc)&&(0===n.indexOf("blob:")?!e.isUploaded(n):0===n.indexOf("data:")&&i(t))});var a=Nt.map(o,function(e){if(n[e.src])return new ce(function(t){n[e.src].then(function(n){if("string"==typeof n)return n;t({image:e,blobInfo:n.blobInfo})})});var r=new ce(function(n,r){Em(t,e,n,r)}).then(function(e){return delete n[e.image.src],e}).catch(function(t){return delete n[e.src],t});return n[e.src]=r,r});return ce.all(a)}}}(h,d)),s.findAll(e.getBody(),E).then(m(function(t){return t=Nt.filter(t,function(t){return"string"!=typeof t||(um.displayError(e,t),!1)}),Nt.each(t,function(e){v(e.image.src,e.blobInfo.blobUri()),e.image.src=e.blobInfo.blobUri(),e.image.removeAttribute("data-mce-src")}),t}))},N=function(t){return t.replace(/src="(blob:[^"]+)"/g,function(t,n){var r=h.getResultUri(n);if(r)return'src="'+r+'"';var i=d.getByUri(n);return i||(i=Nt.reduce(e.editorManager.get(),function(e,t){return e||t.editorUpload&&t.editorUpload.blobCache.getByUri(n)},null)),i?'src="data:'+i.blob().type+";base64,"+i.base64()+'"':t})};return e.on("setContent",function(){!1!==e.settings.automatic_uploads?w():x()}),e.on("RawSaveContent",function(e){e.content=N(e.content)}),e.on("getContent",function(e){e.source_view||"raw"===e.format||(e.content=N(e.content))}),e.on("PostRender",function(){e.parser.addNodeFilter("img",function(e){Nt.each(e,function(e){var t=e.attr("src");if(!d.getByUri(t)){var n=h.getResultUri(t);n&&e.attr("src",n)}})})}),{blobCache:d,uploadImages:C,uploadImagesAuto:w,scanForImages:x,destroy:function(){d.destroy(),h.destroy(),s=a=null}}}var Tm=function(e,t){return e.hasOwnProperty(t.nodeName)},Am=function(e,t){return!!pi.isText(t)||!!pi.isElement(t)&&!Tm(e,t)&&!Tu.isBookmarkNode(t)},Dm=function(e,t){if(pi.isText(t)){if(0===t.nodeValue.length)return!0;if(/^\s+$/.test(t.nodeValue)&&(!t.nextSibling||Tm(e,t.nextSibling)))return!0}return!1},Bm=function(e){var t,n,r,i,o,a,s,u,l,c,d,f=e.settings,h=e.dom,m=e.selection,p=e.schema,g=p.getBlockElements(),v=m.getStart(),b=e.getBody();if(d=f.forced_root_block,v&&pi.isElement(v)&&d&&(c=b.nodeName.toLowerCase(),p.isValidChild(c,d.toLowerCase())&&!function(e,t,n){return O.exists(Fl(Dn.fromDom(n),Dn.fromDom(t)),function(t){return Tm(e,t.dom())})}(g,b,v))){for(n=(t=m.getRng()).startContainer,r=t.startOffset,i=t.endContainer,o=t.endOffset,l=Xh(e),v=b.firstChild;v;)if(Am(g,v)){if(Dm(g,v)){s=v,v=v.nextSibling,h.remove(s);continue}a||(a=h.create(d,e.settings.forced_root_block_attrs),v.parentNode.insertBefore(a,v),u=!0),s=v,v=v.nextSibling,a.appendChild(s)}else a=null,v=v.nextSibling;u&&l&&(t.setStart(n,r),t.setEnd(i,o),m.setRng(t),e.nodeChanged())}},Rm=function(e){e.settings.forced_root_block&&e.on("NodeChange",p.curry(Bm,e))};function _m(e){var t,n=[];"onselectionchange"in e.getDoc()||e.on("NodeChange Click MouseUp KeyUp Focus",function(n){var r,i;i={startContainer:(r=e.selection.getRng()).startContainer,startOffset:r.startOffset,endContainer:r.endContainer,endOffset:r.endOffset},"nodechange"!==n.type&&kf.isEq(i,t)||e.fire("SelectionChange"),t=i}),e.on("contextmenu",function(){e.fire("SelectionChange")}),e.on("SelectionChange",function(){var t=e.selection.getStart(!0);!t||!le.range&&e.selection.isCollapsed()||!function(t){var r,i;if((i=e.$(t).parentsUntil(e.getBody()).add(t)).length===n.length){for(r=i.length;r>=0&&i[r]===n[r];r--);if(-1===r)return n=i,!0}return n=i,!1}(t)&&e.dom.isChildOf(t,e.getBody())&&e.nodeChanged({selectionChange:!0})}),e.on("MouseUp",function(t){t.isDefaultPrevented()||("IMG"===e.selection.getNode().nodeName?me.setEditorTimeout(e,function(){e.nodeChanged()}):e.nodeChanged())}),this.nodeChanged=function(t){var n,r,i,o=e.selection;e.initialized&&o&&!e.settings.disable_nodechange&&!e.readonly&&(i=e.getBody(),(n=o.getStart(!0)||i).ownerDocument===e.getDoc()&&e.dom.isChildOf(n,i)||(n=i),r=[],e.dom.getParent(n,function(e){if(e===i)return!0;r.push(e)}),(t=t||{}).element=n,t.parents=r,e.fire("NodeChange",t))}}var Lm,Om=function(e){var t,n,r,i;return i=e.getBoundingClientRect(),n=(t=e.ownerDocument).documentElement,r=t.defaultView,{top:i.top+r.pageYOffset-n.clientTop,left:i.left+r.pageXOffset-n.clientLeft}},Pm=function(e,t){return n=function(e){return e.inline?Om(e.getBody()):{left:0,top:0}}(e),r=function(e){var t=e.getBody();return e.inline?{left:t.scrollLeft,top:t.scrollTop}:{left:0,top:0}}(e),{pageX:(i=function(e,t){if(t.target.ownerDocument!==e.getDoc()){var n=Om(e.getContentAreaContainer()),r=function(e){var t=e.getBody(),n=e.getDoc().documentElement,r={left:t.scrollLeft,top:t.scrollTop},i={left:t.scrollLeft||n.scrollLeft,top:t.scrollTop||n.scrollTop};return e.inline?r:i}(e);return{left:t.pageX-n.left+r.left,top:t.pageY-n.top+r.top}}return{left:t.pageX,top:t.pageY}}(e,t)).left-n.left+r.left,pageY:i.top-n.top+r.top};var n,r,i},Im=pi.isContentEditableFalse,Fm=pi.isContentEditableTrue,Mm=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},Hm=function(e,t){return function(n){if(function(e){return 0===e.button}(n)){var r=Nt.find(t.dom.getParents(n.target),jo.or(Im,Fm));if(s=t.getBody(),Im(u=r)&&u!==s){var i=t.dom.getPos(r),o=t.getBody(),a=t.getDoc().documentElement;e.element=r,e.screenX=n.screenX,e.screenY=n.screenY,e.maxX=(t.inline?o.scrollWidth:a.offsetWidth)-2,e.maxY=(t.inline?o.scrollHeight:a.offsetHeight)-2,e.relX=n.pageX-i.x,e.relY=n.pageY-i.y,e.width=r.offsetWidth,e.height=r.offsetHeight,e.ghost=function(e,t,n,r){var i=t.cloneNode(!0);e.dom.setStyles(i,{width:n,height:r}),e.dom.setAttrib(i,"data-mce-selected",null);var o=e.dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return e.dom.setStyles(o,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:n,height:r}),e.dom.setStyles(i,{margin:0,boxSizing:"border-box"}),o.appendChild(i),o}(t,r,e.width,e.height)}}var s,u}},qm=function(e,t){return function(n){if(e.dragging&&function(e,t,n){return t!==n&&!e.dom.isChildOf(t,n)&&!Im(t)}(t,(s=t.selection,3===(u=s.getSel().getRangeAt(0).startContainer).nodeType?u.parentNode:u),e.element)){var r=(o=e.element,(a=o.cloneNode(!0)).removeAttribute("data-mce-selected"),a),i=t.fire("drop",{targetClone:r,clientX:n.clientX,clientY:n.clientY});i.isDefaultPrevented()||(r=i.targetClone,t.undoManager.transact(function(){Mm(e.element),t.insertContent(t.dom.getOuterHTML(r)),t._selectionOverrides.hideFakeCaret()}))}var o,a,s,u;zm(e)}},zm=function(e){e.dragging=!1,e.element=null,Mm(e.ghost)},Um=function(e){var t,n,r,i,o,a,s={};t=Zi.DOM,a=document,n=Hm(s,e),r=function(e,t){var n=me.throttle(function(e,n){t._selectionOverrides.hideFakeCaret(),t.selection.placeCaretAt(e,n)},0);return function(r){var i,o,a=Math.max(Math.abs(r.screenX-e.screenX),Math.abs(r.screenY-e.screenY));if(function(e){return e.element}(e)&&!e.dragging&&a>10){if(t.fire("dragstart",{target:e.element}).isDefaultPrevented())return;e.dragging=!0,t.focus()}if(e.dragging){var s=function(e,t){return{pageX:t.pageX-e.relX,pageY:t.pageY+5}}(e,Pm(t,r));i=e.ghost,o=t.getBody(),i.parentNode!==o&&o.appendChild(i),function(e,t,n,r,i,o){var a=0,s=0;e.style.left=t.pageX+"px",e.style.top=t.pageY+"px",t.pageX+n>i&&(a=t.pageX+n-i),t.pageY+r>o&&(s=t.pageY+r-o),e.style.width=n-a+"px",e.style.height=r-s+"px"}(e.ghost,s,e.width,e.height,e.maxX,e.maxY),n(r.clientX,r.clientY)}}}(s,e),i=qm(s,e),o=function(e,t){return function(){zm(e),e.dragging&&t.fire("dragend")}}(s,e),e.on("mousedown",n),e.on("mousemove",r),e.on("mouseup",i),t.bind(a,"mousemove",r),t.bind(a,"mouseup",o),e.on("remove",function(){t.unbind(a,"mousemove",r),t.unbind(a,"mouseup",o)})},jm=function(e){Um(e),function(e){e.on("drop",function(t){var n=void 0!==t.clientX?e.getDoc().elementFromPoint(t.clientX,t.clientY):null;(Im(n)||Im(e.dom.getContentEditableParent(n)))&&t.preventDefault()})}(e)},Vm=function(e){return Nt.reduce(e,function(e,t){return e.concat(function(e){var t=function(t){return Nt.map(t,function(t){return(t=_o(t)).node=e,t})};if(pi.isElement(e))return t(e.getClientRects());if(pi.isText(e)){var n=e.ownerDocument.createRange();return n.setStart(e,0),n.setEnd(e,e.data.length),t(n.getClientRects())}}(t))},[])};!function(e){e[e.Up=-1]="Up",e[e.Down=1]="Down"}(Lm||(Lm={}));var $m=function(e,t,n,r,i,o){var a,s,u=0,l=[],c=function(r){var o,a,c;for(c=Vm([r]),-1===e&&(c=c.reverse()),o=0;o<c.length;o++)if(a=c[o],!n(a,s)){if(l.length>0&&t(a,Nt.last(l))&&u++,a.line=u,i(a))return!0;l.push(a)}};return(s=Nt.last(o.getClientRects()))?(c(a=o.getNode()),function(e,t,n,r){for(;r=ws(r,e,Bo,t);)if(n(r))return}(e,r,c,a),l):l},Wm=p.curry($m,Lm.Up,Po,Io),Km=p.curry($m,Lm.Down,Io,Po),Xm=function(e){return function(t){return function(e,t){return t.line>e}(e,t)}},Ym=function(e){return function(t){return function(e,t){return t.line===e}(e,t)}},Gm=pi.isContentEditableFalse,Zm=ws,Qm=function(e,t){return Math.abs(e.left-t)},Jm=function(e,t){return Math.abs(e.right-t)},ep=function(e,t){return e>=t.left&&e<=t.right},tp=function(e,t){return Nt.reduce(e,function(e,n){var r,i;return r=Math.min(Qm(e,t),Jm(e,t)),i=Math.min(Qm(n,t),Jm(n,t)),ep(t,n)?n:ep(t,e)?e:i===r&&Gm(n.node)?n:i<r?n:e})},np=function(e,t,n,r){for(;r=Zm(r,e,Bo,t);)if(n(r))return},rp=function(e,t,n){var r,i=Vm(function(e){return Nt.filter(Nt.toArray(e.getElementsByTagName("*")),cs)}(e)),o=Nt.filter(i,function(e){return n>=e.top&&n<=e.bottom});return(r=tp(o,t))&&(r=tp(function(e,t){var n=[],r=function(e,r){var i;return i=Nt.filter(Vm([r]),function(n){return!e(n,t)}),n=n.concat(i),0===i.length};return n.push(t),np(Lm.Up,e,p.curry(r,Po),t.node),np(Lm.Down,e,p.curry(r,Io),t.node),n}(e,r),t))&&cs(r.node)?function(e,t){return{node:e.node,before:Qm(e,t)<Jm(e,t)}}(r,t):null},ip=function(e,t,n){return!n.collapsed&&O.foldl(n.getClientRects(),function(n,r){return n||function(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom}(r,e,t)},!1)},op=function(e,t){var n=null;return{cancel:function(){null!==n&&(clearTimeout(n),n=null)},throttle:function(){var r=arguments;null===n&&(n=setTimeout(function(){e.apply(null,r),n=null,r=null},t))}}},ap=function(e){var t=op(function(){if(!e.removed&&e.selection.getRng().collapsed){var t=La(e,e.selection.getRng(),!1);e.selection.setRng(t)}},0);e.on("focus",function(){t.throttle()}),e.on("blur",function(){t.cancel()})},sp={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return le.mac?e.metaKey:e.ctrlKey&&!e.altKey}},up=pi.isContentEditableTrue,lp=pi.isContentEditableFalse,cp=Is,dp=Ps,fp=function(e){var t,n,r=e.getBody(),i=ls(e.getBody(),function(t){return e.dom.isBlock(t)},function(){return Xh(e)}),o="sel-"+e.dom.uniqueId(),a=function(t){t&&e.selection.setRng(t)},s=function(){return e.selection.getRng()},u=function(t,n,r,o){return void 0===o&&(o=!0),e.fire("ShowCaret",{target:n,direction:t,before:r}).isDefaultPrevented()?null:(o&&e.selection.scrollIntoView(n,-1===t),i.show(r,n))},l=function(e,t){return t=Bs(e,r,t),-1===e?ca.fromRangeStart(t):ca.fromRangeEnd(t)},c=function(e){return ho(e)||bo(e)||yo(e)},d=function(e){return c(e.startContainer)||c(e.endContainer)},f=function(n,r){var i,a,s,c,f,h,p,g,v,b,y=e.$,C=e.dom;if(!n)return null;if(n.collapsed){if(!d(n))if(!1===r){if(g=l(-1,n),cs(g.getNode(!0)))return u(-1,g.getNode(!0),!1,!1);if(cs(g.getNode()))return u(-1,g.getNode(),!g.isAtEnd(),!1)}else{if(g=l(1,n),cs(g.getNode()))return u(1,g.getNode(),!g.isAtEnd(),!1);if(cs(g.getNode(!0)))return u(1,g.getNode(!0),!1,!1)}return null}return c=n.startContainer,f=n.startOffset,h=n.endOffset,3===c.nodeType&&0===f&&lp(c.parentNode)&&(c=c.parentNode,f=C.nodeIndex(c),c=c.parentNode),1!==c.nodeType?null:(h===f+1&&(i=c.childNodes[f]),lp(i)?(v=b=i.cloneNode(!0),(p=e.fire("ObjectSelected",{target:i,targetClone:v})).isDefaultPrevented()?null:(a=wl(Dn.fromDom(e.getBody()),"#"+o).fold(function(){return y([])},function(e){return y([e.dom()])}),v=p.targetClone,0===a.length&&(a=y('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",o)).appendTo(e.getBody()),n=e.dom.createRng(),v===b&&le.ie?(a.empty().append('<p style="font-size: 0" data-mce-bogus="all"></p>').append(v),n.setStartAfter(a[0].firstChild.firstChild),n.setEndAfter(v)):(a.empty().append("").append(v).append(""),n.setStart(a[0].firstChild,1),n.setEnd(a[0].lastChild,0)),a.css({top:C.getPos(i,e.getBody()).y}),a[0].focus(),(s=e.selection.getSel()).removeAllRanges(),s.addRange(n),O.each(Ka(Dn.fromDom(e.getBody()),"*[data-mce-selected]"),function(e){Jn.remove(e,"data-mce-selected")}),i.setAttribute("data-mce-selected","1"),t=i,m(),n)):null)},h=function(){t&&(t.removeAttribute("data-mce-selected"),wl(Dn.fromDom(e.getBody()),"#"+o).each(Iu.remove),t=null)},m=function(){i.hide()};return le.ceFalse&&(function(){var n=function(t){for(var n=e.getBody();t&&t!==n;){if(up(t)||lp(t))return t;t=t.parentNode}return null};e.on("mouseup",function(t){var n=s();n.collapsed&&tm.isXYInContentArea(e,t.clientX,t.clientY)&&a(_a(e,n,!1))}),e.on("click",function(t){var r;(r=n(t.target))&&(lp(r)&&(t.preventDefault(),e.focus()),up(r)&&e.dom.isChildOf(r,e.selection.getNode())&&h())}),e.on("blur NewBlock",function(){h()});var i=function(t,n){var r,i,o=e.dom.getParent(t,e.dom.isBlock),a=e.dom.getParent(n,e.dom.isBlock);return o&&(r=o,i=a,!(e.dom.getParent(r,e.dom.isBlock)===e.dom.getParent(i,e.dom.isBlock)))&&function(e){var t=Ys(e);if(!e.firstChild)return!1;var n=ca.before(e.firstChild),r=t.next(n);return r&&!dp(r)&&!cp(r)}(o)};!function(e){var t=!1;e.on("touchstart",function(){t=!1}),e.on("touchmove",function(){t=!0}),e.on("touchend",function(r){var i=n(r.target);lp(i)&&(t||(r.preventDefault(),f(Ra(e,i))))})}(e),e.on("mousedown",function(t){var o,s=t.target;if((s===r||"HTML"===s.nodeName||e.dom.isChildOf(s,r))&&!1!==tm.isXYInContentArea(e,t.clientX,t.clientY))if(o=n(s))lp(o)?(t.preventDefault(),f(Ra(e,o))):(h(),up(o)&&t.shiftKey||ip(t.clientX,t.clientY,e.selection.getRng())||e.selection.placeCaretAt(t.clientX,t.clientY));else if(!1===cs(s)){h(),m();var l=rp(r,t.clientX,t.clientY);if(l&&!i(t.target,l.node)){t.preventDefault();var c=u(1,l.node,l.before,!1);e.getBody().focus(),a(c)}}}),e.on("keypress",function(t){sp.modifierPressed(t)||(t.keyCode,lp(e.selection.getNode())&&t.preventDefault())}),e.on("getSelectionRange",function(e){var n=e.range;if(t){if(!t.parentNode)return void(t=null);(n=n.cloneRange()).selectNode(t),e.range=n}}),e.on("setSelectionRange",function(e){var t;(t=f(e.range,e.forward))&&(e.range=t)}),e.on("AfterSetSelectionRange",function(t){var n,r=t.range;d(r)||m(),n=r.startContainer.parentNode,e.dom.hasClass(n,"mce-offscreen-selection")||h()}),e.on("copy",function(t){var n,r=t.clipboardData;if(!t.isDefaultPrevented()&&t.clipboardData&&!le.ie){var i=(n=e.dom.get(o))?n.getElementsByTagName("*")[0]:n;i&&(t.preventDefault(),r.clearData(),r.setData("text/html",i.outerHTML),r.setData("text/plain",i.outerText))}}),jm(e),ap(e)}(),(n=e.contentStyles).push(i.getCss()),n.push(".mce-content-body .mce-offscreen-selection {position: absolute;left: -9999999999px;max-width: 1000000px;}.mce-content-body *[contentEditable=false] {cursor: default;}.mce-content-body *[contentEditable=true] {cursor: text;}")),{showCaret:u,showBlockCaretContainer:function(t){t.hasAttribute("data-mce-caret")&&(Co(t),a(s()),e.selection.scrollIntoView(t[0]))},hideFakeCaret:m,destroy:function(){i.destroy(),t=null}}},hp=Dt.each,mp=function(e){return 0===e.indexOf("data-")||0===e.indexOf("aria-")},pp=function(e){return e.replace(/<!--|-->/g,"")},gp=function(e,t,n){var r,i,o,a,s=1;for(a=e.getShortEndedElements(),(o=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g).lastIndex=r=n;i=o.exec(t);){if(r=o.lastIndex,"/"===i[1])s--;else if(!i[1]){if(i[2]in a)continue;s++}if(0===s)break}return r};function vp(e,t){void 0===t&&(t=qi());var n=function(){};!1!==(e=e||{}).fix_self_closing&&(e.fix_self_closing=!0),hp("comment cdata text start end pi doctype".split(" "),function(t){t&&(self[t]=e[t]||n)});var r=e.comment?e.comment:n,i=e.cdata?e.cdata:n,o=e.text?e.text:n,a=e.start?e.start:n,s=e.end?e.end:n,u=e.pi?e.pi:n,l=e.doctype?e.doctype:n;return{parse:function(n){var c,d,f,h,m,p,g,v,b,y,C,w,E,x,N,S,k,T,A,D,B,R,_,L,O,P,I,F,M,H=0,q=[],z=0,U=Di.decode,j=Dt.makeMap("src,href,data,background,formaction,poster"),V=/((java|vb)script|mhtml):/i,$=/^data:/i,W=function(e){var t,n;for(t=q.length;t--&&q[t].name!==e;);if(t>=0){for(n=q.length-1;n>=t;n--)(e=q[n]).valid&&s(e.name);q.length=t}},K=function(t,n,r,i,o){var a,s;if(r=(n=n.toLowerCase())in C?n:U(r||i||o||""),E&&!v&&!1===mp(n)){if(!(a=T[n])&&A){for(s=A.length;s--&&!(a=A[s]).pattern.test(n););-1===s&&(a=null)}if(!a)return;if(a.validValues&&!(r in a.validValues))return}if(j[n]&&!e.allow_script_urls){var u=r.replace(/[\s\u0000-\u001F]+/g,"");try{u=decodeURIComponent(u)}catch(e){u=unescape(u)}if(V.test(u))return;if(!e.allow_html_data_urls&&$.test(u)&&!/^data:image\//i.test(u))return}v&&(n in j||0===n.indexOf("on"))||(h.map[n]=r,h.push({name:n,value:r}))};for(O=new RegExp("<(?:(?:!--([\\w\\W]*?)--\x3e)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),P=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,y=t.getShortEndedElements(),L=e.self_closing_elements||t.getSelfClosingElements(),C=t.getBoolAttrs(),E=e.validate,b=e.remove_internals,M=e.fix_self_closing,I=t.getSpecialElements(),_=n+">";c=O.exec(_);){if(H<c.index&&o(U(n.substr(H,c.index-H))),d=c[6])":"===(d=d.toLowerCase()).charAt(0)&&(d=d.substr(1)),W(d);else if(d=c[7]){if(c.index+c[0].length>n.length){o(U(n.substr(c.index))),H=c.index+c[0].length;continue}if(":"===(d=d.toLowerCase()).charAt(0)&&(d=d.substr(1)),w=d in y,M&&L[d]&&q.length>0&&q[q.length-1].name===d&&W(d),!E||(x=t.getElementRule(d))){if(N=!0,E&&(T=x.attributes,A=x.attributePatterns),(k=c[8])?((v=-1!==k.indexOf("data-mce-type"))&&b&&(N=!1),(h=[]).map={},k.replace(P,K)):(h=[]).map={},E&&!v){if(D=x.attributesRequired,B=x.attributesDefault,R=x.attributesForced,x.removeEmptyAttrs&&!h.length&&(N=!1),R)for(m=R.length;m--;)g=(S=R[m]).name,"{$uid}"===(F=S.value)&&(F="mce_"+z++),h.map[g]=F,h.push({name:g,value:F});if(B)for(m=B.length;m--;)(g=(S=B[m]).name)in h.map||("{$uid}"===(F=S.value)&&(F="mce_"+z++),h.map[g]=F,h.push({name:g,value:F}));if(D){for(m=D.length;m--&&!(D[m]in h.map););-1===m&&(N=!1)}if(S=h.map["data-mce-bogus"]){if("all"===S){H=gp(t,n,O.lastIndex),O.lastIndex=H;continue}N=!1}}N&&a(d,h,w)}else N=!1;if(f=I[d]){f.lastIndex=H=c.index+c[0].length,(c=f.exec(n))?(N&&(p=n.substr(H,c.index-H)),H=c.index+c[0].length):(p=n.substr(H),H=n.length),N&&(p.length>0&&o(p,!0),s(d)),O.lastIndex=H;continue}w||(k&&k.indexOf("/")===k.length-1?N&&s(d):q.push({name:d,valid:N}))}else(d=c[1])?(">"===d.charAt(0)&&(d=" "+d),e.allow_conditional_comments||"[if"!==d.substr(0,3).toLowerCase()||(d=" "+d),r(d)):(d=c[2])?i(pp(d)):(d=c[3])?l(d):(d=c[4])&&u(d,c[5]);H=c.index+c[0].length}for(H<n.length&&o(U(n.substr(H))),m=q.length-1;m>=0;m--)(d=q[m]).valid&&s(d.name)}}}!function(e){e.findEndTag=gp}(vp||(vp={}));var bp=vp,yp=function(e,t){var n,r,i,o,a,s=t,u=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,l=e.schema;for(s=function(e,t){var n=new RegExp(["\\s?("+e.join("|")+')="[^"]+"'].join("|"),"gi");return t.replace(n,"")}(e.getTempAttrs(),s),a=l.getShortEndedElements();o=u.exec(s);)r=u.lastIndex,i=o[0].length,n=a[o[1]]?r:bp.findEndTag(l,s,r),s=s.substring(0,r-i)+s.substring(n),u.lastIndex=r-i;return s},Cp=function(e,t){return so(yp(e,t))},wp=yp,Ep=0,xp=2,Np=1,Sp=function(e,t){var n=e.length+t.length+2,r=new Array(n),i=new Array(n),o=function(n,r,i,a,u){var l=s(n,r,i,a);if(null===l||l.start===r&&l.diag===r-a||l.end===n&&l.diag===n-i)for(var c=n,d=i;c<r||d<a;)c<r&&d<a&&e[c]===t[d]?(u.push([0,e[c]]),++c,++d):r-n>a-i?(u.push([2,e[c]]),++c):(u.push([1,t[d]]),++d);else{o(n,l.start,i,l.start-l.diag,u);for(var f=l.start;f<l.end;++f)u.push([0,e[f]]);o(l.end,r,l.end-l.diag,a,u)}},a=function(n,r,i,o){for(var a=n;a-r<o&&a<i&&e[a]===t[a-r];)++a;return function(e,t,n){return{start:e,end:t,diag:n}}(n,a,r)},s=function(n,o,s,u){var l=o-n,c=u-s;if(0===l||0===c)return null;var d,f,h,m,p,g=l-c,v=c+l,b=(v%2==0?v:v+1)/2;for(r[1+b]=n,i[1+b]=o+1,d=0;d<=b;++d){for(f=-d;f<=d;f+=2){for(h=f+b,f===-d||f!==d&&r[h-1]<r[h+1]?r[h]=r[h+1]:r[h]=r[h-1]+1,p=(m=r[h])-n+s-f;m<o&&p<u&&e[m]===t[p];)r[h]=++m,++p;if(g%2!=0&&g-d<=f&&f<=g+d&&i[h-g]<=r[h])return a(i[h-g],f+n-s,o,u)}for(f=g-d;f<=g+d;f+=2){for(h=f+b-g,f===g-d||f!==g+d&&i[h+1]<=i[h-1]?i[h]=i[h+1]-1:i[h]=i[h-1],p=(m=i[h]-1)-n+s-f;m>=n&&p>=s&&e[m]===t[p];)i[h]=m--,p--;if(g%2==0&&-d<=f&&f<=d&&i[h]<=r[h+g])return a(i[h],f+n-s,o,u)}}},u=[];return o(0,e.length,0,t.length,u),u},kp=function(e){return 1===e.nodeType?e.outerHTML:3===e.nodeType?Di.encodeRaw(e.data,!1):8===e.nodeType?"\x3c!--"+e.data+"--\x3e":""},Tp=function(e,t,n){var r=function(e){var t,n,r;for(r=document.createElement("div"),t=document.createDocumentFragment(),e&&(r.innerHTML=e);n=r.firstChild;)t.appendChild(n);return t}(t);if(e.hasChildNodes()&&n<e.childNodes.length){var i=e.childNodes[n];i.parentNode.insertBefore(r,i)}else e.appendChild(r)},Ap=function(e){return Nt.filter(Nt.map(e.childNodes,kp),function(e){return e.length>0})},Dp=function(e,t){var n=Nt.map(t.childNodes,kp);return function(e,t){var n=0;Nt.each(e,function(e){e[0]===Ep?n++:e[0]===Np?(Tp(t,e[1],n),n++):e[0]===xp&&function(e,t){if(e.hasChildNodes()&&t<e.childNodes.length){var n=e.childNodes[t];n.parentNode.removeChild(n)}}(t,n)})}(Sp(n,e),t),t},Bp=function(e){return{type:"fragmented",fragments:e,content:"",bookmark:null,beforeBookmark:null}},Rp=function(e){return{type:"complete",fragments:null,content:e,bookmark:null,beforeBookmark:null}},_p=function(e){return"fragmented"===e.type?e.fragments.join(""):e.content},Lp={createFragmentedLevel:Bp,createCompleteLevel:Rp,createFromEditor:function(e){var t,n,r;return t=Ap(e.getBody()),-1!==(n=(r=O.bind(t,function(t){var n=wp(e.serializer,t);return n.length>0?[n]:[]})).join("")).indexOf("</iframe>")?Bp(r):Rp(n)},applyToEditor:function(e,t,n){"fragmented"===t.type?Dp(t.fragments,e.getBody()):e.setContent(t.content,{format:"raw"}),e.selection.moveToBookmark(n?t.beforeBookmark:t.bookmark)},isEq:function(e,t){return!!e&&!!t&&_p(e)===_p(t)}};function Op(e){var t,n,r=this,i=0,o=[],a=0,s=function(){return 0===a},u=function(e){s()&&(r.typing=e)},l=function(t){e.setDirty(t)},c=function(e){u(!1),r.add({},e)},d=function(){r.typing&&(u(!1),r.add())};return e.on("init",function(){r.add()}),e.on("BeforeExecCommand",function(e){var t=e.command;"Undo"!==t&&"Redo"!==t&&"mceRepaint"!==t&&(d(),r.beforeChange())}),e.on("ExecCommand",function(e){var t=e.command;"Undo"!==t&&"Redo"!==t&&"mceRepaint"!==t&&c(e)}),e.on("ObjectResizeStart Cut",function(){r.beforeChange()}),e.on("SaveContent ObjectResized blur",c),e.on("DragEnd",c),e.on("KeyUp",function(t){var i=t.keyCode;t.isDefaultPrevented()||((i>=33&&i<=36||i>=37&&i<=40||45===i||t.ctrlKey)&&(c(),e.nodeChanged()),46!==i&&8!==i||e.nodeChanged(),n&&r.typing&&!1===Lp.isEq(Lp.createFromEditor(e),o[0])&&(!1===e.isDirty()&&(l(!0),e.fire("change",{level:o[0],lastLevel:null})),e.fire("TypingUndo"),n=!1,e.nodeChanged()))}),e.on("KeyDown",function(e){var t=e.keyCode;if(!e.isDefaultPrevented())if(t>=33&&t<=36||t>=37&&t<=40||45===t)r.typing&&c(e);else{var i=e.ctrlKey&&!e.altKey||e.metaKey;!(t<16||t>20)||224===t||91===t||r.typing||i||(r.beforeChange(),u(!0),r.add({},e),n=!0)}}),e.on("MouseDown",function(e){r.typing&&c(e)}),e.on("input",function(e){e.inputType&&("insertReplacementText"===e.inputType||function(e){return"insertText"===e.inputType&&null===e.data}(e))&&c(e)}),e.addShortcut("meta+z","","Undo"),e.addShortcut("meta+y,meta+shift+z","","Redo"),e.on("AddUndo Undo Redo ClearUndos",function(t){t.isDefaultPrevented()||e.nodeChanged()}),r={data:o,typing:!1,beforeChange:function(){s()&&(t=Eu.getUndoBookmark(e.selection))},add:function(n,r){var a,u,c,d=e.settings;if(c=Lp.createFromEditor(e),n=n||{},n=Dt.extend(n,c),!1===s()||e.removed)return null;if(u=o[i],e.fire("BeforeAddUndo",{level:n,lastLevel:u,originalEvent:r}).isDefaultPrevented())return null;if(u&&Lp.isEq(u,n))return null;if(o[i]&&(o[i].beforeBookmark=t),d.custom_undo_redo_levels&&o.length>d.custom_undo_redo_levels){for(a=0;a<o.length-1;a++)o[a]=o[a+1];o.length--,i=o.length}n.bookmark=Eu.getUndoBookmark(e.selection),i<o.length-1&&(o.length=i+1),o.push(n),i=o.length-1;var f={level:n,lastLevel:u,originalEvent:r};return e.fire("AddUndo",f),i>0&&(l(!0),e.fire("change",f)),n},undo:function(){var t;return r.typing&&(r.add(),r.typing=!1,u(!1)),i>0&&(t=o[--i],Lp.applyToEditor(e,t,!0),l(!0),e.fire("undo",{level:t})),t},redo:function(){var t;return i<o.length-1&&(t=o[++i],Lp.applyToEditor(e,t,!1),l(!0),e.fire("redo",{level:t})),t},clear:function(){o=[],i=0,r.typing=!1,r.data=o,e.fire("ClearUndos")},hasUndo:function(){return i>0||r.typing&&o[0]&&!Lp.isEq(Lp.createFromEditor(e),o[0])},hasRedo:function(){return i<o.length-1&&!r.typing},transact:function(e){return d(),r.beforeChange(),r.ignore(e),r.add()},ignore:function(e){try{a++,e()}finally{a--}},extra:function(t,n){var a,s;r.transact(t)&&(s=o[i].bookmark,a=o[i-1],Lp.applyToEditor(e,a,!0),r.transact(n)&&(o[i-1].beforeBookmark=s))}}}var Pp={},Ip=Nt.filter,Fp=Nt.each;!function(e,t){var n=Pp[e];n||(Pp[e]=n=[]),Pp[e].push(t)}("pre",function(e){var t,n,r=e.selection.getRng();t=pi.matchNodeNames("pre"),r.collapsed||(n=e.selection.getSelectedBlocks(),Fp(Ip(Ip(n,t),function(e){return t(e.previousSibling)&&-1!==Nt.indexOf(n,e.previousSibling)}),function(e){var t,n;t=e.previousSibling,Xt(n=e).remove(),Xt(t).append("<br><br>").append(n.childNodes)}))});var Mp=function(e,t){Fp(Pp[e],function(e){e(t)})},Hp=Dt.each,qp={walk:function(e,t,n){var r,i,o,a,s,u,l,c=t.startContainer,d=t.startOffset,f=t.endContainer,h=t.endOffset;if((l=e.select("td[data-mce-selected],th[data-mce-selected]")).length>0)Hp(l,function(e){n([e])});else{var m,p,g,v=function(e){var t;return 3===(t=e[0]).nodeType&&t===c&&d>=t.nodeValue.length&&e.splice(0,1),t=e[e.length-1],0===h&&e.length>0&&t===f&&3===t.nodeType&&e.splice(e.length-1,1),e},b=function(e,t,n){for(var r=[];e&&e!==n;e=e[t])r.push(e);return r},y=function(e,t){do{if(e.parentNode===t)return e;e=e.parentNode}while(e)},C=function(e,t,r){var i=r?"nextSibling":"previousSibling";for(s=(a=e).parentNode;a&&a!==t;a=s)s=a.parentNode,(u=b(a===e?a:a[i],i)).length&&(r||u.reverse(),n(v(u)))};if(1===c.nodeType&&c.hasChildNodes()&&(c=c.childNodes[d]),1===f.nodeType&&f.hasChildNodes()&&(p=h,g=(m=f).childNodes,--p>g.length-1?p=g.length-1:p<0&&(p=0),f=g[p]||m),c===f)return n(v([c]));for(r=e.findCommonAncestor(c,f),a=c;a;a=a.parentNode){if(a===f)return C(c,r,!0);if(a===r)break}for(a=f;a;a=a.parentNode){if(a===c)return C(f,r);if(a===r)break}i=y(c,r)||c,o=y(f,r)||f,C(c,i,!0),(u=b(i===c?i:i.nextSibling,"nextSibling",o===f?o.nextSibling:o)).length&&n(v(u)),C(f,o)}}},zp=/^(src|href|style)$/,Up=Dt.each,jp=Ac.isEq,Vp=function(e){return/^(TH|TD)$/.test(e.nodeName)},$p=function(e,t,n){var r,i,o;return r=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],pi.isElement(r)&&(o=r.childNodes.length-1,!n&&i&&i--,r=r.childNodes[i>o?o:i]),pi.isText(r)&&n&&i>=r.nodeValue.length&&(r=new Vr(r,e.getBody()).next()||r),pi.isText(r)&&!n&&0===i&&(r=new Vr(r,e.getBody()).prev()||r),r},Wp=function(e,t,n,r){var i=e.create(n,r);return t.parentNode.insertBefore(i,t),i.appendChild(t),i},Kp=function(e,t,n,r){return!(t=Ac.getNonWhiteSpaceSibling(t,n,r))||"BR"===t.nodeName||e.isBlock(t)},Xp=function(e,t,n,r,i){var o,a,s,u=e.dom;if(!function(e,t,n){return!!jp(t,n.inline)||!!jp(t,n.block)||(n.selector?pi.isElement(t)&&e.is(t,n.selector):void 0)}(u,r,t)&&!function(e,t){return t.links&&"A"===e.tagName}(r,t))return!1;if("all"!==t.remove)for(Up(t.styles,function(e,o){e=Ac.normalizeStyleValue(u,Ac.replaceVars(e,n),o),"number"==typeof o&&(o=e,i=0),(t.remove_similar||!i||jp(Ac.getStyle(u,i,o),e))&&u.setStyle(r,o,""),s=1}),s&&""===u.getAttrib(r,"style")&&(r.removeAttribute("style"),r.removeAttribute("data-mce-style")),Up(t.attributes,function(e,t){var o;if(e=Ac.replaceVars(e,n),"number"==typeof t&&(t=e,i=0),!i||jp(u.getAttrib(i,t),e)){if("class"===t&&(e=u.getAttrib(r,t))&&(o="",Up(e.split(/\s+/),function(e){/mce\-\w+/.test(e)&&(o+=(o?" ":"")+e)}),o))return void u.setAttrib(r,t,o);"class"===t&&r.removeAttribute("className"),zp.test(t)&&r.removeAttribute("data-mce-"+t),r.removeAttribute(t)}}),Up(t.classes,function(e){e=Ac.replaceVars(e,n),i&&!u.hasClass(i,e)||u.removeClass(r,e)}),a=u.getAttribs(r),o=0;o<a.length;o++){var l=a[o].nodeName;if(0!==l.indexOf("_")&&0!==l.indexOf("data-"))return!1}return"none"!==t.remove?(function(e,t,n){var r,i=t.parentNode,o=e.dom,a=e.settings.forced_root_block;n.block&&(a?i===o.getRoot()&&(n.list_block&&jp(t,n.list_block)||Up(Dt.grep(t.childNodes),function(t){Ac.isValid(e,a,t.nodeName.toLowerCase())?r?r.appendChild(t):(r=Wp(o,t,a),o.setAttribs(r,e.settings.forced_root_block_attrs)):r=0})):o.isBlock(t)&&!o.isBlock(i)&&(Kp(o,t,!1)||Kp(o,t.firstChild,!0,1)||t.insertBefore(o.create("br"),t.firstChild),Kp(o,t,!0)||Kp(o,t.lastChild,!1,1)||t.appendChild(o.create("br")))),n.selector&&n.inline&&!jp(n.inline,t)||o.remove(t,1)}(e,r,t),!0):void 0},Yp={removeFormat:Xp,remove:function(e,t,n,r,i){var o,a,s=e.formatter.get(t),u=s[0],l=!0,c=e.dom,d=e.selection,f=function(r){var o=function(e,t,n,r,i){var o;return Up(Ac.getParents(e.dom,t.parentNode).reverse(),function(t){var a;o||"_start"===t.id||"_end"===t.id||(a=Kc.matchNode(e,t,n,r,i))&&!1!==a.split&&(o=t)}),o}(e,r,t,n,i);return function(e,t,n,r,i,o,a,s){var u,l,c,d,f,h,m=e.dom;if(n){for(h=n.parentNode,u=r.parentNode;u&&u!==h;u=u.parentNode){for(l=m.clone(u,!1),f=0;f<t.length;f++)if(Xp(e,t[f],s,l,l)){l=0;break}l&&(c&&l.appendChild(c),d||(d=l),c=l)}!o||a.mixed&&m.isBlock(n)||(r=m.split(n,r)),c&&(i.parentNode.insertBefore(c,i),d.appendChild(i))}return r}(e,s,o,r,r,!0,u,n)},h=function(t){var r,i,o,a,d;if(pi.isElement(t)&&c.getContentEditable(t)&&(a=l,l="true"===c.getContentEditable(t),d=!0),r=Dt.grep(t.childNodes),l&&!d)for(i=0,o=s.length;i<o&&!Xp(e,s[i],n,t,t);i++);if(u.deep&&r.length){for(i=0,o=r.length;i<o;i++)h(r[i]);d&&(l=a)}},m=function(e){var t=c.get(e?"_start":"_end"),n=t[e?"firstChild":"lastChild"];return Tu.isBookmarkNode(n)&&(n=n[e?"firstChild":"lastChild"]),pi.isText(n)&&0===n.data.length&&(n=e?t.previousSibling||t.nextSibling:t.nextSibling||t.previousSibling),c.remove(t,!0),n},p=function(t){var n,r,i=t.commonAncestorContainer;if(t=qc(e,t,s,!0),u.split){if((n=$p(e,t,!0))!==(r=$p(e,t))){if(/^(TR|TH|TD)$/.test(n.nodeName)&&n.firstChild&&(n="TR"===n.nodeName?n.firstChild.firstChild||n:n.firstChild||n),i&&/^T(HEAD|BODY|FOOT|R)$/.test(i.nodeName)&&Vp(r)&&r.firstChild&&(r=r.firstChild||r),c.isChildOf(n,r)&&n!==r&&!c.isBlock(r)&&!Vp(n)&&!Vp(r))return n=Wp(c,n,"span",{id:"_start","data-mce-type":"bookmark"}),f(n),void(n=m(!0));n=Wp(c,n,"span",{id:"_start","data-mce-type":"bookmark"}),r=Wp(c,r,"span",{id:"_end","data-mce-type":"bookmark"}),f(n),f(r),n=m(!0),r=m()}else n=r=f(n);t.startContainer=n.parentNode?n.parentNode:n,t.startOffset=c.nodeIndex(n),t.endContainer=r.parentNode?r.parentNode:r,t.endOffset=c.nodeIndex(r)+1}qp.walk(c,t,function(t){Up(t,function(t){h(t),pi.isElement(t)&&"underline"===e.dom.getStyle(t,"text-decoration")&&t.parentNode&&"underline"===Ac.getTextDecoration(c,t.parentNode)&&Xp(e,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,t)})})};if(r)r.nodeType?((a=c.createRng()).setStartBefore(r),a.setEndAfter(r),p(a)):p(r);else if("false"!==c.getContentEditable(d.getNode()))d.isCollapsed()&&u.inline&&!c.select("td[data-mce-selected],th[data-mce-selected]").length?sd.removeCaretFormat(e,t,n,i):(o=d.getBookmark(),p(d.getRng()),d.moveToBookmark(o),u.inline&&Kc.match(e,t,n,d.getStart())&&Ac.moveStart(c,d,d.getRng()),e.nodeChanged());else{r=d.getNode();for(var g=0,v=s.length;g<v&&(!s[g].ceFalseOverride||!Xp(e,s[g],n,r,r));g++);}}},Gp=Dt.each,Zp=function(e){return e&&1===e.nodeType&&!Tu.isBookmarkNode(e)&&!sd.isCaretNode(e)&&!pi.isBogus(e)},Qp=function(e,t){var n;for(n=e;n;n=n[t]){if(3===n.nodeType&&0!==n.nodeValue.length)return e;if(1===n.nodeType&&!Tu.isBookmarkNode(n))return n}return e},Jp=function(e,t,n){var r,i,o=new Du(e);if(t&&n&&(t=Qp(t,"previousSibling"),n=Qp(n,"nextSibling"),o.compare(t,n))){for(r=t.nextSibling;r&&r!==n;)i=r,r=r.nextSibling,t.appendChild(i);return e.remove(n),Dt.each(Dt.grep(n.childNodes),function(e){t.appendChild(e)}),t}return n},eg=function(e,t,n){Gp(e.childNodes,function(e){Zp(e)&&(t(e)&&n(e),e.hasChildNodes()&&eg(e,t,n))})},tg=function(e,t){return p.curry(function(t,n){return!(!n||!Ac.getStyle(e,n,t))},t)},ng=function(e,t,n){return p.curry(function(t,n,r){e.setStyle(r,t,n),""===r.getAttribute("style")&&r.removeAttribute("style"),rg(e,r)},t,n)},rg=function(e,t){"SPAN"===t.nodeName&&0===e.getAttribs(t).length&&e.remove(t,!0)},ig=function(e,t){var n;1===t.nodeType&&t.parentNode&&1===t.parentNode.nodeType&&(n=Ac.getTextDecoration(e,t.parentNode),e.getStyle(t,"color")&&n?e.setStyle(t,"text-decoration",n):e.getStyle(t,"text-decoration")===n&&e.setStyle(t,"text-decoration",null))},og=function(e,t,n,r){Gp(t,function(t){Gp(e.dom.select(t.inline,r),function(r){Zp(r)&&Yp.removeFormat(e,t,n,r,t.exact?r:null)}),function(e,t,n){if(t.clear_child_styles){var r=t.links?"*:not(a)":"*";Gp(e.select(r,n),function(n){Zp(n)&&Gp(t.styles,function(t,r){e.setStyle(n,r,"")})})}}(e.dom,t,r)})},ag=function(e,t,n,r){(t.styles.color||t.styles.textDecoration)&&(Dt.walk(r,p.curry(ig,e),"childNodes"),ig(e,r))},sg=function(e,t,n,r){t.styles&&t.styles.backgroundColor&&eg(r,tg(e,"fontSize"),ng(e,"backgroundColor",Ac.replaceVars(t.styles.backgroundColor,n)))},ug=function(e,t,n,r){"sub"!==t.inline&&"sup"!==t.inline||(eg(r,tg(e,"fontSize"),ng(e,"fontSize","")),e.remove(e.select("sup"===t.inline?"sub":"sup",r),!0))},lg=function(e,t,n,r){r&&!1!==t.merge_siblings&&(r=Jp(e,Ac.getNonWhiteSpaceSibling(r),r),r=Jp(e,r,Ac.getNonWhiteSpaceSibling(r,!0)))},cg=function(e,t,n,r,i){Kc.matchNode(e,i.parentNode,n,r)&&Yp.removeFormat(e,t,r,i)||t.merge_with_parents&&e.dom.getParent(i.parentNode,function(o){if(Kc.matchNode(e,o,n,r))return Yp.removeFormat(e,t,r,i),!0})},dg=Dt.each,fg=function(e,t,n,r){var i,o,a=e.formatter.get(t),s=a[0],u=!r&&e.selection.isCollapsed(),l=e.dom,c=e.selection,d=function(e,t){if(t=t||s,e){if(t.onformat&&t.onformat(e,t,n,r),dg(t.styles,function(t,r){l.setStyle(e,r,Ac.replaceVars(t,n))}),t.styles){var i=l.getAttrib(e,"style");i&&e.setAttribute("data-mce-style",i)}dg(t.attributes,function(t,r){l.setAttrib(e,r,Ac.replaceVars(t,n))}),dg(t.classes,function(t){t=Ac.replaceVars(t,n),l.hasClass(e,t)||l.addClass(e,t)})}},f=function(e,t){var n=!1;return!!s.selector&&(dg(e,function(e){if(!("collapsed"in e&&e.collapsed!==u))return l.is(t,e.selector)&&!sd.isCaretNode(t)?(d(t,e),n=!0,!1):void 0}),n)},h=function(r,i,o,u){var l,c,h=[],m=!0;l=s.inline||s.block,c=r.create(l),d(c),qp.walk(r,i,function(i){var o,p=function(i){var g,v,b,y;if(y=m,g=i.nodeName.toLowerCase(),v=i.parentNode.nodeName.toLowerCase(),1===i.nodeType&&r.getContentEditable(i)&&(y=m,m="true"===r.getContentEditable(i),b=!0),Ac.isEq(g,"br"))return o=0,void(s.block&&r.remove(i));if(s.wrapper&&Kc.matchNode(e,i,t,n))o=0;else{if(m&&!b&&s.block&&!s.wrapper&&Ac.isTextBlock(e,g)&&Ac.isValid(e,v,l))return i=r.rename(i,l),d(i),h.push(i),void(o=0);if(s.selector){var C=f(a,i);if(!s.inline||C)return void(o=0)}!m||b||!Ac.isValid(e,l,g)||!Ac.isValid(e,v,l)||!u&&3===i.nodeType&&1===i.nodeValue.length&&65279===i.nodeValue.charCodeAt(0)||sd.isCaretNode(i)||s.inline&&r.isBlock(i)?(o=0,dg(Dt.grep(i.childNodes),p),b&&(m=y),o=0):(o||(o=r.clone(c,!1),i.parentNode.insertBefore(o,i),h.push(o)),o.appendChild(i))}};dg(i,p)}),!0===s.links&&dg(h,function(e){var t=function(e){"A"===e.nodeName&&d(e,s),dg(Dt.grep(e.childNodes),t)};t(e)}),dg(h,function(i){var o,u=function(e){var t=!1;return dg(e.childNodes,function(e){if(function(e){return e&&1===e.nodeType&&!Tu.isBookmarkNode(e)&&!sd.isCaretNode(e)&&!pi.isBogus(e)}(e))return t=e,!1}),t};o=function(e){var t=0;return dg(e.childNodes,function(e){Ac.isWhiteSpaceNode(e)||Tu.isBookmarkNode(e)||t++}),t}(i),!(h.length>1)&&r.isBlock(i)||0!==o?(s.inline||s.wrapper)&&(s.exact||1!==o||(i=function(e){var t,n;return(t=u(e))&&!Tu.isBookmarkNode(t)&&Kc.matchName(r,t,s)&&(n=r.clone(t,!1),d(n),r.replace(n,e,!0),r.remove(t,1)),n||e}(i)),og(e,a,n,i),cg(e,s,t,n,i),sg(r,s,n,i),ug(r,s,n,i),lg(r,s,n,i)):r.remove(i,1)})};if("false"!==l.getContentEditable(c.getNode())){if(s){if(r)r.nodeType?f(a,r)||((o=l.createRng()).setStartBefore(r),o.setEndAfter(r),h(l,qc(e,o,a),0,!0)):h(l,r,0,!0);else if(u&&s.inline&&!l.select("td[data-mce-selected],th[data-mce-selected]").length)sd.applyCaretFormat(e,t,n);else{var m=e.selection.getNode();e.settings.forced_root_block||!a[0].defaultBlock||l.getParent(m,l.isBlock)||fg(e,a[0].defaultBlock),e.selection.setRng(Wu(e.selection.getRng())),i=c.getBookmark(),h(l,qc(e,c.getRng(),a)),s.styles&&ag(l,s,n,m),c.moveToBookmark(i),Ac.moveStart(l,c,c.getRng()),e.nodeChanged()}Mp(t,e)}}else{r=c.getNode();for(var p=0,g=a.length;p<g;p++)if(a[p].ceFalseOverride&&l.is(r,a[p].selector))return void d(r,a[p])}},hg={applyFormat:fg},mg=Dt.each,pg={formatChanged:function(e,t,n,r,i){null===t.get()&&function(e,t){var n={};e.set({}),t.on("NodeChange",function(r){var i=Ac.getParents(t.dom,r.element),o={};i=Dt.grep(i,function(e){return 1===e.nodeType&&!e.getAttribute("data-mce-bogus")}),mg(e.get(),function(e,r){mg(i,function(a){return t.formatter.matchNode(a,r,{},e.similar)?(n[r]||(mg(e,function(e){e(!0,{node:a,format:r,parents:i})}),n[r]=e),o[r]=e,!1):!Kc.matchesUnInheritedFormatSelector(t,a,r)&&void 0})}),mg(n,function(e,t){o[t]||(delete n[t],mg(e,function(e){e(!1,{node:r.element,format:t,parents:i})}))})})}(t,e),function(e,t,n,r){var i=e.get();mg(t.split(","),function(e){i[e]||(i[e]=[],i[e].similar=r),i[e].push(n)}),e.set(i)}(t,n,r,i)}},gg={get:function(e){var t={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(t,n,r){Dt.each(r,function(n,r){e.setAttrib(t,r,n)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Dt.each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(e){t[e]={block:e,remove:"all"}}),t}},vg=Dt.each,bg=Zi.DOM,yg=function(e,t){var n,r,i,o=t&&t.schema||qi({}),a=function(e){var t;return r="string"==typeof e?{name:e,classes:[],attrs:{}}:e,function(e,t){t.classes.length&&bg.addClass(e,t.classes.join(" ")),bg.setAttribs(e,t.attrs)}(t=bg.create(r.name),r),t},s=function(e,t,n){var r,i,u,l=t.length>0&&t[0],c=l&&l.name;if(u=function(e,t){var n="string"!=typeof e?e.nodeName.toLowerCase():e,r=o.getElementRule(n),i=r&&r.parentsRequired;return!(!i||!i.length)&&(t&&-1!==Dt.inArray(i,t)?t:i[0])}(e,c))c===u?(i=t[0],t=t.slice(1)):i=u;else if(l)i=t[0],t=t.slice(1);else if(!n)return e;return i&&(r=a(i)).appendChild(e),n&&(r||(r=bg.create("div")).appendChild(e),Dt.each(n,function(t){var n=a(t);r.insertBefore(n,e)})),s(r,t,i&&i.siblings)};return e&&e.length?(r=e[0],n=a(r),(i=bg.create("div")).appendChild(s(n,e.slice(1),r.siblings)),i):""},Cg=function(e){var t,n={classes:[],attrs:{}};return"*"!==(e=n.selector=Dt.trim(e))&&(t=e.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function(e,t,r,i,o){switch(t){case"#":n.attrs.id=r;break;case".":n.classes.push(r);break;case":":-1!==Dt.inArray("checked disabled enabled read-only required".split(" "),r)&&(n.attrs[r]=r)}if("["===i){var a=o.match(/([\w\-]+)(?:\=\"([^\"]+))?/);a&&(n.attrs[a[1]]=a[2])}return""})),n.name=t||"div",n},wg=function(e){return e&&"string"==typeof e?(e=(e=e.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Dt.map(e.split(/(?:>|\s+(?![^\[\]]+\]))/),function(e){var t=Dt.map(e.split(/(?:~\+|~|\+)/),Cg),n=t.pop();return t.length&&(n.siblings=t),n}).reverse()):[]},Eg={getCssText:function(e,t){var n,r,i,o,a,s,u="";if(!1===(s=e.settings.preview_styles))return"";"string"!=typeof s&&(s="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow");var l=function(e){return e.replace(/%(\w+)/g,"")};if("string"==typeof t){if(!(t=e.formatter.get(t)))return;t=t[0]}return"preview"in t&&!1===(s=t.preview)?"":(n=t.block||t.inline||"span",(o=wg(t.selector)).length?(o[0].name||(o[0].name=n),n=t.selector,r=yg(o,e)):r=yg([n],e),i=bg.select(n,r)[0]||r.firstChild,vg(t.styles,function(e,t){(e=l(e))&&bg.setStyle(i,t,e)}),vg(t.attributes,function(e,t){(e=l(e))&&bg.setAttrib(i,t,e)}),vg(t.classes,function(e){e=l(e),bg.hasClass(i,e)||bg.addClass(i,e)}),e.fire("PreviewFormats"),bg.setStyles(r,{position:"absolute",left:-65535}),e.getBody().appendChild(r),a=bg.getStyle(e.getBody(),"fontSize",!0),a=/px$/.test(a)?parseInt(a,10):0,vg(s.split(" "),function(t){var n=bg.getStyle(i,t,!0);if(!("background-color"===t&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(n)&&(n=bg.getStyle(e.getBody(),t,!0),"#ffffff"===bg.toHex(n).toLowerCase())||"color"===t&&"#000000"===bg.toHex(n).toLowerCase())){if("font-size"===t&&/em|%$/.test(n)){if(0===a)return;n=(n=parseFloat(n)/(/%$/.test(n)?100:1))*a+"px"}"border"===t&&n&&(u+="padding:0 2px;"),u+=t+":"+n+";"}}),e.fire("AfterPreviewFormats"),bg.remove(r),u)},parseSelector:wg,selectorToHtml:function(e,t){return yg(wg(e),t)}},xg={toggle:function(e,t,n,r,i){var o=t.get(n);!Kc.match(e,n,r,i)||"toggle"in o[0]&&!o[0].toggle?hg.applyFormat(e,n,r,i):Yp.remove(e,n,r,i)}},Ng={setup:function(e){e.addShortcut("meta+b","","Bold"),e.addShortcut("meta+i","","Italic"),e.addShortcut("meta+u","","Underline");for(var t=1;t<=6;t++)e.addShortcut("access+"+t,"",["FormatBlock",!1,"h"+t]);e.addShortcut("access+7","",["FormatBlock",!1,"p"]),e.addShortcut("access+8","",["FormatBlock",!1,"div"]),e.addShortcut("access+9","",["FormatBlock",!1,"address"])}};function Sg(e){var t=function(e){var t={},n=function(e,r){e&&("string"!=typeof e?Dt.each(e,function(e,t){n(t,e)}):(r=r.length?r:[r],Dt.each(r,function(e){void 0===e.deep&&(e.deep=!e.selector),void 0===e.split&&(e.split=!e.selector||e.inline),void 0===e.remove&&e.selector&&!e.inline&&(e.remove="none"),e.selector&&e.inline&&(e.mixed=!0,e.block_expand=!0),"string"==typeof e.classes&&(e.classes=e.classes.split(/\s+/))}),t[e]=r))};return n(gg.get(e.dom)),n(e.settings.formats),{get:function(e){return e?t[e]:t},register:n,unregister:function(e){return e&&t[e]&&delete t[e],t}}}(e),n=Bd(null);return Ng.setup(e),sd.setup(e),{get:t.get,register:t.register,unregister:t.unregister,apply:p.curry(hg.applyFormat,e),remove:p.curry(Yp.remove,e),toggle:p.curry(xg.toggle,e,t),match:p.curry(Kc.match,e),matchAll:p.curry(Kc.matchAll,e),matchNode:p.curry(Kc.matchNode,e),canApply:p.curry(Kc.canApply,e),formatChanged:p.curry(pg.formatChanged,e,n),getCssText:p.curry(Eg.getCssText,e)}}var kg=function(e){return function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},i=0;i<t.length;i++){var o=t[i];for(var a in o)o.hasOwnProperty(a)&&(r[a]=e(r[a],o[a]))}return r}},Tg=kg(function(e,t){return Un.isObject(e)&&Un.isObject(t)?Tg(e,t):t}),Ag=kg(function(e,t){return t}),Dg={deepMerge:Tg,merge:Ag},Bg=function(e,t){return e.fire("PreProcess",t)},Rg=function(e,t){return e.fire("PostProcess",t)},_g=function(e){return e.fire("remove")},Lg={register:function(e,t,n){e.addAttributeFilter("data-mce-tabindex",function(e,t){for(var n,r=e.length;r--;)(n=e[r]).attr("tabindex",n.attributes.map["data-mce-tabindex"]),n.attr(t,null)}),e.addAttributeFilter("src,href,style",function(e,r){for(var i,o,a=e.length,s="data-mce-"+r,u=t.url_converter,l=t.url_converter_scope;a--;)void 0!==(o=(i=e[a]).attributes.map[s])?(i.attr(r,o.length>0?o:null),i.attr(s,null)):(o=i.attributes.map[r],"style"===r?o=n.serializeStyle(n.parseStyle(o),i.name):u&&(o=u.call(l,o,r,i.name)),i.attr(r,o.length>0?o:null))}),e.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)(n=(t=e[r]).attr("class"))&&(n=t.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),t.attr("class",n.length>0?n:null))}),e.addAttributeFilter("data-mce-type",function(e,t,n){for(var r,i=e.length;i--;)"bookmark"!==(r=e[i]).attributes.map["data-mce-type"]||n.cleanup||r.remove()}),e.addNodeFilter("noscript",function(e){for(var t,n=e.length;n--;)(t=e[n].firstChild)&&(t.value=Di.decode(t.value))}),e.addNodeFilter("script,style",function(e,n){for(var r,i,o,a=e.length,s=function(e){return e.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")};a--;)i=(r=e[a]).firstChild?r.firstChild.value:"","script"===n?((o=r.attr("type"))&&r.attr("type","mce-no/type"===o?null:o.replace(/^mce\-/,"")),"xhtml"===t.element_format&&i.length>0&&(r.firstChild.value="// <![CDATA[\n"+s(i)+"\n// ]]>")):"xhtml"===t.element_format&&i.length>0&&(r.firstChild.value="\x3c!--\n"+s(i)+"\n--\x3e")}),e.addNodeFilter("#comment",function(e){for(var t,n=e.length;n--;)0===(t=e[n]).value.indexOf("[CDATA[")?(t.name="#cdata",t.type=4,t.value=t.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===t.value.indexOf("mce:protected ")&&(t.name="#text",t.type=3,t.raw=!0,t.value=unescape(t.value).substr(14))}),e.addNodeFilter("xml:namespace,input",function(e,t){for(var n,r=e.length;r--;)7===(n=e[r]).type?n.remove():1===n.type&&("input"!==t||"type"in n.attributes.map||n.attr("type","text"))}),e.addAttributeFilter("data-mce-type",function(t){O.each(t,function(t){"format-caret"===t.attr("data-mce-type")&&(t.isEmpty(e.schema.getNonEmptyElements())?t.remove():t.unwrap())})}),e.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)})},trimTrailingBr:function(e){var t,n,r=function(e){return e&&"br"===e.name};r(t=e.lastChild)&&r(n=t.prev)&&(t.remove(),n.remove())}},Og={process:function(e,t,n){return function(e,t){return e&&e.hasEventListeners("PreProcess")&&!t.no_events}(e,n)?function(e,t,n){var r,i,o,a=e.dom;return t=t.cloneNode(!0),(r=document.implementation).createHTMLDocument&&(i=r.createHTMLDocument(""),Dt.each("BODY"===t.nodeName?t.childNodes:[t],function(e){i.body.appendChild(i.importNode(e,!0))}),t="BODY"!==t.nodeName?i.body.firstChild:i.body,o=a.doc,a.doc=i),Bg(e,Dg.merge(n,{node:t})),o&&(a.doc=o),t}(e,t,n):t}},Pg=function(e,t,n){e.addNodeFilter("font",function(e){O.each(e,function(e){var r=t.parse(e.attr("style")),i=e.attr("color"),o=e.attr("face"),a=e.attr("size");i&&(r.color=i),o&&(r["font-family"]=o),a&&(r["font-size"]=n[parseInt(e.attr("size"),10)-1]),e.name="span",e.attr("style",t.serialize(r)),function(e,t){O.each(t,function(t){e.attr(t,null)})}(e,["color","face","size"])})})},Ig=function(e,t){var n=Ui();t.convert_fonts_to_spans&&Pg(e,n,Dt.explode(t.font_size_legacy_values)),function(e,t){e.addNodeFilter("strike",function(e){O.each(e,function(e){var n=t.parse(e.attr("style"));n["text-decoration"]="line-through",e.name="span",e.attr("style",t.serialize(n))})})}(e,n)},Fg={register:function(e,t){t.inline_styles&&Ig(e,t)}},Mg=/^[ \t\r\n]*$/,Hg={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},qg=function(e,t,n){var r,i,o=n?"lastChild":"firstChild",a=n?"prev":"next";if(e[o])return e[o];if(e!==t){if(r=e[a])return r;for(i=e.parent;i&&i!==t;i=i.parent)if(r=i[a])return r}},zg=function(){function e(e,t){this.name=e,this.type=t,1===t&&(this.attributes=[],this.attributes.map={})}return e.create=function(t,n){var r,i;if(r=new e(t,Hg[t]||1),n)for(i in n)r.attr(i,n[i]);return r},e.prototype.replace=function(e){return e.parent&&e.remove(),this.insert(e,this),this.remove(),this},e.prototype.attr=function(e,t){var n,r;if("string"!=typeof e){for(r in e)this.attr(r,e[r]);return this}if(n=this.attributes){if(void 0!==t){if(null===t){if(e in n.map)for(delete n.map[e],r=n.length;r--;)if(n[r].name===e)return n=n.splice(r,1),this;return this}if(e in n.map){for(r=n.length;r--;)if(n[r].name===e){n[r].value=t;break}}else n.push({name:e,value:t});return n.map[e]=t,this}return n.map[e]}},e.prototype.clone=function(){var t,n,r,i,o,a=new e(this.name,this.type);if(r=this.attributes){for((o=[]).map={},t=0,n=r.length;t<n;t++)"id"!==(i=r[t]).name&&(o[o.length]={name:i.name,value:i.value},o.map[i.name]=i.value);a.attributes=o}return a.value=this.value,a.shortEnded=this.shortEnded,a},e.prototype.wrap=function(e){return this.parent.insert(e,this),e.append(this),this},e.prototype.unwrap=function(){var e,t;for(e=this.firstChild;e;)t=e.next,this.insert(e,this,!0),e=t;this.remove()},e.prototype.remove=function(){var e=this.parent,t=this.next,n=this.prev;return e&&(e.firstChild===this?(e.firstChild=t,t&&(t.prev=null)):n.next=t,e.lastChild===this?(e.lastChild=n,n&&(n.next=null)):t.prev=n,this.parent=this.next=this.prev=null),this},e.prototype.append=function(e){var t;return e.parent&&e.remove(),(t=this.lastChild)?(t.next=e,e.prev=t,this.lastChild=e):this.lastChild=this.firstChild=e,e.parent=this,e},e.prototype.insert=function(e,t,n){var r;return e.parent&&e.remove(),r=t.parent||this,n?(t===r.firstChild?r.firstChild=e:t.prev.next=e,e.prev=t.prev,e.next=t,t.prev=e):(t===r.lastChild?r.lastChild=e:t.next.prev=e,e.next=t.next,e.prev=t,t.next=e),e.parent=r,e},e.prototype.getAll=function(e){var t,n=[];for(t=this.firstChild;t;t=qg(t,this))t.name===e&&n.push(t);return n},e.prototype.empty=function(){var e,t,n;if(this.firstChild){for(e=[],n=this.firstChild;n;n=qg(n,this))e.push(n);for(t=e.length;t--;)(n=e[t]).parent=n.firstChild=n.lastChild=n.next=n.prev=null}return this.firstChild=this.lastChild=null,this},e.prototype.isEmpty=function(e,t,n){var r,i,o=this.firstChild;if(t=t||{},o)do{if(1===o.type){if(o.attributes.map["data-mce-bogus"])continue;if(e[o.name])return!1;for(r=o.attributes.length;r--;)if("name"===(i=o.attributes[r].name)||0===i.indexOf("data-mce-bookmark"))return!1}if(8===o.type)return!1;if(3===o.type&&!Mg.test(o.value))return!1;if(3===o.type&&o.parent&&t[o.parent.name]&&Mg.test(o.value))return!1;if(n&&n(o))return!1}while(o=qg(o,this));return!0},e.prototype.walk=function(e){return qg(this,null,e)},e}(),Ug=function(e,t,n,r){(e.padd_empty_with_br||t.insert)&&n[r.name]?r.empty().append(new zg("br",1)).shortEnded=!0:r.empty().append(new zg("#text",3)).value=""},jg=function(e){return Vg(e,"#text")&&""===e.firstChild.value},Vg=function(e,t){return e&&e.firstChild&&e.firstChild===e.lastChild&&e.firstChild.name===t},$g=function(e,t,n,r){return r.isEmpty(t,n,function(t){return function(e,t){var n=e.getElementRule(t.name);return n&&n.paddEmpty}(e,t)})},Wg=function(e,t){return e&&(t[e.name]||"br"===e.name)},Kg=function(e,t){var n=e.schema;t.remove_trailing_brs&&e.addNodeFilter("br",function(e,r,i){var o,a,s,u,l,c,d,f,h=e.length,m=Dt.extend({},n.getBlockElements()),p=n.getNonEmptyElements(),g=n.getNonEmptyElements();for(m.body=1,o=0;o<h;o++)if(s=(a=e[o]).parent,m[a.parent.name]&&a===s.lastChild){for(l=a.prev;l;){if("span"!==(c=l.name)||"bookmark"!==l.attr("data-mce-type")){if("br"!==c)break;if("br"===c){a=null;break}}l=l.prev}a&&(a.remove(),$g(n,p,g,s)&&(d=n.getElementRule(s.name))&&(d.removeEmpty?s.remove():d.paddEmpty&&Ug(t,i,m,s)))}else{for(u=a;s&&s.firstChild===u&&s.lastChild===u&&(u=s,!m[s.name]);)s=s.parent;u===s&&!0!==t.padd_empty_with_br&&((f=new zg("#text",3)).value="",a.replace(f))}}),e.addAttributeFilter("href",function(e){var n,r,i,o=e.length;if(!t.allow_unsafe_link_target)for(;o--;)"a"===(n=e[o]).name&&"_blank"===n.attr("target")&&n.attr("rel",(r=n.attr("rel"),i=r?Dt.trim(r):"",/\b(noopener)\b/g.test(i)?i:function(e){return e.split(" ").filter(function(e){return e.length>0}).concat(["noopener"]).sort().join(" ")}(i)))}),t.allow_html_in_named_anchor||e.addAttributeFilter("id,name",function(e){for(var t,n,r,i,o=e.length;o--;)if("a"===(i=e[o]).name&&i.firstChild&&!i.attr("href")){r=i.parent,t=i.lastChild;do{n=t.prev,r.insert(t,i),t=n}while(t)}}),t.fix_list_elements&&e.addNodeFilter("ul,ol",function(e){for(var t,n,r=e.length;r--;)if("ul"===(n=(t=e[r]).parent).name||"ol"===n.name)if(t.prev&&"li"===t.prev.name)t.prev.append(t);else{var i=new zg("li",1);i.attr("style","list-style-type: none"),t.wrap(i)}}),t.validate&&n.getValidClasses()&&e.addAttributeFilter("class",function(e){for(var t,r,i,o,a,s,u,l=e.length,c=n.getValidClasses();l--;){for(r=(t=e[l]).attr("class").split(" "),a="",i=0;i<r.length;i++)o=r[i],u=!1,(s=c["*"])&&s[o]&&(u=!0),s=c[t.name],!u&&s&&s[o]&&(u=!0),u&&(a&&(a+=" "),a+=o);a.length||(a=null),t.attr("class",a)}})},Xg=Dt.makeMap,Yg=Dt.each,Gg=Dt.explode,Zg=Dt.extend;function Qg(e,t){void 0===t&&(t=qi());var n={},r=[],i={},o={};(e=e||{}).validate=!("validate"in e)||e.validate,e.root_name=e.root_name||"body";var a=function(e){var t,a,s;a in n&&((s=i[a])?s.push(e):i[a]=[e]),t=r.length;for(;t--;)(a=r[t].name)in e.attributes.map&&((s=o[a])?s.push(e):o[a]=[e]);return e},s={schema:t,addAttributeFilter:function(e,t){Yg(Gg(e),function(e){var n;for(n=0;n<r.length;n++)if(r[n].name===e)return void r[n].callbacks.push(t);r.push({name:e,callbacks:[t]})})},getAttributeFilters:function(){return[].concat(r)},addNodeFilter:function(e,t){Yg(Gg(e),function(e){var r=n[e];r||(n[e]=r=[]),r.push(t)})},getNodeFilters:function(){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push({name:t,callbacks:n[t]});return e},filterNode:a,parse:function(s,u){var l,c,d,f,h,m,p,g,v,b,y,C=[];u=u||{},i={},o={},v=Zg(Xg("script,style,head,html,body,title,meta,param"),t.getBlockElements());var w=t.getNonEmptyElements(),E=t.children,x=e.validate,N="forced_root_block"in u?u.forced_root_block:e.forced_root_block,S=t.getWhiteSpaceElements(),k=/^[ \t\r\n]+/,T=/[ \t\r\n]+$/,A=/[ \t\r\n]+/g,D=/^[ \t\r\n]+$/,B=function(e,t){var r,o=new zg(e,t);return e in n&&((r=i[e])?r.push(o):i[e]=[o]),o},R=function(e){var n,r,i,o,a=t.getBlockElements();for(n=e.prev;n&&3===n.type;){if((i=n.value.replace(T,"")).length>0)return void(n.value=i);if(r=n.next){if(3===r.type&&r.value.length){n=n.prev;continue}if(!a[r.name]&&"script"!==r.name&&"style"!==r.name){n=n.prev;continue}}o=n.prev,n.remove(),n=o}};l=bp({validate:x,allow_script_urls:e.allow_script_urls,allow_conditional_comments:e.allow_conditional_comments,self_closing_elements:function(e){var t,n={};for(t in e)"li"!==t&&"p"!==t&&(n[t]=e[t]);return n}(t.getSelfClosingElements()),cdata:function(e){y.append(B("#cdata",4)).value=e},text:function(e,t){var n;b||(e=e.replace(A," "),Wg(y.lastChild,v)&&(e=e.replace(k,""))),0!==e.length&&((n=B("#text",3)).raw=!!t,y.append(n).value=e)},comment:function(e){y.append(B("#comment",8)).value=e},pi:function(e,t){y.append(B(e,7)).value=t,R(y)},doctype:function(e){y.append(B("#doctype",10)).value=e,R(y)},start:function(e,n,i){var a,s,u,l,c;if(u=x?t.getElementRule(e):{}){for((a=B(u.outputName||e,1)).attributes=n,a.shortEnded=i,y.append(a),(c=E[y.name])&&E[a.name]&&!c[a.name]&&C.push(a),s=r.length;s--;)(l=r[s].name)in n.map&&((p=o[l])?p.push(a):o[l]=[a]);v[e]&&R(a),i||(y=a),!b&&S[e]&&(b=!0)}},end:function(n){var r,i,o,a,s;if(i=x?t.getElementRule(n):{}){if(v[n]&&!b){if((r=y.firstChild)&&3===r.type)if((o=r.value.replace(k,"")).length>0)r.value=o,r=r.next;else for(a=r.next,r.remove(),r=a;r&&3===r.type;)o=r.value,a=r.next,(0===o.length||D.test(o))&&(r.remove(),r=a),r=a;if((r=y.lastChild)&&3===r.type)if((o=r.value.replace(T,"")).length>0)r.value=o,r=r.prev;else for(a=r.prev,r.remove(),r=a;r&&3===r.type;)o=r.value,a=r.prev,(0===o.length||D.test(o))&&(r.remove(),r=a),r=a}if(b&&S[n]&&(b=!1),i.removeEmpty&&$g(t,w,S,y)&&!y.attributes.map.name&&!y.attr("id"))return s=y.parent,v[y.name]?y.empty().remove():y.unwrap(),void(y=s);i.paddEmpty&&(jg(y)||$g(t,w,S,y))&&Ug(e,u,v,y),y=y.parent}}},t);var _=y=new zg(u.context||e.root_name,11);if(l.parse(s),x&&C.length&&(u.context?u.invalid=!0:function(e){var n,r,i,o,s,u,l,c,d,f,h,m,p,g,v,b;for(m=Xg("tr,td,th,tbody,thead,tfoot,table"),f=t.getNonEmptyElements(),h=t.getWhiteSpaceElements(),p=t.getTextBlockElements(),g=t.getSpecialElements(),n=0;n<e.length;n++)if((r=e[n]).parent&&!r.fixed)if(p[r.name]&&"li"===r.parent.name){for(v=r.next;v&&p[v.name];)v.name="li",v.fixed=!0,r.parent.insert(v,r.parent),v=v.next;r.unwrap(r)}else{for(o=[r],i=r.parent;i&&!t.isValidChild(i.name,r.name)&&!m[i.name];i=i.parent)o.push(i);if(i&&o.length>1){for(o.reverse(),s=u=a(o[0].clone()),d=0;d<o.length-1;d++){for(t.isValidChild(u.name,o[d].name)?(l=a(o[d].clone()),u.append(l)):l=u,c=o[d].firstChild;c&&c!==o[d+1];)b=c.next,l.append(c),c=b;u=l}$g(t,f,h,s)?i.insert(r,o[0],!0):(i.insert(s,o[0],!0),i.insert(r,s)),i=o[0],($g(t,f,h,i)||Vg(i,"br"))&&i.empty().remove()}else if(r.parent){if("li"===r.name){if((v=r.prev)&&("ul"===v.name||"ul"===v.name)){v.append(r);continue}if((v=r.next)&&("ul"===v.name||"ul"===v.name)){v.insert(r,v.firstChild,!0);continue}r.wrap(a(new zg("ul",1)));continue}t.isValidChild(r.parent.name,"div")&&t.isValidChild("div",r.name)?r.wrap(a(new zg("div",1))):g[r.name]?r.empty().remove():r.unwrap()}}}(C)),N&&("body"===_.name||u.isRootContent)&&function(){var n,r,i=_.firstChild,o=function(e){e&&((i=e.firstChild)&&3===i.type&&(i.value=i.value.replace(k,"")),(i=e.lastChild)&&3===i.type&&(i.value=i.value.replace(T,"")))};if(t.isValidChild(_.name,N.toLowerCase())){for(;i;)n=i.next,3===i.type||1===i.type&&"p"!==i.name&&!v[i.name]&&!i.attr("data-mce-type")?r?r.append(i):((r=B(N,1)).attr(e.forced_root_block_attrs),_.insert(r,i),r.append(i)):(o(r),r=null),i=n;o(r)}}(),!u.invalid){for(g in i){for(p=n[g],h=(c=i[g]).length;h--;)c[h].parent||c.splice(h,1);for(d=0,f=p.length;d<f;d++)p[d](c,g,u)}for(d=0,f=r.length;d<f;d++)if((p=r[d]).name in o){for(h=(c=o[p.name]).length;h--;)c[h].parent||c.splice(h,1);for(h=0,m=p.callbacks.length;h<m;h++)p.callbacks[h](c,p.name,u)}}return _}};return Kg(s,e),Fg.register(s,e),s}var Jg=function(e,t,n){-1===Dt.inArray(t,n)&&(e.addAttributeFilter(n,function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),t.push(n))},ev=function(e,t,n){var r=so(n.getInner?t.innerHTML:e.getOuterHTML(t));return n.selection?r:Dt.trim(r)},tv=function(e,t,n,r){var i=r.selection?Dg.merge({forced_root_block:!1},r):r,o=e.parse(n,i);return Lg.trimTrailingBr(o),o},nv=function(e,t,n,r,i){return function(e,t,n){return!t.no_events&&e?Rg(e,Dg.merge(t,{content:n})).content:n}(e,i,function(e,t,n){return Vu(e,t).serialize(n)}(t,n,r))};function rv(e,t){var n=function(e,t){var n,r,i,o=["data-mce-selected"];return n=t&&t.dom?t.dom:Zi.DOM,r=t&&t.schema?t.schema:qi(e),e.entity_encoding=e.entity_encoding||"named",e.remove_trailing_brs=!("remove_trailing_brs"in e)||e.remove_trailing_brs,i=Qg(e,r),Lg.register(i,e,n),{schema:r,addNodeFilter:i.addNodeFilter,addAttributeFilter:i.addAttributeFilter,serialize:function(o,a){var s=Dg.merge({format:"html"},a||{}),u=Og.process(t,o,s),l=ev(n,u,s),c=tv(i,n,l,s);return"tree"===s.format?c:nv(t,e,r,c,s)},addRules:function(e){r.addValidElements(e)},setRules:function(e){r.setValidElements(e)},addTempAttr:p.curry(Jg,i,o),getTempAttrs:function(){return o}}}(e,t);return{schema:n.schema,addNodeFilter:n.addNodeFilter,addAttributeFilter:n.addAttributeFilter,serialize:n.serialize,addRules:n.addRules,setRules:n.setRules,addTempAttr:n.addTempAttr,getTempAttrs:n.getTempAttrs}}var iv=function(e,t){t.hasAttribute("data-mce-caret")&&(Co(t),function(e){e.selection.setRng(e.selection.getRng())}(e),e.selection.scrollIntoView(t))},ov=function(e,t){var n=function(e){return wl(Dn.fromDom(e.getBody()),"*[data-mce-caret]").fold(p.constant(null),function(e){return e.dom()})}(e);if(n)return"compositionstart"===t.type?(t.preventDefault(),t.stopPropagation(),void iv(e,n)):void(mo(n)&&iv(e,n))},av=function(e){e.on("keyup compositionstart",p.curry(ov,e))};function sv(e){return{getBookmark:p.curry(Tu.getBookmark,e),moveToBookmark:p.curry(Tu.moveToBookmark,e)}}!function(e){e.isBookmarkNode=Tu.isBookmarkNode}(sv||(sv={}));var uv=sv,lv=pi.isContentEditableFalse,cv=pi.isContentEditableTrue,dv=function(e,t){var n,r,i,o,a,s,u,l,c,d,f,h,m,p,g,v,b,y=t.dom,C=Dt.each,w=t.getDoc(),E=document,x=Math.abs,N=Math.round,S=t.getBody();o={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var k=".mce-content-body";t.contentStyles.push(k+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: content-box;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+k+" .mce-resizehandle:hover {background: #000}"+k+" img[data-mce-selected],"+k+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+k+" .mce-clonedresizable {position: absolute;"+(le.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+k+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}");var T=function(e){return e&&("IMG"===e.nodeName||t.dom.is(e,"figure.image"))},A=function(e){var n=e.target;(function(e,t){return T(e.target)&&!ip(e.clientX,e.clientY,t)})(e,t.selection.getRng())&&!e.isDefaultPrevented()&&(e.preventDefault(),t.selection.select(n))},D=function(e){return t.dom.is(e,"figure.image")?e.querySelector("img"):e},B=function(e){var n=t.settings.object_resizing;return!1!==n&&!le.iOS&&("string"!=typeof n&&(n="table,img,figure.image,div"),"false"!==e.getAttribute("data-mce-resize")&&e!==t.getBody()&&br.is(Dn.fromDom(e),n))},R=function(e){var o,C,w,E;o=e.screenX-s,C=e.screenY-u,p=o*a[2]+d,g=C*a[3]+f,p=p<5?5:p,g=g<5?5:g,(T(n)&&!1!==t.settings.resize_img_proportional?!sp.modifierPressed(e):sp.modifierPressed(e)||T(n)&&a[2]*a[3]!=0)&&(x(o)>x(C)?(g=N(p*h),p=N(g/h)):(p=N(g/h),g=N(p*h))),y.setStyles(D(r),{width:p,height:g}),w=a.startPos.x+o,E=a.startPos.y+C,w=w>0?w:0,E=E>0?E:0,y.setStyles(i,{left:w,top:E,display:"block"}),i.innerHTML=p+" &times; "+g,a[2]<0&&r.clientWidth<=p&&y.setStyle(r,"left",l+(d-p)),a[3]<0&&r.clientHeight<=g&&y.setStyle(r,"top",c+(f-g)),(o=S.scrollWidth-v)+(C=S.scrollHeight-b)!=0&&y.setStyles(i,{left:w-o,top:E-C}),m||(t.fire("ObjectResizeStart",{target:n,width:d,height:f}),m=!0)},_=function(){m=!1;var e=function(e,r){r&&(n.style[e]||!t.schema.isValid(n.nodeName.toLowerCase(),e)?y.setStyle(D(n),e,r):y.setAttrib(D(n),e,r))};e("width",p),e("height",g),y.unbind(w,"mousemove",R),y.unbind(w,"mouseup",_),E!==w&&(y.unbind(E,"mousemove",R),y.unbind(E,"mouseup",_)),y.remove(r),y.remove(i),L(n),t.fire("ObjectResized",{target:n,width:p,height:g}),y.setAttrib(n,"style",y.getAttrib(n,"style")),t.nodeChanged()},L=function(e){var m,x,N,k,T;O(),F(),m=y.getPos(e,S),l=m.x,c=m.y,T=e.getBoundingClientRect(),x=T.width||T.right-T.left,N=T.height||T.bottom-T.top,n!==e&&(n=e,p=g=0),k=t.fire("ObjectSelected",{target:e}),B(e)&&!k.isDefaultPrevented()?C(o,function(e,t){var o;(o=y.get("mceResizeHandle"+t))&&y.remove(o),o=y.add(S,"div",{id:"mceResizeHandle"+t,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+t+"-resize; margin:0; padding:0"}),le.ie&&(o.contentEditable=!1),y.bind(o,"mousedown",function(t){t.stopImmediatePropagation(),t.preventDefault(),function(t){s=t.screenX,u=t.screenY,d=D(n).clientWidth,f=D(n).clientHeight,h=f/d,a=e,e.startPos={x:x*e[0]+l,y:N*e[1]+c},v=S.scrollWidth,b=S.scrollHeight,r=n.cloneNode(!0),y.addClass(r,"mce-clonedresizable"),y.setAttrib(r,"data-mce-bogus","all"),r.contentEditable=!1,r.unSelectabe=!0,y.setStyles(r,{left:l,top:c,margin:0}),r.removeAttribute("data-mce-selected"),S.appendChild(r),y.bind(w,"mousemove",R),y.bind(w,"mouseup",_),E!==w&&(y.bind(E,"mousemove",R),y.bind(E,"mouseup",_)),i=y.add(S,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},d+" &times; "+f)}(t)}),e.elm=o,y.setStyles(o,{left:x*e[0]+l-o.offsetWidth/2,top:N*e[1]+c-o.offsetHeight/2})}):O(),n.setAttribute("data-mce-selected","1")},O=function(){var e,t;for(e in F(),n&&n.removeAttribute("data-mce-selected"),o)(t=y.get("mceResizeHandle"+e))&&(y.unbind(t),y.remove(t))},P=function(n){var r,i=function(e,t){if(e)do{if(e===t)return!0}while(e=e.parentNode)};m||t.removed||(C(y.select("img[data-mce-selected],hr[data-mce-selected]"),function(e){e.removeAttribute("data-mce-selected")}),r="mousedown"===n.type?n.target:e.getNode(),i(r=y.$(r).closest("table,img,figure.image,hr")[0],S)&&(M(),i(e.getStart(!0),r)&&i(e.getEnd(!0),r))?L(r):O())},I=function(e){return lv(function(e,t){for(;t&&t!==e;){if(cv(t)||lv(t))return t;t=t.parentNode}return null}(t.getBody(),e))},F=function(){for(var e in o){var t=o[e];t.elm&&(y.unbind(t.elm),delete t.elm)}},M=function(){try{t.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(e){}};return t.on("init",function(){M(),le.ie&&le.ie>=11&&(t.on("mousedown click",function(e){var n=e.target,r=n.nodeName;m||!/^(TABLE|IMG|HR)$/.test(r)||I(n)||(2!==e.button&&t.selection.select(n,"TABLE"===r),"mousedown"===e.type&&t.nodeChanged())}),t.dom.bind(S,"mscontrolselect",function(e){var n=function(e){me.setEditorTimeout(t,function(){t.selection.select(e)})};if(I(e.target))return e.preventDefault(),void n(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&n(e.target))}));var e=me.throttle(function(e){t.composing||P(e)});t.on("nodechange ResizeEditor ResizeWindow drop FullscreenStateChanged",e),t.on("keyup compositionend",function(t){n&&"TABLE"===n.nodeName&&e(t)}),t.on("hide blur",O),t.on("contextmenu",A)}),t.on("remove",F),{isResizable:B,showResizeRect:L,hideResizeRect:O,updateResizeRect:P,destroy:function(){n=r=null}}},fv=function(e){for(var t=0,n=0,r=e;r&&r.nodeType;)t+=r.offsetLeft||0,n+=r.offsetTop||0,r=r.offsetParent;return{x:t,y:n}},hv=function(e,t,n){var r,i,o,a,s=e.dom,u=s.getRoot(),l=0;if(!function(e,t,n){var r={elm:t,alignToTop:n};return e.fire("scrollIntoView",r),r.isDefaultPrevented()}(e,t,n)&&pi.isElement(t)){if(!1===n&&(l=t.offsetHeight),"BODY"!==u.nodeName){var c=e.selection.getScrollContainer();if(c)return r=fv(t).y-fv(c).y+l,a=c.clientHeight,void((r<(o=c.scrollTop)||r+25>o+a)&&(c.scrollTop=r<o?r:r-a+25))}i=s.getViewPort(e.getWin()),r=s.getPos(t).y+l,o=i.y,a=i.h,(r<i.y||r+25>o+a)&&e.getWin().scrollTo(0,r<o?r:r-a+25)}},mv=function(e){return pi.isContentEditableTrue(e)||pi.isContentEditableFalse(e)},pv={fromPoint:function(e,t,n){var r,i,o=n;if(o.caretPositionFromPoint)(i=o.caretPositionFromPoint(e,t))&&((r=n.createRange()).setStart(i.offsetNode,i.offset),r.collapse(!0));else if(n.caretRangeFromPoint)r=n.caretRangeFromPoint(e,t);else if(o.body.createTextRange){r=o.body.createTextRange();try{r.moveToPoint(e,t),r.collapse(!0)}catch(i){r=function(e,t,n){var r,i,o;if(r=n.elementFromPoint(e,t),i=n.body.createTextRange(),r&&"HTML"!==r.tagName||(r=n.body),i.moveToElementText(r),(o=(o=Dt.toArray(i.getClientRects())).sort(function(e,n){return(e=Math.abs(Math.max(e.top-t,e.bottom-t)))-(n=Math.abs(Math.max(n.top-t,n.bottom-t)))})).length>0){t=(o[0].bottom+o[0].top)/2;try{return i.moveToPoint(e,t),i.collapse(!0),i}catch(e){}}return null}(e,t,n)}return function(e,t){var n=e&&e.parentElement?e.parentElement():null;return pi.isContentEditableFalse(function(e,t,n){for(;e&&e!==t;){if(n(e))return e;e=e.parentNode}return null}(n,t,mv))?null:e}(r,n.body)}return r}},gv=function(e,t){return O.map(t,function(t){var n=e.fire("GetSelectionRange",{range:t});return n.range!==t?n.range:t})},vv=function(e,t){return Dn.fromDom(e.dom().cloneNode(t))},bv=function(e){return vv(e,!0)},yv=function(e){return vv(e,!1)},Cv=bv,wv=function(e,t){var n=(t||document).createDocumentFragment();return O.each(e,function(e){n.appendChild(e.dom())}),Dn.fromDom(n)},Ev=function(e){return Dr.firstChild(e).fold(p.constant([e]),function(t){return[e].concat(Ev(t))})},xv=function(e){return Dr.lastChild(e).fold(p.constant([e]),function(t){return"br"===qn.name(t)?Dr.prevSibling(t).map(function(t){return[e].concat(xv(t))}).getOr([]):[e].concat(xv(t))})},Nv=function(e,t){return Oa([function(e){var t=e.startContainer,n=e.startOffset;return pi.isText(t)?0===n?w.some(Dn.fromDom(t)):w.none():w.from(t.childNodes[n]).map(Dn.fromDom)}(t),function(e){var t=e.endContainer,n=e.endOffset;return pi.isText(t)?n===t.data.length?w.some(Dn.fromDom(t)):w.none():w.from(t.childNodes[n-1]).map(Dn.fromDom)}(t)],function(t,n){var r=O.find(Ev(e),p.curry(wr.eq,t)),i=O.find(xv(e),p.curry(wr.eq,n));return r.isSome()&&i.isSome()}).getOr(!1)},Sv=function(e,t,n,r){var i=n,o=new Vr(n,i),a=e.schema.getNonEmptyElements();do{if(3===n.nodeType&&0!==Dt.trim(n.nodeValue).length)return void(r?t.setStart(n,0):t.setEnd(n,n.nodeValue.length));if(a[n.nodeName]&&!/^(TD|TH)$/.test(n.nodeName))return void(r?t.setStartBefore(n):"BR"===n.nodeName?t.setEndBefore(n):t.setEndAfter(n));if(le.ie&&le.ie<11&&e.isBlock(n)&&e.isEmpty(n))return void(r?t.setStart(n,0):t.setEnd(n,0))}while(n=r?o.next():o.prev());"BODY"===i.nodeName&&(r?t.setStart(i,0):t.setEnd(i,i.childNodes.length))},kv=cr.immutable("element","width","rows"),Tv=cr.immutable("element","cells"),Av=cr.immutable("x","y"),Dv=function(e,t){var n=parseInt(Jn.get(e,t),10);return isNaN(n)?1:n},Bv=function(e,t,n){var r=e.rows();return!!(r[n]?r[n].cells():[])[t]},Rv=function(e){return O.foldl(e,function(e,t){return t.cells().length>e?t.cells().length:e},0)},_v=function(e,t){for(var n=e.rows(),r=0;r<n.length;r++)for(var i=n[r].cells(),o=0;o<i.length;o++)if(wr.eq(i[o],t))return w.some(Av(o,r));return w.none()},Lv=function(e,t,n,r,i){for(var o=[],a=e.rows(),s=n;s<=i;s++){var u=a[s].cells(),l=t<r?u.slice(t,r+1):u.slice(r,t+1);o.push(Tv(a[s].element(),l))}return o},Ov=function(e){var t=kv(yv(e),0,[]);return O.each(Ka(e,"tr"),function(e,n){O.each(Ka(e,"td,th"),function(r,i){!function(e,t,n,r,i){for(var o=Dv(i,"rowspan"),a=Dv(i,"colspan"),s=e.rows(),u=n;u<n+o;u++){s[u]||(s[u]=Tv(Cv(r),[]));for(var l=t;l<t+a;l++)s[u].cells()[l]=u===n&&l===t?i:yv(i)}}(t,function(e,t,n){for(;Bv(e,t,n);)t++;return t}(t,i,n),n,e,r)})}),kv(t.element(),Rv(t.rows()),t.rows())},Pv=function(e){return function(e,t){var n=yv(e.element()),r=Dn.fromTag("tbody");return Ou(r,t),_u.append(n,r),n}(e,function(e){return O.map(e.rows(),function(e){var t=O.map(e.cells(),function(e){var t=Cv(e);return Jn.remove(t,"colspan"),Jn.remove(t,"rowspan"),t}),n=yv(e.element());return Ou(n,t),n})}(e))},Iv=function(e,t,n){return _v(e,t).bind(function(t){return _v(e,n).map(function(n){return function(e,t,n){var r=t.x(),i=t.y(),o=n.x(),a=n.y(),s=i<a?Lv(e,r,i,o,a):Lv(e,r,a,o,i);return kv(e.element(),Rv(s),s)}(e,t,n)})})},Fv=function(e,t){return O.find(e,function(e){return"li"===qn.name(e)&&Nv(e,t)}).fold(p.constant([]),function(t){return function(e){return O.find(e,function(e){return"ul"===qn.name(e)||"ol"===qn.name(e)})}(e).map(function(e){return[Dn.fromTag("li"),Dn.fromTag(qn.name(e))]}).getOr([])})},Mv=function(e,t){var n=Dn.fromDom(t.commonAncestorContainer),r=Ml(n,e),i=O.filter(r,function(e){return Zr(e)||Yr(e)}),o=Fv(r,t),a=i.concat(o.length?o:function(e){return ti(e)?Dr.parent(e).filter(ei).fold(p.constant([]),function(t){return[e,t]}):ei(e)?[e]:[]}(n));return O.map(a,yv)},Hv=function(){return wv([])},qv=function(e,t){return n=Dn.fromDom(t.cloneContents()),r=Mv(e,t),i=O.foldl(r,function(e,t){return _u.append(t,e),t},n),r.length>0?wv([i]):i;var n,r,i},zv=function(e,t){return(n=e,r=t[0],Cl(r,"table",p.curry(wr.eq,n))).bind(function(e){var n=t[0],r=t[t.length-1],i=Ov(e);return Iv(i,n,r).map(function(e){return wv([Pv(e)])})}).getOrThunk(Hv);var n,r},Uv=function(e,t){var n=ff(t,e);return n.length>0?zv(e,n):function(e,t){return t.length>0&&t[0].collapsed?Hv():qv(e,t[0])}(e,t)},jv=function(e,t){var n,r=e.selection.getRng(),i=e.dom.create("body"),o=e.selection.getSel(),a=gv(e,af(o));if((t=t||{}).get=!0,t.format=t.format||"html",t.selection=!0,(t=e.fire("BeforeGetContent",t)).isDefaultPrevented())return e.fire("GetContent",t),t.content;if("text"===t.format)return e.selection.isCollapsed()?"":so(r.text||(o.toString?o.toString():""));r.cloneContents?(n=t.contextual?Uv(Dn.fromDom(e.getBody()),a).dom():r.cloneContents())&&i.appendChild(n):void 0!==r.item||void 0!==r.htmlText?(i.innerHTML="<br>"+(r.item?r.item(0).outerHTML:r.htmlText),i.removeChild(i.firstChild)):i.innerHTML=r.toString(),t.getInner=!0;var s=e.selection.serializer.serialize(i,t);return"tree"===t.format?s:(t.content=e.selection.isCollapsed()?"":s,e.fire("GetContent",t),t.content)},Vv=function(e,t,n){var r,i,o,a=e.selection.getRng(),s=e.getDoc();if((n=n||{format:"html"}).set=!0,n.selection=!0,n.content=t,n.no_events||!(n=e.fire("BeforeSetContent",n)).isDefaultPrevented()){if(t=n.content,a.insertNode){t+='<span id="__caret">_</span>',a.startContainer===s&&a.endContainer===s?s.body.innerHTML=t:(a.deleteContents(),0===s.body.childNodes.length?s.body.innerHTML=t:a.createContextualFragment?a.insertNode(a.createContextualFragment(t)):(i=s.createDocumentFragment(),o=s.createElement("div"),i.appendChild(o),o.outerHTML=t,a.insertNode(i))),r=e.dom.get("__caret"),(a=s.createRange()).setStartBefore(r),a.setEndBefore(r),e.selection.setRng(a),e.dom.remove("__caret");try{e.selection.setRng(a)}catch(e){}}else a.item&&(s.execCommand("Delete",!1,null),a=e.getRng()),/^\s+/.test(t)?(a.pasteHTML('<span id="__mce_tmp">_</span>'+t),e.dom.remove("__mce_tmp")):a.pasteHTML(t);n.no_events||e.fire("SetContent",n)}else e.fire("SetContent",n)},$v=function(e,t,n,r,i){var o=n?t.startContainer:t.endContainer,a=n?t.startOffset:t.endOffset;return w.from(o).map(Dn.fromDom).map(function(e){return r&&t.collapsed?e:Dr.child(e,i(e,a)).getOr(e)}).bind(function(e){return qn.isElement(e)?w.some(e):Dr.parent(e)}).map(function(e){return e.dom()}).getOr(e)},Wv=function(e,t,n){return $v(e,t,!0,n,function(e,t){return Math.min(Dr.childNodesCount(e),t)})},Kv=function(e,t,n){return $v(e,t,!1,n,function(e,t){return t>0?t-1:t})},Xv=function(e,t){for(var n=e;e&&pi.isText(e)&&0===e.length;)e=t?e.nextSibling:e.previousSibling;return e||n},Yv=Dt.each,Gv=function(e){return!!e.select},Zv=function(e){return!(!e||!e.ownerDocument)&&wr.contains(Dn.fromDom(e.ownerDocument),Dn.fromDom(e))},Qv=function(e,t,n,r){var i,o,a,s,u,l=function(e,t){return Vv(r,e,t)},c=function(e){var t=f();t.collapse(!!e),h(t)},d=function(){return t.getSelection?t.getSelection():t.document.selection},f=function(){var n,i,o,u,l=function(e,t,n){try{return t.compareBoundaryPoints(e,n)}catch(e){return-1}};if(!t)return null;if(void 0===(u=t.document)||null===u)return null;if(void 0!==r.bookmark&&!1===Xh(r)){var c=ch.getRng(r);if(c.isSome())return c.map(function(e){return gv(r,[e])[0]}).getOr(u.createRange())}try{(n=d())&&(i=n.rangeCount>0?n.getRangeAt(0):n.createRange?n.createRange():u.createRange())}catch(e){}return(i=gv(r,[i])[0])||(i=u.createRange?u.createRange():u.body.createTextRange()),i.setStart&&9===i.startContainer.nodeType&&i.collapsed&&(o=e.getRoot(),i.setStart(o,0),i.setEnd(o,0)),a&&s&&(0===l(i.START_TO_START,i,a)&&0===l(i.END_TO_END,i,a)?i=s:(a=null,s=null)),i},h=function(e,t){var n,i;if(function(e){return!!e&&(!!Gv(e)||Zv(e.startContainer)&&Zv(e.endContainer))}(e)){var o=Gv(e)?e:null;if(o){s=null;try{o.select()}catch(e){}}else{if(n=d(),e=r.fire("SetSelectionRange",{range:e,forward:t}).range,n){s=e;try{n.removeAllRanges(),n.addRange(e)}catch(e){}!1===t&&n.extend&&(n.collapse(e.endContainer,e.endOffset),n.extend(e.startContainer,e.startOffset)),a=n.rangeCount>0?n.getRangeAt(0):null}e.collapsed||e.startContainer!==e.endContainer||!n.setBaseAndExtent||le.ie||e.endOffset-e.startOffset<2&&e.startContainer.hasChildNodes()&&(i=e.startContainer.childNodes[e.startOffset])&&"IMG"===i.tagName&&(n.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset),n.anchorNode===e.startContainer&&n.focusNode===e.endContainer||n.setBaseAndExtent(i,0,i,1)),r.fire("AfterSetSelectionRange",{range:e,forward:t})}}},m=function(){var t,n,r=d();return!(r&&r.anchorNode&&r.focusNode)||((t=e.createRng()).setStart(r.anchorNode,r.anchorOffset),t.collapse(!0),(n=e.createRng()).setStart(r.focusNode,r.focusOffset),n.collapse(!0),t.compareBoundaryPoints(t.START_TO_START,n)<=0)},p={bookmarkManager:null,controlSelection:null,dom:e,win:t,serializer:n,editor:r,collapse:c,setCursorLocation:function(t,n){var i=e.createRng();t?(i.setStart(t,n),i.setEnd(t,n),h(i),c(!1)):(Sv(e,i,r.getBody(),!0),h(i))},getContent:function(e){return jv(r,e)},setContent:l,getBookmark:function(e,t){return i.getBookmark(e,t)},moveToBookmark:function(e){return i.moveToBookmark(e)},select:function(t,n){return function(e,t,n){return w.from(t).map(function(t){var r=e.nodeIndex(t),i=e.createRng();return i.setStart(t.parentNode,r),i.setEnd(t.parentNode,r+1),n&&(Sv(e,i,t,!0),Sv(e,i,t,!1)),i})}(e,t,n).each(h),t},isCollapsed:function(){var e=f(),t=d();return!(!e||e.item)&&(e.compareEndPoints?0===e.compareEndPoints("StartToEnd",e):!t||e.collapsed)},isForward:m,setNode:function(t){return l(e.getOuterHTML(t)),t},getNode:function(){return e=r.getBody(),(t=f())?(i=t.startContainer,o=t.endContainer,a=t.startOffset,s=t.endOffset,n=t.commonAncestorContainer,!t.collapsed&&(i===o&&s-a<2&&i.hasChildNodes()&&(n=i.childNodes[a]),3===i.nodeType&&3===o.nodeType&&(i=i.length===a?Xv(i.nextSibling,!0):i.parentNode,o=0===s?Xv(o.previousSibling,!1):o.parentNode,i&&i===o))?i:n&&3===n.nodeType?n.parentNode:n):e;var e,t,n,i,o,a,s},getSel:d,setRng:h,getRng:f,getStart:function(e){return Wv(r.getBody(),f(),e)},getEnd:function(e){return Kv(r.getBody(),f(),e)},getSelectedBlocks:function(t,n){return function(e,t,n,r){var i,o,a=[];if(o=e.getRoot(),n=e.getParent(n||Wv(o,t,!1),e.isBlock),r=e.getParent(r||Kv(o,t,!1),e.isBlock),n&&n!==o&&a.push(n),n&&r&&n!==r){i=n;for(var s=new Vr(n,o);(i=s.next())&&i!==r;)e.isBlock(i)&&a.push(i)}return r&&n!==r&&r!==o&&a.push(r),a}(e,f(),t,n)},normalize:function(){var t=f();if(!uf(d())){var n=If.normalize(e,t);return n.each(function(e){h(e,m())}),n.getOr(t)}return t},selectorChanged:function(t,n){var i;return u||(u={},i={},r.on("NodeChange",function(t){var n=t.element,r=e.getParents(n,null,e.getRoot()),o={};Yv(u,function(t,n){Yv(r,function(a){if(e.is(a,n))return i[n]||(Yv(t,function(e){e(!0,{node:a,selector:n,parents:r})}),i[n]=t),o[n]=t,!1})}),Yv(i,function(e,t){o[t]||(delete i[t],Yv(e,function(e){e(!1,{node:n,selector:t,parents:r})}))})})),u[t]||(u[t]=[]),u[t].push(n),p},getScrollContainer:function(){for(var t,n=e.getRoot();n&&"BODY"!==n.nodeName;){if(n.scrollHeight>n.clientHeight){t=n;break}n=n.parentNode}return t},scrollIntoView:function(e,t){return hv(r,e,t)},placeCaretAt:function(e,t){return h(pv.fromPoint(e,t,r.getDoc()))},getBoundingClientRect:function(){var e=f();return e.collapsed?ca.fromRangeStart(e).getClientRects()[0]:e.getBoundingClientRect()},destroy:function(){t=a=s=null,o.destroy()}};return i=uv(p),o=dv(p,r),p.bookmarkManager=i,p.controlSelection=o,p},Jv=pi.isContentEditableFalse,eb=Fo,tb=Is,nb=Ps,rb=function(e,t){for(;t=e(t);)if(t.isVisible())return t;return t},ib=function(e,t,n,r){var i,o,a,s,u,l,c=e===Pa.Forwards,d=c?nb:tb;return!r.collapsed&&(i=eb(r),Jv(i))?Ba(e,t,i,e===Pa.Backwards,!0):(s=function(e){return co(e.startContainer)}(r),d(o=Os(e,t.getBody(),r))?Ra(t,o.getNode(!c)):(o=n(o))?d(o)?Ba(e,t,o.getNode(!c),c,!0):d(a=n(o))&&(!(l=xs(u=o,a))&&pi.isBr(u.getNode())||l)?Ba(e,t,a.getNode(!c),c,!0):s?La(t,o.toRange(),!0):null:s?r:null)},ob=function(e,t,n,r){var i,o,a,s,u,l,c,d,f;if(f=eb(r),i=Os(e,t.getBody(),r),o=n(t.getBody(),Xm(1),i),a=Nt.filter(o,Ym(1)),u=Nt.last(i.getClientRects()),(nb(i)||Fs(i))&&(f=i.getNode()),(tb(i)||Ms(i))&&(f=i.getNode(!0)),!u)return null;if(l=u.left,(s=tp(a,l))&&Jv(s.node))return c=Math.abs(l-s.left),d=Math.abs(l-s.right),Ba(e,t,s.node,c<d,!0);if(f){var h=function(e,t,n,r){var i,o,a,s,u,l,c=Ys(t),d=[],f=0,h=function(e){return Nt.last(e.getClientRects())};1===e?(i=c.next,o=Io,a=Po,s=ca.after(r)):(i=c.prev,o=Po,a=Io,s=ca.before(r)),l=h(s);do{if(s.isVisible()&&!a(u=h(s),l)){if(d.length>0&&o(u,Nt.last(d))&&f++,(u=_o(u)).position=s,u.line=f,n(u))return d;d.push(u)}}while(s=i(s));return d}(e,t.getBody(),Xm(1),f);if(s=tp(Nt.filter(h,Ym(1)),l))return La(t,s.position.toRange(),!0);if(s=Nt.last(Nt.filter(h,Ym(0))))return La(t,s.position.toRange(),!0)}},ab=function(e,t,n){var r,i,o=Ys(e.getBody()),a=jo.curry(rb,o.next),s=jo.curry(rb,o.prev);if(n.collapsed&&e.settings.forced_root_block){if(!(r=e.dom.getParent(n.startContainer,"PRE")))return;(1===t?a(ca.fromRangeStart(n)):s(ca.fromRangeStart(n)))||(i=function(e){var t=e.dom.create(e.settings.forced_root_block);return(!le.ie||le.ie>=11)&&(t.innerHTML='<br data-mce-bogus="1">'),t}(e),1===t?e.$(r).after(i):e.$(r).before(i),e.selection.select(i,!0),e.selection.collapse())}},sb=function(e,t){return function(){var n=function(e,t){var n,r=Ys(e.getBody()),i=jo.curry(rb,r.next),o=jo.curry(rb,r.prev),a=t?Pa.Forwards:Pa.Backwards,s=t?i:o,u=e.selection.getRng();return(n=ib(a,e,s,u))?n:(n=ab(e,a,u))||null}(e,t);return!!n&&(e.selection.setRng(n),!0)}},ub=function(e,t){return function(){var n=function(e,t){var n,r=t?1:-1,i=t?Km:Wm,o=e.selection.getRng();return(n=ob(r,e,i,o))?n:(n=ab(e,r,o))||null}(e,t);return!!n&&(e.selection.setRng(n),!0)}},lb=function(e,t){return O.bind(function(e){return O.map(e,function(e){return Dg.merge({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:p.noop},e)})}(e),function(e){return function(e,t){return t.keyCode===e.keyCode&&t.shiftKey===e.shiftKey&&t.altKey===e.altKey&&t.ctrlKey===e.ctrlKey&&t.metaKey===e.metaKey}(e,t)?[e]:[]})},cb=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,r)}},db=function(e,t){return O.find(lb(e,t),function(e){return e.action()})},fb=function(e,t){e.on("keydown",function(n){!1===n.isDefaultPrevented()&&function(e,t,n){var r=Tn.detect().os;db([{keyCode:sp.RIGHT,action:sb(e,!0)},{keyCode:sp.LEFT,action:sb(e,!1)},{keyCode:sp.UP,action:ub(e,!1)},{keyCode:sp.DOWN,action:ub(e,!0)},{keyCode:sp.RIGHT,action:as(e,!0)},{keyCode:sp.LEFT,action:as(e,!1)},{keyCode:sp.UP,action:ss(e,!1)},{keyCode:sp.DOWN,action:ss(e,!0)},{keyCode:sp.RIGHT,action:Hd.move(e,t,!0)},{keyCode:sp.LEFT,action:Hd.move(e,t,!1)},{keyCode:sp.RIGHT,ctrlKey:!r.isOSX(),altKey:r.isOSX(),action:Hd.moveNextWord(e,t)},{keyCode:sp.LEFT,ctrlKey:!r.isOSX(),altKey:r.isOSX(),action:Hd.movePrevWord(e,t)}],n).each(function(e){n.preventDefault()})}(e,t,n)})},hb=function(e){return 1===Dr.children(e).length},mb=function(e,t){var n=Dn.fromDom(e.getBody()),r=Dn.fromDom(e.selection.getStart()),i=O.filter(function(e,t){var n=Ml(t,e);return O.findIndex(n,Gr).fold(p.constant(n),function(e){return n.slice(0,e)})}(n,r),hb);return O.last(i).map(function(n){var r=ca.fromRangeStart(e.selection.getRng());return!!bl(t,r,n.dom())&&(function(e,t,n,r){var i=p.curry(sd.isFormatElement,t),o=O.map(O.filter(r,i),function(e){return e.dom()});if(0===o.length)cc(t,e,n);else{var a=sd.replaceWithCaretFormat(n.dom(),o);t.selection.setRng(a.toRange())}}(t,e,n,i),!0)}).getOr(!1)},pb=function(e,t){return!!e.selection.isCollapsed()&&mb(e,t)},gb=function(e,t){e.on("keydown",function(n){!1===n.isDefaultPrevented()&&function(e,t,n){db([{keyCode:sp.BACKSPACE,action:cb(hc,e,!1)},{keyCode:sp.DELETE,action:cb(hc,e,!0)},{keyCode:sp.BACKSPACE,action:cb(jd,e,t,!1)},{keyCode:sp.DELETE,action:cb(jd,e,t,!0)},{keyCode:sp.BACKSPACE,action:cb(Yl,e,!1)},{keyCode:sp.DELETE,action:cb(Yl,e,!0)},{keyCode:sp.BACKSPACE,action:cb($l,e,!1)},{keyCode:sp.DELETE,action:cb($l,e,!0)},{keyCode:sp.BACKSPACE,action:cb(xf,e,!1)},{keyCode:sp.DELETE,action:cb(xf,e,!0)},{keyCode:sp.BACKSPACE,action:cb(pb,e,!1)},{keyCode:sp.DELETE,action:cb(pb,e,!0)}],n).each(function(e){n.preventDefault()})}(e,t,n)}),e.on("keyup",function(t){!1===t.isDefaultPrevented()&&function(e,t){db([{keyCode:sp.BACKSPACE,action:cb(mc,e)},{keyCode:sp.DELETE,action:cb(mc,e)}],t)}(e,t)})},vb=function(e,t,n){var r=e.getParam(t,n);if(-1!==r.indexOf("=")){var i=e.getParam(t,"","hash");return i.hasOwnProperty(e.id)?i[e.id]:n}return r},bb=function(e){return e.getParam("iframe_attrs",{})},yb=function(e){return e.getParam("doctype","<!DOCTYPE html>")},Cb=function(e){return e.getParam("document_base_url","")},wb=function(e){return vb(e,"body_id","tinymce")},Eb=function(e){return vb(e,"body_class","")},xb=function(e){return e.getParam("content_security_policy","")},Nb=function(e){return e.getParam("br_in_pre",!0)},Sb=function(e){if(e.getParam("force_p_newlines",!1))return"p";var t=e.getParam("forced_root_block","p");return!1===t?"":t},kb=function(e){return e.getParam("forced_root_block_attrs",{})},Tb=function(e){return e.getParam("br_newline_selector",".mce-toc h2,figcaption,caption")},Ab=function(e){return e.getParam("no_newline_selector","")},Db=function(e){return e.getParam("keep_styles",!0)},Bb=function(e){return e.getParam("end_container_on_empty_block",!1)},Rb=function(e){return w.from(e.dom.getParent(e.selection.getStart(!0),e.dom.isBlock))},_b=function(e,t){var n,r,i,o=t,a=e.dom,s=e.schema.getMoveCaretBeforeOnEnterElements();if(t){if(/^(LI|DT|DD)$/.test(t.nodeName)){var u=function(e){for(;e;){if(1===e.nodeType||3===e.nodeType&&e.data&&/[\r\n\s]/.test(e.data))return e;e=e.nextSibling}}(t.firstChild);u&&/^(UL|OL|DL)$/.test(u.nodeName)&&t.insertBefore(a.doc.createTextNode(""),t.firstChild)}if(i=a.createRng(),t.normalize(),t.hasChildNodes()){for(n=new Vr(t,t);r=n.current();){if(pi.isText(r)){i.setStart(r,0),i.setEnd(r,0);break}if(s[r.nodeName.toLowerCase()]){i.setStartBefore(r),i.setEndBefore(r);break}o=r,r=n.next()}r||(i.setStart(o,0),i.setEnd(o,0))}else pi.isBr(t)?t.nextSibling&&a.isBlock(t.nextSibling)?(i.setStartBefore(t),i.setEndBefore(t)):(i.setStartAfter(t),i.setEndAfter(t)):(i.setStart(t,0),i.setEnd(t,0));e.selection.setRng(i),a.remove(void 0),e.selection.scrollIntoView(t)}},Lb=function(e,t){var n,r,i=e.getRoot();for(n=t;n!==i&&"false"!==e.getContentEditable(n);)"true"===e.getContentEditable(n)&&(r=n),n=n.parentNode;return n!==i?r:i},Ob=Rb,Pb=function(e){return Rb(e).fold(p.constant(""),function(e){return e.nodeName.toUpperCase()})},Ib=function(e){return Rb(e).filter(function(e){return ti(Dn.fromDom(e))}).isSome()},Fb=function(e,t){return e&&e.parentNode&&e.parentNode.nodeName===t},Mb=function(e){return e&&/^(OL|UL|LI)$/.test(e.nodeName)},Hb=function(e){var t=e.parentNode;return/^(LI|DT|DD)$/.test(t.nodeName)?t:e},qb=function(e,t,n){for(var r=e[n?"firstChild":"lastChild"];r&&!pi.isElement(r);)r=r[n?"nextSibling":"previousSibling"];return r===t},zb=function(e,t,n,r,i){var o=e.dom,a=e.selection.getRng();if(n!==e.getBody()){var s;Mb(s=n)&&Mb(s.parentNode)&&(i="LI");var u=i?t(i):o.create("BR");if(qb(n,r,!0)&&qb(n,r,!1))Fb(n,"LI")?o.insertAfter(u,Hb(n)):o.replace(u,n);else if(qb(n,r,!0))Fb(n,"LI")?(o.insertAfter(u,Hb(n)),u.appendChild(o.doc.createTextNode(" ")),u.appendChild(n)):n.parentNode.insertBefore(u,n);else if(qb(n,r,!1))o.insertAfter(u,Hb(n));else{n=Hb(n);var l=a.cloneRange();l.setStartAfter(r),l.setEndAfter(n);var c=l.extractContents();"LI"===i&&function(e,t){return e.firstChild&&e.firstChild.nodeName===t}(c,"LI")?(u=c.firstChild,o.insertAfter(c,n)):(o.insertAfter(c,n),o.insertAfter(u,n))}o.remove(r),_b(e,u)}},Ub=function(e){e.innerHTML='<br data-mce-bogus="1">'},jb=function(e,t){return e.nodeName===t||e.previousSibling&&e.previousSibling.nodeName===t},Vb=function(e,t){return t&&e.isBlock(t)&&!/^(TD|TH|CAPTION|FORM)$/.test(t.nodeName)&&!/^(fixed|absolute)/i.test(t.style.position)&&"true"!==e.getContentEditable(t)},$b=function(e,t,n){return!1===pi.isText(t)?n:e?1===n&&t.data.charAt(n-1)===ao?0:n:n===t.data.length-1&&t.data.charAt(n)===ao?t.data.length:n},Wb=function(e,t){var n,r,i=e.getRoot();for(n=t;n!==i&&"false"!==e.getContentEditable(n);)"true"===e.getContentEditable(n)&&(r=n),n=n.parentNode;return n!==i?r:i},Kb=function(e,t){var n=Sb(e);n&&n.toLowerCase()===t.tagName.toLowerCase()&&e.dom.setAttribs(t,kb(e))},Xb=function(e,t){var n,r,i,o,a,s,u,l,c,d,f,h,m,p=e.dom,g=e.schema,v=g.getNonEmptyElements(),b=e.selection.getRng(),y=function(t){var n,o,s,u=i,l=g.getTextInlineElements();if(t||"TABLE"===d||"HR"===d?(n=p.create(t||h),Kb(e,n)):n=a.cloneNode(!1),s=n,!1===Db(e))p.setAttrib(n,"style",null),p.setAttrib(n,"class",null);else do{if(l[u.nodeName]){if(sd.isCaretNode(u))continue;o=u.cloneNode(!1),p.setAttrib(o,"id",""),n.hasChildNodes()?(o.appendChild(n.firstChild),n.appendChild(o)):(s=o,n.appendChild(o))}}while((u=u.parentNode)&&u!==r);return Ub(s),n},C=function(e){var t,n,r,s;if(s=$b(e,i,o),pi.isText(i)&&(e?s>0:s<i.nodeValue.length))return!1;if(i.parentNode===a&&m&&!e)return!0;if(e&&pi.isElement(i)&&i===a.firstChild)return!0;if(jb(i,"TABLE")||jb(i,"HR"))return m&&!e||!m&&e;for(t=new Vr(i,a),pi.isText(i)&&(e&&0===s?t.prev():e||s!==i.nodeValue.length||t.next());n=t.current();){if(pi.isElement(n)){if(!n.getAttribute("data-mce-bogus")&&(r=n.nodeName.toLowerCase(),v[r]&&"br"!==r))return!1}else if(pi.isText(n)&&!/^[ \t\r\n]*$/.test(n.nodeValue))return!1;e?t.prev():t.next()}return!0},w=function(){u=/^(H[1-6]|PRE|FIGURE)$/.test(d)&&"HGROUP"!==f?y(h):y(),Bb(e)&&Vb(p,c)&&p.isEmpty(a)?u=p.split(c,a):p.insertAfter(u,a),_b(e,u)};If.normalize(p,b).each(function(e){b.setStart(e.startContainer,e.startOffset),b.setEnd(e.endContainer,e.endOffset)}),i=b.startContainer,o=b.startOffset,h=Sb(e),s=t.shiftKey,pi.isElement(i)&&i.hasChildNodes()&&(m=o>i.childNodes.length-1,i=i.childNodes[Math.min(o,i.childNodes.length-1)]||i,o=m&&pi.isText(i)?i.nodeValue.length:0),(r=Wb(p,i))&&((h&&!s||!h&&s)&&(i=function(e,t,n,r,i){var o,a,s,u,l,c,d=t||"P",f=e.dom,h=Wb(f,r);if(!(a=f.getParent(r,f.isBlock))||!Vb(f,a)){if(c=(a=a||h)===e.getBody()||function(e){return e&&/^(TD|TH|CAPTION)$/.test(e.nodeName)}(a)?a.nodeName.toLowerCase():a.parentNode.nodeName.toLowerCase(),!a.hasChildNodes())return o=f.create(d),Kb(e,o),a.appendChild(o),n.setStart(o,0),n.setEnd(o,0),o;for(u=r;u.parentNode!==a;)u=u.parentNode;for(;u&&!f.isBlock(u);)s=u,u=u.previousSibling;if(s&&e.schema.isValidChild(c,d.toLowerCase())){for(o=f.create(d),Kb(e,o),s.parentNode.insertBefore(o,s),u=s;u&&!f.isBlock(u);)l=u.nextSibling,o.appendChild(u),u=l;n.setStart(r,i),n.setEnd(r,i)}}return r}(e,h,b,i,o)),a=p.getParent(i,p.isBlock),c=a?p.getParent(a.parentNode,p.isBlock):null,d=a?a.nodeName.toUpperCase():"","LI"!==(f=c?c.nodeName.toUpperCase():"")||t.ctrlKey||(a=c,c=c.parentNode,d=f),/^(LI|DT|DD)$/.test(d)&&p.isEmpty(a)?zb(e,y,c,a,h):h&&a===e.getBody()||(h=h||"P",co(a)?(u=Co(a),p.isEmpty(a)&&Ub(a),_b(e,u)):C()?w():C(!0)?(u=a.parentNode.insertBefore(y(),a),_b(e,jb(a,"HR")?u:a)):((n=function(e){var t=e.cloneRange();return t.setStart(e.startContainer,$b(!0,e.startContainer,e.startOffset)),t.setEnd(e.endContainer,$b(!1,e.endContainer,e.endOffset)),t}(b).cloneRange()).setEndAfter(a),function(e){do{pi.isText(e)&&(e.nodeValue=e.nodeValue.replace(/^[\r\n]+/,"")),e=e.firstChild}while(e)}(l=n.extractContents()),u=l.firstChild,p.insertAfter(l,a),function(e,t,n){var r,i=n,o=[];if(i){for(;i=i.firstChild;){if(e.isBlock(i))return;pi.isElement(i)&&!t[i.nodeName.toLowerCase()]&&o.push(i)}for(r=o.length;r--;)!(i=o[r]).hasChildNodes()||i.firstChild===i.lastChild&&""===i.firstChild.nodeValue?e.remove(i):(a=i)&&"A"===a.nodeName&&0===Dt.trim(so(a.innerText||a.textContent)).length&&e.remove(i);var a}}(p,v,u),function(e,t){var n;t.normalize(),(n=t.lastChild)&&!/^(left|right)$/gi.test(e.getStyle(n,"float",!0))||e.add(t,"br")}(p,a),p.isEmpty(a)&&Ub(a),u.normalize(),p.isEmpty(u)?(p.remove(u),w()):_b(e,u)),p.setAttrib(u,"id",""),e.fire("NewBlock",{newBlock:u})))},Yb=function(e,t){return Ob(e).filter(function(e){return t.length>0&&br.is(Dn.fromDom(e),t)}).isSome()},Gb=function(e){return Yb(e,Tb(e))},Zb=function(e){return Yb(e,Ab(e))},Qb=Gl([{br:[]},{block:[]},{none:[]}]),Jb=function(e,t){return Zb(e)},ey=function(e){return function(t,n){return""===Sb(t)===e}},ty=function(e){return function(t,n){return Ib(t)===e}},ny=function(e){return function(t,n){return"PRE"===Pb(t)===e}},ry=function(e){return function(t,n){return Nb(t)===e}},iy=function(e,t){return Gb(e)},oy=function(e,t){return t},ay=function(e){var t=Sb(e),n=Lb(e.dom,e.selection.getStart());return n&&e.schema.isValidChild(n.nodeName,t||"P")},sy=function(e,t){return function(n,r){return O.foldl(e,function(e,t){return e&&t(n,r)},!0)?w.some(t):w.none()}},uy=function(e,t){return ud([sy([Jb],Qb.none()),sy([ny(!0),ry(!1),oy],Qb.br()),sy([ny(!0),ry(!1)],Qb.block()),sy([ny(!0),ry(!0),oy],Qb.block()),sy([ny(!0),ry(!0)],Qb.br()),sy([ty(!0),oy],Qb.br()),sy([ty(!0)],Qb.block()),sy([ey(!0),oy,ay],Qb.block()),sy([ey(!0)],Qb.br()),sy([iy],Qb.br()),sy([ey(!1),oy],Qb.br()),sy([ay],Qb.block())],[e,t.shiftKey]).getOr(Qb.none())},ly=function(e,t){uy(e,t).fold(function(){Wf.insert(e,t)},function(){Xb(e,t)},p.noop)},cy=function(e){e.on("keydown",function(t){t.keyCode===sp.ENTER&&function(e,t){var n;t.isDefaultPrevented()||(t.preventDefault(),(n=e.undoManager).typing&&(n.typing=!1,n.add()),e.undoManager.transact(function(){!1===e.selection.isCollapsed()&&e.execCommand("Delete"),ly(e,t)}))}(e,t)})},dy=function(e,t,n){return!!function(e,t){return fy(e)&&pi.isText(t.container())}(n,t)&&(function(e,t){var n=t.container(),r=t.offset();n.insertData(r,""),e.selection.setCursorLocation(n,r+1)}(e,t),!0)},fy=function(e){return e.fold(p.constant(!1),p.constant(!0),p.constant(!0),p.constant(!1))},hy=function(e){return!!e.selection.isCollapsed()&&function(e){var t=p.curry(pl.isInlineTarget,e),n=ca.fromRangeStart(e.selection.getRng());return kd(t,e.getBody(),n).map(p.curry(dy,e,n)).getOr(!1)}(e)},my=function(e){e.on("keydown",function(t){!1===t.isDefaultPrevented()&&function(e,t){db([{keyCode:sp.SPACEBAR,action:cb(hy,e)}],t).each(function(e){t.preventDefault()})}(e,t)})},py=function(e){var t=Hd.setupSelectedState(e);fb(e,t),gb(e,t),cy(e),my(e)};function gy(e){var t,n,r,i=Dt.each,o=sp.BACKSPACE,a=sp.DELETE,s=e.dom,u=e.selection,l=e.settings,c=e.parser,d=le.gecko,f=le.ie,h=le.webkit,m=f?"Text":"URL",p=function(t,n){try{e.getDoc().execCommand(t,!1,n)}catch(e){}},g=function(e){return e.isDefaultPrevented()},v=function(){e.shortcuts.add("meta+a",null,"SelectAll")},b=function(){e.on("keydown",function(e){if(!g(e)&&e.keyCode===o&&u.isCollapsed()&&0===u.getRng().startOffset){var t=u.getNode().previousSibling;if(t&&t.nodeName&&"table"===t.nodeName.toLowerCase())return e.preventDefault(),!1}})},y=function(){e.inline||(e.contentStyles.push("body {min-height: 150px}"),e.on("click",function(t){var n;if("HTML"===t.target.nodeName){if(le.ie>11)return void e.getBody().focus();n=e.selection.getRng(),e.getBody().focus(),e.selection.setRng(n),e.selection.normalize(),e.nodeChanged()}}))};return e.on("keydown",function(t){var n,r,i,o,a;if(!g(t)&&t.keyCode===sp.BACKSPACE&&(r=(n=u.getRng()).startContainer,i=n.startOffset,o=s.getRoot(),a=r,n.collapsed&&0===i)){for(;a&&a.parentNode&&a.parentNode.firstChild===a&&a.parentNode!==o;)a=a.parentNode;"BLOCKQUOTE"===a.tagName&&(e.formatter.toggle("blockquote",null,a),(n=s.createRng()).setStart(r,0),n.setEnd(r,0),u.setRng(n))}}),t=function(e){var t=s.create("body"),n=e.cloneContents();return t.appendChild(n),u.serializer.serialize(t,{format:"html"})},e.on("keydown",function(n){var r,i,u,l,c,d=n.keyCode;if(!g(n)&&(d===a||d===o)){if(r=e.selection.isCollapsed(),i=e.getBody(),r&&!s.isEmpty(i))return;if(!r&&(u=e.selection.getRng(),l=t(u),(c=s.createRng()).selectNode(e.getBody()),l!==t(c)))return;n.preventDefault(),e.setContent(""),i.firstChild&&s.isBlock(i.firstChild)?e.selection.setCursorLocation(i.firstChild,0):e.selection.setCursorLocation(i,0),e.nodeChanged()}}),le.windowsPhone||e.on("keyup focusin mouseup",function(e){sp.modifierPressed(e)||u.normalize()},!0),h&&(e.settings.content_editable||s.bind(e.getDoc(),"mousedown mouseup",function(t){var n;if(t.target===e.getDoc().documentElement)if(n=u.getRng(),e.getBody().focus(),"mousedown"===t.type){if(ho(n.startContainer))return;u.placeCaretAt(t.clientX,t.clientY)}else u.setRng(n)}),e.on("click",function(t){var n=t.target;/^(IMG|HR)$/.test(n.nodeName)&&"false"!==s.getContentEditableParent(n)&&(t.preventDefault(),e.selection.select(n),e.nodeChanged()),"A"===n.nodeName&&s.hasClass(n,"mce-item-anchor")&&(t.preventDefault(),u.select(n))}),l.forced_root_block&&e.on("init",function(){p("DefaultParagraphSeparator",l.forced_root_block)}),e.on("init",function(){e.dom.bind(e.getBody(),"submit",function(e){e.preventDefault()})}),b(),c.addNodeFilter("br",function(e){for(var t=e.length;t--;)"Apple-interchange-newline"===e[t].attr("class")&&e[t].remove()}),le.iOS?(e.inline||e.on("keydown",function(){document.activeElement===document.body&&e.getWin().focus()}),y(),e.on("click",function(e){var t=e.target;do{if("A"===t.tagName)return void e.preventDefault()}while(t=t.parentNode)}),e.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")):v()),le.ie>=11&&(y(),b()),le.ie&&(v(),p("AutoUrlDetect",!1),e.on("dragstart",function(t){!function(t){var n,r;t.dataTransfer&&(e.selection.isCollapsed()&&"IMG"===t.target.tagName&&u.select(t.target),(n=e.selection.getContent()).length>0&&(r="data:text/mce-internal,"+escape(e.id)+","+escape(n),t.dataTransfer.setData(m,r)))}(t)}),e.on("drop",function(t){if(!g(t)){var n=function(e){var t;return e.dataTransfer&&(t=e.dataTransfer.getData(m))&&t.indexOf("data:text/mce-internal,")>=0?(t=t.substr("data:text/mce-internal,".length).split(","),{id:unescape(t[0]),html:unescape(t[1])}):null}(t);if(n&&n.id!==e.id){t.preventDefault();var r=pv.fromPoint(t.x,t.y,e.getDoc());u.setRng(r),i=n.html,o=!0,e.queryCommandSupported("mceInsertClipboardContent")?e.execCommand("mceInsertClipboardContent",!1,{content:i,internal:o}):e.execCommand("mceInsertContent",!1,i)}}var i,o})),d&&(e.on("keydown",function(t){if(!g(t)&&t.keyCode===o){if(!e.getBody().getElementsByTagName("hr").length)return;if(u.isCollapsed()&&0===u.getRng().startOffset){var n=u.getNode(),r=n.previousSibling;if("HR"===n.nodeName)return s.remove(n),void t.preventDefault();r&&r.nodeName&&"hr"===r.nodeName.toLowerCase()&&(s.remove(r),t.preventDefault())}}}),Range.prototype.getClientRects||e.on("mousedown",function(t){if(!g(t)&&"HTML"===t.target.nodeName){var n=e.getBody();n.blur(),me.setEditorTimeout(e,function(){n.focus()})}}),n=function(){var t=s.getAttribs(u.getStart().cloneNode(!1));return function(){var n=u.getStart();n!==e.getBody()&&(s.setAttrib(n,"style",null),i(t,function(e){n.setAttributeNode(e.cloneNode(!0))}))}},r=function(){return!u.isCollapsed()&&s.getParent(u.getStart(),s.isBlock)!==s.getParent(u.getEnd(),s.isBlock)},e.on("keypress",function(t){var i;if(!g(t)&&(8===t.keyCode||46===t.keyCode)&&r())return i=n(),e.getDoc().execCommand("delete",!1,null),i(),t.preventDefault(),!1}),s.bind(e.getDoc(),"cut",function(t){var i;!g(t)&&r()&&(i=n(),me.setEditorTimeout(e,function(){i()}))}),l.readonly||e.on("BeforeExecCommand MouseDown",function(){p("StyleWithCSS",!1),p("enableInlineTableEditing",!1),l.object_resizing||p("enableObjectResizing",!1)}),e.on("SetContent ExecCommand",function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||i(s.select("a"),function(e){var t=e.parentNode,n=s.getRoot();if(t.lastChild===e){for(;t&&!s.isBlock(t);){if(t.parentNode.lastChild!==t||t===n)return;t=t.parentNode}s.add(t,"br",{"data-mce-bogus":1})}})}),e.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"),le.mac&&e.on("keydown",function(t){!sp.metaKeyPressed(t)||t.shiftKey||37!==t.keyCode&&39!==t.keyCode||(t.preventDefault(),e.selection.getSel().modify("move",37===t.keyCode?"backward":"forward","lineboundary"))}),b()),{refreshContentEditable:function(){},isHidden:function(){var t;return!d||e.removed?0:!(t=e.selection.getSel())||!t.rangeCount||0===t.rangeCount}}}var vy=Zi.DOM,by=function(e){e.bindPendingEventDelegates(),e.initialized=!0,e.fire("init"),e.focus(!0),e.nodeChanged({initial:!0}),e.execCallback("init_instance_callback",e),function(e){e.settings.auto_focus&&me.setEditorTimeout(e,function(){var t;(t=!0===e.settings.auto_focus?e:e.editorManager.get(e.settings.auto_focus)).destroyed||t.focus()},100)}(e)},yy=function(e,t){var n,r,i=e.settings,o=e.getElement(),a=e.getDoc();i.inline||(e.getElement().style.visibility=e.orgVisibility),t||i.content_editable||(a.open(),a.write(e.iframeHTML),a.close()),i.content_editable&&(e.on("remove",function(){var e=this.getBody();vy.removeClass(e,"mce-content-body"),vy.removeClass(e,"mce-edit-focus"),vy.setAttrib(e,"contentEditable",null)}),vy.addClass(o,"mce-content-body"),e.contentDocument=a=i.content_document||document,e.contentWindow=i.content_window||window,e.bodyElement=o,i.content_document=i.content_window=null,i.root_name=o.nodeName.toLowerCase()),(n=e.getBody()).disabled=!0,e.readonly=i.readonly,e.readonly||(e.inline&&"static"===vy.getStyle(n,"position",!0)&&(n.style.position="relative"),n.contentEditable=e.getParam("content_editable_state",!0)),n.disabled=!1,e.editorUpload=km(e),e.schema=qi(i),e.dom=new Zi(a,{keep_values:!0,url_converter:e.convertURL,url_converter_scope:e,hex_colors:i.force_hex_style_colors,class_filter:i.class_filter,update_styles:!0,root_element:e.inline?e.getBody():null,collect:i.content_editable,schema:e.schema,onSetAttrib:function(t){e.fire("SetAttrib",t)}}),e.parser=function(e){var t=Qg(e.settings,e.schema);return t.addAttributeFilter("src,href,style,tabindex",function(t,n){for(var r,i,o,a=t.length,s=e.dom;a--;)if(i=(r=t[a]).attr(n),o="data-mce-"+n,!r.attributes.map[o]){if(0===i.indexOf("data:")||0===i.indexOf("blob:"))continue;"style"===n?((i=s.serializeStyle(s.parseStyle(i),r.name)).length||(i=null),r.attr(o,i),r.attr(n,i)):"tabindex"===n?(r.attr(o,i),r.attr(n,null)):r.attr(o,e.convertURL(i,n,r.name))}}),t.addNodeFilter("script",function(e){for(var t,n,r=e.length;r--;)0!==(n=(t=e[r]).attr("type")||"no/type").indexOf("mce-")&&t.attr("type","mce-"+n)}),t.addNodeFilter("#cdata",function(e){for(var t,n=e.length;n--;)(t=e[n]).type=8,t.name="#comment",t.value="[CDATA["+t.value+"]]"}),t.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(t){for(var n,r=t.length,i=e.schema.getNonEmptyElements();r--;)(n=t[r]).isEmpty(i)&&0===n.getAll("br").length&&(n.append(new zg("br",1)).shortEnded=!0)}),t}(e),e.serializer=rv(i,e),e.selection=Qv(e.dom,e.getWin(),e.serializer,e),e.formatter=Sg(e),e.undoManager=Op(e),e._nodeChangeDispatcher=new _m(e),e._selectionOverrides=fp(e),av(e),py(e),Rm(e),e.fire("PreInit"),i.browser_spellcheck||i.gecko_spellcheck||(a.body.spellcheck=!1,vy.setAttrib(n,"spellcheck","false")),e.quirks=gy(e),e.fire("PostRender"),i.directionality&&(n.dir=i.directionality),i.nowrap&&(n.style.whiteSpace="nowrap"),i.protect&&e.on("BeforeSetContent",function(e){Dt.each(i.protect,function(t){e.content=e.content.replace(t,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})})}),e.on("SetContent",function(){e.addVisual(e.getBody())}),i.padd_empty_editor&&e.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),e.load({initial:!0,format:"html"}),e.startContent=e.getContent({format:"raw"}),e.on("compositionstart compositionend",function(t){e.composing="compositionstart"===t.type}),e.contentStyles.length>0&&(r="",Dt.each(e.contentStyles,function(e){r+=e+"\r\n"}),e.dom.addStyle(r)),function(e){return e.inline?vy.styleSheetLoader:e.dom.styleSheetLoader}(e).loadAll(e.contentCSS,function(t){by(e)},function(t){by(e)}),i.content_style&&function(e,t){var n=Dn.fromDom(e.getDoc().head),r=Dn.fromTag("style");Jn.set(r,"type","text/css"),_u.append(r,Dn.fromText(t)),_u.append(n,r)}(e,i.content_style)},Cy=Zi.DOM,wy=function(e,t){var n=e.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),r=function(e,t,n,r){var i=Dn.fromTag("iframe");return Jn.setAll(i,r),Jn.setAll(i,{id:e+"_ifr",frameBorder:"0",allowTransparency:"true",title:t}),ar(i,{width:"100%",height:function(e){var t="number"==typeof e?e+"px":e;return t||""}(n),display:"block"}),i}(e.id,n,t.height,bb(e)).dom();r.onload=function(){r.onload=null,e.fire("load")};var i=function(e,t){if(document.domain!==window.location.hostname&&le.ie&&le.ie<12){var n=Sm.uuid("mce");e[n]=function(){yy(e)};var r='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+e.id+'");document.write(ed.iframeHTML);document.close();ed.'+n+"(true);})()";return Cy.setAttrib(t,"src",r),!0}return!1}(e,r);return e.contentAreaContainer=t.iframeContainer,e.iframeElement=r,e.iframeHTML=function(e){var t,n,r;return r=yb(e)+"<html><head>",Cb(e)!==e.documentBaseUrl&&(r+='<base href="'+e.documentBaseURI.getURI()+'" />'),r+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',t=wb(e),n=Eb(e),xb(e)&&(r+='<meta http-equiv="Content-Security-Policy" content="'+xb(e)+'" />'),r+='</head><body id="'+t+'" class="mce-content-body '+n+'" data-id="'+e.id+'"><br></body></html>'}(e),Cy.add(t.iframeContainer,r),i},Ey=function(e,t){var n=wy(e,t);t.editorContainer&&(Cy.get(t.editorContainer).style.display=e.orgDisplay,e.hidden=Cy.isHidden(t.editorContainer)),e.getElement().style.display="none",Cy.setAttrib(e.id,"aria-hidden",!0),n||yy(e)},xy=Zi.DOM,Ny=function(e,t,n){var r,i,o=lm.get(n);if(r=lm.urls[n]||e.documentBaseUrl.replace(/\/$/,""),n=Dt.trim(n),o&&-1===Dt.inArray(t,n)){if(Dt.each(lm.dependencies(n),function(n){Ny(e,t,n)}),e.plugins[n])return;i=new o(e,r,e.$),e.plugins[n]=i,i.init&&(i.init(e,r),t.push(n))}},Sy=function(e){return e.replace(/^\-/,"")},ky=function(e){return{editorContainer:e,iframeContainer:e}},Ty=function(e){var t=e.getElement();return e.inline?ky(null):function(e){var t=xy.create("div");return xy.insertAfter(t,e),ky(t)}(t)},Ay=function(e){var t=e.settings,n=e.getElement();return e.orgDisplay=n.style.display,Un.isString(t.theme)?function(e){var t,n,r,i,o,a=e.settings,s=e.getElement();return t=a.width||xy.getStyle(s,"width")||"100%",n=a.height||xy.getStyle(s,"height")||s.offsetHeight,r=a.min_height||100,(i=/^[0-9\.]+(|px)$/i).test(""+t)&&(t=Math.max(parseInt(t,10),100)),i.test(""+n)&&(n=Math.max(parseInt(n,10),r)),o=e.theme.renderUI({targetNode:s,width:t,height:n,deltaWidth:a.delta_width,deltaHeight:a.delta_height}),a.content_editable||(n=(o.iframeHeight||n)+("number"==typeof n?o.deltaHeight||0:""))<r&&(n=r),o.height=n,o}(e):Un.isFunction(t.theme)?function(e){var t,n=e.getElement();return(t=e.settings.theme(e,n)).editorContainer.nodeType&&(t.editorContainer.id=t.editorContainer.id||e.id+"_parent"),t.iframeContainer&&t.iframeContainer.nodeType&&(t.iframeContainer.id=t.iframeContainer.id||e.id+"_iframecontainer"),t.height=t.iframeHeight?t.iframeHeight:n.offsetHeight,t}(e):Ty(e)},Dy=function(e){var t,n=e.settings,r=e.getElement();return e.rtl=n.rtl_ui||e.editorManager.i18n.rtl,e.editorManager.i18n.setCode(n.language),n.aria_label=n.aria_label||xy.getAttrib(r,"aria-label",e.getLang("aria.rich_text_area")),e.fire("ScriptsLoaded"),function(e){var t,n=e.settings.theme;Un.isString(n)?(e.settings.theme=Sy(n),t=cm.get(n),e.theme=new t(e,cm.urls[n]),e.theme.init&&e.theme.init(e,cm.urls[n]||e.documentBaseUrl.replace(/\/$/,""),e.$)):e.theme={}}(e),function(e){var t=[];Dt.each(e.settings.plugins.split(/[ ,]/),function(n){Ny(e,t,Sy(n))})}(e),t=Ay(e),e.editorContainer=t.editorContainer?t.editorContainer:null,n.content_css&&Dt.each(Dt.explode(n.content_css),function(t){e.contentCSS.push(e.documentBaseURI.toAbsolute(t))}),n.content_editable?yy(e):Ey(e,t)},By=Zi.DOM,Ry=function(e){return"-"===e.charAt(0)},_y=function(e,t){var n=no.ScriptLoader;!function(e,t,n,r){var i=t.settings,o=i.theme;if(Un.isString(o)){if(!Ry(o)&&!cm.urls.hasOwnProperty(o)){var a=i.theme_url;a?cm.load(o,t.documentBaseURI.toAbsolute(a)):cm.load(o,"themes/"+o+"/theme"+n+".js")}e.loadQueue(function(){cm.waitFor(o,r)})}else r()}(n,e,t,function(){!function(e,t){var n=t.settings;n.language&&"en"!==n.language&&!n.language_url&&(n.language_url=t.editorManager.baseURL+"/langs/"+n.language+".js"),n.language_url&&!t.editorManager.i18n.data[n.language]&&e.add(n.language_url)}(n,e),function(e,t){Dt.isArray(e.plugins)&&(e.plugins=e.plugins.join(" ")),Dt.each(e.external_plugins,function(t,n){lm.load(n,t),e.plugins+=" "+n}),Dt.each(e.plugins.split(/[ ,]/),function(e){if((e=Dt.trim(e))&&!lm.urls[e])if(Ry(e)){e=e.substr(1,e.length);var n=lm.dependencies(e);Dt.each(n,function(e){var n={prefix:"plugins/",resource:e,suffix:"/plugin"+t+".js"};e=lm.createUrl(n,e),lm.load(e.resource,e)})}else lm.load(e,{prefix:"plugins/",resource:e,suffix:"/plugin"+t+".js"})})}(e.settings,t),n.loadQueue(function(){e.removed||Dy(e)},e,function(t){um.pluginLoadError(e,t[0]),e.removed||Dy(e)})})},Ly=function(e){var t=e.settings,n=e.id,r=function(){By.unbind(window,"ready",r),e.render()};if(xe.Event.domLoaded){if(e.getElement()&&le.contentEditable){t.inline?e.inline=!0:(e.orgVisibility=e.getElement().style.visibility,e.getElement().style.visibility="hidden");var i=e.getElement().form||By.getParent(n,"form");i&&(e.formElement=i,t.hidden_input&&!/TEXTAREA|INPUT/i.test(e.getElement().nodeName)&&(By.insertAfter(By.create("input",{type:"hidden",name:n}),n),e.hasHiddenInput=!0),e.formEventDelegate=function(t){e.fire(t.type,t)},By.bind(i,"submit reset",e.formEventDelegate),e.on("reset",function(){e.setContent(e.startContent,{format:"raw"})}),!t.submit_patch||i.submit.nodeType||i.submit.length||i._mceOldSubmit||(i._mceOldSubmit=i.submit,i.submit=function(){return e.editorManager.triggerSave(),e.setDirty(!1),i._mceOldSubmit(i)})),e.windowManager=rm(e),e.notificationManager=nm(e),"xml"===t.encoding&&e.on("GetContent",function(e){e.save&&(e.content=By.encode(e.content))}),t.add_form_submit_trigger&&e.on("submit",function(){e.initialized&&e.save()}),t.add_unload_trigger&&(e._beforeUnload=function(){!e.initialized||e.destroyed||e.isHidden()||e.save({format:"raw",no_events:!0,set_dirty:!1})},e.editorManager.on("BeforeUnload",e._beforeUnload)),e.editorManager.add(e),_y(e,e.suffix)}}else By.bind(window,"ready",r)},Oy=function(e,t,n){var r=e.sidebars?e.sidebars:[];r.push({name:t,settings:n}),e.sidebars=r},Py=Dt.each,Iy=Dt.trim,Fy="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),My={ftp:21,http:80,https:443,mailto:25},Hy=function(e,t){var n,r,i=this;if(e=Iy(e),n=(t=i.settings=t||{}).base_uri,/^([\w\-]+):([^\/]{2})/i.test(e)||/^\s*#/.test(e))i.source=e;else{var o=0===e.indexOf("//");0!==e.indexOf("/")||o||(e=(n&&n.protocol||"http")+"://mce_host"+e),/^[\w\-]*:?\/\//.test(e)||(r=t.base_uri?t.base_uri.path:new Hy(document.location.href).directory,""==t.base_uri.protocol?e="//mce_host"+i.toAbsPath(r,e):(e=/([^#?]*)([#?]?.*)/.exec(e),e=(n&&n.protocol||"http")+"://mce_host"+i.toAbsPath(r,e[1])+e[2])),e=e.replace(/@@/g,"(mce_at)"),e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),Py(Fy,function(t,n){var r=e[n];r&&(r=r.replace(/\(mce_at\)/g,"@@")),i[t]=r}),n&&(i.protocol||(i.protocol=n.protocol),i.userInfo||(i.userInfo=n.userInfo),i.port||"mce_host"!==i.host||(i.port=n.port),i.host&&"mce_host"!==i.host||(i.host=n.host),i.source=""),o&&(i.protocol="")}};Hy.prototype={setPath:function(e){e=/^(.*?)\/?(\w+)?$/.exec(e),this.path=e[0],this.directory=e[1],this.file=e[2],this.source="",this.getURI()},toRelative:function(e){var t;if("./"===e)return e;if("mce_host"!==(e=new Hy(e,{base_uri:this})).host&&this.host!==e.host&&e.host||this.port!==e.port||this.protocol!==e.protocol&&""!==e.protocol)return e.getURI();var n=this.getURI(),r=e.getURI();return n===r||"/"===n.charAt(n.length-1)&&n.substr(0,n.length-1)===r?n:(t=this.toRelPath(this.path,e.path),e.query&&(t+="?"+e.query),e.anchor&&(t+="#"+e.anchor),t)},toAbsolute:function(e,t){return(e=new Hy(e,{base_uri:this})).getURI(t&&this.isSameOrigin(e))},isSameOrigin:function(e){if(this.host==e.host&&this.protocol==e.protocol){if(this.port==e.port)return!0;var t=My[this.protocol];if(t&&(this.port||t)==(e.port||t))return!0}return!1},toRelPath:function(e,t){var n,r,i,o=0,a="";if(e=(e=e.substring(0,e.lastIndexOf("/"))).split("/"),n=t.split("/"),e.length>=n.length)for(r=0,i=e.length;r<i;r++)if(r>=n.length||e[r]!==n[r]){o=r+1;break}if(e.length<n.length)for(r=0,i=n.length;r<i;r++)if(r>=e.length||e[r]!==n[r]){o=r+1;break}if(1===o)return t;for(r=0,i=e.length-(o-1);r<i;r++)a+="../";for(r=o-1,i=n.length;r<i;r++)a+=r!==o-1?"/"+n[r]:n[r];return a},toAbsPath:function(e,t){var n,r,i,o=0,a=[];for(r=/\/$/.test(t)?"/":"",e=e.split("/"),t=t.split("/"),Py(e,function(e){e&&a.push(e)}),e=a,n=t.length-1,a=[];n>=0;n--)0!==t[n].length&&"."!==t[n]&&(".."!==t[n]?o>0?o--:a.push(t[n]):o++);return 0!==(i=(n=e.length-o)<=0?a.reverse().join("/"):e.slice(0,n).join("/")+"/"+a.reverse().join("/")).indexOf("/")&&(i="/"+i),r&&i.lastIndexOf("/")!==i.length-1&&(i+=r),i},getURI:function(e){var t;return this.source&&!e||(t="",e||(this.protocol?t+=this.protocol+"://":t+="//",this.userInfo&&(t+=this.userInfo+"@"),this.host&&(t+=this.host),this.port&&(t+=":"+this.port)),this.path&&(t+=this.path),this.query&&(t+="?"+this.query),this.anchor&&(t+="#"+this.anchor),this.source=t),this.source}},Hy.parseDataUri=function(e){var t,n;return e=decodeURIComponent(e).split(","),(n=/data:([^;]+)/.exec(e[0]))&&(t=n[1]),{type:t,data:e[1]}},Hy.getDocumentBaseUrl=function(e){var t;return t=0!==e.protocol.indexOf("http")&&"file:"!==e.protocol?e.href:e.protocol+"//"+e.host+e.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(t)&&(t=t.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(t)||(t+="/")),t};var qy=function(e,t){t(e),e.firstChild&&qy(e.firstChild,t),e.next&&qy(e.next,t)},zy=function(e,t,n){var r=function(e,t,n){var r={},i={},o=[];for(var a in n.firstChild&&qy(n.firstChild,function(n){O.each(e,function(e){e.name===n.name&&(r[e.name]?r[e.name].nodes.push(n):r[e.name]={filter:e,nodes:[n]})}),O.each(t,function(e){"string"==typeof n.attr(e.name)&&(i[e.name]?i[e.name].nodes.push(n):i[e.name]={filter:e,nodes:[n]})})}),r)r.hasOwnProperty(a)&&o.push(r[a]);for(var s in i)i.hasOwnProperty(s)&&o.push(i[s]);return o}(e,t,n);O.each(r,function(e){O.each(e.filter.callbacks,function(t){t(e.nodes,e.filter.name,{})})})},Uy=function(e){return e instanceof zg},jy=function(e,t,n){return void 0===n&&(n={}),n.format=n.format?n.format:"html",n.set=!0,n.content=Uy(t)?"":t,Uy(t)||n.no_events||(e.fire("BeforeSetContent",n),t=n.content),Uy(t)?function(e,t,n){zy(e.parser.getNodeFilters(),e.parser.getAttributeFilters(),t);var r=Vu({validate:e.validate},e.schema).serialize(t);return n.content=Dt.trim(r),e.dom.setHTML(e.getBody(),n.content),n.no_events||e.fire("SetContent",n),t}(e,t,n):function(e,t,n){var r,i,o=e.getBody();return 0===t.length||/^\s+$/.test(t)?(i='<br data-mce-bogus="1">',"TABLE"===o.nodeName?t="<tr><td>"+i+"</td></tr>":/^(UL|OL)$/.test(o.nodeName)&&(t="<li>"+i+"</li>"),(r=e.settings.forced_root_block)&&e.schema.isValidChild(o.nodeName.toLowerCase(),r.toLowerCase())?(t=i,t=e.dom.createHTML(r,e.settings.forced_root_block_attrs,t)):t||(t='<br data-mce-bogus="1">'),e.dom.setHTML(o,t),e.fire("SetContent",n)):("raw"!==n.format&&(t=Vu({validate:e.validate},e.schema).serialize(e.parser.parse(t,{isRootContent:!0,insert:!0}))),n.content=Dt.trim(t),e.dom.setHTML(o,n.content),n.no_events||e.fire("SetContent",n)),n.content}(e,t,n)},Vy=Zi.DOM,$y=function(e){return w.from(e).each(function(e){return e.destroy()})},Wy=function(e){if(!e.removed){var t=e._selectionOverrides,n=e.editorUpload,r=e.getBody(),i=e.getElement();r&&e.save(),e.removed=1,e.unbindAllNativeEvents(),e.hasHiddenInput&&i&&Vy.remove(i.nextSibling),!e.inline&&r&&function(e){Vy.setStyle(e.id,"display",e.orgDisplay)}(e),_g(e),e.editorManager.remove(e),Vy.remove(e.getContainer()),$y(t),$y(n),e.destroy()}},Ky=function(e,t){var n=e.selection,r=e.dom;e.destroyed||(t||e.removed?(t||(e.editorManager.off("beforeunload",e._beforeUnload),e.theme&&e.theme.destroy&&e.theme.destroy(),$y(n),$y(r)),function(e){var t=e.formElement;t&&(t._mceOldSubmit&&(t.submit=t._mceOldSubmit,t._mceOldSubmit=null),Vy.unbind(t,"submit reset",e.formEventDelegate))}(e),function(e){e.contentAreaContainer=e.formElement=e.container=e.editorContainer=null,e.bodyElement=e.contentDocument=e.contentWindow=null,e.iframeElement=e.targetElm=null,e.selection&&(e.selection=e.selection.win=e.selection.dom=e.selection.dom.doc=null)}(e),e.destroyed=1):e.remove())},Xy=Zi.DOM,Yy=Dt.extend,Gy=Dt.each,Zy=Dt.resolve,Qy=le.ie,Jy=function(e,t,n){var r,i,o=this;r=o.documentBaseUrl=n.documentBaseURL,i=n.baseURI,t=function(e,t,n,r,i){var o=function(e,t,n){return{id:e,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:t,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:n.convertURL,url_converter_scope:n,ie7_compat:!0}}(t,n,e);return ll(nl,o,r,i)}(o,e,r,n.defaultSettings,t),o.settings=t,io.language=t.language||"en",io.languageLoad=t.language_load,io.baseURL=n.baseURL,o.id=e,o.setDirty(!1),o.plugins={},o.documentBaseURI=new Hy(t.document_base_url,{base_uri:i}),o.baseURI=i,o.contentCSS=[],o.contentStyles=[],o.shortcuts=new Fh(o),o.loadedCSS={},o.editorCommands=new yh(o),o.suffix=n.suffix,o.editorManager=n,o.inline=t.inline,o.buttons={},o.menuItems={},t.cache_suffix&&(le.cacheSuffix=t.cache_suffix.replace(/^[\?\&]+/,"")),!1===t.override_viewport&&(le.overrideViewPort=!1),n.fire("SetupEditor",{editor:o}),o.execCallback("setup",o),o.$=Xt.overrideDefaults(function(){return{context:o.inline?o.getBody():o.getDoc(),element:o.getBody()}})};Yy(Jy.prototype={render:function(){Ly(this)},focus:function(e){Kh(this,e)},execCallback:function(e){var t,n=this.settings[e];if(n)return this.callbackLookup&&(t=this.callbackLookup[e])&&(n=t.func,t=t.scope),"string"==typeof n&&(t=(t=n.replace(/\.\w+$/,""))?Zy(t):0,n=Zy(n),this.callbackLookup=this.callbackLookup||{},this.callbackLookup[e]={func:n,scope:t}),n.apply(t||this,Array.prototype.slice.call(arguments,1))},translate:function(e){if(e&&Dt.is(e,"string")){var t=this.settings.language||"en",n=this.editorManager.i18n;e=n.data[t+"."+e]||e.replace(/\{\#([^\}]+)\}/g,function(e,r){return n.data[t+"."+r]||"{#"+r+"}"})}return this.editorManager.translate(e)},getLang:function(e,t){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+e]||(void 0!==t?t:"{#"+e+"}")},getParam:function(e,t,n){return fl(this,e,t,n)},nodeChanged:function(e){this._nodeChangeDispatcher.nodeChanged(e)},addButton:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),t.stateSelector&&void 0===t.active&&(t.active=!1),t.text||t.icon||(t.icon=e),n.buttons=n.buttons,t.tooltip=t.tooltip||t.title,n.buttons[e]=t},addSidebar:function(e,t){return Oy(this,e,t)},addMenuItem:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),n.menuItems=n.menuItems,n.menuItems[e]=t},addContextToolbar:function(e,t){var n,r=this;r.contextToolbars=r.contextToolbars||[],"string"==typeof e&&(n=e,e=function(e){return r.dom.is(e,n)}),r.contextToolbars.push({id:Sm.uuid("mcet"),predicate:e,items:t})},addCommand:function(e,t,n){this.editorCommands.addCommand(e,t,n)},addQueryStateHandler:function(e,t,n){this.editorCommands.addQueryStateHandler(e,t,n)},addQueryValueHandler:function(e,t,n){this.editorCommands.addQueryValueHandler(e,t,n)},addShortcut:function(e,t,n,r){this.shortcuts.add(e,t,n,r)},execCommand:function(e,t,n,r){return this.editorCommands.execCommand(e,t,n,r)},queryCommandState:function(e){return this.editorCommands.queryCommandState(e)},queryCommandValue:function(e){return this.editorCommands.queryCommandValue(e)},queryCommandSupported:function(e){return this.editorCommands.queryCommandSupported(e)},show:function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable=!0:(Xy.show(this.getContainer()),Xy.hide(this.id)),this.load(),this.fire("show"))},hide:function(){var e=this.getDoc();this.hidden||(Qy&&e&&!this.inline&&e.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable=!1,this===this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(Xy.hide(this.getContainer()),Xy.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(e,t){this.fire("ProgressState",{state:e,time:t})},load:function(e){var t,n=this.getElement();return this.removed?"":n?((e=e||{}).load=!0,t=this.setContent(void 0!==n.value?n.value:n.innerHTML,e),e.element=n,e.no_events||this.fire("LoadContent",e),e.element=n=null,t):void 0},save:function(e){var t,n,r=this,i=r.getElement();if(i&&r.initialized&&!r.removed)return(e=e||{}).save=!0,e.element=i,e.content=r.getContent(e),e.no_events||r.fire("SaveContent",e),"raw"===e.format&&r.fire("RawSaveContent",e),t=e.content,/TEXTAREA|INPUT/i.test(i.nodeName)?i.value=t:(r.inline||(i.innerHTML=t),(n=Xy.getParent(r.id,"form"))&&Gy(n.elements,function(e){if(e.name===r.id)return e.value=t,!1})),e.element=i=null,!1!==e.set_dirty&&r.setDirty(!1),t},setContent:function(e,t){return jy(this,e,t)},getContent:function(e){return function(e,t){var n;void 0===t&&(t={});var r=e.getBody();if(e.removed)return"";if(t.format=t.format?t.format:"html",t.get=!0,t.getInner=!0,t.no_events||e.fire("BeforeGetContent",t),"raw"===t.format)n=Dt.trim(Cp(e.serializer,r.innerHTML));else if("text"===t.format)n=r.innerText||r.textContent;else{if("tree"===t.format)return e.serializer.serialize(r,t);n=e.serializer.serialize(r,t)}return"text"!==t.format?t.content=Dt.trim(n):t.content=n,t.no_events||e.fire("GetContent",t),t.content}(this,e)},insertContent:function(e,t){t&&(e=Yy({content:e},t)),this.execCommand("mceInsertContent",!1,e)},isDirty:function(){return!this.isNotDirty},setDirty:function(e){var t=!this.isNotDirty;this.isNotDirty=!e,e&&e!==t&&this.fire("dirty")},setMode:function(e){_h(this,e)},getContainer:function(){return this.container||(this.container=Xy.get(this.editorContainer||this.id+"_parent")),this.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=Xy.get(this.id)),this.targetElm},getWin:function(){var e;return this.contentWindow||(e=this.iframeElement)&&(this.contentWindow=e.contentWindow),this.contentWindow},getDoc:function(){var e;return this.contentDocument||(e=this.getWin())&&(this.contentDocument=e.document),this.contentDocument},getBody:function(){var e=this.getDoc();return this.bodyElement||(e?e.body:null)},convertURL:function(e,t,n){var r=this.settings;return r.urlconverter_callback?this.execCallback("urlconverter_callback",e,n,!0,t):!r.convert_urls||n&&"LINK"===n.nodeName||0===e.indexOf("file:")||0===e.length?e:r.relative_urls?this.documentBaseURI.toRelative(e):e=this.documentBaseURI.toAbsolute(e,r.remove_script_host)},addVisual:function(e){var t,n=this,r=n.settings,i=n.dom;e=e||n.getBody(),void 0===n.hasVisual&&(n.hasVisual=r.visual),Gy(i.select("table,a",e),function(e){var o;switch(e.nodeName){case"TABLE":return t=r.visual_table_class||"mce-item-table",void((o=i.getAttrib(e,"border"))&&"0"!==o||!n.hasVisual?i.removeClass(e,t):i.addClass(e,t));case"A":return void(i.getAttrib(e,"href",!1)||(o=i.getAttrib(e,"name")||e.id,t=r.visual_anchor_class||"mce-item-anchor",o&&n.hasVisual?i.addClass(e,t):i.removeClass(e,t)))}}),n.fire("VisualAid",{element:e,hasVisual:n.hasVisual})},remove:function(){Wy(this)},destroy:function(e){Ky(this,e)},uploadImages:function(e){return this.editorUpload.uploadImages(e)},_scanForImages:function(){return this.editorUpload.scanForImages()}},Dh);var eC,tC,nC,rC={isEditorUIElement:function(e){return-1!==e.className.toString().indexOf("mce-")}},iC=function(e,t){var n=Tn.detect().browser;n.isIE()||n.isEdge()?function(e){e.on("focusout",function(){ch.store(e)})}(e):function(e,t){e.on("mouseup touchend",function(e){t.throttle()})}(e,t),e.on("keyup nodechange",function(t){(function(e){return"nodechange"===e.type&&e.selectionChange})(t)||ch.store(e)})},oC=function(e){var t=op(function(){ch.store(e)},0);e.inline&&function(e,t){var n=function(){t.throttle()};Zi.DOM.bind(document,"mouseup",n),e.on("remove",function(){Zi.DOM.unbind(document,"mouseup",n)})}(e,t),e.on("init",function(){iC(e,t)}),e.on("remove",function(){t.cancel()})},aC=Zi.DOM,sC=function(e){return rC.isEditorUIElement(e)},uC=function(e,t){var n=e?e.settings.custom_ui_selector:"";return null!==aC.getParent(t,function(t){return sC(t)||!!n&&e.dom.is(t,n)})},lC=function(e,t){var n=t.editor;oC(n),n.on("focusin",function(){var t=e.focusedEditor;t!==this&&(t&&t.fire("blur",{focusedEditor:this}),e.setActive(this),e.focusedEditor=this,this.fire("focus",{blurredEditor:t}),this.focus(!0))}),n.on("focusout",function(){var t=this;me.setEditorTimeout(t,function(){var n=e.focusedEditor;uC(t,function(){try{return document.activeElement}catch(e){return document.body}}())||n!==t||(t.fire("blur",{focusedEditor:null}),e.focusedEditor=null)})}),eC||(eC=function(t){var n,r=e.activeEditor;n=t.target,r&&n.ownerDocument===document&&(n===document.body||uC(r,n)||e.focusedEditor!==r||(r.fire("blur",{focusedEditor:null}),e.focusedEditor=null))},aC.bind(document,"focusin",eC))},cC=function(e,t){e.focusedEditor===t.editor&&(e.focusedEditor=null),e.activeEditor||(aC.unbind(document,"focusin",eC),eC=null)},dC=function(e){e.on("AddEditor",p.curry(lC,e)),e.on("RemoveEditor",p.curry(cC,e))},fC={},hC="en",mC={setCode:function(e){e&&(hC=e,this.rtl=!!this.data[e]&&"rtl"===this.data[e]._dir)},getCode:function(){return hC},rtl:!1,add:function(e,t){var n=fC[e];for(var r in n||(fC[e]=n={}),t)n[r]=t[r];this.setCode(e)},translate:function(e){var t=fC[hC]||{},n=function(e){return Dt.is(e,"function")?Object.prototype.toString.call(e):r(e)?"":""+e},r=function(e){return""===e||null===e||Dt.is(e,"undefined")},i=function(e){return e=n(e),Dt.hasOwn(t,e)?n(t[e]):e};if(r(e))return"";if(Dt.is(e,"object")&&Dt.hasOwn(e,"raw"))return n(e.raw);if(Dt.is(e,"array")){var o=e.slice(1);e=i(e[0]).replace(/\{([0-9]+)\}/g,function(e,t){return Dt.hasOwn(o,t)?n(o[t]):e})}return i(e).replace(/{context:\w+}$/,"")},data:fC},pC=Zi.DOM,gC=Dt.explode,vC=Dt.each,bC=Dt.extend,yC=0,CC=!1,wC=[],EC=[],xC=function(e){vC(nC.get(),function(t){"scroll"===e.type?t.fire("ScrollWindow",e):t.fire("ResizeWindow",e)})},NC=function(e){e!==CC&&(e?Xt(window).on("resize scroll",xC):Xt(window).off("resize scroll",xC),CC=e)},SC=function(e){var t=EC;delete wC[e.id];for(var n=0;n<wC.length;n++)if(wC[n]===e){wC.splice(n,1);break}return EC=O.filter(EC,function(t){return e!==t}),nC.activeEditor===e&&(nC.activeEditor=EC.length>0?EC[0]:null),nC.focusedEditor===e&&(nC.focusedEditor=null),t.length!==EC.length};bC(nC={defaultSettings:{},$:Xt,majorVersion:"4",minorVersion:"7.9",releaseDate:"2018-02-27",editors:wC,i18n:mC,activeEditor:null,settings:{},setup:function(){var e,t,n,r,i="";if(t=Hy.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(t)&&(t=t.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(t)||(t+="/")),n=window.tinymce||window.tinyMCEPreInit)e=n.base||n.baseURL,i=n.suffix;else{for(var o=document.getElementsByTagName("script"),a=0;a<o.length;a++){var s=(r=o[a].src).substring(r.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(r)){-1!==s.indexOf(".min")&&(i=".min"),e=r.substring(0,r.lastIndexOf("/"));break}}!e&&document.currentScript&&(-1!==(r=document.currentScript.src).indexOf(".min")&&(i=".min"),e=r.substring(0,r.lastIndexOf("/")))}this.baseURL=new Hy(t).toAbsolute(e),this.documentBaseURL=t,this.baseURI=new Hy(this.baseURL),this.suffix=i,dC(this)},overrideDefaults:function(e){var t,n;(t=e.base_url)&&(this.baseURL=new Hy(this.documentBaseURL).toAbsolute(t.replace(/\/+$/,"")),this.baseURI=new Hy(this.baseURL)),n=e.suffix,e.suffix&&(this.suffix=n),this.defaultSettings=e;var r=e.plugin_base_urls;for(var i in r)io.PluginManager.urls[i]=r[i]},init:function(e){var t,n,r=this;n=Dt.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu"," ");var i=function(e){var t=e.id;return t||(t=(t=e.name)&&!pC.get(t)?e.name:pC.uniqueId(),e.setAttribute("id",t)),t},o=function(e,t){return t.constructor===RegExp?t.test(e.className):pC.hasClass(e,t)},a=function(e){t=e},s=function(){var t,u=0,l=[],c=function(e,n,i){var o=new Jy(e,n,r);l.push(o),o.on("init",function(){++u===t.length&&a(l)}),o.targetElm=o.targetElm||i,o.render()};pC.unbind(window,"ready",s),function(t){var n=e[t];n&&n.apply(r,Array.prototype.slice.call(arguments,2))}("onpageload"),t=Xt.unique(function(e){var t,n=[];if(le.ie&&le.ie<11)return um.initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(e.types)return vC(e.types,function(e){n=n.concat(pC.select(e.selector))}),n;if(e.selector)return pC.select(e.selector);if(e.target)return[e.target];switch(e.mode){case"exact":(t=e.elements||"").length>0&&vC(gC(t),function(e){var t;(t=pC.get(e))?n.push(t):vC(document.forms,function(t){vC(t.elements,function(t){t.name===e&&(e="mce_editor_"+yC++,pC.setAttrib(t,"id",e),n.push(t))})})});break;case"textareas":case"specific_textareas":vC(pC.select("textarea"),function(t){e.editor_deselector&&o(t,e.editor_deselector)||e.editor_selector&&!o(t,e.editor_selector)||n.push(t)})}return n}(e)),e.types?vC(e.types,function(n){Dt.each(t,function(t){return!pC.is(t,n.selector)||(c(i(t),bC({},e,n),t),!1)})}):(Dt.each(t,function(e){var t;(t=r.get(e.id))&&t.initialized&&!(t.getContainer()||t.getBody()).parentNode&&(SC(t),t.unbindAllNativeEvents(),t.destroy(!0),t.removed=!0,t=null)}),0===(t=Dt.grep(t,function(e){return!r.get(e.id)})).length?a([]):vC(t,function(t){!function(e,t){return e.inline&&t.tagName.toLowerCase()in n}(e,t)?c(i(t),e,t):um.initError("Could not initialize inline editor on invalid inline target element",t)}))};return r.settings=e,pC.bind(window,"ready",s),new ce(function(e){t?e(t):a=function(t){e(t)}})},get:function(e){return 0===arguments.length?EC.slice(0):Un.isString(e)?O.find(EC,function(t){return t.id===e}).getOr(null):Un.isNumber(e)&&EC[e]?EC[e]:null},add:function(e){var t=this;return wC[e.id]===e?e:(null===t.get(e.id)&&("length"!==e.id&&(wC[e.id]=e),wC.push(e),EC.push(e)),NC(!0),t.activeEditor=e,t.fire("AddEditor",{editor:e}),tC||(tC=function(){t.fire("BeforeUnload")},pC.bind(window,"beforeunload",tC)),e)},createEditor:function(e,t){return this.add(new Jy(e,t,this))},remove:function(e){var t,n,r=this;if(e)return Un.isString(e)?(e=e.selector||e,void vC(pC.select(e),function(e){(n=r.get(e.id))&&r.remove(n)})):(n=e,Un.isNull(r.get(n.id))?null:(SC(n)&&r.fire("RemoveEditor",{editor:n}),0===EC.length&&pC.unbind(window,"beforeunload",tC),n.remove(),NC(EC.length>0),n));for(t=EC.length-1;t>=0;t--)r.remove(EC[t])},execCommand:function(e,t,n){var r=this.get(n);switch(e){case"mceAddEditor":return this.get(n)||new Jy(n,this.settings,this).render(),!0;case"mceRemoveEditor":return r&&r.remove(),!0;case"mceToggleEditor":return r?(r.isHidden()?r.show():r.hide(),!0):(this.execCommand("mceAddEditor",0,n),!0)}return!!this.activeEditor&&this.activeEditor.execCommand(e,t,n)},triggerSave:function(){vC(EC,function(e){e.save()})},addI18n:function(e,t){mC.add(e,t)},translate:function(e){return mC.translate(e)},setActive:function(e){var t=this.activeEditor;this.activeEditor!==e&&(t&&t.fire("deactivate",{relatedTarget:e}),e.fire("activate",{relatedTarget:t})),this.activeEditor=e}},Nh),nC.setup();var kC=nC;function TC(e){return{walk:function(t,n){return qp.walk(e,t,n)},split:Yc.split,normalize:function(t){return If.normalize(e,t).fold(p.constant(!1),function(e){return t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),!0})}}}!function(e){e.compareRanges=kf.isEq,e.getCaretRangeFromPoint=pv.fromPoint,e.getSelectedNode=Fo,e.getNode=Mo}(TC||(TC={}));var AC,DC,BC=TC,RC=Math.min,_C=Math.max,LC=Math.round,OC=function(e,t,n){var r,i,o,a,s,u;return r=t.x,i=t.y,o=e.w,a=e.h,s=t.w,u=t.h,"b"===(n=(n||"").split(""))[0]&&(i+=u),"r"===n[1]&&(r+=s),"c"===n[0]&&(i+=LC(u/2)),"c"===n[1]&&(r+=LC(s/2)),"b"===n[3]&&(i-=a),"r"===n[4]&&(r-=o),"c"===n[3]&&(i-=LC(a/2)),"c"===n[4]&&(r-=LC(o/2)),PC(r,i,o,a)},PC=function(e,t,n,r){return{x:e,y:t,w:n,h:r}},IC={inflate:function(e,t,n){return PC(e.x-t,e.y-n,e.w+2*t,e.h+2*n)},relativePosition:OC,findBestRelativePosition:function(e,t,n,r){var i,o;for(o=0;o<r.length;o++)if((i=OC(e,t,r[o])).x>=n.x&&i.x+i.w<=n.w+n.x&&i.y>=n.y&&i.y+i.h<=n.h+n.y)return r[o];return null},intersect:function(e,t){var n,r,i,o;return n=_C(e.x,t.x),r=_C(e.y,t.y),i=RC(e.x+e.w,t.x+t.w),o=RC(e.y+e.h,t.y+t.h),i-n<0||o-r<0?null:PC(n,r,i-n,o-r)},clamp:function(e,t,n){var r,i,o,a,s,u,l,c,d,f;return s=e.x,u=e.y,l=e.x+e.w,c=e.y+e.h,d=t.x+t.w,f=t.y+t.h,r=_C(0,t.x-s),i=_C(0,t.y-u),o=_C(0,l-d),a=_C(0,c-f),s+=r,u+=i,n&&(l+=r,c+=i,s-=o,u-=a),PC(s,u,(l-=o)-s,(c-=a)-u)},create:PC,fromClientRect:function(e){return PC(e.left,e.top,e.width,e.height)}},FC={},MC={add:function(e,t){FC[e.toLowerCase()]=t},has:function(e){return!!FC[e.toLowerCase()]},get:function(e){var t=e.toLowerCase(),n=FC.hasOwnProperty(t)?FC[t]:null;if(null===n)throw new Error("Could not find module for type: "+e);return n},create:function(e,t){var n;if("string"==typeof e?(t=t||{}).type=e:e=(t=e).type,e=e.toLowerCase(),!(n=FC[e]))throw new Error("Could not find control by type: "+e);return(n=new n(t)).type=e,n}},HC=Dt.each,qC=Dt.extend,zC=function(){};zC.extend=AC=function(e){var t,n,r,i=this.prototype,o=function(){var e,t,n;if(!DC&&(this.init&&this.init.apply(this,arguments),t=this.Mixins))for(e=t.length;e--;)(n=t[e]).init&&n.init.apply(this,arguments)},a=function(){return this},s=function(e,t){return function(){var n,r=this._super;return this._super=i[e],n=t.apply(this,arguments),this._super=r,n}};for(n in DC=!0,t=new this,DC=!1,e.Mixins&&(HC(e.Mixins,function(t){for(var n in t)"init"!==n&&(e[n]=t[n])}),i.Mixins&&(e.Mixins=i.Mixins.concat(e.Mixins))),e.Methods&&HC(e.Methods.split(","),function(t){e[t]=a}),e.Properties&&HC(e.Properties.split(","),function(t){var n="_"+t;e[t]=function(e){return void 0!==e?(this[n]=e,this):this[n]}}),e.Statics&&HC(e.Statics,function(e,t){o[t]=e}),e.Defaults&&i.Defaults&&(e.Defaults=qC({},i.Defaults,e.Defaults)),e)"function"==typeof(r=e[n])&&i[n]?t[n]=s(n,r):t[n]=r;return o.prototype=t,o.constructor=o,o.extend=AC,o};var UC=Math.min,jC=Math.max,VC=Math.round,$C=function(e,t){var n,r,i,o;if(t=t||'"',null===e)return"null";if("string"==(i=typeof e))return r="\bb\tt\nn\ff\rr\"\"''\\\\",t+e.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(e,i){return'"'===t&&"'"===e?e:(n=r.indexOf(i))+1?"\\"+r.charAt(n+1):(e=i.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e)})+t;if("object"===i){if(e.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(e)){for(n=0,r="[";n<e.length;n++)r+=(n>0?",":"")+$C(e[n],t);return r+"]"}for(o in r="{",e)e.hasOwnProperty(o)&&(r+="function"!=typeof e[o]?(r.length>1?","+t:t)+o+t+":"+$C(e[o],t):"");return r+"}"}return""+e},WC={serialize:$C,parse:function(e){try{return JSON.parse(e)}catch(e){}}},KC={callbacks:{},count:0,send:function(e){var t=this,n=Zi.DOM,r=void 0!==e.count?e.count:t.count,i="tinymce_jsonp_"+r;t.callbacks[r]=function(o){n.remove(i),delete t.callbacks[r],e.callback(o)},n.add(n.doc.body,"script",{id:i,src:e.url,type:"text/javascript"}),t.count++}},XC={send:function(e){var t,n=0,r=function(){!e.async||4===t.readyState||n++>1e4?(e.success&&n<1e4&&200===t.status?e.success.call(e.success_scope,""+t.responseText,t,e):e.error&&e.error.call(e.error_scope,n>1e4?"TIMED_OUT":"GENERAL",t,e),t=null):setTimeout(r,10)};if(e.scope=e.scope||this,e.success_scope=e.success_scope||e.scope,e.error_scope=e.error_scope||e.scope,e.async=!1!==e.async,e.data=e.data||"",XC.fire("beforeInitialize",{settings:e}),t=new dm){if(t.overrideMimeType&&t.overrideMimeType(e.content_type),t.open(e.type||(e.data?"POST":"GET"),e.url,e.async),e.crossDomain&&(t.withCredentials=!0),e.content_type&&t.setRequestHeader("Content-Type",e.content_type),e.requestheaders&&Dt.each(e.requestheaders,function(e){t.setRequestHeader(e.key,e.value)}),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),(t=XC.fire("beforeSend",{xhr:t,settings:e}).xhr).send(e.data),!e.async)return r();setTimeout(r,10)}}};Dt.extend(XC,Nh);var YC=Dt.extend,GC=function(e){this.settings=YC({},e),this.count=0};GC.sendRPC=function(e){return(new GC).send(e)},GC.prototype={send:function(e){var t=e.error,n=e.success;(e=YC(this.settings,e)).success=function(r,i){void 0===(r=WC.parse(r))&&(r={error:"JSON Parse error."}),r.error?t.call(e.error_scope||e.scope,r.error,i):n.call(e.success_scope||e.scope,r.result)},e.error=function(n,r){t&&t.call(e.error_scope||e.scope,n,r)},e.data=WC.serialize({id:e.id||"c"+this.count++,method:e.method,params:e.params}),e.content_type="application/json",XC.send(e)}};var ZC=window.localStorage,QC=kC,JC={geom:{Rect:IC},util:{Promise:ce,Delay:me,Tools:Dt,VK:sp,URI:Hy,Class:zC,EventDispatcher:wh,Observable:Nh,I18n:mC,XHR:XC,JSON:WC,JSONRequest:GC,JSONP:KC,LocalStorage:ZC,Color:function(e){var t={},n=0,r=0,i=0,o=function(e){var o;return"object"==typeof e?"r"in e?(n=e.r,r=e.g,i=e.b):"v"in e&&function(e,t,o){var a,s,u,l;if(e=(parseInt(e,10)||0)%360,t=parseInt(t,10)/100,o=parseInt(o,10)/100,t=jC(0,UC(t,1)),o=jC(0,UC(o,1)),0!==t){switch(a=e/60,u=(s=o*t)*(1-Math.abs(a%2-1)),l=o-s,Math.floor(a)){case 0:n=s,r=u,i=0;break;case 1:n=u,r=s,i=0;break;case 2:n=0,r=s,i=u;break;case 3:n=0,r=u,i=s;break;case 4:n=u,r=0,i=s;break;case 5:n=s,r=0,i=u;break;default:n=r=i=0}n=VC(255*(n+l)),r=VC(255*(r+l)),i=VC(255*(i+l))}else n=r=i=VC(255*o)}(e.h,e.s,e.v):(o=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(e))?(n=parseInt(o[1],10),r=parseInt(o[2],10),i=parseInt(o[3],10)):(o=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(e))?(n=parseInt(o[1],16),r=parseInt(o[2],16),i=parseInt(o[3],16)):(o=/#([0-F])([0-F])([0-F])/gi.exec(e))&&(n=parseInt(o[1]+o[1],16),r=parseInt(o[2]+o[2],16),i=parseInt(o[3]+o[3],16)),n=n<0?0:n>255?255:n,r=r<0?0:r>255?255:r,i=i<0?0:i>255?255:i,t};return e&&o(e),t.toRgb=function(){return{r:n,g:r,b:i}},t.toHsv=function(){return function(e,t,n){var r,i,o,a;return i=0,(o=UC(e/=255,UC(t/=255,n/=255)))===(a=jC(e,jC(t,n)))?{h:0,s:0,v:100*(i=o)}:(r=(a-o)/a,i=a,{h:VC(60*((e===o?3:n===o?1:5)-(e===o?t-n:n===o?e-t:n-e)/(a-o))),s:VC(100*r),v:VC(100*i)})}(n,r,i)},t.toHex=function(){var e=function(e){return(e=parseInt(e,10).toString(16)).length>1?e:"0"+e};return"#"+e(n)+e(r)+e(i)},t.parse=o,t}},dom:{EventUtils:xe,Sizzle:at,DomQuery:Xt,TreeWalker:Vr,DOMUtils:Zi,ScriptLoader:no,RangeUtils:BC,Serializer:rv,ControlSelection:dv,BookmarkManager:uv,Selection:Qv,Event:xe.Event},html:{Styles:Ui,Entities:Di,Node:zg,Schema:qi,SaxParser:bp,DomParser:Qg,Writer:ju,Serializer:Vu},ui:{Factory:MC},Env:le,AddOnManager:io,Formatter:Sg,UndoManager:Op,EditorCommands:yh,WindowManager:rm,NotificationManager:nm,EditorObservable:Dh,Shortcuts:Fh,Editor:Jy,FocusManager:rC,EditorManager:kC,DOM:Zi.DOM,ScriptLoader:no.ScriptLoader,PluginManager:io.PluginManager,ThemeManager:io.ThemeManager,trim:Dt.trim,isArray:Dt.isArray,is:Dt.is,toArray:Dt.toArray,makeMap:Dt.makeMap,each:Dt.each,map:Dt.map,grep:Dt.grep,inArray:Dt.inArray,extend:Dt.extend,create:Dt.create,walk:Dt.walk,createNS:Dt.createNS,resolve:Dt.resolve,explode:Dt.explode,_addCacheSuffix:Dt._addCacheSuffix,isOpera:le.opera,isWebKit:le.webkit,isIE:le.ie,isGecko:le.gecko,isMac:le.mac},ew=QC=Dt.extend(QC,JC);!function(e){window.tinymce=e,window.tinyMCE=e}(ew),function(t){try{e.exports=t}catch(e){}}(ew)}()}),HTMLEditor={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{attrs:{id:this.editorId},domProps:{innerHTML:this._s(this.value)}})},staticRenderFns:[],_scopeId:"data-v-58a47308",name:"FireComponentHTMLEditor",props:{plugins:{type:Array,validator:e=>e.reduce((e,t)=>e&&"string"==typeof t,!0),default:()=>["print","preview","fullpage","powerpaste","searchreplace","autolink","directionality","advcode","visualblocks","visualchars","fullscreen","image","link","media","template","codesample","table","charmap","hr","pagebreak","nonbreaking","anchor","toc","insertdatetime","advlist","lists","textcolor","wordcount","tinymcespellchecker","a11ychecker","imagetools","mediaembed","linkchecker","contextmenu","colorpicker","textpattern","help"]},toolbar:{type:String,default:()=>"formatselect | bold italic strikethrough forecolor backcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat"},value:{type:String,required:!0}},data:()=>({editor:null}),mounted(){this.$nextTick(()=>{tinymce.init({selector:this.editorId,theme:"modern",mobile:{theme:"mobile"},plugins:this.plugins.join(" "),toolbar1:this.toolbar,init_instance_callback:this.setupEventTriggers})})},beforeDestroy(){this.destroy()},computed:{editorId(){return"firecomponent--html-editor--"+this.$uniqId},setupEventTriggers(e){this.editor=e,this.editor.on("Change",e=>{this.$emit("input",this.editor.getContent())})},destroy(){this.editor&&this.editor.destroy()}}},InlineEditor={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.customTag,{tag:"component",staticStyle:{width:"100%"},attrs:{title:e.title},on:{mouseover:e.startEdit,mouseleave:e.attemptStop}},[e.isEditing?n("div",{key:e.uniqueKey,ref:"editor",staticClass:"firecomponent--inline-editor",style:e.editorStyle,attrs:{contenteditable:"true"},on:{blur:e.stopEdit,input:e.contentChangeEventHandler}},[e._v(" "+e._s(e.value)+" ")]):e._t("display",[e._v(" "+e._s(e.value)+" ")],{content:e.value})],2)},staticRenderFns:[],_scopeId:"data-v-8691ead4",name:"FireComponentInlineEditor",props:{value:{type:[String,Number],required:!0},editable:{required:!0,type:[Boolean]},customTag:{type:[String],default:"span"},editorStyle:{type:[Object],default:()=>Object.create(null)}},data(){return{uniqueKey:"firecomponent--inline-editor--"+this.$uniqId,isEditing:!1}},computed:{title(){return this.editable?"Click to Edit":null}},methods:{contentChangeEventHandler(e){this.$emit("input",e)},startEdit(e){this.isEditing=this.editable},stopEdit(e){this.isEditing=!1},attemptStop(e){this.isEditing=this.$refs.editor===document.activeElement}}};function ImageBus(e){this.bus=new e,this.newUpload=function(...e){bus.$emit("newUpload",...e)}}function FireMessenger(e){this.bus=new e,this.send=function(e){bus.$emit(e)},this.save=function(){this.send("save")},this.reset=function(){this.send("reset")}}function install(e,t){if("object"==typeof t){e.prototype.$firebase=t,e.prototype.$imageBus=new ImageBus(e),e.prototype.$messenger=new FireMessenger(e),Object.defineProperty(e.prototype,"$uniqId",{get(){return this._uid}});var n="firecomponent--image-editor",r=window.document.createElement("div");r.id=n,window.document.body.appendChild(r),new e({el:"#"+n,render:e=>e(ImageEditor)}),e.component("fire-text",component),e.component("fire-html",FireHtml),e.component("fire-image",FireImage),e.component("fire-input",FireInput),e.component("fire-html-editor",HTMLEditor),e.component("fire-inline-editor",InlineEditor)}else console.error("You must add your firebase configuration object to the firecomponent library")}var plugin={install:install},GlobalVue=null;"undefined"!=typeof window?GlobalVue=window.Vue:"undefined"!=typeof global&&(GlobalVue=global.Vue),GlobalVue&&(GlobalVue.initializeApp=function(e){Vue.use(plugin,e)}),exports.install=install,exports.FireHtml=FireHtml,exports.FireText=component,exports.FireImage=FireImage,exports.FireInput=FireInput,exports.default=plugin;
